
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<script src="leaflet.js" ></script>
	<link rel="stylesheet" type="text/css" href="leaflet.css" />

	<!-- <script src="http://cdn.leafletjs.com/leaflet-0.4.5/lseaflet.js"></script> -->
	<!-- <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4.5/leaflet.css"/> -->
	<!-- <script src="OSMBuildings-Leaflet.js"></script> -->
	<script src="https://cdn.osmbuildings.org/classic/0.2.2b/OSMBuildings-Leaflet.js"></script>
	<script src="OSMBuildings-Leaflet.js"></script>
	<link rel="stylesheet" type="text/css" href="leaflet.draw.css" />
	<link href="style33.css" rel="stylesheet">  <!-- cette ligne fait la liaison entre notre page html et notre code CSS...on la dÃ©clare entre les balises "head" -->
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"/>
	<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css"/>
	<!-- <link rel="stylesheet" type="text/css" href="leaflet.toolbar.css" /> -->
	<link rel="stylesheet" href="bootstrap.min.css"/>
	<link rel="stylesheet" href="bootstrap-theme.min.css"/>
    <!-- <link rel="stylesheet" href="leaflet.draw-toolbar.css"/> -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script src="jquery.min.js"></script>
	<script src="bootstrap.min.js"></script>
	<script src="leaflet-src.js"></script>
	<!-- <script src="leaflet.toolbar-src.js"></script>
	<script src="leaflet.draw-src.js"></script>
    <script src="leaflet.draw-toolbar.js"></script> -->

	
    
	<script src='Leaflet.fullscreen.js'></script>
    <script src='Leaflet.fullscreen.min.js'></script>
    <link href='leaflet.fullscreen.css' rel='stylesheet' />
    <script src='turf.min.js'></script>
    <link href='leaflet.measure.css' rel='stylesheet' />
    <script src='measureInt.js'></script>
    <link rel="stylesheet" href="L.Control.ZoomBox.css" />
    <!-- <script src="js/L.Control.ZoomBox.min.js"></script> -->
	    <script src="zoomBox2.js"></script>

    <!-- <script src="tableaux2.js"></script> -->
    <script src="proj4.js"></script>
    <script src="proj4js-compressed.js"></script>
    <script src="jquery.min.js"></script>
    <script src="proj4leaflet.js"></script>
    <script src="print.min.js"></script>
    <link rel="stylesheet" type="text/css" href="print.min.css">
    <script src="jspdf.umd.min.js"></script>
    <script src="html2canvas.min.js"></script>
    <script src="runtime.js"></script>
    <script src="t-arcgis.umd.js"></script>
    <script src="leaflet-topography.js"></script>
    <script src="Path.Drag.min.js"></script>
    <script src="sorttable.js"></script>
    <!-- <script src="couches3.js"></script> -->
    <!-- <script src="geologie.js"></script> -->
    <script src="shp.js"></script>
    <script src="xlsx.full.min.js"></script>
		<link rel="stylesheet" href="leaflet.draw2.css" />
		<link rel="stylesheet" href="leaflet-measure-path.css" />
		<script type="text/javascript" src="leaflet.draw-src.js"></script>
		<script src="editable.js" ></script>
		<script src="measure.js"></script>
		<script src="leaflet.MeasurePolygon.js"></script>
		<script src="Leaflet.Editable.js"></script>
		<script src="Chart.js"></script>
		<script src="Edit.Poly.Drag.js"></script>


		<!-- <script src="https://cdn.jsdelivr.net/npm/leaflet-pixi-overlay@1.9.4/L.PixiOverlay.min.js"></script> -->
		<script src="leaflet.conditionalmarkers.js"></script>
		<!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> -->
		<!-- <script src="sweetalert2@11"></script> -->

		<script src="sweetalert2.all.min.js"></script>
		<link rel="stylesheet" href="sweetalert2.min.css">


		<script src="proj42.js"></script>
		<script src="jszip.js"></script>

		<script src="jszip-utils.js"></script>
		<!--[if IE]>
		<script type="text/javascript" src="lib/jszip-utils-ie.js"></script>
		<![endif]-->

		<script src="preprocess.js"></script>
		<script src="preview.js"></script>

		<script src="leaflet.toolbar.js"></script>
<script src="leaflet.draw-toolbar.js"></script>
<link rel="stylesheet" href="leaflet.toolbar.css"/>
<link rel="stylesheet" href="leaflet.draw-toolbar.css"/>
<!-- <script src="node_modules/leaflet-toolbar/dist/leaflet.toolbar.js"></script>
<script src="node_modules/leaflet-draw-toolbar/dist/leaflet.draw-toolbar.js"></script>
<link rel="stylesheet" href="node_modules/leaflet-toolbar/dist/leaflet.toolbar.css"/>
<link rel="stylesheet" href="node_modules/leaflet-draw-toolbar/dist/leaflet.draw-toolbar.css"/> -->

<script src="FileSaver.min.js"></script>
<script src="shpwrite.js"></script>

<script src="heatmap.js"></script>

<script src="leaflet-heatmap.js"></script>
<script src="leaflet-heat.js"></script>
<script src="HeatLayer.js"></script>
<link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.css" />
<!-- <link rel="stylesheet" href="leaflet-elevation.css" /> -->
<script src="https://unpkg.com/@raruto/leaflet-elevation/dist/leaflet-elevation.js"></script>
<!-- <script src="leaflet-elevation.js"></script> -->

<script src="leaflet-idw-directdraw.js"></script>
<script src="https://unpkg.com/leaflet.minichart/dist/leaflet.minichart.min.js" charset="utf-8"></script>
<script src="leaflet.minichart.min.js" charset="utf-8"></script>
<link rel="stylesheet" href="leaflet.legend.css" />
<script type="text/javascript" src="leaflet.legend.js"></script>
<script type="text/javascript" src="L.Control.AccordionLegend.js"></script>
<link rel="stylesheet" type="text/css" href="L.Control.AccordionLegend.css" />



<!-- <script src="leaflet-webgl-heatmap.js"></script> -->



	<style>
		html, body, #map { margin: 0; height: 100%; width: 100%; }
	</style>
</head>
<body style="background-image: url('abstract.jpg');">
	<div style="margin-left:3vh;margin-right:3vh">
		<div class="row">
		  <div class="col-md-4">
			<div class="row" >
				<div class="col-md-12" style="height:50vh;border:0.2vh solid;">
				  
				  <div id="tableSp" style="height: 48vh; overflow-x: scroll;margin-top:1vh"></div>
				</div>
				<div class="col-md-12" style="height:50vh;border:0.2vh solid;" >
					<h3 style="margin:1vh">Selection</h3>
				  <div  id="slcSp2" style="height: 35vh; overflow-x: scroll;margin-top:1vh"></div>
				  <div style="margin-top:2vh;">
					<input class="form-control btn btn-success" type="submit" id="btn" value="Modify" style="width:9.5vh;font-size:3vh;padding:0"  onclick="fnselect()">
					<span><input class="form-control btn btn-warning" type="submit" id="btn2" value="Save" style="margin-left:0.2vh;width:7.5vh;font-size:3vh;padding:0;"  onclick="upd()" >
					<input class="form-control btn btn-primary" type="submit" id="btn22" value="Clear Selection" style="margin-left:0.2vh;width:16vh;font-size:2.25vh;padding:0"  onclick="clearslc()" >
					<input class="form-control btn btn-danger" type="submit" id="btn23" value="Delete Selection" style="margin-left:0.2vh;width:17vh;font-size:2.25vh;padding:0"  onclick="deletepr(0)" >
					<input class="form-control btn btn-danger" type="submit" id="btn24" value="Delete All" style="margin-left:0.2vh;width:12vh;font-size:2.5vh;padding:0"  onclick="deletepr(1)" >
					<!-- <input class="form-control btn btn-secondary" type="submit" id="btn25" value="Slct tout" style="margin-left:5px;width:17%;font-size:13px;text-align:center;"  onclick="slctall()" > -->
				
				  </span>
					</div>
				</div>
			  </div>
		  </div>
		  <div class="col-md-2">
			<div class="row">
				<div class="col-md-12" style="height:30vh;border:0.2vh solid;background-color:beige" id="TableList">
				  <h2 style="margin-top:0">Tables</h2>
				</div>
				<div class="col-md-12" style="height:70vh;border:0.2vh solid;background-color:rgb(144, 176, 121)" id="layersList">
				  <h2 style="margin-top:0">Layers<span><input type="button" class="btn btn-success" style="height:5vh;float:right;margin:1vh" onclick="swalCreate()" value="Create"></span></h2>
				  <ul id="dragList" class="drag-list">
        
				  </ul>
				</div>
			  </div>
		  </div>
		  <div class="col-md-6">
			<div class="row">
				<div class="col-md-12" style="height:6vh;border:0.2vh solid">
					<div style="margin-top:1vh">
						<form method="post" enctype="multipart/form-data" id="form">
							<label class="btn btn-warning" style="color:black;height:4vh;padding: 0px;">
								<input type="file" style="display: none;" name="file4" id="excel_file" multiple="multiple" style="color:transparent"/>
								<span><img src="arrow.png" alt="carte" style="width:4vh;height:4vh;">
								</span> Upload File <span id="animate" class="animate">(JSON/Shapefile(.shp)/Excel(.xslx/.xls/.ods))</span> 
							</label>
						</form>	
					</div>
								
				</div>
				<div class="col-md-12" style="height:16vh;border:0.2vh solid">
						
						<div class="row" >
							<div class="col-md-5" style="height:16vh;border:0.2vh solid;">
								<div class="dbgOuter2" style="margin-top:1vh">
									<label for="country1" style="float:left;margin-top:1vh">Country</label>
								<select id="country1" name="country" class="form-control" style="width:15vh;margin-left:25vh;">
								<option value="Afghanistan">World</option>
										  <option value="Afghanistan">Afghanistan</option>
										  <option value="Aland Islands">Aland Islands</option>
										  <option value="Albania">Albania</option>
										  <option value="Algeria">Algeria</option>
										  <option value="American Samoa">American Samoa</option>
										  <option value="Andorra">Andorra</option>
										  <option value="Angola">Angola</option>
										  <option value="Anguilla">Anguilla</option>
										  <option value="Antarctica">Antarctica</option>
										  <option value="Antigua and Barbuda">Antigua and Barbuda</option>
										  <option value="Argentina">Argentina</option>
										  <option value="Armenia">Armenia</option>
										  <option value="Aruba">Aruba</option>
										  <option value="Australia">Australia</option>
										  <option value="Austria">Austria</option>
										  <option value="Azerbaijan">Azerbaijan</option>
										  <option value="Bahamas">Bahamas</option>
										  <option value="Bahrain">Bahrain</option>
										  <option value="Bangladesh">Bangladesh</option>
										  <option value="Barbados">Barbados</option>
										  <option value="Belarus">Belarus</option>
										  <option value="Belgium">Belgium</option>
										  <option value="Belize">Belize</option>
										  <option value="Benin">Benin</option>
										  <option value="Bermuda">Bermuda</option>
										  <option value="Bhutan">Bhutan</option>
										  <option value="Bolivia">Bolivia</option>
										  <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
										  <option value="Botswana">Botswana</option>
										  <option value="Bouvet Island">Bouvet Island</option>
										  <option value="Brazil">Brazil</option>
										  <option value="British Indian Ocean Territory">British Indian Ocean Territory</option>
										  <option value="Brunei Darussalam">Brunei Darussalam</option>
										  <option value="Bulgaria">Bulgaria</option>
										  <option value="Burkina Faso">Burkina Faso</option>
										  <option value="Burundi">Burundi</option>
										  <option value="Cambodia">Cambodia</option>
										  <option value="Cameroon">Cameroon</option>
										  <option value="Canada">Canada</option>
										  <option value="Cape Verde">Cape Verde</option>
										  <option value="Cayman Islands">Cayman Islands</option>
										  <option value="Central African Republic">Central African Republic</option>
										  <option value="Chad">Chad</option>
										  <option value="Chile">Chile</option>
										  <option value="China">China</option>
										  <option value="Christmas Island">Christmas Island</option>
										  <option value="Cocos (Keeling) Islands">Cocos (Keeling) Islands</option>
										  <option value="Colombia">Colombia</option>
										  <option value="Comoros">Comoros</option>
										  <option value="Congo">Congo</option>
										  <option value="Congo, The Democratic Republic of The">Congo, The Democratic Republic of The</option>
										  <option value="Cook Islands">Cook Islands</option>
										  <option value="Costa Rica">Costa Rica</option>
										  <option value="Cote D'ivoire">Cote D'ivoire</option>
										  <option value="Croatia">Croatia</option>
										  <option value="Cuba">Cuba</option>
										  <option value="Cyprus">Cyprus</option>
										  <option value="Czech Republic">Czech Republic</option>
										  <option value="Denmark">Denmark</option>
										  <option value="Djibouti">Djibouti</option>
										  <option value="Dominica">Dominica</option>
										  <option value="Dominican Republic">Dominican Republic</option>
										  <option value="Ecuador">Ecuador</option>
										  <option value="Egypt">Egypt</option>
										  <option value="El Salvador">El Salvador</option>
										  <option value="Equatorial Guinea">Equatorial Guinea</option>
										  <option value="Eritrea">Eritrea</option>
										  <option value="Estonia">Estonia</option>
										  <option value="Ethiopia">Ethiopia</option>
										  <option value="Falkland Islands (Malvinas)">Falkland Islands (Malvinas)</option>
										  <option value="Faroe Islands">Faroe Islands</option>
										  <option value="Fiji">Fiji</option>
										  <option value="Finland">Finland</option>
										  <option value="France">France</option>
										  <option value="French Guiana">French Guiana</option>
										  <option value="French Polynesia">French Polynesia</option>
										  <option value="French Southern Territories">French Southern Territories</option>
										  <option value="Gabon">Gabon</option>
										  <option value="Gambia">Gambia</option>
										  <option value="Georgia">Georgia</option>
										  <option value="Germany">Germany</option>
										  <option value="Ghana">Ghana</option>
										  <option value="Gibraltar">Gibraltar</option>
										  <option value="Greece">Greece</option>
										  <option value="Greenland">Greenland</option>
										  <option value="Grenada">Grenada</option>
										  <option value="Guadeloupe">Guadeloupe</option>
										  <option value="Guam">Guam</option>
										  <option value="Guatemala">Guatemala</option>
										  <option value="Guernsey">Guernsey</option>
										  <option value="Guinea">Guinea</option>
										  <option value="Guinea-bissau">Guinea-bissau</option>
										  <option value="Guyana">Guyana</option>
										  <option value="Haiti">Haiti</option>
										  <option value="Heard Island and Mcdonald Islands">Heard Island and Mcdonald Islands</option>
										  <option value="Holy See (Vatican City State)">Holy See (Vatican City State)</option>
										  <option value="Honduras">Honduras</option>
										  <option value="Hong Kong">Hong Kong</option>
										  <option value="Hungary">Hungary</option>
										  <option value="Iceland">Iceland</option>
										  <option value="India">India</option>
										  <option value="Indonesia">Indonesia</option>
										  <option value="Iran, Islamic Republic of">Iran, Islamic Republic of</option>
										  <option value="Iraq">Iraq</option>
										  <option value="Ireland">Ireland</option>
										  <option value="Isle of Man">Isle of Man</option>
										  <option value="Israel">Israel</option>
										  <option value="Italy">Italy</option>
										  <option value="Jamaica">Jamaica</option>
										  <option value="Japan">Japan</option>
										  <option value="Jersey">Jersey</option>
										  <option value="Jordan">Jordan</option>
										  <option value="Kazakhstan">Kazakhstan</option>
										  <option value="Kenya">Kenya</option>
										  <option value="Kiribati">Kiribati</option>
										  <option value="Korea, Democratic People's Republic of">Korea, Democratic People's Republic of</option>
										  <option value="Korea, Republic of">Korea, Republic of</option>
										  <option value="Kuwait">Kuwait</option>
										  <option value="Kyrgyzstan">Kyrgyzstan</option>
										  <option value="Lao People's Democratic Republic">Lao People's Democratic Republic</option>
										  <option value="Latvia">Latvia</option>
										  <option value="Lebanon">Lebanon</option>
										  <option value="Lesotho">Lesotho</option>
										  <option value="Liberia">Liberia</option>
										  <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option>
										  <option value="Liechtenstein">Liechtenstein</option>
										  <option value="Lithuania">Lithuania</option>
										  <option value="Luxembourg">Luxembourg</option>
										  <option value="Macao">Macao</option>
										  <option value="Macedonia, The Former Yugoslav Republic of">Macedonia, The Former Yugoslav Republic of</option>
										  <option value="Madagascar">Madagascar</option>
										  <option value="Malawi">Malawi</option>
										  <option value="Malaysia">Malaysia</option>
										  <option value="Maldives">Maldives</option>
										  <option value="Mali">Mali</option>
										  <option value="Malta">Malta</option>
										  <option value="Marshall Islands">Marshall Islands</option>
										  <option value="Martinique">Martinique</option>
										  <option value="Mauritania">Mauritania</option>
										  <option value="Mauritius">Mauritius</option>
										  <option value="Mayotte">Mayotte</option>
										  <option value="Mexico">Mexico</option>
										  <option value="Micronesia, Federated States of">Micronesia, Federated States of</option>
										  <option value="Moldova, Republic of">Moldova, Republic of</option>
										  <option value="Monaco">Monaco</option>
										  <option value="Mongolia">Mongolia</option>
										  <option value="Montenegro">Montenegro</option>
										  <option value="Montserrat">Montserrat</option>
										  <option value="Morocco">Morocco</option>
										  <option value="Mozambique">Mozambique</option>
										  <option value="Myanmar">Myanmar</option>
										  <option value="Namibia">Namibia</option>
										  <option value="Nauru">Nauru</option>
										  <option value="Nepal">Nepal</option>
										  <option value="Netherlands">Netherlands</option>
										  <option value="Netherlands Antilles">Netherlands Antilles</option>
										  <option value="New Caledonia">New Caledonia</option>
										  <option value="New Zealand">New Zealand</option>
										  <option value="Nicaragua">Nicaragua</option>
										  <option value="Niger">Niger</option>
										  <option value="Nigeria">Nigeria</option>
										  <option value="Niue">Niue</option>
										  <option value="Norfolk Island">Norfolk Island</option>
										  <option value="Northern Mariana Islands">Northern Mariana Islands</option>
										  <option value="Norway">Norway</option>
										  <option value="Oman">Oman</option>
										  <option value="Pakistan">Pakistan</option>
										  <option value="Palau">Palau</option>
										  <option value="Palestinian Territory, Occupied">Palestinian Territory, Occupied</option>
										  <option value="Panama">Panama</option>
										  <option value="Papua New Guinea">Papua New Guinea</option>
										  <option value="Paraguay">Paraguay</option>
										  <option value="Peru">Peru</option>
										  <option value="Philippines">Philippines</option>
										  <option value="Pitcairn">Pitcairn</option>
										  <option value="Poland">Poland</option>
										  <option value="Portugal">Portugal</option>
										  <option value="Puerto Rico">Puerto Rico</option>
										  <option value="Qatar">Qatar</option>
										  <option value="Reunion">Reunion</option>
										  <option value="Romania">Romania</option>
										  <option value="Russian Federation">Russian Federation</option>
										  <option value="Rwanda">Rwanda</option>
										  <option value="Saint Helena">Saint Helena</option>
										  <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
										  <option value="Saint Lucia">Saint Lucia</option>
										  <option value="Saint Pierre and Miquelon">Saint Pierre and Miquelon</option>
										  <option value="Saint Vincent and The Grenadines">Saint Vincent and The Grenadines</option>
										  <option value="Samoa">Samoa</option>
										  <option value="San Marino">San Marino</option>
										  <option value="Sao Tome and Principe">Sao Tome and Principe</option>
										  <option value="Saudi Arabia">Saudi Arabia</option>
										  <option value="Senegal">Senegal</option>
										  <option value="Serbia">Serbia</option>
										  <option value="Seychelles">Seychelles</option>
										  <option value="Sierra Leone">Sierra Leone</option>
										  <option value="Singapore">Singapore</option>
										  <option value="Slovakia">Slovakia</option>
										  <option value="Slovenia">Slovenia</option>
										  <option value="Solomon Islands">Solomon Islands</option>
										  <option value="Somalia">Somalia</option>
										  <option value="South Africa">South Africa</option>
										  <option value="South Georgia and The South Sandwich Islands">South Georgia and The South Sandwich Islands</option>
										  <option value="Spain">Spain</option>
										  <option value="Sri Lanka">Sri Lanka</option>
										  <option value="Sudan">Sudan</option>
										  <option value="Suriname">Suriname</option>
										  <option value="Svalbard and Jan Mayen">Svalbard and Jan Mayen</option>
										  <option value="Swaziland">Swaziland</option>
										  <option value="Sweden">Sweden</option>
										  <option value="Switzerland">Switzerland</option>
										  <option value="Syrian Arab Republic">Syrian Arab Republic</option>
										  <option value="Taiwan">Taiwan</option>
										  <option value="Tajikistan">Tajikistan</option>
										  <option value="Tanzania, United Republic of">Tanzania, United Republic of</option>
										  <option value="Thailand">Thailand</option>
										  <option value="Timor-leste">Timor-leste</option>
										  <option value="Togo">Togo</option>
										  <option value="Tokelau">Tokelau</option>
										  <option value="Tonga">Tonga</option>
										  <option value="Trinidad and Tobago">Trinidad and Tobago</option>
										  <option value="Tunisia">Tunisia</option>
										  <option value="Turkey">Turkey</option>
										  <option value="Turkmenistan">Turkmenistan</option>
										  <option value="Turks and Caicos Islands">Turks and Caicos Islands</option>
										  <option value="Tuvalu">Tuvalu</option>
										  <option value="Uganda">Uganda</option>
										  <option value="Ukraine">Ukraine</option>
										  <option value="United Arab Emirates">United Arab Emirates</option>
										  <option value="United Kingdom">United Kingdom</option>
										  <option value="United States">United States</option>
										  <option value="United States Minor Outlying Islands">United States Minor Outlying Islands</option>
										  <option value="Uruguay">Uruguay</option>
										  <option value="Uzbekistan">Uzbekistan</option>
										  <option value="Vanuatu">Vanuatu</option>
										  <option value="Venezuela">Venezuela</option>
										  <option value="Viet Nam">Viet Nam</option>
										  <option value="Virgin Islands, British">Virgin Islands, British</option>
										  <option value="Virgin Islands, U.S.">Virgin Islands, U.S.</option>
										  <option value="Wallis and Futuna">Wallis and Futuna</option>
										  <option value="Yemen">Yemen</option>
										  <option value="Zambia">Zambia</option>
										  <option value="Zimbabwe">Zimbabwe</option>
									  </select>      
									
										
									</div>
									<div class="dbgOuter2" style="margin-top:1vh" >
										<label for="country2" style="float:left;margin-top:1vh">Coordinates System</label>
									<select id="country2" name="country" class="form-control" style="width:15vh;margin-left:25vh;">
									<option value="4326">WGS</option>
											  <option value="Afghanistan">Afghanistan</option>
											  <option value="Aland Islands">Aland Islands</option>
											  <option value="Albania">Albania</option>
											  <option value="Algeria">Algeria</option>
											  <option value="American Samoa">American Samoa</option>
											  <option value="Andorra">Andorra</option>
											  <option value="Angola">Angola</option>
											  <option value="Anguilla">Anguilla</option>
											  <option value="Antarctica">Antarctica</option>
											  <option value="Antigua and Barbuda">Antigua and Barbuda</option>
											  <option value="Argentina">Argentina</option>
											  <option value="Armenia">Armenia</option>
											  <option value="Aruba">Aruba</option>
											  <option value="Australia">Australia</option>
											  <option value="Austria">Austria</option>
											  <option value="Azerbaijan">Azerbaijan</option>
											  <option value="Bahamas">Bahamas</option>
											  <option value="Bahrain">Bahrain</option>
											  <option value="Bangladesh">Bangladesh</option>
											  <option value="Barbados">Barbados</option>
											  <option value="Belarus">Belarus</option>
											  <option value="Belgium">Belgium</option>
											  <option value="Belize">Belize</option>
											  <option value="Benin">Benin</option>
											  <option value="Bermuda">Bermuda</option>
											  <option value="Bhutan">Bhutan</option>
											  <option value="Bolivia">Bolivia</option>
											  <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
											  <option value="Botswana">Botswana</option>
											  <option value="Bouvet Island">Bouvet Island</option>
											  <option value="Brazil">Brazil</option>
											  <option value="British Indian Ocean Territory">British Indian Ocean Territory</option>
											  <option value="Brunei Darussalam">Brunei Darussalam</option>
											  <option value="Bulgaria">Bulgaria</option>
											  <option value="Burkina Faso">Burkina Faso</option>
											  <option value="Burundi">Burundi</option>
											  <option value="Cambodia">Cambodia</option>
											  <option value="Cameroon">Cameroon</option>
											  <option value="Canada">Canada</option>
											  <option value="Cape Verde">Cape Verde</option>
											  <option value="Cayman Islands">Cayman Islands</option>
											  <option value="Central African Republic">Central African Republic</option>
											  <option value="Chad">Chad</option>
											  <option value="Chile">Chile</option>
											  <option value="China">China</option>
											  <option value="Christmas Island">Christmas Island</option>
											  <option value="Cocos (Keeling) Islands">Cocos (Keeling) Islands</option>
											  <option value="Colombia">Colombia</option>
											  <option value="Comoros">Comoros</option>
											  <option value="Congo">Congo</option>
											  <option value="Congo, The Democratic Republic of The">Congo, The Democratic Republic of The</option>
											  <option value="Cook Islands">Cook Islands</option>
											  <option value="Costa Rica">Costa Rica</option>
											  <option value="Cote D'ivoire">Cote D'ivoire</option>
											  <option value="Croatia">Croatia</option>
											  <option value="Cuba">Cuba</option>
											  <option value="Cyprus">Cyprus</option>
											  <option value="Czech Republic">Czech Republic</option>
											  <option value="Denmark">Denmark</option>
											  <option value="Djibouti">Djibouti</option>
											  <option value="Dominica">Dominica</option>
											  <option value="Dominican Republic">Dominican Republic</option>
											  <option value="Ecuador">Ecuador</option>
											  <option value="Egypt">Egypt</option>
											  <option value="El Salvador">El Salvador</option>
											  <option value="Equatorial Guinea">Equatorial Guinea</option>
											  <option value="Eritrea">Eritrea</option>
											  <option value="Estonia">Estonia</option>
											  <option value="Ethiopia">Ethiopia</option>
											  <option value="Falkland Islands (Malvinas)">Falkland Islands (Malvinas)</option>
											  <option value="Faroe Islands">Faroe Islands</option>
											  <option value="Fiji">Fiji</option>
											  <option value="Finland">Finland</option>
											  <option value="France">France</option>
											  <option value="French Guiana">French Guiana</option>
											  <option value="French Polynesia">French Polynesia</option>
											  <option value="French Southern Territories">French Southern Territories</option>
											  <option value="Gabon">Gabon</option>
											  <option value="Gambia">Gambia</option>
											  <option value="Georgia">Georgia</option>
											  <option value="Germany">Germany</option>
											  <option value="Ghana">Ghana</option>
											  <option value="Gibraltar">Gibraltar</option>
											  <option value="Greece">Greece</option>
											  <option value="Greenland">Greenland</option>
											  <option value="Grenada">Grenada</option>
											  <option value="Guadeloupe">Guadeloupe</option>
											  <option value="Guam">Guam</option>
											  <option value="Guatemala">Guatemala</option>
											  <option value="Guernsey">Guernsey</option>
											  <option value="Guinea">Guinea</option>
											  <option value="Guinea-bissau">Guinea-bissau</option>
											  <option value="Guyana">Guyana</option>
											  <option value="Haiti">Haiti</option>
											  <option value="Heard Island and Mcdonald Islands">Heard Island and Mcdonald Islands</option>
											  <option value="Holy See (Vatican City State)">Holy See (Vatican City State)</option>
											  <option value="Honduras">Honduras</option>
											  <option value="Hong Kong">Hong Kong</option>
											  <option value="Hungary">Hungary</option>
											  <option value="Iceland">Iceland</option>
											  <option value="India">India</option>
											  <option value="Indonesia">Indonesia</option>
											  <option value="Iran, Islamic Republic of">Iran, Islamic Republic of</option>
											  <option value="Iraq">Iraq</option>
											  <option value="Ireland">Ireland</option>
											  <option value="Isle of Man">Isle of Man</option>
											  <option value="Israel">Israel</option>
											  <option value="Italy">Italy</option>
											  <option value="Jamaica">Jamaica</option>
											  <option value="Japan">Japan</option>
											  <option value="Jersey">Jersey</option>
											  <option value="Jordan">Jordan</option>
											  <option value="Kazakhstan">Kazakhstan</option>
											  <option value="Kenya">Kenya</option>
											  <option value="Kiribati">Kiribati</option>
											  <option value="Korea, Democratic People's Republic of">Korea, Democratic People's Republic of</option>
											  <option value="Korea, Republic of">Korea, Republic of</option>
											  <option value="Kuwait">Kuwait</option>
											  <option value="Kyrgyzstan">Kyrgyzstan</option>
											  <option value="Lao People's Democratic Republic">Lao People's Democratic Republic</option>
											  <option value="Latvia">Latvia</option>
											  <option value="Lebanon">Lebanon</option>
											  <option value="Lesotho">Lesotho</option>
											  <option value="Liberia">Liberia</option>
											  <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option>
											  <option value="Liechtenstein">Liechtenstein</option>
											  <option value="Lithuania">Lithuania</option>
											  <option value="Luxembourg">Luxembourg</option>
											  <option value="Macao">Macao</option>
											  <option value="Macedonia, The Former Yugoslav Republic of">Macedonia, The Former Yugoslav Republic of</option>
											  <option value="Madagascar">Madagascar</option>
											  <option value="Malawi">Malawi</option>
											  <option value="Malaysia">Malaysia</option>
											  <option value="Maldives">Maldives</option>
											  <option value="Mali">Mali</option>
											  <option value="Malta">Malta</option>
											  <option value="Marshall Islands">Marshall Islands</option>
											  <option value="Martinique">Martinique</option>
											  <option value="Mauritania">Mauritania</option>
											  <option value="Mauritius">Mauritius</option>
											  <option value="Mayotte">Mayotte</option>
											  <option value="Mexico">Mexico</option>
											  <option value="Micronesia, Federated States of">Micronesia, Federated States of</option>
											  <option value="Moldova, Republic of">Moldova, Republic of</option>
											  <option value="Monaco">Monaco</option>
											  <option value="Mongolia">Mongolia</option>
											  <option value="Montenegro">Montenegro</option>
											  <option value="Montserrat">Montserrat</option>
											  <option value="Morocco">Morocco</option>
											  <option value="Mozambique">Mozambique</option>
											  <option value="Myanmar">Myanmar</option>
											  <option value="Namibia">Namibia</option>
											  <option value="Nauru">Nauru</option>
											  <option value="Nepal">Nepal</option>
											  <option value="Netherlands">Netherlands</option>
											  <option value="Netherlands Antilles">Netherlands Antilles</option>
											  <option value="New Caledonia">New Caledonia</option>
											  <option value="New Zealand">New Zealand</option>
											  <option value="Nicaragua">Nicaragua</option>
											  <option value="Niger">Niger</option>
											  <option value="Nigeria">Nigeria</option>
											  <option value="Niue">Niue</option>
											  <option value="Norfolk Island">Norfolk Island</option>
											  <option value="Northern Mariana Islands">Northern Mariana Islands</option>
											  <option value="Norway">Norway</option>
											  <option value="Oman">Oman</option>
											  <option value="Pakistan">Pakistan</option>
											  <option value="Palau">Palau</option>
											  <option value="Palestinian Territory, Occupied">Palestinian Territory, Occupied</option>
											  <option value="Panama">Panama</option>
											  <option value="Papua New Guinea">Papua New Guinea</option>
											  <option value="Paraguay">Paraguay</option>
											  <option value="Peru">Peru</option>
											  <option value="Philippines">Philippines</option>
											  <option value="Pitcairn">Pitcairn</option>
											  <option value="Poland">Poland</option>
											  <option value="Portugal">Portugal</option>
											  <option value="Puerto Rico">Puerto Rico</option>
											  <option value="Qatar">Qatar</option>
											  <option value="Reunion">Reunion</option>
											  <option value="Romania">Romania</option>
											  <option value="Russian Federation">Russian Federation</option>
											  <option value="Rwanda">Rwanda</option>
											  <option value="Saint Helena">Saint Helena</option>
											  <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
											  <option value="Saint Lucia">Saint Lucia</option>
											  <option value="Saint Pierre and Miquelon">Saint Pierre and Miquelon</option>
											  <option value="Saint Vincent and The Grenadines">Saint Vincent and The Grenadines</option>
											  <option value="Samoa">Samoa</option>
											  <option value="San Marino">San Marino</option>
											  <option value="Sao Tome and Principe">Sao Tome and Principe</option>
											  <option value="Saudi Arabia">Saudi Arabia</option>
											  <option value="Senegal">Senegal</option>
											  <option value="Serbia">Serbia</option>
											  <option value="Seychelles">Seychelles</option>
											  <option value="Sierra Leone">Sierra Leone</option>
											  <option value="Singapore">Singapore</option>
											  <option value="Slovakia">Slovakia</option>
											  <option value="Slovenia">Slovenia</option>
											  <option value="Solomon Islands">Solomon Islands</option>
											  <option value="Somalia">Somalia</option>
											  <option value="South Africa">South Africa</option>
											  <option value="South Georgia and The South Sandwich Islands">South Georgia and The South Sandwich Islands</option>
											  <option value="Spain">Spain</option>
											  <option value="Sri Lanka">Sri Lanka</option>
											  <option value="Sudan">Sudan</option>
											  <option value="Suriname">Suriname</option>
											  <option value="Svalbard and Jan Mayen">Svalbard and Jan Mayen</option>
											  <option value="Swaziland">Swaziland</option>
											  <option value="Sweden">Sweden</option>
											  <option value="Switzerland">Switzerland</option>
											  <option value="Syrian Arab Republic">Syrian Arab Republic</option>
											  <option value="Taiwan">Taiwan</option>
											  <option value="Tajikistan">Tajikistan</option>
											  <option value="Tanzania, United Republic of">Tanzania, United Republic of</option>
											  <option value="Thailand">Thailand</option>
											  <option value="Timor-leste">Timor-leste</option>
											  <option value="Togo">Togo</option>
											  <option value="Tokelau">Tokelau</option>
											  <option value="Tonga">Tonga</option>
											  <option value="Trinidad and Tobago">Trinidad and Tobago</option>
											  <option value="Tunisia">Tunisia</option>
											  <option value="Turkey">Turkey</option>
											  <option value="Turkmenistan">Turkmenistan</option>
											  <option value="Turks and Caicos Islands">Turks and Caicos Islands</option>
											  <option value="Tuvalu">Tuvalu</option>
											  <option value="Uganda">Uganda</option>
											  <option value="Ukraine">Ukraine</option>
											  <option value="United Arab Emirates">United Arab Emirates</option>
											  <option value="United Kingdom">United Kingdom</option>
											  <option value="United States">United States</option>
											  <option value="United States Minor Outlying Islands">United States Minor Outlying Islands</option>
											  <option value="Uruguay">Uruguay</option>
											  <option value="Uzbekistan">Uzbekistan</option>
											  <option value="Vanuatu">Vanuatu</option>
											  <option value="Venezuela">Venezuela</option>
											  <option value="Viet Nam">Viet Nam</option>
											  <option value="Virgin Islands, British">Virgin Islands, British</option>
											  <option value="Virgin Islands, U.S.">Virgin Islands, U.S.</option>
											  <option value="Wallis and Futuna">Wallis and Futuna</option>
											  <option value="Yemen">Yemen</option>
											  <option value="Zambia">Zambia</option>
											  <option value="Zimbabwe">Zimbabwe</option>
										  </select>      
										
											
										</div>
							
							</div>
							<div class="col-md-2" style="height:16vh;border:0.2vh solid;display: flex;justify-content: center;align-items: center;">
							
								<img src="arrow.png" alt="carte" style="width:13vh;height:13vh;background-color:bisque">
								</div>
								
								<div class="col-md-5" style="height:16vh;border:0.2vh solid;">
									<div class="dbgOuter2"style="margin-top:1vh">
										<label for="country3" style="float:left;margin-top:1vh">Country</label>
									<select id="country3" name="country" class="form-control" style="width:15vh;margin-left:25vh;">
									<option value="Afghanistan">World</option>
											  <option value="Afghanistan">Afghanistan</option>
											  <option value="Aland Islands">Aland Islands</option>
											  <option value="Albania">Albania</option>
											  <option value="Algeria">Algeria</option>
											  <option value="American Samoa">American Samoa</option>
											  <option value="Andorra">Andorra</option>
											  <option value="Angola">Angola</option>
											  <option value="Anguilla">Anguilla</option>
											  <option value="Antarctica">Antarctica</option>
											  <option value="Antigua and Barbuda">Antigua and Barbuda</option>
											  <option value="Argentina">Argentina</option>
											  <option value="Armenia">Armenia</option>
											  <option value="Aruba">Aruba</option>
											  <option value="Australia">Australia</option>
											  <option value="Austria">Austria</option>
											  <option value="Azerbaijan">Azerbaijan</option>
											  <option value="Bahamas">Bahamas</option>
											  <option value="Bahrain">Bahrain</option>
											  <option value="Bangladesh">Bangladesh</option>
											  <option value="Barbados">Barbados</option>
											  <option value="Belarus">Belarus</option>
											  <option value="Belgium">Belgium</option>
											  <option value="Belize">Belize</option>
											  <option value="Benin">Benin</option>
											  <option value="Bermuda">Bermuda</option>
											  <option value="Bhutan">Bhutan</option>
											  <option value="Bolivia">Bolivia</option>
											  <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
											  <option value="Botswana">Botswana</option>
											  <option value="Bouvet Island">Bouvet Island</option>
											  <option value="Brazil">Brazil</option>
											  <option value="British Indian Ocean Territory">British Indian Ocean Territory</option>
											  <option value="Brunei Darussalam">Brunei Darussalam</option>
											  <option value="Bulgaria">Bulgaria</option>
											  <option value="Burkina Faso">Burkina Faso</option>
											  <option value="Burundi">Burundi</option>
											  <option value="Cambodia">Cambodia</option>
											  <option value="Cameroon">Cameroon</option>
											  <option value="Canada">Canada</option>
											  <option value="Cape Verde">Cape Verde</option>
											  <option value="Cayman Islands">Cayman Islands</option>
											  <option value="Central African Republic">Central African Republic</option>
											  <option value="Chad">Chad</option>
											  <option value="Chile">Chile</option>
											  <option value="China">China</option>
											  <option value="Christmas Island">Christmas Island</option>
											  <option value="Cocos (Keeling) Islands">Cocos (Keeling) Islands</option>
											  <option value="Colombia">Colombia</option>
											  <option value="Comoros">Comoros</option>
											  <option value="Congo">Congo</option>
											  <option value="Congo, The Democratic Republic of The">Congo, The Democratic Republic of The</option>
											  <option value="Cook Islands">Cook Islands</option>
											  <option value="Costa Rica">Costa Rica</option>
											  <option value="Cote D'ivoire">Cote D'ivoire</option>
											  <option value="Croatia">Croatia</option>
											  <option value="Cuba">Cuba</option>
											  <option value="Cyprus">Cyprus</option>
											  <option value="Czech Republic">Czech Republic</option>
											  <option value="Denmark">Denmark</option>
											  <option value="Djibouti">Djibouti</option>
											  <option value="Dominica">Dominica</option>
											  <option value="Dominican Republic">Dominican Republic</option>
											  <option value="Ecuador">Ecuador</option>
											  <option value="Egypt">Egypt</option>
											  <option value="El Salvador">El Salvador</option>
											  <option value="Equatorial Guinea">Equatorial Guinea</option>
											  <option value="Eritrea">Eritrea</option>
											  <option value="Estonia">Estonia</option>
											  <option value="Ethiopia">Ethiopia</option>
											  <option value="Falkland Islands (Malvinas)">Falkland Islands (Malvinas)</option>
											  <option value="Faroe Islands">Faroe Islands</option>
											  <option value="Fiji">Fiji</option>
											  <option value="Finland">Finland</option>
											  <option value="France">France</option>
											  <option value="French Guiana">French Guiana</option>
											  <option value="French Polynesia">French Polynesia</option>
											  <option value="French Southern Territories">French Southern Territories</option>
											  <option value="Gabon">Gabon</option>
											  <option value="Gambia">Gambia</option>
											  <option value="Georgia">Georgia</option>
											  <option value="Germany">Germany</option>
											  <option value="Ghana">Ghana</option>
											  <option value="Gibraltar">Gibraltar</option>
											  <option value="Greece">Greece</option>
											  <option value="Greenland">Greenland</option>
											  <option value="Grenada">Grenada</option>
											  <option value="Guadeloupe">Guadeloupe</option>
											  <option value="Guam">Guam</option>
											  <option value="Guatemala">Guatemala</option>
											  <option value="Guernsey">Guernsey</option>
											  <option value="Guinea">Guinea</option>
											  <option value="Guinea-bissau">Guinea-bissau</option>
											  <option value="Guyana">Guyana</option>
											  <option value="Haiti">Haiti</option>
											  <option value="Heard Island and Mcdonald Islands">Heard Island and Mcdonald Islands</option>
											  <option value="Holy See (Vatican City State)">Holy See (Vatican City State)</option>
											  <option value="Honduras">Honduras</option>
											  <option value="Hong Kong">Hong Kong</option>
											  <option value="Hungary">Hungary</option>
											  <option value="Iceland">Iceland</option>
											  <option value="India">India</option>
											  <option value="Indonesia">Indonesia</option>
											  <option value="Iran, Islamic Republic of">Iran, Islamic Republic of</option>
											  <option value="Iraq">Iraq</option>
											  <option value="Ireland">Ireland</option>
											  <option value="Isle of Man">Isle of Man</option>
											  <option value="Israel">Israel</option>
											  <option value="Italy">Italy</option>
											  <option value="Jamaica">Jamaica</option>
											  <option value="Japan">Japan</option>
											  <option value="Jersey">Jersey</option>
											  <option value="Jordan">Jordan</option>
											  <option value="Kazakhstan">Kazakhstan</option>
											  <option value="Kenya">Kenya</option>
											  <option value="Kiribati">Kiribati</option>
											  <option value="Korea, Democratic People's Republic of">Korea, Democratic People's Republic of</option>
											  <option value="Korea, Republic of">Korea, Republic of</option>
											  <option value="Kuwait">Kuwait</option>
											  <option value="Kyrgyzstan">Kyrgyzstan</option>
											  <option value="Lao People's Democratic Republic">Lao People's Democratic Republic</option>
											  <option value="Latvia">Latvia</option>
											  <option value="Lebanon">Lebanon</option>
											  <option value="Lesotho">Lesotho</option>
											  <option value="Liberia">Liberia</option>
											  <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option>
											  <option value="Liechtenstein">Liechtenstein</option>
											  <option value="Lithuania">Lithuania</option>
											  <option value="Luxembourg">Luxembourg</option>
											  <option value="Macao">Macao</option>
											  <option value="Macedonia, The Former Yugoslav Republic of">Macedonia, The Former Yugoslav Republic of</option>
											  <option value="Madagascar">Madagascar</option>
											  <option value="Malawi">Malawi</option>
											  <option value="Malaysia">Malaysia</option>
											  <option value="Maldives">Maldives</option>
											  <option value="Mali">Mali</option>
											  <option value="Malta">Malta</option>
											  <option value="Marshall Islands">Marshall Islands</option>
											  <option value="Martinique">Martinique</option>
											  <option value="Mauritania">Mauritania</option>
											  <option value="Mauritius">Mauritius</option>
											  <option value="Mayotte">Mayotte</option>
											  <option value="Mexico">Mexico</option>
											  <option value="Micronesia, Federated States of">Micronesia, Federated States of</option>
											  <option value="Moldova, Republic of">Moldova, Republic of</option>
											  <option value="Monaco">Monaco</option>
											  <option value="Mongolia">Mongolia</option>
											  <option value="Montenegro">Montenegro</option>
											  <option value="Montserrat">Montserrat</option>
											  <option value="Morocco">Morocco</option>
											  <option value="Mozambique">Mozambique</option>
											  <option value="Myanmar">Myanmar</option>
											  <option value="Namibia">Namibia</option>
											  <option value="Nauru">Nauru</option>
											  <option value="Nepal">Nepal</option>
											  <option value="Netherlands">Netherlands</option>
											  <option value="Netherlands Antilles">Netherlands Antilles</option>
											  <option value="New Caledonia">New Caledonia</option>
											  <option value="New Zealand">New Zealand</option>
											  <option value="Nicaragua">Nicaragua</option>
											  <option value="Niger">Niger</option>
											  <option value="Nigeria">Nigeria</option>
											  <option value="Niue">Niue</option>
											  <option value="Norfolk Island">Norfolk Island</option>
											  <option value="Northern Mariana Islands">Northern Mariana Islands</option>
											  <option value="Norway">Norway</option>
											  <option value="Oman">Oman</option>
											  <option value="Pakistan">Pakistan</option>
											  <option value="Palau">Palau</option>
											  <option value="Palestinian Territory, Occupied">Palestinian Territory, Occupied</option>
											  <option value="Panama">Panama</option>
											  <option value="Papua New Guinea">Papua New Guinea</option>
											  <option value="Paraguay">Paraguay</option>
											  <option value="Peru">Peru</option>
											  <option value="Philippines">Philippines</option>
											  <option value="Pitcairn">Pitcairn</option>
											  <option value="Poland">Poland</option>
											  <option value="Portugal">Portugal</option>
											  <option value="Puerto Rico">Puerto Rico</option>
											  <option value="Qatar">Qatar</option>
											  <option value="Reunion">Reunion</option>
											  <option value="Romania">Romania</option>
											  <option value="Russian Federation">Russian Federation</option>
											  <option value="Rwanda">Rwanda</option>
											  <option value="Saint Helena">Saint Helena</option>
											  <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
											  <option value="Saint Lucia">Saint Lucia</option>
											  <option value="Saint Pierre and Miquelon">Saint Pierre and Miquelon</option>
											  <option value="Saint Vincent and The Grenadines">Saint Vincent and The Grenadines</option>
											  <option value="Samoa">Samoa</option>
											  <option value="San Marino">San Marino</option>
											  <option value="Sao Tome and Principe">Sao Tome and Principe</option>
											  <option value="Saudi Arabia">Saudi Arabia</option>
											  <option value="Senegal">Senegal</option>
											  <option value="Serbia">Serbia</option>
											  <option value="Seychelles">Seychelles</option>
											  <option value="Sierra Leone">Sierra Leone</option>
											  <option value="Singapore">Singapore</option>
											  <option value="Slovakia">Slovakia</option>
											  <option value="Slovenia">Slovenia</option>
											  <option value="Solomon Islands">Solomon Islands</option>
											  <option value="Somalia">Somalia</option>
											  <option value="South Africa">South Africa</option>
											  <option value="South Georgia and The South Sandwich Islands">South Georgia and The South Sandwich Islands</option>
											  <option value="Spain">Spain</option>
											  <option value="Sri Lanka">Sri Lanka</option>
											  <option value="Sudan">Sudan</option>
											  <option value="Suriname">Suriname</option>
											  <option value="Svalbard and Jan Mayen">Svalbard and Jan Mayen</option>
											  <option value="Swaziland">Swaziland</option>
											  <option value="Sweden">Sweden</option>
											  <option value="Switzerland">Switzerland</option>
											  <option value="Syrian Arab Republic">Syrian Arab Republic</option>
											  <option value="Taiwan">Taiwan</option>
											  <option value="Tajikistan">Tajikistan</option>
											  <option value="Tanzania, United Republic of">Tanzania, United Republic of</option>
											  <option value="Thailand">Thailand</option>
											  <option value="Timor-leste">Timor-leste</option>
											  <option value="Togo">Togo</option>
											  <option value="Tokelau">Tokelau</option>
											  <option value="Tonga">Tonga</option>
											  <option value="Trinidad and Tobago">Trinidad and Tobago</option>
											  <option value="Tunisia">Tunisia</option>
											  <option value="Turkey">Turkey</option>
											  <option value="Turkmenistan">Turkmenistan</option>
											  <option value="Turks and Caicos Islands">Turks and Caicos Islands</option>
											  <option value="Tuvalu">Tuvalu</option>
											  <option value="Uganda">Uganda</option>
											  <option value="Ukraine">Ukraine</option>
											  <option value="United Arab Emirates">United Arab Emirates</option>
											  <option value="United Kingdom">United Kingdom</option>
											  <option value="United States">United States</option>
											  <option value="United States Minor Outlying Islands">United States Minor Outlying Islands</option>
											  <option value="Uruguay">Uruguay</option>
											  <option value="Uzbekistan">Uzbekistan</option>
											  <option value="Vanuatu">Vanuatu</option>
											  <option value="Venezuela">Venezuela</option>
											  <option value="Viet Nam">Viet Nam</option>
											  <option value="Virgin Islands, British">Virgin Islands, British</option>
											  <option value="Virgin Islands, U.S.">Virgin Islands, U.S.</option>
											  <option value="Wallis and Futuna">Wallis and Futuna</option>
											  <option value="Yemen">Yemen</option>
											  <option value="Zambia">Zambia</option>
											  <option value="Zimbabwe">Zimbabwe</option>
										  </select>      
										
											
										</div>
										<div class="dbgOuter2" style="margin-top:1vh" >
											<label for="country4" style="float:left;margin-top:1vh">Coordinates System</label>
										<select id="country4" name="country" class="form-control" style="width:15vh;margin-left:25vh;">
										<option value="Afghanistan">WGS</option>
												  <option value="Afghanistan">Afghanistan</option>
												  <option value="Aland Islands">Aland Islands</option>
												  <option value="Albania">Albania</option>
												  <option value="Algeria">Algeria</option>
												  <option value="American Samoa">American Samoa</option>
												  <option value="Andorra">Andorra</option>
												  <option value="Angola">Angola</option>
												  <option value="Anguilla">Anguilla</option>
												  <option value="Antarctica">Antarctica</option>
												  <option value="Antigua and Barbuda">Antigua and Barbuda</option>
												  <option value="Argentina">Argentina</option>
												  <option value="Armenia">Armenia</option>
												  <option value="Aruba">Aruba</option>
												  <option value="Australia">Australia</option>
												  <option value="Austria">Austria</option>
												  <option value="Azerbaijan">Azerbaijan</option>
												  <option value="Bahamas">Bahamas</option>
												  <option value="Bahrain">Bahrain</option>
												  <option value="Bangladesh">Bangladesh</option>
												  <option value="Barbados">Barbados</option>
												  <option value="Belarus">Belarus</option>
												  <option value="Belgium">Belgium</option>
												  <option value="Belize">Belize</option>
												  <option value="Benin">Benin</option>
												  <option value="Bermuda">Bermuda</option>
												  <option value="Bhutan">Bhutan</option>
												  <option value="Bolivia">Bolivia</option>
												  <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
												  <option value="Botswana">Botswana</option>
												  <option value="Bouvet Island">Bouvet Island</option>
												  <option value="Brazil">Brazil</option>
												  <option value="British Indian Ocean Territory">British Indian Ocean Territory</option>
												  <option value="Brunei Darussalam">Brunei Darussalam</option>
												  <option value="Bulgaria">Bulgaria</option>
												  <option value="Burkina Faso">Burkina Faso</option>
												  <option value="Burundi">Burundi</option>
												  <option value="Cambodia">Cambodia</option>
												  <option value="Cameroon">Cameroon</option>
												  <option value="Canada">Canada</option>
												  <option value="Cape Verde">Cape Verde</option>
												  <option value="Cayman Islands">Cayman Islands</option>
												  <option value="Central African Republic">Central African Republic</option>
												  <option value="Chad">Chad</option>
												  <option value="Chile">Chile</option>
												  <option value="China">China</option>
												  <option value="Christmas Island">Christmas Island</option>
												  <option value="Cocos (Keeling) Islands">Cocos (Keeling) Islands</option>
												  <option value="Colombia">Colombia</option>
												  <option value="Comoros">Comoros</option>
												  <option value="Congo">Congo</option>
												  <option value="Congo, The Democratic Republic of The">Congo, The Democratic Republic of The</option>
												  <option value="Cook Islands">Cook Islands</option>
												  <option value="Costa Rica">Costa Rica</option>
												  <option value="Cote D'ivoire">Cote D'ivoire</option>
												  <option value="Croatia">Croatia</option>
												  <option value="Cuba">Cuba</option>
												  <option value="Cyprus">Cyprus</option>
												  <option value="Czech Republic">Czech Republic</option>
												  <option value="Denmark">Denmark</option>
												  <option value="Djibouti">Djibouti</option>
												  <option value="Dominica">Dominica</option>
												  <option value="Dominican Republic">Dominican Republic</option>
												  <option value="Ecuador">Ecuador</option>
												  <option value="Egypt">Egypt</option>
												  <option value="El Salvador">El Salvador</option>
												  <option value="Equatorial Guinea">Equatorial Guinea</option>
												  <option value="Eritrea">Eritrea</option>
												  <option value="Estonia">Estonia</option>
												  <option value="Ethiopia">Ethiopia</option>
												  <option value="Falkland Islands (Malvinas)">Falkland Islands (Malvinas)</option>
												  <option value="Faroe Islands">Faroe Islands</option>
												  <option value="Fiji">Fiji</option>
												  <option value="Finland">Finland</option>
												  <option value="France">France</option>
												  <option value="French Guiana">French Guiana</option>
												  <option value="French Polynesia">French Polynesia</option>
												  <option value="French Southern Territories">French Southern Territories</option>
												  <option value="Gabon">Gabon</option>
												  <option value="Gambia">Gambia</option>
												  <option value="Georgia">Georgia</option>
												  <option value="Germany">Germany</option>
												  <option value="Ghana">Ghana</option>
												  <option value="Gibraltar">Gibraltar</option>
												  <option value="Greece">Greece</option>
												  <option value="Greenland">Greenland</option>
												  <option value="Grenada">Grenada</option>
												  <option value="Guadeloupe">Guadeloupe</option>
												  <option value="Guam">Guam</option>
												  <option value="Guatemala">Guatemala</option>
												  <option value="Guernsey">Guernsey</option>
												  <option value="Guinea">Guinea</option>
												  <option value="Guinea-bissau">Guinea-bissau</option>
												  <option value="Guyana">Guyana</option>
												  <option value="Haiti">Haiti</option>
												  <option value="Heard Island and Mcdonald Islands">Heard Island and Mcdonald Islands</option>
												  <option value="Holy See (Vatican City State)">Holy See (Vatican City State)</option>
												  <option value="Honduras">Honduras</option>
												  <option value="Hong Kong">Hong Kong</option>
												  <option value="Hungary">Hungary</option>
												  <option value="Iceland">Iceland</option>
												  <option value="India">India</option>
												  <option value="Indonesia">Indonesia</option>
												  <option value="Iran, Islamic Republic of">Iran, Islamic Republic of</option>
												  <option value="Iraq">Iraq</option>
												  <option value="Ireland">Ireland</option>
												  <option value="Isle of Man">Isle of Man</option>
												  <option value="Israel">Israel</option>
												  <option value="Italy">Italy</option>
												  <option value="Jamaica">Jamaica</option>
												  <option value="Japan">Japan</option>
												  <option value="Jersey">Jersey</option>
												  <option value="Jordan">Jordan</option>
												  <option value="Kazakhstan">Kazakhstan</option>
												  <option value="Kenya">Kenya</option>
												  <option value="Kiribati">Kiribati</option>
												  <option value="Korea, Democratic People's Republic of">Korea, Democratic People's Republic of</option>
												  <option value="Korea, Republic of">Korea, Republic of</option>
												  <option value="Kuwait">Kuwait</option>
												  <option value="Kyrgyzstan">Kyrgyzstan</option>
												  <option value="Lao People's Democratic Republic">Lao People's Democratic Republic</option>
												  <option value="Latvia">Latvia</option>
												  <option value="Lebanon">Lebanon</option>
												  <option value="Lesotho">Lesotho</option>
												  <option value="Liberia">Liberia</option>
												  <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option>
												  <option value="Liechtenstein">Liechtenstein</option>
												  <option value="Lithuania">Lithuania</option>
												  <option value="Luxembourg">Luxembourg</option>
												  <option value="Macao">Macao</option>
												  <option value="Macedonia, The Former Yugoslav Republic of">Macedonia, The Former Yugoslav Republic of</option>
												  <option value="Madagascar">Madagascar</option>
												  <option value="Malawi">Malawi</option>
												  <option value="Malaysia">Malaysia</option>
												  <option value="Maldives">Maldives</option>
												  <option value="Mali">Mali</option>
												  <option value="Malta">Malta</option>
												  <option value="Marshall Islands">Marshall Islands</option>
												  <option value="Martinique">Martinique</option>
												  <option value="Mauritania">Mauritania</option>
												  <option value="Mauritius">Mauritius</option>
												  <option value="Mayotte">Mayotte</option>
												  <option value="Mexico">Mexico</option>
												  <option value="Micronesia, Federated States of">Micronesia, Federated States of</option>
												  <option value="Moldova, Republic of">Moldova, Republic of</option>
												  <option value="Monaco">Monaco</option>
												  <option value="Mongolia">Mongolia</option>
												  <option value="Montenegro">Montenegro</option>
												  <option value="Montserrat">Montserrat</option>
												  <option value="Morocco">Morocco</option>
												  <option value="Mozambique">Mozambique</option>
												  <option value="Myanmar">Myanmar</option>
												  <option value="Namibia">Namibia</option>
												  <option value="Nauru">Nauru</option>
												  <option value="Nepal">Nepal</option>
												  <option value="Netherlands">Netherlands</option>
												  <option value="Netherlands Antilles">Netherlands Antilles</option>
												  <option value="New Caledonia">New Caledonia</option>
												  <option value="New Zealand">New Zealand</option>
												  <option value="Nicaragua">Nicaragua</option>
												  <option value="Niger">Niger</option>
												  <option value="Nigeria">Nigeria</option>
												  <option value="Niue">Niue</option>
												  <option value="Norfolk Island">Norfolk Island</option>
												  <option value="Northern Mariana Islands">Northern Mariana Islands</option>
												  <option value="Norway">Norway</option>
												  <option value="Oman">Oman</option>
												  <option value="Pakistan">Pakistan</option>
												  <option value="Palau">Palau</option>
												  <option value="Palestinian Territory, Occupied">Palestinian Territory, Occupied</option>
												  <option value="Panama">Panama</option>
												  <option value="Papua New Guinea">Papua New Guinea</option>
												  <option value="Paraguay">Paraguay</option>
												  <option value="Peru">Peru</option>
												  <option value="Philippines">Philippines</option>
												  <option value="Pitcairn">Pitcairn</option>
												  <option value="Poland">Poland</option>
												  <option value="Portugal">Portugal</option>
												  <option value="Puerto Rico">Puerto Rico</option>
												  <option value="Qatar">Qatar</option>
												  <option value="Reunion">Reunion</option>
												  <option value="Romania">Romania</option>
												  <option value="Russian Federation">Russian Federation</option>
												  <option value="Rwanda">Rwanda</option>
												  <option value="Saint Helena">Saint Helena</option>
												  <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
												  <option value="Saint Lucia">Saint Lucia</option>
												  <option value="Saint Pierre and Miquelon">Saint Pierre and Miquelon</option>
												  <option value="Saint Vincent and The Grenadines">Saint Vincent and The Grenadines</option>
												  <option value="Samoa">Samoa</option>
												  <option value="San Marino">San Marino</option>
												  <option value="Sao Tome and Principe">Sao Tome and Principe</option>
												  <option value="Saudi Arabia">Saudi Arabia</option>
												  <option value="Senegal">Senegal</option>
												  <option value="Serbia">Serbia</option>
												  <option value="Seychelles">Seychelles</option>
												  <option value="Sierra Leone">Sierra Leone</option>
												  <option value="Singapore">Singapore</option>
												  <option value="Slovakia">Slovakia</option>
												  <option value="Slovenia">Slovenia</option>
												  <option value="Solomon Islands">Solomon Islands</option>
												  <option value="Somalia">Somalia</option>
												  <option value="South Africa">South Africa</option>
												  <option value="South Georgia and The South Sandwich Islands">South Georgia and The South Sandwich Islands</option>
												  <option value="Spain">Spain</option>
												  <option value="Sri Lanka">Sri Lanka</option>
												  <option value="Sudan">Sudan</option>
												  <option value="Suriname">Suriname</option>
												  <option value="Svalbard and Jan Mayen">Svalbard and Jan Mayen</option>
												  <option value="Swaziland">Swaziland</option>
												  <option value="Sweden">Sweden</option>
												  <option value="Switzerland">Switzerland</option>
												  <option value="Syrian Arab Republic">Syrian Arab Republic</option>
												  <option value="Taiwan">Taiwan</option>
												  <option value="Tajikistan">Tajikistan</option>
												  <option value="Tanzania, United Republic of">Tanzania, United Republic of</option>
												  <option value="Thailand">Thailand</option>
												  <option value="Timor-leste">Timor-leste</option>
												  <option value="Togo">Togo</option>
												  <option value="Tokelau">Tokelau</option>
												  <option value="Tonga">Tonga</option>
												  <option value="Trinidad and Tobago">Trinidad and Tobago</option>
												  <option value="Tunisia">Tunisia</option>
												  <option value="Turkey">Turkey</option>
												  <option value="Turkmenistan">Turkmenistan</option>
												  <option value="Turks and Caicos Islands">Turks and Caicos Islands</option>
												  <option value="Tuvalu">Tuvalu</option>
												  <option value="Uganda">Uganda</option>
												  <option value="Ukraine">Ukraine</option>
												  <option value="United Arab Emirates">United Arab Emirates</option>
												  <option value="United Kingdom">United Kingdom</option>
												  <option value="United States">United States</option>
												  <option value="United States Minor Outlying Islands">United States Minor Outlying Islands</option>
												  <option value="Uruguay">Uruguay</option>
												  <option value="Uzbekistan">Uzbekistan</option>
												  <option value="Vanuatu">Vanuatu</option>
												  <option value="Venezuela">Venezuela</option>
												  <option value="Viet Nam">Viet Nam</option>
												  <option value="Virgin Islands, British">Virgin Islands, British</option>
												  <option value="Virgin Islands, U.S.">Virgin Islands, U.S.</option>
												  <option value="Wallis and Futuna">Wallis and Futuna</option>
												  <option value="Yemen">Yemen</option>
												  <option value="Zambia">Zambia</option>
												  <option value="Zimbabwe">Zimbabwe</option>
											  </select>      
											
												
											</div>								
										</div>

						</div>
						
						
						
					
				</div>
				<div class="col-md-12" style="height:8vh;border:0.2vh solid">
					<div class="row">
						<div class="col-md-5" style="height:8vh;border:0.2vh solid">
							<div class="dbgOuter5" style="margin-top:1.5vh;color:white">
								
								 <label for="X">X(Lon):</label>
								 <input type="text" id="X" placeholder="X" name="Long" required style="width:12vh;color:black">
								 <label for="Y">Y(Lat):</label>
								 <input type="text" id="Y" placeholder="Y" name="Lat" required style="width:12vh;color:black">
								</div>
								
							</div>
							<div class="col-md-2" style="height:8vh;border:0.2vh solid">
								<div style="margin-top:1vh;display: flex;justify-content: center;align-items: center;">
									<input type="button" class="btn btn-danger" style="height:5vh;width:6vh;padding-left:1.5vh" onclick="gotoxy()" value="Go">
								 <input type="button" class="btn btn-warning" style="height:5vh;width:7vh;margin-left:0.5vh;padding-left:1vh" onclick="removeMarkers()" value="Clear">
								</div>
								
							</div>
							<div class="col-md-5" style="height:8vh;border:0.2vh solid">
								<div class="dbgOuter5" style="margin-top:1.5vh;color:white">
									
									 <label for="X">X(Lon):</label>
									 <input type="text" id="X2" placeholder="X" name="Long" readonly  style="width:12vh;color:black">
									 <label for="Y">Y(Lat):</label>
									 <input type="text" id="Y2" placeholder="Y" name="Lat" readonly   style="width:12vh;color:black">
								   
									</div>
							</div>

						</div>

					</div>
					
				<div class="col-md-12" style="height:70vh;border:0.2vh solid" >
				  <div class="row">
					<div class="col-md-10" style="height:70vh;border:0.2vh solid">
		
						<div id='map'></div>
						<!-- <div id="zoneRech"><input type="text" name="recherche" id="inprech" style="width:10vh"><input type="button" value="Go" onclick="searchPermit()"></div> -->

					</div>
					<div class="col-md-2" style="height:70vh;border:0.2vh solid " id="drawingTools">
								<div style="border:0.2vh solid;background-color:beige">
									<input type="checkbox" id="rd4" onclick="cursormap()"/>
								<label for="rd4">Coord</label>
								</div>
								<div style="border:0.2vh solid;background-color:beige">
									<input type="checkbox" id="rd9" onclick="mult()"/>
								<label for="rd9">Select</label>
								</div>
								<div style="border:0.2vh solid;background-color:beige">
									<input type="checkbox" id="rd11" onclick="drag()"/>
								<label for="rd11">Drag</label>
								</div>
								<div style="border:0.2vh solid;background-color:beige">
									<input class="form-check-input" type="radio" name="flexRadioDefault" id="radioPol" onclick="Polygon()">   <!--NB!!! pour que cette 2eme case radiobox soit regroupÃ©e avec la 1ere, il faut que les deux possedent le meme nom (ici name="flexRadioDefault"); sinon on peut cocher les deux Ã  la fois, ce qui n'est pas le caractere d'un radio --> <!--"checked" cÃ d le radiobox est dÃ©jÃ  cochÃ©, pour le prÃ©venir d'etre cochÃ© on ajoute "disabled"-->
								<label class="form-check-label" for="radioPol">Polygon</label>
								</div>
								<div style="border:0.2vh solid;background-color:beige">
									<input class="form-check-input" type="radio" name="flexRadioDefault" id="radioRec" onclick="Rectangle()">   <!--NB!!! pour que cette 2eme case radiobox soit regroupÃ©e avec la 1ere, il faut que les deux possedent le meme nom (ici name="flexRadioDefault"); sinon on peut cocher les deux Ã  la fois, ce qui n'est pas le caractere d'un radio --> <!--"checked" cÃ d le radiobox est dÃ©jÃ  cochÃ©, pour le prÃ©venir d'etre cochÃ© on ajoute "disabled"-->
								<label class="form-check-label" for="radioRec">Rectg</label>
								</div>
								<div style="border:0.2vh solid;background-color:beige">
									<input class="form-check-input" type="radio" name="flexRadioDefault" id="radioCir" onclick="Circle()">   <!--NB!!! pour que cette 2eme case radiobox soit regroupÃ©e avec la 1ere, il faut que les deux possedent le meme nom (ici name="flexRadioDefault"); sinon on peut cocher les deux Ã  la fois, ce qui n'est pas le caractere d'un radio --> <!--"checked" cÃ d le radiobox est dÃ©jÃ  cochÃ©, pour le prÃ©venir d'etre cochÃ© on ajoute "disabled"-->
								<label class="form-check-label" for="radioCir">Circle</label>
								</div>
								<div style="border:0.2vh solid;background-color:beige">
									<input class="form-check-input" type="radio" name="flexRadioDefault" id="radioPolyl" onclick="Polyline()">   <!--NB!!! pour que cette 2eme case radiobox soit regroupÃ©e avec la 1ere, il faut que les deux possedent le meme nom (ici name="flexRadioDefault"); sinon on peut cocher les deux Ã  la fois, ce qui n'est pas le caractere d'un radio --> <!--"checked" cÃ d le radiobox est dÃ©jÃ  cochÃ©, pour le prÃ©venir d'etre cochÃ© on ajoute "disabled"-->
								<label class="form-check-label" for="radioPolyl">Polyline</label>
								</div>
								<div style="border:0.2vh solid;background-color:beige">
									<input class="form-check-input" type="radio" name="flexRadioDefault" id="radioPt" onclick="Point()">   <!--NB!!! pour que cette 2eme case radiobox soit regroupÃ©e avec la 1ere, il faut que les deux possedent le meme nom (ici name="flexRadioDefault"); sinon on peut cocher les deux Ã  la fois, ce qui n'est pas le caractere d'un radio --> <!--"checked" cÃ d le radiobox est dÃ©jÃ  cochÃ©, pour le prÃ©venir d'etre cochÃ© on ajoute "disabled"-->
								<label class="form-check-label" for="radioPt">Point</label>
								</div>
								<div style="border:0.2vh solid;background-color:beige">
									<input class="form-check-input" type="radio" name="flexRadioDefault" id="radioHole" onclick="Hole()">   <!--NB!!! pour que cette 2eme case radiobox soit regroupÃ©e avec la 1ere, il faut que les deux possedent le meme nom (ici name="flexRadioDefault"); sinon on peut cocher les deux Ã  la fois, ce qui n'est pas le caractere d'un radio --> <!--"checked" cÃ d le radiobox est dÃ©jÃ  cochÃ©, pour le prÃ©venir d'etre cochÃ© on ajoute "disabled"-->
								<label class="form-check-label" for="radioHole">Hole</label>
								</div>
								
								<div style="border:0.2vh solid;background-color:beige">
									<div style="margin:1vh">
										<input type="button" class="btn btn-success" style="height:5vh;width:10vh;margin-bottom:0.5vh;font-size:3vh;padding:0" onclick="SaveEd()" value="Save">
										<input type="button" class="btn btn-danger" style="height:5vh;width:10vh;margin-bottom:0.5vh;font-size:3vh;padding:0" id='confirmId' onclick="CancelEd()" value="Cancel">
										<input type="button" class="btn btn-primary" style="height:5vh;width:10vh;margin-bottom:0.5vh;font-size:3vh;padding:0" onclick="EdEd()" value="Edit">
										<input type="button" class="btn btn-primary" style="height:5vh;width:10vh;margin-bottom:0.5vh;font-size:3vh;padding:0" id="delFdBtn" value="delFd">
										<input type="button" class="btn btn-primary" style="height:5vh;width:10vh;margin-bottom:0.5vh;font-size:3vh;padding:0" id="interp" value="interp">


									</div>
									
								</div>
								
					</div>
				  </div>
				</div>
				
			  </div>
			
			

			
			
		  </div>
		</div>
	  </div>
	
	<script>
// 		function updateText(){

// let delay = 200;

// 	let anm = document.getElementById("animate");

//       anm.innerHTML = anm.innerHTML
//         .split("")
//         .map(letter => {
//           console.log(letter);
//           return `<span>` + letter + `</span>`;
//         })
//         .join("");

//       Array.from(anm.children).forEach((span, index) => {
//         setTimeout(() => {
//           span.classList.add("wavy");
//         }, index * 60 + delay);
//       });

// }
// updateText();



		// new LeafletToolbar.DrawToolbar({
		// 	position: 'topleft'
		// }).addTo(map);

        // new LeafletToolbar.EditToolbar.Control({
        //     position: 'topleft'
        // }).addTo(map, drawnItems);

		// map.on('draw:created', function(evt) {
		// 	var type = evt.layerType,
		// 		layer = evt.layer;

		// 	drawnItems.addLayer(layer);
		// });



		var fc,sc,out;

function addClickTable(z,tslc,bdslc,ly,lbl,fc,sc,out,e,sld)
{
	console.log(e.target.parentNode.className)
	let ss=z.rows[0].getElementsByTagName("th")[0].innerText;
	console.log(ss)
	if(editStart==1)
	{
		swal.fire("Stop editing first")
		return;
	}
for(t of ly)
 {
	if(typeof(t.editEnabled)!="undefined")
	{
		if (t.editEnabled())
		{
		swal.fire("stop editing first");
		return;
		}
	}
	
 }
	if(deleteStopKey==0)
	{
		swal.fire("Finish removing first")
		return;
	}
	
	drawnItems.eachLayer(function (layer) {
		if(multp==0)
		{
		drawnItems.removeLayer(layer)
		layer.addTo(map);
		}
		map.eachLayer(function (pg) {
	
		if((typeof(pg._bounds)!=="undefined") && (pg.options.table==layer.options.table))
		{
			if(pg!=layer && typeof(pg._bounds.max)==="undefined")
				{	
					if(layer.options.type!="pointGis")
					{
						if(typeof(layer.options.center)!=="undefined")
						{	let lyr;
							let center = [layer.options.center.lng, layer.options.center.lat];
							let radius = layer.options.radius;
							let options = {steps: 128, units: 'meters'};
							let circle = turf.circle(center, radius, options);
							if(typeof(pg.options.center)!=="undefined")
										{
											let center2 = [pg.options.center.lng, pg.options.center.lat];
										console.log(center)
										let radius2 = pg.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=pg.toGeoJSON();
										}
							if(turf.booleanContains(circle, lyr)==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						else
						{
							let lyr;

							if(typeof(pg.options.center)!=="undefined")
										{
											let center2 = [pg.options.center.lng, pg.options.center.lat];
										console.log(center)
										let radius2 = pg.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=pg.toGeoJSON();
										}
							if(turf.booleanContains(layer.toGeoJSON(), lyr)==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						
					}

				}
		}
			
		});	
	});	

if(multp==0)
{
	let slcSp2=document.getElementById("slcSp2");
	let tbslcAll=slcSp2.getElementsByTagName("tbody");
	for(l of tbslcAll)
	{
		while(l.firstChild)
					 {
					   l.removeChild(l.firstChild);
					 }
	}
	let lyrs11=document.getElementById("tableSp");
	let tbslcAll2=lyrs11.getElementsByTagName("tbody");
	if(e.target.parentNode.className != 'selected')
{
	for(m of tbslcAll2)
	   {
		for(g of m.childNodes)
		{
			g.className="";
		}
		 
	   }
}
	
	   let lyrs22=document.getElementById("TableList");
	   let lab=lyrs22.getElementsByTagName("span");
	   for(lb of lab)
	   {
		lb.innerText="(Selected: 0 Highlighted: 0)";
	   }
	
	

}
	
if(e.target.parentNode!=z.rows[0])
{
 
 ly=[...new Set(ly)];
 for(i=0;i<ly.length;i++)
{
	console.log(ly[i].options)
 let strg="";
   for(let j=0;j<Object.keys(ly[i].options.attributes).length;j++)
   {
	 strg+=Object.keys(ly[i].options.attributes)[j];
	 strg+=':';
	 strg+=Object.values(ly[i].options.attributes)[j];
	 strg+='\n';
	 
   }
  
   
console.log(e.target.parentNode.children[0].innerText)
console.log(ly[i].options.attributes[ss])
 if(ly[i].options.attributes[ss]==e.target.parentNode.children[0].innerText)
 {
	console.log("yesyesyes")
	if(multp==0)
	{
		map.eachLayer(function (layer) {
		if(layer!=ly[i] && layer.options.clicked==1)
		{
			if(layer.options.type=="polyg" || layer.options.type=="circle")
		{
			console.log(layer.options.colors[0])
			
			layer.setStyle({fillColor: layer.options.colors[0],color: layer.options.colors[2],weight:1});
		}
		else if(layer.options.type=="polylineGis")
		{
			layer.setStyle({color: layer.options.colors[0],weight:1});
		}
		else if(layer.options.type=="pointGis")
		{
			layer.setIcon(layer.options.colors[0]);
		}
		layer.options.clicked=0;
		}
		
	});	
	}
	
	
  console.log(e.target.parentNode.className)
	 if(e.target.parentNode.className == 'selected')
 {
//    clickedDrawn=[];
   ly[i].options.clicked=0;
   clickedDrawn = clickedDrawn.filter(function(item){ return item[0] != ly[i] })
	
		
				drawnItems.removeLayer(ly[i])
				ly[i].addTo(map);
				setZindexItem2(ly[i]);
	
   if(ly[i].options.type=="polyg" || ly[i].options.type=="circle")
   {
	 ly[i].setStyle({fillColor: fc,color: out,weight:1});
	 let mz=map.getBoundsZoom(ly[i].getBounds());
   map.setZoom(mz-2);
   }
   else if(ly[i].options.type=="polylineGis")
   {
	 ly[i].setStyle({color: fc,weight:1});
	 let mz=map.getBoundsZoom(ly[i].getBounds());
   map.setZoom(mz-2);
   }
   else if(ly[i].options.type=="pointGis")
   {
	 ly[i].setIcon(fc);
	 map.setView(ly[i].getLatLng(),9)
   }
   
   let inda=clickedY.indexOf(ly[i]);
	 delete clickedY[inda];
	 let inda2=clickedZ.indexOf(ly[i]);
	 if(inda2!=-1)
	 {
	   delete clickedZ[inda2];

	 }
	 
 }
 else
 {
 
   ly[i].options.clicked=1;
   
   if(ly[i].options.type=="polyg" || ly[i].options.type=="circle")
   {
	 ly[i].setStyle({fillColor: sc,color: out,weight:3});
	 map.fitBounds(ly[i].getBounds());
   }
   else if(ly[i].options.type=="polylineGis")
   {
	 ly[i].setStyle({color: sc,weight:3});
	 map.fitBounds(ly[i].getBounds());
   }
   else if(ly[i].options.type=="pointGis")
   {
	 ly[i].setIcon(sc);
	 let latLngs = [ ly[i].getLatLng() ];
	 let markerBounds = L.latLngBounds(latLngs);
	  map.fitBounds(markerBounds);
   }
   if(multp==0)
   {
	clickedY=[];
	clickedDrawn=[[ly[i],sld,sc,out]];
   }
   else
   {
	clickedY.push(ly[i]);
	clickedDrawn.push([ly[i],sld,sc,out]);
   }
   drawnItems.addLayer(ly[i])
   ly[i].bindPopup(strg).openPopup();
   
			
 }

  
 setZindexItem2(ly[i]);

   
   
 }
 else
 {
   if(multp==0)
   {
	 // clickedDrawn=[];
	 ly[i].options.clicked=0;
	 if(ly[i].options.type=="polyg" || ly[i].options.type=="circle")
	 {
	   ly[i].setStyle({fillColor: fc,color: out,weight:1});
	 }
   else if(ly[i].options.type=="polylineGis")
	 {
	   ly[i].setStyle({color: fc,weight:1});
	 }
	 else if(ly[i].options.type=="pointGis")
   {
	 ly[i].setIcon(fc);
   }
   drawnItems.removeLayer(ly[i])

   }
 }
 
}
if(multp==0)
 {
   while(bdslc.firstChild)
			 {
			   bdslc.removeChild(bdslc.firstChild);
			 }
 }
 if(multp==1)
	 {
	   
	   for(m of bdslc.rows)
	   {
		 if(m.getElementsByTagName("td")[0].innerText==e.target.parentNode.children[0].innerText)
		 {
		   m.remove();
		   break;
		 }
	   }
	   
	 }

	 
 if(e.target.parentNode.className == 'selected')
 {
	console.log("yyy")
   if(multp==0)
   {
	 for(m of z.rows)
	   {
		 m.className="";
	   }
		  
   }
   else
   {
	 e.target.parentNode.className = '';
   }
   
 }
 else
 {
	console.log("zzz")

 //   for(k of table.rows)
 // {
 //   k.className="";
 // }
   
	 if(multp==0)
	 {
	   for(m of z.rows)
	   {
		 m.className="";
	   }
	 }

	 e.target.parentNode.className ="selected";
   let tablerw=e.target.parentNode.cloneNode(true);
   bdslc.appendChild(tablerw);
   
   // tableSlc.appendChild(tbdSlc);
   
   
   

 }
selectedHighlighted(z,bdslc,lbl);

}
console.log(e.target.parentNode.className)
}

function onclickPgs(e,ly,z,bdslc,lbl,fc,sc,out,sld)
{		
	
	if(editStart==1)
	{
		swal.fire("Stop editing first")
		return;
	}
	if(deleteStopKey==0)
	{
		swal.fire("Finish removing first")
		return;
	}
	drawnItems.eachLayer(function (layer) {
		if(multp==0)
		{
		drawnItems.removeLayer(layer)
		layer.addTo(map);
		setZindexItem2(layer)
		}
		map.eachLayer(function (pg) {
	
		if((typeof(pg._bounds)!=="undefined") && (pg.options.table==layer.options.table))
		{
			if(pg!=layer && typeof(pg._bounds.max)==="undefined")
				{	
					if(layer.options.type!="pointGis")
					{
						if(typeof(layer.options.center)!=="undefined")
						{
							let lyr;
							let center = [layer.options.center.lng, layer.options.center.lat];
							let radius = layer.options.radius;
							let options = {steps: 128, units: 'meters'};
							let circle = turf.circle(center, radius, options);
							// L.geoJson(circle).addTo(map);
							if(typeof(pg.options.center)!=="undefined")
										{
											let center2 = [pg.options.center.lng, pg.options.center.lat];
										console.log(center)
										let radius2 = pg.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=pg.toGeoJSON();
										}
							if(turf.booleanContains(circle, lyr)==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)

							}
						}
						else
						{
							let lyr;
							if(typeof(pg.options.center)!=="undefined")
										{
											let center2 = [pg.options.center.lng, pg.options.center.lat];
										console.log(center)
										let radius2 = pg.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=pg.toGeoJSON();
										}
							if(turf.booleanContains(layer.toGeoJSON(), lyr)==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						
					}

							
		}
		}
			
		});	
	});	
	if(multp==0)
	{
		map.eachLayer(function (layer) {
		if(layer!=e && layer.options.clicked==1)
		{
			if(layer.options.type=="polyg" || layer.options.type=="circle")
		{
			
			layer.setStyle({fillColor: layer.options.colors[0],color: layer.options.colors[2],weight:1});
		}
		else if(layer.options.type=="polylineGis")
		{
			layer.setStyle({color: layer.options.colors[0],weight:1});
		}
		else if(layer.options.type=="pointGis")
		{
			layer.setIcon(layer.options.colors[0]);
		}
		layer.options.clicked=0;
		}
		
	});	
	let slcSp2=document.getElementById("slcSp2");
	let tbslcAll=slcSp2.getElementsByTagName("tbody");
	for(l of tbslcAll)
	{
		while(l.firstChild)
					 {
					   l.removeChild(l.firstChild);
					 }
	}
	let lyrs11=document.getElementById("tableSp");
	let tbslcAll2=lyrs11.getElementsByTagName("tbody");
	console.log(tbslcAll2)
	let jj=e.options.table;
			let jj2=document.getElementsByTagName("table");
			let ss=jj2[jj].rows[0].getElementsByTagName("th")[0].innerText;
	for(m of tbslcAll2)
	   {
		for(g of m.childNodes)
		{
			
			if(g.childNodes[0].innerText != e.options.attributes[ss] || m!==tbslcAll2[e.options.table])
			 {
				g.className="";

			 }
		}
		 
	   }

	
	   let lyrs22=document.getElementById("TableList");
	   let lab=lyrs22.getElementsByTagName("span");
	   for(lb of lab)
	   {
		lb.innerText="(Selected: 0 Highlighted: 0)";
	   }
	  
	}

	// else
	// {
	// 	drawnItems.addLayer(e)

	// }
	
// if (e.editEnabled())
// {
//   return;
// }


for(g of lyrsT)
{
for(t of g)
 {
	if (typeof(t.editEnabled) !== "undefined") { 
				if (t.editEnabled())
		{
		swal.fire("stop editing first");
		return;
		}	
	}
   
 }
}
 
			 

// if(map.editTools._drawingEditor)
// {
//   swal.fire("stop editing first");
//   return;
// }
   if(e.options.clicked==0)
   {
	 if(multp==0)
   {
	
	//  for(t of ly)
	//  {
	//    if(t.options.type=="polyg" ||  t.options.type=="circle")
	// 	 {
	// 	   t.setStyle({fillColor: fc,color: out,weight:1});
	// 	 }
	//    else if(t.options.type="polylineGis")
	// 	 {
	// 	   t.setStyle({color: fc,weight:1});
	// 	 }
	//    else
	//    {
	// 	 t.setIcon(fc);
	//    }
	//    t.options.clicked=0;
	 
	   
	   

		// 	 let tbslc2=tbslc.getElementsByTagName("tbody")[0];
		//    while(tbslc2.firstChild)
		// 			 {
		// 			   tbslc2.removeChild(tbslc2.firstChild);
		// 			 }
		   

	//  }
	 clickedY=[];
	 clickedZ=[];
   }
   if(e.options.type=="polyg" || e.options.type=="circle")
		 {
		   e.setStyle({fillColor: sc,fillOpacity:sld,color: out,weight:3});
		   map.fitBounds(e.getBounds());
		 }
   else if(e.options.type=="polylineGis")
		 {
		   e.setStyle({color: sc,weight:sld*3});
		   map.fitBounds(e.getBounds());
		 }
   else if(e.options.type=="pointGis")
		 {
		   e.setIcon(sc);
		   let latLngs = [ e.getLatLng() ];
		   let markerBounds = L.latLngBounds(latLngs);
		   map.fitBounds(markerBounds);
		 }
	 e.options.clicked=1;
			drawnItems.addLayer(e);

			// var drawControl = new L.Control.Draw({
			// 	edit: {
			// 		featureGroup: drawnItems
			// 	}
			// });
   
   let strg="";
   for(let i=0;i<Object.keys(e.options.attributes).length;i++)
   {
	 strg+=Object.keys(e.options.attributes)[i];
	 strg+=':';
	 strg+=Object.values(e.options.attributes)[i];
	 strg+='\n';
	 
   }
   console.log("oui44");

   e.bindPopup(strg).openPopup();
   console.log("oui555");

   clickedY.push(e);
   if(multp==0)
   {
	clickedDrawn=[[e,sld,sc,out]];
   }
   else
   {
	clickedDrawn.push([e,sld,sc,out]);
   }

   }
   else
   {
	clickedDrawn = clickedDrawn.filter(function(item){ return item[0] != e })
	if(multp!=0)
	{
		
				drawnItems.removeLayer(e)
				e.addTo(map);
				// setZindexItem2(e);
	}
		// drawnItems.removeLayer(e)
		// e.addTo(map);
		// map.eachLayer(function (pg) {
	
		// if((typeof(pg._bounds)!=="undefined") && (pg.options.table==e.options.table))
		// {
		// 	if(pg!=e && typeof(pg._bounds.max)==="undefined" && turf.booleanContains(e.toGeoJSON(), pg.toGeoJSON())==true)
		// 		{	
		// 			pg.bringToFront();
		// 		}
		// }
			
		// });	
	
	//  clickedDrawn=[];
	 e.options.clicked=0;
	 if(e.options.type=="polyg" || e.options.type=="circle")
		 {
		   e.setStyle({fillColor: fc,fillOpacity:sld,color: out,weight:1});
		   let mz=map.getBoundsZoom(e.getBounds());
		 map.setZoom(mz-2);
		 }
	 else if(e.options.type=="polylineGis")
		 {
		   e.setStyle({color: fc,weight:1*sld});
		   let mz=map.getBoundsZoom(e.getBounds());
   map.setZoom(mz-2);
		 }
	 else if(e.options.type=="pointGis")
	 {
	   e.setIcon(fc);
	   // let mz=map.getBoundsZoom(e.getLatLng());
		 map.setZoom(10);
	   
	 }
	 
	 
	 let inda=clickedY.indexOf(e);
	 delete clickedY[inda];
	 let inda2=clickedZ.indexOf(e);
	 if(inda2!=-1)
	 {
	   delete clickedZ[inda2];

	 }
	 

   }
   

   console.log("ouiVVVV");
 var elt1=z.rows;
 console.log("oui666");
 // var p=0;

			let ss=z.rows[0].getElementsByTagName("th")[0].innerText;
for(j=1;j<elt1.length;j++)
{
 //elt1[i].className = '';
 if(elt1[j].getElementsByTagName("td")[0].innerText==e.options.attributes[ss])
 {
  
   if(elt1[j].className =="")
   {
	 if(multp==0)
	 {
	   for(m of elt1)
	   {
		 m.className ="";
	   }
	   for(m of bdslc.rows)
	   {
		 m.remove();
	   }
	   
	   
	 }
	 elt1[j].classList.add("selected");
   let tablerw=elt1[j].cloneNode(true);
   bdslc.appendChild(tablerw);
   console.log(tablerw)
   console.log(bdslc)

   // tableSlc.appendChild(tbdSlc);


   }
   else
   {
	 
	 for(m of bdslc.rows)
	   {
		 if(m.getElementsByTagName("td")[0].innerText==e.options.attributes[ss])
		 {
		   m.remove();
		   break;
		 }
	   }
	   
	 
	 elt1[j].className ="";
   }
  
  console.log("trouvÃ©")
  break;
   // elt1[j].className=='selected'
}
}
console.log("oui777");
selectedHighlighted(z,bdslc,lbl);
setZindexItem2(e)

}


// var pgs=[];
// var table,tableSlc,tbdSlc,lab,fc,sc,out,t;

var greenIcon = new L.Icon({
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
iconSize: [12, 20],
iconAnchor: [6, 20],
popupAnchor: [6, 10],
shadowSize: [20, 20]
});

var blueIcon = new L.Icon({
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
iconSize: [12, 20],
iconAnchor: [6, 20],
popupAnchor: [6, 40],
shadowSize: [20, 20]
});

var redIcon = new L.Icon({
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
iconSize: [12, 20],
iconAnchor: [6, 20],
popupAnchor: [6, 10],
shadowSize: [20, 20]
});

var yellowIcon = new L.Icon({
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',
shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
iconSize: [12, 20],
iconAnchor: [6, 20],
popupAnchor: [6, 10],
shadowSize: [20, 20]
});

var whiteIcon = new L.Icon({
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',
shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
iconSize: [12, 20],
iconAnchor: [6, 20],
popupAnchor: [6, 10],
shadowSize: [20, 20]
});

var orangeIcon = new L.Icon({
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png',
shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
iconSize: [12, 20],
iconAnchor: [6, 20],
popupAnchor: [6, 10],
shadowSize: [20, 20]
});

var cyanIcon = new L.Icon({
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',
shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
iconSize: [12, 20],
iconAnchor: [6, 20],
popupAnchor: [6, 10],
shadowSize: [20, 20]
});

var blackIcon = new L.Icon({
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-black.png',
shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
iconSize: [12, 20],
iconAnchor: [6, 20],
popupAnchor: [6, 10],
shadowSize: [20, 20]
});

// function drawMarker(icn,ltlng)
// {
//   const markerTexture = await PIXI.Assets.load(icn);

// const marker = new PIXI.Sprite(markerTexture);
// marker.anchor.set(0.5, 1);

// const pixiContainer = new PIXI.Container();
// pixiContainer.addChild(marker);

// let firstDraw = true;
// let prevZoom;

// const pixiOverlay = L.pixiOverlay((utils) => {
//     const zoom = utils.getMap().getZoom();
//     const container = utils.getContainer();
//     const renderer = utils.getRenderer();
//     const project = utils.latLngToLayerPoint;
//     const scale = utils.getScale();
//     let options,
//     if (firstDraw) {
//         const markerCoords = project(ltlng);
//         marker.x = markerCoords.x;
//         marker.y = markerCoords.y;
//     }

//     if (firstDraw || prevZoom !== zoom) {
//         marker.scale.set(1 / scale);
//     }

//     firstDraw = false;
//     prevZoom = zoom;
//     renderer.render(container);
// }, pixiContainer);

// pixiOverlay.addTo(map);
// return marker;
// }

// var markerLayer = new L.ConditionalMarkers({
//         minZoomShow: 8,
//         viewportPadding: 0.0
//       });


function myFunction()
   {
	 
	   
	   onclickPgs(t,pgs,table,tableSlc,lab,fc,sc,out,slider.value);
	 
	 
   }

function myFunction2()
{
   function myFunction3(e)
 {
   addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value);
 }
}

function myFunction4()
{
   function myFunction5(e)
 {
   addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);
 }
}

function parsePolyStrings(ps,sc) {
 let i, j, lat, lng, tmp, tmpArr,
	arr = [],
	 
	 //match '(' and ')' plus contents between them which contain anything other than '(' or ')'
	 m = ps.match(/\([^\(\)]+\)/g);
	 let smwgs;
 if (m !== null) {
	 for (i = 0; i < m.length; i++) {
		 //match all numeric strings
		 tmp = m[i].match(/-?\d+\.?\d*/g);
		 if (tmp !== null) {
			 //convert all the coordinate sets in tmp from strings to Numbers and convert to LatLng objects
			 for (j = 0, tmpArr = []; j < tmp.length; j+=2) {
				 lat = Number(tmp[j+1]);
				 lng = Number(tmp[j]);
				   smwgs=proj4(sc,wgs,[lng,lat]);
				 tmpArr.push(new L.latLng(smwgs[1], smwgs[0]));
			 }
			 arr.push(tmpArr);
		 }
	 }
 }
 //array of arrays of LatLng objects, or empty array
 return arr;
}


   function updateOpacity(ly,value) {
for(let i=0; i<ly.length;i++)
{
 ly[i].setStyle({opacity: value,fillOpacity: value});
}
}
   var allInter,reste;
   var clickedR;
   var idx=[0,0,0,0];
   var layChv=[];
   var layChvR=[];
//  var map = L.map('map', { editable: true }).setView([29.949134,-6.5], 8);
 var map = L.map('map', { editable: true }).setView([41.38886738109273, 2.1858716011047363], 18);
 L.control.scale().addTo(map);
 var north = L.control({position: "topright"});
north.onAdd = function(map) {
    var div = L.DomUtil.create("div", "info legend");
    div.innerHTML = '<img src="north.png" style="width:40px;heigh:60px">';
    return div;
}
north.addTo(map);

// var legend = L.control.Legend({
//             position: "bottomleft",
//             collapsed: false,
//             symbolWidth: 24,
//             opacity: 1,
//             column: 2,
            // legends: [{
            //     label: "Marker1",
            //     type: "image",
            //     url: "marker/marker-red.png",
            // }, 
			// {
            //     label: "Marker2",
            //     type: "image",
            //     url: "marker/purple.png"
            // }, {
            //     label: "Circle",
            //     type: "circle",
            //     radius: 6,
            //     color: "blue",
            //     fillColor: "#FF0000",
            //     fillOpacity: 0.6,
            //     weight: 2,
            //     layers: [marker],
            //     inactive: true,
            // }, {
            //     label: "Real line",
            //     type: "polyline",
            //     color: "#FF0000",
            //     fillColor: "#FF0000",
            //     weight: 2,
            //     layers: polyline
            // }, {
            //     label: "Dotted line",
            //     type: "polyline",
            //     color: "#0000FF",
            //     fillColor: "#0000FF",
            //     dashArray: [5, 5],
            //     weight: 2
            // }, {
            //     label: "Rectangle",
            //     type: "rectangle",
            //     color: "#FF0000",
            //     fillColor: "#FF0000",
            //     weight: 2
            // }, {
            //     label: "Square",
            //     type: "polygon",
            //     sides: 4,
            //     color: "#FF0000",
            //     fillColor: "#FF0000",
            //     weight: 2
            // }, {
            //     label: "Regular triangle",
            //     type: "polygon",
            //     sides: 3,
            //     color: "#FF0000",
            //     fillColor: "#FF0000",
            //     weight: 2
            // }, {
            //     label: "Regular polygon",
            //     type: "polygon",
            //     sides: 5,
            //     color: "#FF0000",
            //     fillColor: "#FF0000",
            //     weight: 2
            // }]
        // });
		// legend.addTo(map);

		var LAYERS_AND_LEGENDS = [
        {
            title: "Base Maps",
            layers: [
                {
                    'title': "OSM Basemap",
                    'layer': L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {}),
                    'legend': [
                        { 'type':'line', 'color':'#e99dae', 'text':"Interstate Highway" },
                        { 'type':'line', 'color':'#f2baa8', 'text':"State Highway" },
                        { 'type':'line', 'color':'#e1c6db', 'text':"State Boundary" },
                        { 'type':'square', 'color':'#bdd3d3', 'text':"Water" },
                    ],
                },
                // add more layer objects to this section
            ]
        },
        // add more sections, with a 'section' title and a list of layers:[]
        // {
            // title: "Second Section",
            // layers: [ ... add layers to this accordion section ... ]
        // },
        // to make a section with no title and expand/collapse behavior, add directory: false and skip the title
        // this is particularly useful for legends with only one section
        // {
        //     directory: false,
        //     layers: [
        //         {
        //                 'title': 'Boundary',
        //                 // 'layer': vectorLayer,
        //                 'legend': [{ 'type':'square', 'color':'#bdd3d3', 'text':'' }],
        //                 'opacity': 0.1
        //         },
        //         // ... more layers
        //     ],
        // },
    ];

    new L.Control.AccordionLegend({
        content: LAYERS_AND_LEGENDS,position: "bottomright"
    }).addTo(map);

 var GS=googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
 maxZoom: 20,
 subdomains:['mt0','mt1','mt2','mt3']
}).addTo(map);

// var OSM = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);

// var osmb = new OSMBuildings({
//     container: 'map',
//     position: { latitude: 52.52000, longitude: 13.41000 },
//     zoom: 16,
//     minZoom: 15,
//     maxZoom: 22
//   });
var myTower = {
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "properties": {
              "wallColor": "rgb(255,0,0)",
              "roofColor": "rgb(255,128,0)",
              "height": 30,
              "minHeight": 0,
              "piso": 0,
			  "shape": "cylinder",
			  
            },
            "geometry": {
              "type": "Polygon",
              "coordinates": [
                [
                  [2.1853861212730408, 41.38901629106905],
                  [2.185828685760498, 41.388623892423745],
                  [2.1864724159240723, 41.38910281968238],
                  [2.185984253883362, 41.3894167364756],
                  [2.1853861212730408, 41.38901629106905]
                ]
              ]
            }
          },
          {
            "type": "Feature",
            "properties": {
              "wallColor": "",
              "roofColor": "",
              "height": 60,
              "minHeight": 30,
              "piso": 1
            },
            "geometry": {
              "type": "Polygon",
              "coordinates": [
                [
                  [2.185606062412262, 41.389012266479575],
                  [2.1858233213424683, 41.3888210981928],
                  [2.186225652694702, 41.38910483197434],
                  [2.1859654784202576, 41.38927386427688],
                  [2.185606062412262, 41.389012266479575]
                ]
              ]
            }
          },
          {
            "type": "Feature",
            "properties": {
              "wallColor": "green",
              "roofColor": "cyan",
              "height": 90,
              "minHeight": 60,
              "piso": 2,
			  "shape":"sphere",
			  "center": [2.185753583908081, 41.38902031565826],
			  "radius": 4
			  
            },
            "geometry": {
              "type": "Polygon",
              "coordinates": [
                [
                  [2.185753583908081, 41.38902031565826],
                  [2.1858367323875423, 41.388959946793776],
                  [2.1860405802726746, 41.38910885655806],
                  [2.1859386563301086, 41.389177274443526],
                  [2.1857374906539917, 41.389022327952766],
                  [2.185753583908081, 41.38902031565826]
                ]
              ]
            }
          },
          {
            "type": "Feature",
            "properties": {
              "wallColor": "rgb(255,0,0)",
              "roofColor": "rgb(255,128,0)",
              "height": 120,
              "minHeight": 90,
              "piso": 3,
			  "roofShape":"cone",
			  "roofHeight":4

	            },
            "geometry": {
              "type": "Polygon",
              "coordinates": [
                [
                  [2.185858190059662, 41.38905653695002],
                  [2.185858190059662, 41.38907867217396],
                  [2.185882329940796, 41.38907867217396],
                  [2.185882329940796, 41.38905653695002],
                  [2.185858190059662, 41.38905653695002]
                ]
              ]
            }
          }
        ]
      }

	//   for (i = 0, gridLength = myTower.features.length; i < gridLength; i++) {
    //       myTower.features[i].properties.wallColor = '#0033CC';
    //       myTower.features[i].properties.roofColor = 'rgb(150,180,210)';
    //       myTower.features[i].properties.height = myTower.features[i].properties.height * 20
    //       myTower.features[i].properties.minHeight = myTower.features[i].properties.minHeight * 20;
    //   }
	  

      
	var osmb2 = new OSMBuildings(map).load();
	
		var osmb= new OSMBuildings(map).set(myTower);
		osmb.date(new Date(2014, 4, 15, 8, 30))
		
      var tile=new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
          maxZoom: 22}
      );

	  var Esri_WorldShadedRelief = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri',
	maxZoom: 22
});

var Esri_OceanBasemap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Sources: GEBCO, NOAA, CHS, OSU, UNH, CSUMB, National Geographic, DeLorme, NAVTEQ, and Esri',
	maxZoom: 22
});

var elevationLayer = new Topography.TopoLayer({ 
  topotype: 'slope', 
  token: 'pk.eyJ1IjoibWVkbXpvdXJpIiwiYSI6ImNrbXQ5dXV0NzBwbGkycnBiMjNqY2JmY3kifQ.ixtZJYME8oXUB8yBCNeZRg'
//   customization: <customization_options>
});

L.Topography.configure({
  token: 'pk.eyJ1IjoibWVkbXpvdXJpIiwiYSI6ImNrbXQ5dXV0NzBwbGkycnBiMjNqY2JmY3kifQ.ixtZJYME8oXUB8yBCNeZRg'
});

map.on('click', async e => {
  const { elevation, slope, aspect } = await L.Topography.getTopography(e.latlng)
  console.log(elevation, slope, aspect)
})

      L.control.layers({}, { Buildings:osmb2,OSM:tile,Satellite:GS,Shaded_relief:Esri_WorldShadedRelief,elevation:elevationLayer,Hydro:Esri_OceanBasemap}).addTo(map);
	//   osmb.addEventListener("click", function(){alert("ok");});
	function osmbc()
	{
		alert("ok");
	}
	osmb.on('loadfeature', function(e) {
    var b = e.detail;
    if (b.id.indexOf('highlight_') === -1) {
      var id = b.properties.relationId || b.id || b.properties.id;
      b.properties.color = HIGHLIGHT_COLOR;
      b.properties.roofColor = HIGHLIGHT_COLOR;
      b.properties.relationId = '';
      b.id = 'highlight_' + b.id;
      if (id in buildings) {
        buildings[id].push(b);
      } else {
        buildings[id] = [b];
      }
    }
});

var elevation_options = {

// Default chart colors: theme lime-theme, magenta-theme, ...
theme: "lightblue-theme",

// Chart container outside/inside map container
detached: true,

// if (detached), the elevation chart container
elevationDiv: "#elevation-div",

// if (!detached) autohide chart profile on chart mouseleave
autohide: false,

// if (!detached) initial state of chart profile control
collapsed: false,

// if (!detached) control position on one of map corners
position: "topright",

// Toggle close icon visibility
closeBtn: true,

// Autoupdate map center on chart mouseover.
followMarker: true,

// Autoupdate map bounds on chart update.
autofitBounds: true,

// Chart distance/elevation units.
imperial: false,

// [Lat, Long] vs [Long, Lat] points. (leaflet default: [Lat, Long])
reverseCoords: false,

// Acceleration chart profile: true || "summary" || "disabled" || false
acceleration: false,

// Slope chart profile: true || "summary" || "disabled" || false
slope: false,

// Speed chart profile: true || "summary" || "disabled" || false
speed: false,

// Altitude chart profile: true || "summary" || "disabled" || false
altitude: true,

// Display time info: true || "summary" || false
time: true,

// Display distance info: true || "summary" || false
distance: true,

// Summary track info style: "inline" || "multiline" || false
summary: 'multiline',

// Download link: "link" || false || "modal"
downloadLink: 'link',

// Toggle chart ruler filter
ruler: true,

// Toggle chart legend filter
legend: true,

// Toggle "leaflet-almostover" integration
almostOver: true,

// Toggle "leaflet-distance-markers" integration
distanceMarkers: false,

// Toggle "leaflet-edgescale" integration
edgeScale: false,

// Toggle "leaflet-hotline" integration
hotline: true,

// Display track datetimes: true || false
timestamps: false,

// Display track waypoints: true || "markers" || "dots" || false
waypoints: true,

// Toggle custom waypoint icons: true || { associative array of <sym> tags } || false
wptIcons: {
  '': L.divIcon({
    className: 'elevation-waypoint-marker',
    html: '<i class="elevation-waypoint-icon"></i>',
    iconSize: [30, 30],
    iconAnchor: [8, 30],
  }),
},

// Toggle waypoint labels: true || "markers" || "dots" || false
wptLabels: true,

// Render chart profiles as Canvas or SVG Paths
preferCanvas: true,

};

// Instantiate map (leaflet-ui).

// Instantiate elevation control.
var controlElevation = L.control.elevation(elevation_options).addTo(map);

// Load track from url (allowed data types: "*.geojson", "*.gpx", "*.tcx")
controlElevation.load("https://raruto.github.io/leaflet-elevation/examples/via-emilia.gpx");


 let options = {
 position: 'bottomright',
};

var drawnItems = new L.FeatureGroup().addTo(map);

new L.Toolbar2.DrawToolbar({
    position: 'topleft'
}).addTo(map);

new L.Toolbar2.EditToolbar.Control({
    position: 'topleft',
}).addTo(map, drawnItems);

map.on('draw:created', function(evt) {
			var type = evt.layerType,
				layer = evt.layer;

			drawnItems.addLayer(layer);
		});


var fllsc=new L.Control.Fullscreen(options);
 map.addControl(fllsc);
 
//  var customControl3 =  L.Control.extend({        
//    options: {
// 	 position: 'bottomleft'
//    },

//    onAdd: function (map) {
// 	 var container = L.DomUtil.get('zoneRech');

// 	 return container;
//    }
//  });
//  map.addControl(new customControl3());

 var customControl =  L.Control.extend({        
   options: {
	 position: 'bottomright'
   },

   onAdd: function (map) {
	 var container = L.DomUtil.get('dbgouter6');

	 return container;
   }
 });
 // map.addControl(new customControl());

 // var divR=document.createElement("div");
 // divR.setAttribute("id", "zoneRech");
 // divR.style.width="100px";
 // divR.style.height="20px";
 // divR.style.outline="2px";
 // divR.textContent='test'
 // // divR.style.display="none";
 // document.body.appendChild(divR);
 

 var customControl2 =  L.Control.extend({        
   options: {
	 position: 'topright'
   },

   onAdd: function (map) {
	 var container = L.DomUtil.get('cntrl');
	 document.getElementById("cntrl").style.display="block";

	 return container;
   }
 });
 map.on('fullscreenchange', function () {
   if(map.isFullscreen())
   {
 map.addControl(new customControl2());

   }
   else
   {
	 document.getElementById("cntrl").style.display="none";

	}
});


 
//  var msr=L.control.measure({
//    options: {
// 	 position: 'bottomright'
//    },
//  //  distance formatter, output mile instead of km
//  formatDistance: function (val) {
//    return Math.round(1000 * val / 1000) + ' metres';
//  }
 
// });
// map.addControl(msr);

// let measurePolygonControl = L.control.measurePolygon();
//  measurePolygonControl.addTo(map);



// msr.on('click', function(e) {

//       for(i=0;i<permisAll.length;i++)
//   {
//     permisAll[i][0].setInteractive(false);
//   }
//     });
var options3 = {
 position: 'topright',
 modal: true,
 title: "Box area zoom"
};
var control5 = L.control.zoomBox(options3);
map.addControl(control5);

// var control6 = L.Map.BoxZoom(options3);
// map.addControl(control6);


// osmb.addGeoJSON(geojson);
// let geoJsonBlock={
//     "type": "FeatureCollection", 
//     "features": [
//         {
//             "type": "Feature", 
//             "geometry": {
//                 "type": "Polygon", 
//                 "coordinates": [
//                     [
//                         [
//                             120.62857, 
//                             24.1948
//                         ], 
//                         [
//                             120.62918, 
//                             24.19465
//                         ], 
//                         [
//                             120.62867, 
//                             24.19412
//                         ], 
//                         [
//                             120.6285, 
//                             24.19419
//                         ], 
//                         [
//                             120.62896, 
//                             24.19465
//                         ], 
//                         [
//                             120.62882, 
//                             24.19469
//                         ], 
//                         [
//                             120.62837, 
//                             24.19423
//                         ], 
//                         [
//                             120.62821, 
//                             24.19428
//                         ], 
//                         [
//                             120.62863, 
//                             24.19473
//                         ], 
//                         [
//                             120.62853, 
//                             24.19476
//                         ], 
//                         [
//                             120.62857, 
//                             24.1948
//                         ]
//                     ]
//                 ]
//             }, 
//             "properties": {
//                 "color": "rgb(150,180,210)", 
//                 "height": 140
//             }
//         }
//     ]
// };
// function getCenter(geoJson) {
//   var geometry, len = 0, lat = 0, lon = 0;

//   for (var i = 0, il = geoJson.features.length; i < il; i++) {
//     geometry = geoJson.features[i].geometry.coordinates[0];
//     if (geometry[0][0][0]) {
//       geometry = geometry[0];
//     }

//     len += geometry.length-1;
//     for (var j = 0, jl = geometry.length-1; j < jl; j++) {
//       lat += geometry[j][1];
//       lon += geometry[j][0];
//     }
//   }

//   return { lat:lat/len, lon:lon/len };
// }


// function setGeoJSON() {
//   try {
//     var geoJson = JSON.parse(geoJsonBlock.value);
//   } catch(e) {}
//   osmb.addGeoJSON(geoJson);
//   var center = getCenter(geoJson);
//   map.setView([center.lat, center.lon], 17)
// }


// setGeoJSON();
// var osmb = new OSMBuildings(map).loadData();
// L.control.layers({}, { Buildings:osmb }).addTo(map);



// var redIcon = L.icon({
//     iconUrl: 'iconn.svg',
 

//     iconSize:     [90, 110], // size of the icon
 
//     iconAnchor:   [45, 55], // point of the icon which will correspond to marker's location
//     popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
 
// });
var redIcon1 = L.icon({
 iconUrl: 'newIcon.svg',
 

 iconSize:     [8, 37], // size of the icon
 
 iconAnchor:   [4, 18.5], // point of the icon which will correspond to marker's location
 popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
 
});
var redIcon2 = L.icon({
 iconUrl: 'newIcon.svg',
 

 iconSize:     [32, 37], // size of the icon
 
 iconAnchor:   [16, 18.5], // point of the icon which will correspond to marker's location
 popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
 
});

var palette='<select name="color" class="form-control" id="palette1" style="background-color:#0071c5"><option style="background-color:#0071c5;" value="blue">blue</option><option style="background-color:#40E0D0;" value="cyan">cyan</option><option style="background-color:#008000;" value="green">green</option><option style="background-color:#FFD700;" value="yellow">yellow</option><option style="background-color:#FF8C00;" value="orange">orange</option><option style="background-color:#FF0000;" value="red">red</option><option style="background-color:#000;" value="black">black</option></select>'
// var drawnItems = new L.FeatureGroup();
var colorsPlt=["blue","cyan","green","yellow","orange","red","black"];
var slctPlt=["yellow","orange","red","blue","cyan","green","white"];
var outPlt=["white","black","blue","black","black","blue","red"];
//     map.addLayer(drawnItems);
 var permis = [];
 var reserv = [];
 var permis2 = [];
 var permisAll = [];
 var pn = [];
 var lc = [];
//L.geoJSON(MAR).addTo(map);
var pg=[];
var pg2=[];
var pg3=[];
var pg4=[];
var parc;
var diff,crdd;
var chvch=[];
var chvchR=[];
var clicked=[];
var clicked2=[];

var mod=0;

// var crtRaster=L.imageOverlay("OUARZAZATE.jpg",[[31.000000000000057,-6.499999999999943],[30.500000000000057,-6.999999999999943]]);









var un2f,un2;
function cursormap()
{


// var elt4=document.getElementsByTagName("tr");
// for(i=0;i<elt4.length;i++)
//   {
//       elt4[i].className='';
//   }

 map.closePopup();
	 // createMap2(true);

	 
   L.DomUtil.removeClass(map._container,'crosshair-cursor-enabled');
   
}



var popup = L.popup();
const options2 = {
token: 'pk.eyJ1IjoibWVkbXpvdXJpIiwiYSI6ImNrbXQ5dXV0NzBwbGkycnBiMjNqY2JmY3kifQ.ixtZJYME8oXUB8yBCNeZRg'
}
// L.Topography.configure({
//   token: 'pk.eyJ1IjoibWVkbXpvdXJpIiwiYSI6ImNrbXQ5dXV0NzBwbGkycnBiMjNqY2JmY3kifQ.ixtZJYME8oXUB8yBCNeZRg'
// });
// const elevationLayer = new Topography.TopoLayer({ 
//   topotype: 'elevation', 
//   token: 'pk.eyJ1IjoibWVkbXpvdXJpIiwiYSI6ImNrbXQ5dXV0NzBwbGkycnBiMjNqY2JmY3kifQ.ixtZJYME8oXUB8yBCNeZRg'

// });

// elevationLayer.addTo(map);



// const call = (input) => {
//         return new Promise((resolve, reject) => {
//             return resolve({
//                 val: input
//             })
//         })
//     }

 // Letâs await the response of the promise
 // and log the result to the console

 // test();



// function onMapClick(e) {
// 	  if(document.getElementById("rd4").checked)
// 	  {
	  
// 	   // getElevation([e.latlng.lat,e.latlng.lng]);
// 	   var crd1=proj4(wgs,sm,[e.latlng.lng,e.latlng.lat]);
// 	 var crd2=proj4(wgs,nm,[e.latlng.lng,e.latlng.lat]);
// 	 var pt2 = turf.point([e.latlng.lng,e.latlng.lat]);

// var nrc=turf.nearestPoint(pt2, cities);
// var nrckm=" ("+nrc.properties.distanceToPoint.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" km)";

// var nrcom;

// for(let i=0;i<communes.features.length;i++)
// {

// var plc=turf.polygon([communes.features[i].geometry.coordinates[0]]);
// if (turf.booleanPointInPolygon(pt2, plc)) {

// 	nrcom=communes.features[i].properties.NOM_COM;
//    break;
//   }
// }
// var nrprv="";
// 	 for(let i=0;i<provinces.features.length;i++)
// 	   {
		 
// 		 var plc=turf.polygon([provinces.features[i].geometry.coordinates[0]]);
// 	   if (turf.booleanPointInPolygon(pt2, plc)) {
		 
// 			 nrprv=provinces.features[i].properties.Nom_Provin;
// 		   break;
// 		   }
// 	   }

// 	 Topography.getTopography(e.latlng, options2)
	 
// 	  .then((results) =>popup.setLatLng(e.latlng).setContent("<b>WGS:</b> " +parseFloat(e.latlng.lng).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+"<b> ; </b> "+parseFloat(e.latlng.lat).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+ "<br><b>SUD MAROC:</b> "+parseFloat(crd1[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(crd1[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><b>NORD MAROC:</b> "+parseFloat(crd2[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(crd2[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><span style='color:blue'><b>Altitude:</b></span> "+parseFloat(results.elevation).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" m"+ "<br><b>Ville: </b> "+nrc.properties.name+nrckm+"<br><b>Province :</b> "+nrprv+"<br><b>Commune :</b> "+nrcom).openOn(map));
// 	 //  const printAddress = async () => {
// 	 //     res = await res2;
		 
// 	 //   };
// 	 //   printAddress();
// 	   //
	 
	   
	  
	 
	 
	 
// 	 document.getElementById("X").value=parseFloat(crd1[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];
// 	  document.getElementById("Y").value=parseFloat(crd1[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];
// 	  document.getElementById("rd2").checked=true;

// 	  document.getElementById("X2").value=parseFloat(crd1[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];
// 	  document.getElementById("Y2").value=parseFloat(crd1[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];
// 	  document.getElementById("rd22").checked=true;
// 	  }
	  
//    }
// map.on('click', onMapClick);

</script>

</div>

<script>
//   map.data.setStyle(function(feature) {

//     return {
//       fillColor: 'red',
//       strokeWeight: 1
//     };
// });

//php

// $mp= $_COOKIE['mp'];
// var map = 'php echo $mp ;?>';


	 

 
</script>
<script>
var wgs = new proj4.Proj('EPSG:4326'); 
      proj4.defs("EPSG:26192","+proj=lcc +lat_1=29.7 +lat_0=29.7 +lon_0=-5.4 +k_0=0.9996155960000001 +x_0=500000 +y_0=300000 +a=6378249.2 +b=6356515 +towgs84=31,146,47,0,0,0,0 +units=m +no_defs");
      var sm =new proj4.Proj('EPSG:26192');  
      proj4.defs("EPSG:26191","+proj=lcc +lat_1=33.3 +lat_0=33.3 +lon_0=-5.4 +k_0=0.999625769 +x_0=500000 +y_0=300000 +a=6378249.2 +b=6356515 +towgs84=31,146,47,0,0,0,0 +units=m +no_defs");
      var nm =new proj4.Proj('EPSG:26191'); 
      proj4.defs("EPSG:102191","+proj=lcc +lat_1=33.3 +lat_0=33.3 +lon_0=-5.4 +k_0=0.999625769 +x_0=500000 +y_0=300000 +a=6378249.2 +b=6356515 +towgs84=31,146,47,0,0,0,0 +units=m +no_defs");
      var nmd=new proj4.Proj('EPSG:102191'); 
      proj4.defs("EPSG:102192","+proj=lcc +lat_1=29.7 +lat_0=29.7 +lon_0=-5.4 +k_0=0.9996155960000001 +x_0=500000 +y_0=300000 +a=6378249.2 +b=6356514.999904194 +units=m +no_defs");
      var smd=new proj4.Proj('EPSG:102192'); 



// function parsePolyStrings(ps,sc) {
//     var i, j, lat, lng, tmp, tmpArr,
//         arr = [],
        
//         //match '(' and ')' plus contents between them which contain anything other than '(' or ')'
//         m = ps.match(/\([^\(\)]+\)/g);
//         var smwgs;
//     if (m !== null) {
//         for (i = 0; i < m.length; i++) {
//             //match all numeric strings
//             tmp = m[i].match(/-?\d+\.?\d*/g);
//             if (tmp !== null) {
//                 //convert all the coordinate sets in tmp from strings to Numbers and convert to LatLng objects
//                 for (j = 0, tmpArr = []; j < tmp.length; j+=2) {
//                     lat = Number(tmp[j+1]);
//                     lng = Number(tmp[j]);
//                     console.log([lng,lat]);
//                     if(sc=='Sud Maroc')
//                     {
//                       smwgs=proj4(sm,wgs,[lng,lat]);
//                     }
//                      else if(sc=='Nord Maroc')
//                     {
//                       smwgs=proj4(nm,wgs,[lng,lat]);
//                       console.log([smwgs[1], smwgs[0]]);

//                     }
//                     else
//                     {
//                       smwgs=[lng,lat];
//                     }

//                     tmpArr.push(new L.latLng(smwgs[1], smwgs[0]));
//                 }
//                 arr.push(tmpArr);
//             }
//         }
//     }
//     //array of arrays of LatLng objects, or empty array
//     return arr;
// }
var markers=[];
 // var layerGroup = L.layerGroup().addTo(map);
//     var redIcon = L.icon({
//     iconUrl: 'iconn.svg',
 

//     iconSize:     [90, 110], // size of the icon
 
//     iconAnchor:   [45, 55], // point of the icon which will correspond to marker's location
//     popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
 
// });
 var redIcon1 = L.icon({
 iconUrl: 'newIcon.svg',
 

 iconSize:     [8, 37], // size of the icon
 
 iconAnchor:   [4, 18.5], // point of the icon which will correspond to marker's location
 popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
 
});
var redIcon2 = L.icon({
 iconUrl: 'newIcon.svg',
 

 iconSize:     [32, 37], // size of the icon
 
 iconAnchor:   [16, 18.5], // point of the icon which will correspond to marker's location
 popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
 
});

// map.on('zoomend', function() {
//     var currentZoom = map.getZoom();
//     if (currentZoom > 11) {
//       if(document.getElementById("cities").checked)
//       {
//         cit.eachLayer(function(layer) {
//           layer.bindPopup('<h1>'+layer.feature.properties.name+'</h1>');
//                 return layer.setIcon(redIcon2);
		
//         });
//       }
	
   
	 
//     } else {

//       if(document.getElementById("cities").checked)
//       {
//         cit.eachLayer(function(layer) {
		 
//             return layer.setIcon(redIcon1);
	
//     });
//       }
  

//     }
// });


function gotoxy()
 {  
	// let tb=document.getElementById("tableSp");
	// let tblBd=tb.getElementsByTagName("tbody")[0];
    // let rows=tblBd.rows;
	// let radius = 2000;
	// let options = {steps: 64, units: 'meters', properties: {foo: 'bar'}};
	// let carteS;
	// for(let u=0;u<lyrsT[0].length;u++)
	// {
	// 			for(let v=0;v<lyrsT[1].length;v++)
	// 		{
	// 			if(turf.booleanPointInPolygon(lyrsT[0][u].toGeoJSON(), lyrsT[1][v].toGeoJSON()))
	// 			{
	// 				rows[u].getElementsByTagName("td")[27].innerText=lyrsT[1][v].options.attributes.Nom_Commun;
	// 				lyrsT[0][u].options.attributes.Commune2=lyrsT[1][v].options.attributes.Nom_Commun;
	// 				break;
	// 			}

	// 		}
	// 		let center=[lyrsT[0][u].getLatLng().lng,lyrsT[0][u].getLatLng().lat];
	// 		console.log(center)
	// 		let circle = turf.circle(center, radius, options);
	// 		 carteS="";
	// 		for(let v=0;v<lyrsT[2].length;v++)
	// 		{
	// 			if(turf.booleanIntersects(circle, lyrsT[2][v].toGeoJSON()))
	// 			{
	// 				carteS=carteS+"-"+lyrsT[2][v].options.attributes.Carte;
	// 				rows[u].getElementsByTagName("td")[28].innerText=carteS;
	// 				lyrsT[0][u].options.attributes.Carte2=carteS;
	// 			}

	// 		}
	// }





	// return;
   var cnm,csm,marker,pt;
   var x=parseFloat(document.getElementById("X").value);
   var y=parseFloat(document.getElementById("Y").value);
   if (document.getElementById("country2").value=="4326")
   {
	 csm=proj4(wgs,sm,[x,y]);
	 cnm=proj4(wgs,nm,[x,y]);
	 //marker=new L.Marker([y,x]);  
	 marker=new L.Marker([y,x], {icon: redIcon});  
	 marker.addTo(map);
	 map.setView([y, x], 16);
	//  marker.addTo(layerGroup);
	 markers.push(marker);
	 
// 	 pt = turf.point([x,y]);

//   var nrc=turf.nearestPoint(pt, cities);
//   var nrckm=" ("+nrc.properties.distanceToPoint.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" km)";
//    var nrcom;
 
//    for(let i=0;i<communes.features.length;i++)
//    {
	 
// 	 var plc=turf.polygon([communes.features[i].geometry.coordinates[0]]);
// 	if (turf.booleanPointInPolygon(pt, plc)) {
	 

// 		 nrcom=communes.features[i].properties.NOM_COM;
// 		break;
// 	   }
//    }
//    var nrprv="";
// 	 for(let i=0;i<provinces.features.length;i++)
// 	   {
		 
// 		 var plc=turf.polygon([provinces.features[i].geometry.coordinates[0]]);
// 	   if (turf.booleanPointInPolygon(pt, plc)) {
		 
// 			 nrprv=provinces.features[i].properties.Nom_Provin;
// 		   break;
// 		   }
// 	   }
   
  
// 	 Topography.getTopography(marker.getLatLng(), options2)
	 
// 	  .then((results) =>marker.bindPopup("<b>WGS:</b> "  +parseFloat(x).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+"<b> ; </b> "+parseFloat(y).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+ "<br><b>SUD MAROC:</b> "+parseFloat(csm[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(csm[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><b>NORD MAROC:</b> "+parseFloat(cnm[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(cnm[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><span style='color:blue'><b>Altitude:</b></span> "+parseFloat(results.elevation).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" m"+ "<br><b>Ville: </b> "+nrc.properties.name+nrckm+ "<br><b>Province: </b> "+nrprv+"<br><b>Commune: </b> "+nrcom));
	 
   }
   else if(document.getElementById("country2").value=="26192") {
	 csm=proj4(sm,wgs,[x,y]);
	 cnm=proj4(sm,nm,[x,y]);
	 marker=new L.Marker([csm[1],csm[0]], {icon: redIcon});  
	 marker.addTo(map);
	 map.setView([csm[1], csm[0]], 16);
	 
	 // map.panTo(new L.LatLng(csm[1], csm[0]));
	 // map.setZoom(16);
	//  marker.addTo(layerGroup);
	 markers.push(marker);
// 	 pt = turf.point([csm[0],csm[1]]);

// var nrc=turf.nearestPoint(pt, cities);
// var nrckm=" ("+nrc.properties.distanceToPoint.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" km)";
// var nrcom;

// for(let i=0;i<communes.features.length;i++)
// {

// var plc=turf.polygon([communes.features[i].geometry.coordinates[0]]);
// if (turf.booleanPointInPolygon(pt, plc)) {


// 	nrcom=communes.features[i].properties.NOM_COM;
//    break;
//   }
// }
// var nrprv="";
// 	 for(let i=0;i<provinces.features.length;i++)
// 	   {
		 
// 		 var plc=turf.polygon([provinces.features[i].geometry.coordinates[0]]);
// 	   if (turf.booleanPointInPolygon(pt, plc)) {
		 
// 			 nrprv=provinces.features[i].properties.Nom_Provin;
// 		   break;
// 		   }
// 	   }



// Topography.getTopography(marker.getLatLng(), options2)
	 
// .then((results) =>marker.bindPopup("<b>WGS:</b> " +parseFloat(csm[0]).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+"<b> ; </b> "+parseFloat(csm[1]).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+ "<br><b>SUD MAROC:</b> " +parseFloat(x).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(y).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+  "<br><b>NORD MAROC:</b> "+parseFloat(cnm[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(cnm[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><span style='color:blue'><b>Altitude:</b></span> "+parseFloat(results.elevation).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" m"+ "<br><b>Ville: </b> "+nrc.properties.name+nrckm+ "<br><b>Province: </b> "+nrprv+ "<br><b>Commune: </b> "+nrcom));

	 

	 // var center = [csm[0], csm[1]];
	 // var radius = 2000;
	 // var options = {steps: 128, units: 'meters'};
	 // var circle = turf.circle(center, radius, options);
	 // var bb=turf.bboxPolygon(turf.bbox(circle));
	 // var centroid = turf.centroid(bb);
	 //
	 //
   }
   else
   {
	 cnm=proj4(nm,wgs,[x,y]);
	 csm=proj4(nm,sm,[x,y]);
	 marker=new L.Marker([cnm[1],cnm[0]], {icon: redIcon});  
	 marker.addTo(map);
	 map.setView([cnm[1], cnm[0]], 16);
	//  marker.addTo(layerGroup);
	 markers.push(marker);
	 pt = turf.point([cnm[0],cnm[1]]);


// var nrc=turf.nearestPoint(pt, cities);
// var nrckm=" ("+nrc.properties.distanceToPoint.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" km)";
// var nrcom;

// for(let i=0;i<communes.features.length;i++)
// {

// var plc=turf.polygon([communes.features[i].geometry.coordinates[0]]);
// if (turf.booleanPointInPolygon(pt, plc)) {


// 	nrcom=communes.features[i].properties.NOM_COM;
//    break;
//   }
// }
// var nrprv="";
// 	 for(let i=0;i<provinces.features.length;i++)
// 	   {
		 
// 		 var plc=turf.polygon([provinces.features[i].geometry.coordinates[0]]);
// 	   if (turf.booleanPointInPolygon(pt, plc)) {
		 
// 			 nrprv=provinces.features[i].properties.Nom_Provin;
// 		   break;
// 		   }
// 	   }


// Topography.getTopography(marker.getLatLng(), options2)
	 
// .then((results) =>marker.bindPopup("<b>WGS:</b> " +parseFloat(cnm[0]).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+"<b> ; </b> "+parseFloat(cnm[1]).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+ "<br><b>SUD MAROC:</b> "+parseFloat(csm[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(csm[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><b>NORD MAROC:</b> "+parseFloat(x).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(y).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><span style='color:blue'><b>Altitude:</b></span> "+parseFloat(results.elevation).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" m"+ "<br><b>Ville: </b> "+nrc.properties.name+nrckm+ "<br><b>Province: </b> "+nrprv+ "<br><b>Commune: </b> "+nrcom));
	
   }
  

 }

//  function gotoxy2()
//  {
 
//    var cnm,csm,marker,pt;
//    var x=parseFloat(document.getElementById("X2").value);
//    var y=parseFloat(document.getElementById("Y2").value);
//    if (document.getElementById("rd12").checked)
//    {
// 	 csm=proj4(wgs,sm,[x,y]);
// 	 cnm=proj4(wgs,nm,[x,y]);
// 	 //marker=new L.Marker([y,x]);  
// 	 marker=new L.Marker([y,x], {icon: redIcon});  
// 	 marker.addTo(map);
// 	 map.setView([y, x], 16);
// 	 marker.addTo(layerGroup);
// 	 markers.push(marker);
	 
// 	 pt = turf.point([x,y]);

//   var nrc=turf.nearestPoint(pt, cities);
//   var nrckm=" ("+nrc.properties.distanceToPoint.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" km)";
//    var nrcom;
 
//    for(let i=0;i<communes.features.length;i++)
//    {
	 
// 	 var plc=turf.polygon([communes.features[i].geometry.coordinates[0]]);
// 	if (turf.booleanPointInPolygon(pt, plc)) {
	 

// 		 nrcom=communes.features[i].properties.NOM_COM;
// 		break;
// 	   }
//    }
//    var nrprv="";
// 	 for(let i=0;i<provinces.features.length;i++)
// 	   {
		 
// 		 var plc=turf.polygon([provinces.features[i].geometry.coordinates[0]]);
// 	   if (turf.booleanPointInPolygon(pt, plc)) {
		 
// 			 nrprv=provinces.features[i].properties.Nom_Provin;
// 		   break;
// 		   }
// 	   }
   
  
// 	 Topography.getTopography(marker.getLatLng(), options2)
	 
// 	  .then((results) =>marker.bindPopup("<b>WGS:</b> "  +parseFloat(x).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+"<b> ; </b> "+parseFloat(y).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+ "<br><b>SUD MAROC:</b> "+parseFloat(csm[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(csm[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><b>NORD MAROC:</b> "+parseFloat(cnm[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(cnm[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><span style='color:blue'><b>Altitude:</b></span> "+parseFloat(results.elevation).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" m"+ "<br><b>Ville: </b> "+nrc.properties.name+nrckm+ "<br><b>Province: </b> "+nrprv+"<br><b>Commune: </b> "+nrcom));
	 
//    }
//    else if(document.getElementById("rd22").checked) {
// 	 csm=proj4(sm,wgs,[x,y]);
// 	 cnm=proj4(sm,nm,[x,y]);
// 	 marker=new L.Marker([csm[1],csm[0]], {icon: redIcon});  
// 	 marker.addTo(map);
// 	 map.setView([csm[1], csm[0]], 16);
	 
// 	 // map.panTo(new L.LatLng(csm[1], csm[0]));
// 	 // map.setZoom(16);
// 	 marker.addTo(layerGroup);
// 	 markers.push(marker);
// 	 pt = turf.point([csm[0],csm[1]]);

// var nrc=turf.nearestPoint(pt, cities);
// var nrckm=" ("+nrc.properties.distanceToPoint.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" km)";
// var nrcom;

// for(let i=0;i<communes.features.length;i++)
// {

// var plc=turf.polygon([communes.features[i].geometry.coordinates[0]]);
// if (turf.booleanPointInPolygon(pt, plc)) {


// 	nrcom=communes.features[i].properties.NOM_COM;
//    break;
//   }
// }
// var nrprv="";
// 	 for(let i=0;i<provinces.features.length;i++)
// 	   {
		 
// 		 var plc=turf.polygon([provinces.features[i].geometry.coordinates[0]]);
// 	   if (turf.booleanPointInPolygon(pt, plc)) {
		 
// 			 nrprv=provinces.features[i].properties.Nom_Provin;
// 		   break;
// 		   }
// 	   }



// Topography.getTopography(marker.getLatLng(), options2)
	 
// .then((results) =>marker.bindPopup("<b>WGS:</b> " +parseFloat(csm[0]).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+"<b> ; </b> "+parseFloat(csm[1]).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+ "<br><b>SUD MAROC:</b> " +parseFloat(x).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(y).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+  "<br><b>NORD MAROC:</b> "+parseFloat(cnm[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(cnm[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><span style='color:blue'><b>Altitude:</b></span> "+parseFloat(results.elevation).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" m"+ "<br><b>Ville: </b> "+nrc.properties.name+nrckm+ "<br><b>Province: </b> "+nrprv+ "<br><b>Commune: </b> "+nrcom));

	 

// 	 // var center = [csm[0], csm[1]];
// 	 // var radius = 2000;
// 	 // var options = {steps: 128, units: 'meters'};
// 	 // var circle = turf.circle(center, radius, options);
// 	 // var bb=turf.bboxPolygon(turf.bbox(circle));
// 	 // var centroid = turf.centroid(bb);
// 	 //
// 	 //
//    }
//    else
//    {
// 	 cnm=proj4(nm,wgs,[x,y]);
// 	 csm=proj4(nm,sm,[x,y]);
// 	 marker=new L.Marker([cnm[1],cnm[0]], {icon: redIcon});  
// 	 marker.addTo(map);
// 	 map.setView([cnm[1], cnm[0]], 16);
// 	 marker.addTo(layerGroup);
// 	 markers.push(marker);
// 	 pt = turf.point([cnm[0],cnm[1]]);


// var nrc=turf.nearestPoint(pt, cities);
// var nrckm=" ("+nrc.properties.distanceToPoint.toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" km)";
// var nrcom;

// for(let i=0;i<communes.features.length;i++)
// {

// var plc=turf.polygon([communes.features[i].geometry.coordinates[0]]);
// if (turf.booleanPointInPolygon(pt, plc)) {


// 	nrcom=communes.features[i].properties.NOM_COM;
//    break;
//   }
// }
// var nrprv="";
// 	 for(let i=0;i<provinces.features.length;i++)
// 	   {
		 
// 		 var plc=turf.polygon([provinces.features[i].geometry.coordinates[0]]);
// 	   if (turf.booleanPointInPolygon(pt, plc)) {
		 
// 			 nrprv=provinces.features[i].properties.Nom_Provin;
// 		   break;
// 		   }
// 	   }


// Topography.getTopography(marker.getLatLng(), options2)
	 
// .then((results) =>marker.bindPopup("<b>WGS:</b> " +parseFloat(cnm[0]).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+"<b> ; </b> "+parseFloat(cnm[1]).toString().match(/^-?\d+(?:\.\d{0,5})?/)[0]+ "<br><b>SUD MAROC:</b> "+parseFloat(csm[0]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(csm[1]).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><b>NORD MAROC:</b> "+parseFloat(x).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"<b> ; </b> "+parseFloat(y).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+ "<br><span style='color:blue'><b>Altitude:</b></span> "+parseFloat(results.elevation).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+" m"+ "<br><b>Ville: </b> "+nrc.properties.name+nrckm+ "<br><b>Province: </b> "+nrprv+ "<br><b>Commune: </b> "+nrcom));
	
//    }
//    var cdtpg=turf.polygon([cadetaf.features[0].geometry.coordinates[0]]);
  
//    if(turf.booleanPointInPolygon(pt, cdtpg))
// 		 {
// 		   alert("le point se situe dans la zone CADETAF");
// 		 }
// 		 var mrc=turf.polygon([morocco.features[0].geometry.coordinates[0]]);
//    var mrc2=turf.polygonToLine(mrc);
//    let distancemrc = turf.pointToLineDistance(pt,mrc2, {units: 'meters'});
// 		 if(distancemrc<10000)
// 		 {
// 		   alert("zone frontaliÃ¨re");
// 		 }
// 		 if(turf.booleanPointInPolygon(pt, mrc)==false && distancemrc>10000)
// 		 {
// 		   alert("le point se situe hors le maroc");
// 		 }
		
//  //   marker.setLatLng(y, x);
//  //   var marker = new L.Marker([12, 15]);
  
//  var lmt="";
//  let distanceKm2 = turf.pointToLineDistance(pt,limit, {units: 'meters'});
//  if(distanceKm2>10000 && turf.booleanPointInPolygon(pt, limit2)==false)
// 		 {
// 		   alert("le point se situe hors la rÃ©gion Draa-Tafilalet");
		 
// 		 }
// 		 for(let i=0;i<limits.length;i++)
//    {
// 	 var pl= limits[i][0];
// 	 var pl2= limits[i][2];
	 
// 	 let distanceKm = turf.pointToLineDistance(pt,pl, {units: 'meters'});
	 
	
// 		if(distanceKm<6000 && distanceKm2<6000)
// 		 {
// 		   lmt=lmt+"/"+limits[i][1];
		
		 
// 		 }
		  
//    }
// 		 if(lmt!="")
// 		 {
// 		   alert("Zone limitrophe avec "+lmt);
		  
// 		 }

//  }

function removeMarkers() {
// addunion();
layerGroup.clearLayers();
}
var dragpol="";

function printExternal(url) {
 var printWindow = window.open( url, 'Print', 'left=200, top=200, width=950, height=500, toolbar=0, resizable=0');

 printWindow.addEventListener('load', function() {
	 if (Boolean(printWindow.chrome)) {
		 printWindow.print();
		 setTimeout(function(){
			 printWindow.close();
		 }, 500);
	 } else {
		 printWindow.print();
		 printWindow.close();
	 }
 }, true);
}



function intersect()
{

if(document.getElementById("rd5").checked)
{
 allInter.setStyle({fillColor: 'purple',opacity: 1,fillOpacity: 1,color: 'red',weight:1});
 allInter.bringToFront();
 allInter.addTo(map); 
 var str="";
 for(let p=0;p<chvchR.length;p++)
 {
   str+="/"+chvchR[p].options.N_Permis;

 }
 str=str.substring(1);
 allInter.bindPopup("Les chevauchements sont: " +str).openPopup();
}
else{
 
 map.removeLayer(allInter);
}

}
var hg2=[];
function chvchm()
{
var str="";
var redn=[];
if(hg2.length>0)
{
 for(let p=0;p<hg2.length;p++)
 {
   hg2[p].removeFrom(map);
 
}
}

map.eachLayer(function (layer) {
layer.closePopup();
});

if(document.getElementById("rd7").checked)
{
 
 for(let p=0;p<chvch.length;p++)
 {
   hg2[p]=L.geoJSON(chvch[p][0].toGeoJSON());
   hg2[p].setStyle({fillColor: 'pink',opacity: 1,fillOpacity: 1,color: 'white',weight:2});
 if(chvch[p][0].options.N_Permis!=null)
 {
   chvch[p][0].bindPopup(chvch[p][0].options.N_Permis, {closeOnClick: false, autoClose: false}).openPopup();

   redn[p]=chvch[p][0].options.N_Permis;
 }
 else
 {
   if(chvch[p][0].options.N_Licence!=null)
   {
	 chvch[p][0].bindPopup('LE'+chvch[p][0].options.N_Licence, {closeOnClick: false, autoClose: false}).openPopup();
   redn[p]='LE'+chvch[p][0].options.N_Licence;
   }

   else
   {
	 chvch[p][0].bindPopup('R'+chvch[p][0].options.nr, {closeOnClick: false, autoClose: false}).openPopup();
   redn[p]='R'+chvch[p][0].options.nr;
   }
   
 }
 hg2[p].addTo(map);
 hg2[p].setInteractive(false);
 
}
redn=[...new Set(redn)];
for(let p=0;p<redn.length;p++)
 {
str+="/"+redn[p];
 }
 str=str.substring(1);
 clicked[clicked.length-1].bindPopup("Les intersections sont: " +str).openPopup();
}
else{
 map.eachLayer(function (layer) {
layer.closePopup();
 });
 for(let p=0;p<hg2.length;p++)
 {
   hg2[p].removeFrom(map);
 
}
}
 

}
var hg=[];

function erase()
{
var area;
if(reste!="" && reste!=null)
{
 area = (turf.area(reste.toGeoJSON())/1000000).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];
 if(area>16)
 {
   area=16.00;
 }
 else
 {
   area = (turf.area(reste.toGeoJSON())/1000000).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0];
 }
 if(document.getElementById("rd6").checked)
{
 reste.setStyle({fillColor: 'orange',opacity: 1,fillOpacity: 1,weight:0});
 // reste.bringToFront();
 reste.addTo(map); 

 reste.bindPopup(area +" km2",{closeOnClick: false, autoClose: false}).openPopup();
}
else{
 map.removeLayer(reste);
 map.closePopup();
}
} 
}





var lastZoom,zoom;
function showHide(id,layer,color)
{
if(document.getElementById(id).checked==false)
{
 // for(let l of layer) {
 //     if (l.getTooltip) {
 //     var toolTip = l.getTooltip();
 //     if (toolTip) {
 //       this.map.closeTooltip(toolTip);
 //     }
 //   }
 // }
 if(allInter!=null)
 {
   allInter.setStyle({opacity: 0,fillOpacity: 0,weight:0});

 }
 if(reste!=null && reste!="")
 {
   reste.setStyle({opacity: 0,fillOpacity: 0,weight:0});

 }
 
 map.closePopup();
for (let l of layer)
{
 l.setStyle({opacity: 0,fillOpacity: 0,weight:0});
 l.unbindTooltip();
}
for(i=0;i<layer.length;i++)
 {
   layer[i].setInteractive(false);
 }
}
else
{
//   zoom = map.getZoom();
//   if (zoom >= 12) {
//     for(let l of layer) {
//       if (l.getTooltip) {
//       var toolTip = l.getTooltip();
//       if (toolTip) {
//         this.map.addLayer(toolTip);
//       }
//     }
//   }
// }
if(allInter!=null)
 {
   allInter.setStyle({fillColor: 'purple',opacity: 1,fillOpacity: 1,color: 'red',weight:1});
 }
 
if(reste!=null && reste!="")
 {
   reste.setStyle({fillColor: 'orange',opacity: 1,fillOpacity: 1,weight:0});

 }
 for(i=0;i<layer.length;i++)
 {
   layer[i].setInteractive(true);
 }
 for (let l of layer)
{
 
   if(clicked.includes(l))
 {
   l.setStyle({opacity: 1,fillOpacity: 1,fillColor:'red',weight:3});
   continue;
 }
//  if(layChv.includes(l) && document.getElementById("rd7").checked)
//   {
//     l.setStyle({opacity: 1,fillOpacity: 1,fillColor:'white',color: 'red',weight:1});
//     continue;
//   }
//   if(layChvR.includes(l) && document.getElementById("rd8").checked)
//   {
//     l.setStyle({opacity: 1,fillOpacity: 1,fillColor:'white',color: 'red',weight:1});
//     continue;
//   }
 
   l.setStyle({opacity: 1,fillOpacity: 1,fillColor:color,weight:1});
 
 }
 
 
 
}
 
 
}

// function showHideCDT(id)
// {
// if(document.getElementById(id).checked==false)
// {
//  cadetafG.removeFrom(map);
// }
// else
// {
//  cadetafG.addTo(map);
//  cadetafG.setInteractive(false);
 
// }
 
 
// }

// function showHideCRT(id)
// {
// if(document.getElementById(id).checked==false)
// {
//  crtRaster.removeFrom(map);
// }
// else
// {
//  crtRaster.addTo(map);
 
// }
 
 
// }
// var com=L.geoJSON(communes);
var trfc,trfcI;

// var com = L.geoJSON(communes, {
// onEachFeature: function (feature, layer) {
 
//  layer.bindPopup('<h1>'+feature.properties.NOM_COM+'</h1>');
//  layer.setStyle({color: 'red',weight:2});
//  layer.addEventListener("click", function() {
//  //   trfc=L.geoJSON(layer.toGeoJSON());
//  // trfc.setStyle({color: 'white',weight:3});
//  // trfc.addTo(map);

 
//  if(layer.feature.id==trfcI)
//  {
  
//    trfc.removeFrom(map);
//    trfc.closePopup();
//    trfcI=10000000000001;
//  }
//  else
//  {
//    if(trfc!=10000000000001 && trfc!=null)
//    {
// 	 trfc.removeFrom(map);
//    }
   
//    // trfc.removeFrom(map);
  
//    trfc=L.geoJSON(layer.toGeoJSON());
//  trfc.setStyle({color: 'white',weight:3});
//  trfc.addTo(map);
//  trfc.setInteractive(false);
//  trfcI=layer.feature.id;
//  }



// });

// }
// });



function showHideCom(id)
{
if(document.getElementById(id).checked==false)
{
 com.removeFrom(map);
 if(trfc)
   {
	 trfc.removeFrom(map);
   }
}
else
{
 
 com.setStyle({color: 'red',weight:2});
		 com.addTo(map);
		 com.bringToBack();
				 
}
 
 
}

// var reg=L.geoJSON(region);

// function showHideReg(id)
// {
// if(document.getElementById(id).checked==false)
// {
//  reg.removeFrom(map);
 
// }
// else
// {
 
//  reg.setStyle({color: 'white',weight:3});
// 		 reg.addTo(map);
// 		 reg.bringToBack();
// 		 reg.setInteractive(false);
// }
 
 
// }

function createCustomIcon (feature, latlng) {
let myIcon = redIcon1;
return L.marker(latlng, { icon: myIcon })
}

// create an options object that specifies which function will called on each feature
let myLayerOptions = {
pointToLayer: createCustomIcon
}

var trfcit,trfcitI;
// var cit = L.geoJSON(cities,myLayerOptions, {
// onEachFeature: function (feature, layer) {
 
//  layer.bindPopup('<h1>'+feature.properties.name+'</h1>');
//  layer.setStyle({color: 'red',weight:2});
//  layer.addEventListener("click", function() {
//  //   trfc=L.geoJSON(layer.toGeoJSON());
//  // trfc.setStyle({color: 'white',weight:3});
//  // trfc.addTo(map);

 
//  if(layer.feature.id==trfcitI)
//  {
  
//    trfcit.removeFrom(map);
//    trfcit.closePopup();
//    trfcitI=10000000000001;
//  }
//  else
//  {
//    if(trfcitI!=10000000000001 && trfcitI!=null)
//    {
// 	 trfcit.removeFrom(map);
//    }
   
//    // trfc.removeFrom(map);
  
//    trfcit=L.geoJSON(layer.toGeoJSON());
//  trfcit.setStyle({color: 'white',weight:3});
//  trfcit.addTo(map);
//  trfcit.setInteractive(false);
//  trfcitI=layer.feature.id;
//  }



// });

// }
// });

function showHideCit(id)
{
if(document.getElementById(id).checked==false)
{
 cit.removeFrom(map);
 if(trfcit)
   {
	 trfcit.removeFrom(map);
   }
}
else
{
 
 cit.setStyle({color: 'red',weight:2});
		 cit.addTo(map);
		 cit.bringToBack();
				 
}


}

var trfp,trfpI;

// var prov = L.geoJSON(provinces, {
// onEachFeature: function (feature, layer) {
 
//  layer.bindPopup('<h1>'+feature.properties.Nom_Provin+'</h1>');
//  layer.setStyle({color: 'pink',weight:5});
//  layer.addEventListener("click", function() {
//  //   trfc=L.geoJSON(layer.toGeoJSON());
//  // trfc.setStyle({color: 'white',weight:3});
//  // trfc.addTo(map);

 
//  if(layer.feature.id==trfpI)
//  {
  
//    trfp.removeFrom(map);
//    trfp.closePopup();
//    trfpI=10;
//  }
//  else
//  {
//    if(trfp!=10 && trfp!=null)
//    {
// 	 trfp.removeFrom(map);
//    }
   
//    // trfc.removeFrom(map);
  
//    trfp=L.geoJSON(layer.toGeoJSON());
//  trfp.setStyle({color: 'white',weight:3});
//  trfp.addTo(map);
//  trfp.setInteractive(false);
//  trfpI=layer.feature.id;
//  }



// });

// }
// });

function showHideProv(id)
{
if(document.getElementById(id).checked==false)
{
 prov.removeFrom(map);
 if(trfp)
   {
	 trfp.removeFrom(map);
   }
}
else
{
 
 prov.setStyle({color: 'pink',weight:5});
		 prov.addTo(map);
		 prov.bringToBack();
				 
}
 
 
}


var trfr,trfrI;

// var regi = L.geoJSON(regions, {
// onEachFeature: function (feature, layer) {
 
//  layer.bindPopup('<h1>'+feature.properties.Nom_Region+'</h1>');
//  layer.setStyle({color: 'brown',weight:5});
//  layer.addEventListener("click", function() {
//  //   trfc=L.geoJSON(layer.toGeoJSON());
//  // trfc.setStyle({color: 'white',weight:3});
//  // trfc.addTo(map);

 
//  if(layer.feature.id==trfrI)
//  {
  
//    trfr.removeFrom(map);
//    trfr.closePopup();
//    trfrI=1000001;
//  }
//  else
//  {
//    if(trfr!=1000001 && trfr!=null)
//    {
// 	 trfr.removeFrom(map);
//    }
   
//    // trfc.removeFrom(map);
  
//    trfr=L.geoJSON(layer.toGeoJSON());
//  trfr.setStyle({color: 'white',weight:3});
//  trfr.addTo(map);
//  trfr.setInteractive(false);
//  trfrI=layer.feature.id;
//  }



// });

// }
// });

function showHideRegions(id)
{
if(document.getElementById(id).checked==false)
{
 regi.removeFrom(map);
 if(trfr)
   {
	 trfr.removeFrom(map);
   }
}
else
{
 
 regi.setStyle({color: 'brown',weight:5});
		 regi.addTo(map);
		 regi.bringToBack();
				 
}
 
 
}


var trfg,trfgI;

// var geo = L.geoJSON(geologie, {
// onEachFeature: function (feature, layer) {
 
//  layer.bindPopup('<h1>'+feature.properties.desc_+'</h1>');
//  layer.setStyle({color: 'green',weight:5});
//  layer.addEventListener("click", function() {
//  //   trfc=L.geoJSON(layer.toGeoJSON());
//  // trfc.setStyle({color: 'white',weight:3});
//  // trfc.addTo(map);

 
//  if(layer.feature.id==trfgI)
//  {
  
//    trfg.removeFrom(map);
//    trfg.closePopup();
//    trfgI=10000001;
//  }
//  else
//  {
//    if(trfgI!=10000001 && trfgI!=null)
//    {
// 	 trfg.removeFrom(map);
//    }
   
//    // trfc.removeFrom(map);
  
//    trfg=L.geoJSON(layer.toGeoJSON());
//  trfg.setStyle({color: 'white',weight:3});
//  trfg.addTo(map);
//  trfg.setInteractive(false);
//  trfgI=layer.feature.id;
//  }



// });

// }
// });

function showHideGeo(id)
{
if(document.getElementById(id).checked==false)
{
 geo.removeFrom(map);
 if(trfg)
   {
	 trfg.removeFrom(map);
   }
}
else
{
 
 geo.setStyle({color: 'green',weight:5});
		 geo.addTo(map);
		 geo.bringToBack();
				 
}
 
 
}





// map.on('zoomend', function() {
//   zoom = map.getZoom();

//   if (zoom < 12) {
//     map.eachLayer(function(l) {
//       if (l.getTooltip) {
//         var toolTip = l.getTooltip();
//         if (toolTip) {
//           this.map.closeTooltip(toolTip);
//         }
//       }
//     });
//     for(let l of permis) {
//         if (l.getTooltip) {
//         var toolTip = l.getTooltip();
//         if (toolTip) {
//           map.closeTooltip(toolTip);
//         }
	 
//       }
//     }
//   } else if (zoom >= 12) {
//     map.eachLayer(function(l) {
//       if (l.getTooltip) {
//         var toolTip = l.getTooltip();
//         if (toolTip) {
//           this.map.closeTooltip(toolTip);
//         }
//       }
//     });
//     for(let l of permis) {
//         if (l.getTooltip) {
//         var toolTip = l.getTooltip();
//         if (toolTip) {
//           map.closeTooltip(toolTip);
//         }
	 
//       }
//     }
//     map.eachLayer(function(l) {
//       if (l.getTooltip) {
//         var toolTip = l.getTooltip();
//         if (toolTip) {
//           this.map.addLayer(toolTip);
//         }
//       }
//     });
//   }
//   lastZoom = zoom;

// })


function showTable(y) {
var x = document.getElementById("myTable");
 var x2 = document.getElementById("myTable2");
 var x3 = document.getElementById("myTable6");
 var x4 = document.getElementById("myTable4");
 var xN = document.getElementById("myTableN");
 var x5 = document.getElementById("myTable5");
 var x5N = document.getElementById("myTable5N");
 // var x6 = document.getElementById("myTable6");
 // var x6N = document.getElementById("myTable6N");
 var x2N = document.getElementById("myTable2N");
 var x3N = document.getElementById("myTable6N");
 var x4N = document.getElementById("myTable4N");
 var z = document.getElementById("PM");
 var z2 = document.getElementById("LC");
 var z3 = document.getElementById("PN");
 var z4 = document.getElementById("RS");
 var z5 = document.getElementById("Soc");
 var b = document.getElementById("btn4");
 // var b2 = document.getElementById("btn5");
 // var b3 = document.getElementById("btn6");
 var b4 = document.getElementById("btn7");
 var b42 = document.getElementById("btn72");

 var rsv = document.getElementsByClassName("accordion");
 var rsv2 = document.getElementsByClassName("panel");
 var rcp=document.getElementById("recipissePR");
 var prgOuv=document.getElementById("prgOuv");


if(y=="PM")
{
 b.style.display = "none";
 // b2.style.display = "block";
 // b3.style.display = "block";
 b4.style.display = "none";
 b42.style.display = "none";
 

 rsv[0].style.display = "none";
 rsv2[0].style.display = "none";
 rsv[1].style.display = "block";
 rsv[1].innerText="Dossier PR";
 rcp.style.display = "none";
 prgOuv.style.display = "block";
 rsv2[1].style.display = "none";
 rsv[2].style.display = "block";
 // rsv2[2].style.display = "block";
 rsv[3].style.display = "block";
 rsv[4].style.display = "block";

 // rsv2[3].style.display = "block";
 // rsv2[4].style.display = "block";


 z2.checked=false;
 z3.checked=false;
 z4.checked=false;
 z5.checked=false;

 x2.style.display = "none";
 x4.style.display = "none";
 x2N.style.display = "none";
 x4N.style.display = "none";
 x5.style.display = "none";
 x5N.style.display = "none";
 x3.style.display = "none";
 x3N.style.display = "none";

 // x3.style.display = "none";
if (x.style.display === "none") {
 x.style.display = "block";
 x.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x.getElementsByTagName("thead")[0].style.position="sticky";
 x.getElementsByTagName("thead")[0].style.top="0";

 xN.style.display = "block";
 xN.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 xN.getElementsByTagName("thead")[0].style.position="sticky";
 xN.getElementsByTagName("thead")[0].style.top="0";
} else {
 x.style.display = "none";
 xN.style.display = "none";
}
}
else if(y=="PN")
{
 // b3.style.display = "none";
 // b2.style.display = "none";
 b.style.display = "none";
 b4.style.display = "none";
 b42.style.display = "none";

 rsv[0].style.display = "none";
 rsv2[0].style.display = "none";
 rsv[1].style.display = "none";
 rsv2[1].style.display = "none";
 rsv[2].style.display = "none";
 rsv2[2].style.display = "none";
 rsv[3].style.display = "none";
 rsv2[3].style.display = "none";
 rsv[4].style.display = "none";
 rsv2[4].style.display = "none";

 z.checked=false;
 z2.checked=false;
 z4.checked=false;
 z5.checked=false;


 x.style.display = "none";
 x4.style.display = "none";
 xN.style.display = "none";
 x4N.style.display = "none";
 x5.style.display = "none";
 x5N.style.display = "none";
 x3.style.display = "none";
 x3N.style.display = "none";
 //x3.style.display = "none";
if (x2.style.display === "none") {
 x2.style.display = "block";
 x2.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x2.getElementsByTagName("thead")[0].style.position="sticky";
 x2.getElementsByTagName("thead")[0].style.top="0";
 x2N.style.display = "block";
 x2N.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x2N.getElementsByTagName("thead")[0].style.position="sticky";
 x2N.getElementsByTagName("thead")[0].style.top="0";
} else {
 x2.style.display = "none";
 x2N.style.display = "none";
}
}
else if(y=="RS")
{
 // b3.style.display = "none";
 // b2.style.display = "none";
 b.style.display = "block";
 b4.style.display = "block";
 b42.style.display = "block";
 
 rsv[0].style.display = "block";
 rsv[1].style.display = "block";
 rsv[1].innerText="Institution PR";
 prgOuv.style.display = "none";

 rcp.style.display = "block";
 rsv[2].style.display = "none";
 rsv2[2].style.display = "none";
 rsv[3].style.display = "none";
 rsv[4].style.display = "none";
 rsv2[4].style.display = "none";

 rsv2[3].style.display = "none";
 z.checked=false;
 z2.checked=false;
 z3.checked=false;
 z5.checked=false;
 
 x.style.display = "none";
 x2.style.display = "none";
 xN.style.display = "none";
 x2N.style.display = "none";
 x5.style.display = "none";
 x5N.style.display = "none";
 x3.style.display = "none";
 x3N.style.display = "none";
 //x3.style.display = "none";
if (x4.style.display === "none") {
 x4.style.display = "block";
 x4.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x4.getElementsByTagName("thead")[0].style.position="sticky";
 x4.getElementsByTagName("thead")[0].style.top="0";
 x4N.style.display = "block";
 x4N.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x4N.getElementsByTagName("thead")[0].style.position="sticky";
 x4N.getElementsByTagName("thead")[0].style.top="0";
} else {
 x4.style.display = "none";
 x4N.style.display = "none";
}
}
else if(y=="LC")
{
 // b3.style.display = "none";
 // b2.style.display = "none";
 b.style.display = "none";
 b4.style.display = "none";
 b42.style.display = "none";

 rsv[0].style.display = "none";
 rsv2[0].style.display = "none";
 rsv[1].style.display = "none";
 rsv2[1].style.display = "none";
 rsv[2].style.display = "none";
 rsv2[2].style.display = "none";
 rsv[3].style.display = "none";
 rsv2[3].style.display = "none";
 rsv[4].style.display = "block";
 // rsv2[4].style.display = "block";

 z.checked=false;
 z3.checked=false;
 z4.checked=false;
 z5.checked=false;

  x.style.display = "none";
 x2.style.display = "none";
 x4.style.display = "none";
 xN.style.display = "none";
 x2N.style.display = "none";
 x4N.style.display = "none";
 x5.style.display = "none";
 x5N.style.display = "none";

if (x3.style.display === "none") {
 x3.style.display = "block";
 x3N.style.display = "block";
} else {
 x3.style.display = "none";
 x3N.style.display = "none";
}
}
else if(y=="Soc")
{
 // b3.style.display = "none";
 // b2.style.display = "none";
 // b.style.display = "none";
 // b4.style.display = "none";
 // rsv[0].style.display = "none";
 // rsv2[0].style.display = "none";
 // rsv[1].style.display = "none";
 // rsv2[1].style.display = "none";
 rsv[0].style.display = "none";
 rsv2[0].style.display = "none";
 rsv[1].style.display = "none";
 rsv2[1].style.display = "none";
 rsv[2].style.display = "none";
 rsv2[2].style.display = "none";
 rsv[3].style.display = "none";
 rsv2[3].style.display = "none";
 z.checked=false;
 z3.checked=false;
 z4.checked=false;
 z2.checked=false;

  x.style.display = "none";
 x2.style.display = "none";
 x4.style.display = "none";
 xN.style.display = "none";
 x2N.style.display = "none";
 x4N.style.display = "none";
 x3.style.display = "none";
 x3N.style.display = "none";
if (x5.style.display === "none") {
 x5.style.display = "block";
 x5N.style.display = "block";
} else {
 x5.style.display = "none";
 x5N.style.display = "none";
}
}

}

function showTable2(y) {
var prgOuv=document.getElementById("prgOuv");

var x = document.getElementById("myTable");
 var x2 = document.getElementById("myTable2");
 var x3 = document.getElementById("myTable6");
 var x4 = document.getElementById("myTable4");
 var xN = document.getElementById("myTableN");
 var x2N = document.getElementById("myTable2N");
 var x3N = document.getElementById("myTable6N");
 var x4N = document.getElementById("myTable4N");
 var x5 = document.getElementById("myTable5");
 var x5N = document.getElementById("myTable5N");
 var z = document.getElementById("PM");
 var z2 = document.getElementById("LC");
 var z3 = document.getElementById("PN");
 var z4 = document.getElementById("RS");
 var z5 = document.getElementById("Soc");
 var b = document.getElementById("btn4");
 // var b2 = document.getElementById("btn5");
 // var b3 = document.getElementById("btn6");
 var b4 = document.getElementById("btn7");
 var rsv = document.getElementsByClassName("accordion");
 var rsv2 = document.getElementsByClassName("panel");
 var rcp=document.getElementById("recipissePR");
 // var prgOuv=document.getElementById("prgOuv");


if(y=="PM")
{
 // b3.style.display = "block";
 // b2.style.display = "block";
 b.style.display = "none";
 b4.style.display = "none";
 

 rsv[0].style.display = "none";
 rsv2[0].style.display = "none";
 rsv[1].style.display = "block";
 rsv[1].innerText="Dossier PR";
 rcp.style.display = "none";

 rsv2[1].style.display = "none";
 rsv[2].style.display = "block";
 // rsv2[2].style.display = "block";
 rsv[3].style.display = "block";
 rsv[4].style.display = "block";
 prgOuv.style.display = "block";

 // rsv2[3].style.display = "block";
 z.checked=true;
 z2.checked=false;
 z3.checked=false;
 z4.checked=false;
 z5.checked=false;

 x2.style.display = "none";
 x4.style.display = "none";
 x2N.style.display = "none";
 x4N.style.display = "none";
 x5.style.display = "none";
 x5N.style.display = "none";
 x3.style.display = "none";
 x3N.style.display = "none";
 // x3.style.display = "none";
if (x.style.display === "none") {
 x.style.display = "block";
 x.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x.getElementsByTagName("thead")[0].style.position="sticky";
 x.getElementsByTagName("thead")[0].style.top="0";
 xN.style.display = "block";
 xN.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 xN.getElementsByTagName("thead")[0].style.position="sticky";
 xN.getElementsByTagName("thead")[0].style.top="0";
} 
}
else if(y=="PN")
{
 // b3.style.display = "none";
 // b2.style.display = "none";
 b.style.display = "none";
 b4.style.display = "none";
 rsv[0].style.display = "none";
 rsv2[0].style.display = "none";
 rsv[1].style.display = "none";
 rsv2[1].style.display = "none";
 rsv[2].style.display = "none";
 rsv2[2].style.display = "none";
 rsv[3].style.display = "none";
 rsv[4].style.display = "none";

 // rsv2[3].style.display = "none";
 z3.checked=true;
 z.checked=false;
 z2.checked=false;
 z4.checked=false;
 z5.checked=false;

 x.style.display = "none";
 x4.style.display = "none";
 xN.style.display = "none";
 x4N.style.display = "none";
 x5.style.display = "none";
 x5N.style.display = "none";
 x3.style.display = "none";
 x3N.style.display = "none";
if (x2.style.display === "none") {
 x2.style.display = "block";
 x2.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x2.getElementsByTagName("thead")[0].style.position="sticky";
 x2.getElementsByTagName("thead")[0].style.top="0";
 x2N.style.display = "block";
 x2N.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x2N.getElementsByTagName("thead")[0].style.position="sticky";
 x2N.getElementsByTagName("thead")[0].style.top="0";
} 
}
else if(y=="RS")
{
 // b3.style.display = "none";
 // b2.style.display = "none";
 b.style.display = "block";
 b4.style.display = "block";


 
 rsv[0].style.display = "block";
 rsv[1].style.display = "block";
 rsv[2].style.display = "none";
 rsv2[2].style.display = "none";
 rsv[3].style.display = "none";
 rsv[4].style.display = "none";
 rsv2[4].style.display = "none";

 rsv2[3].style.display = "none";
 rsv[1].innerText="Institution PR";
 prgOuv.style.display = "none";
 rcp.style.display = "block";
 z4.checked=true;
 z.checked=false;
 z2.checked=false;
 z3.checked=false;
 z5.checked=false;
 
 x.style.display = "none";
 x2.style.display = "none";
 xN.style.display = "none";
 x2N.style.display = "none";
 x5.style.display = "none";
 x5N.style.display = "none";
 x3.style.display = "none";
 x3N.style.display = "none";
 //x3.style.display = "none";
if (x4.style.display === "none") {
 x4.style.display = "block";
 x4.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x4.getElementsByTagName("thead")[0].style.position="sticky";
 x4.getElementsByTagName("thead")[0].style.top="0";
 x4N.style.display = "block";
 x4N.getElementsByTagName("thead")[0].style.position="-webkit-sticky";
 x4N.getElementsByTagName("thead")[0].style.position="sticky";
 x4N.getElementsByTagName("thead")[0].style.top="0";
} 
}
else if(y=="LC"){
 // b3.style.display = "none";
 // b2.style.display = "none";
 b.style.display = "none";
 b4.style.display = "none";
 rsv[0].style.display = "none";
 // rsv2[0].style.display = "none";
 rsv[1].style.display = "none";
 rsv2[1].style.display = "none";
 rsv[2].style.display = "none";
 rsv2[2].style.display = "none";
 rsv[3].style.display = "none";
 rsv2[3].style.display = "none";

 rsv[4].style.display = "block";

 // rsv2[3].style.display = "none";
 z2.checked=true;
 z.checked=false;
 z3.checked=false;
 z4.checked=false;
 z5.checked=false;

  x.style.display = "none";
 x2.style.display = "none";
 x4.style.display = "none";
 xN.style.display = "none";
 x2N.style.display = "none";
 x4N.style.display = "none";
 x5.style.display = "none";
 x5N.style.display = "none";
if (x3.style.display === "none") {
 x3.style.display = "block";
 x3N.style.display = "block";
} 
}

}




 </script>
<script>

//   printJS('PHP/bpdf.pdf');
//  
//   window.jsPDF = window.jspdf.jsPDF;

// var doc = new jsPDF();
// doc.text(20, 20, 'Hello world!');
// doc.text(20, 30, 'This is client-side Javascript to generate a PDF.');

// // Add new page
// doc.addPage();
// doc.text(20, 20, 'Visit CodexWorld.com');

// // Save the PDF
// doc.save('document.pdf');




//   const PizZip = require(["pizzip"]);
// const Docxtemplater = require(["docxtemplater"]);

// const fs = require(["fs"]);
// const path = require(["path"]);
// import * as docx from "./node_modules/docxtemplater/js/docxtemplater.js";
// var moduleName = 'docx';
// var Document1 = 'Document';
// var Packer1 = 'Packer';
// var Paragraph1 = 'Paragraph';
// var TextRun1 = 'TextRun';
// require([moduleName]);
// require([Document1], [Packer1], [Paragraph1], [TextRun1]);
// /import { Document, Packer, Paragraph, TextRun } from "./node_modules/docxtemplater/js/docxtemplater.js";
// function generate() {
//   const doc = new docx.Document({
//     sections: [
//       {
//         properties: {},
//         children: [
//           new docx.Paragraph({
//             children: [
//               new docx.TextRun("Hello World"),
//               new docx.TextRun({
//                 text: "Foo Bar",
//                 bold: true
//               }),
//               new docx.TextRun({
//                 text: "\tGithub is the best",
//                 bold: true
//               })
//             ]
//           })
//         ]
//       }
//     ]
//   });

//   docx.Packer.toBlob(doc).then((blob) => {
//    
//     saveAs(blob, "example.docx");
//    
//   });
// }
// generate();

// const content = fs.readFileSync(
//     path.resolve(__dirname, "input.docx"),
//     "binary"
// );

// const zip = new PizZip(content);

// const doc = new Docxtemplater(zip, {
//     paragraphLoop: true,
//     linebreaks: true,
// });

// // Render the document (Replace {first_name} by John, {last_name} by Doe, ...)
// doc.render({
//     first_name: "John",
//     last_name: "Doe",
//     phone: "0652455478",
//     description: "New Website",
// });

// const buf = doc.getZip().generate({
//     type: "nodebuffer",
//     // compression: DEFLATE adds a compression step.
//     // For a 50MB output document, expect 500ms additional CPU time
//     compression: "DEFLATE",
// });

// // buf is a nodejs Buffer, you can either write it to a
// // file or res.send it with express for example.
// fs.writeFileSync(path.resolve(__dirname, "output.docx"), buf);





var trf;
function observ()
{
if(clicked.length==0 && document.getElementById('rd10').checked )
{
 alert("selectionner un titre minier");
 document.getElementById('rd10').checked=false;
 return;
}

if(document.getElementById('rd10').checked)
{
 trf=L.geoJSON(clicked[clicked.length-1].toGeoJSON());
 
 trf.addTo(map);
 trf.setInteractive(false);
 
}
else
{
 trf.removeFrom(map);
}
}

var multp=0;
 function mult()
 {
   if(document.getElementById("rd9").checked)
   {multp=1;}
   else
   {multp=0;}

   

 }

 function mult2()
 {
   if(document.getElementById("rd92").checked)
   {multp=1;}
   else
   {multp=0;}

   

 }

 function clearslc()
 {
   document.getElementById("tot0").value=0;
		 document.getElementById("tot1").value=0;
		 document.getElementById("tot2").value=0;
		 document.getElementById("tot4").value=0;
			 clicked=[];
   var elt3=document.getElementsByTagName("table")[0].rows;
   var elt4=document.getElementsByTagName("table")[1].rows;
   var elt5=document.getElementsByTagName("table")[2].rows;
   var elt6=document.getElementsByTagName("table")[4].rows;
   var elt7=document.getElementsByTagName("table")[3].rows;
   for(i=1;i<elt7.length;i++)
		 {
			 elt7[i].className='';
		 }

		 for(i=1;i<elt3.length;i++)
		 {
			 elt3[i].className='';
		 }
		 for(i=1;i<elt4.length;i++)
		 {
			 elt4[i].className='';
		 }
		 for(i=1;i<elt5.length;i++)
		 {
			 elt5[i].className='';
		 }
		 for(i=1;i<elt6.length;i++)
		 {
			 elt6[i].className='';
		 }
		 document.getElementById("t0").value="";
		 document.getElementById("t02").value='';
		 document.getElementById("t04").value='';
		 document.getElementById("t06").value='';
		 myFunction('myTable','t0');
		 myFunction('myTable2','t02');
		 myFunction('myTable4','t04');
		 myFunction('myTable6','t06');


		 var table2=document.getElementsByTagName('tbody')[5];
					 while(table2.hasChildNodes())
			 {
			   table2.removeChild(table2.firstChild);
			 }
			 var table2=document.getElementsByTagName('tbody')[6];
					 while(table2.hasChildNodes())
			 {
			   table2.removeChild(table2.firstChild);
			 }
			 var table2=document.getElementsByTagName('tbody')[7];
					 while(table2.hasChildNodes())
			 {
			   table2.removeChild(table2.firstChild);
			 }
			 var table2=document.getElementsByTagName('tbody')[9];
					 while(table2.hasChildNodes())
			 {
			   table2.removeChild(table2.firstChild);
			 }
		 for (var t = 0; t < pg2.length; t++)
	   {
		 pg2[t].setStyle({fillColor: 'yellow',color: 'blue',weight:1});
	   }
	   for (var t = 0; t < pg3.length; t++)
	   {
		 pg3[t].setStyle({fillColor: 'black',color: 'blue',weight:1});
	   }
	   for (var t = 0; t < pg4.length; t++)
	   {
		 pg4[t].setStyle({fillColor: 'green',color: 'blue',weight:1});
	   }
	   for (var t = 0; t < pg.length; t++)
	   {
		 pg[t].setStyle({fillColor: 'blue',color: 'orange',weight:1});
	   }
	   // let mz=map.getZoom();
   map.setZoom(10);
 }

 function slctall()
 {
   
   var elt3=document.getElementsByTagName("table")[5].rows;
   var elt4=document.getElementsByTagName("table")[6].rows;
   var elt5=document.getElementsByTagName("table")[7].rows;
   var elt6=document.getElementsByTagName("table")[9].rows;

	 if(document.getElementById("PM").checked)
	 {
	   for(i=1;i<elt3.length;i++)
		 {
			 elt3[i].className='selected2';
		 for (var t = 0; t < pg2.length; t++)
	   {
		 if(pg2[t].options.id==elt3[i].getElementsByTagName("td")[0].innerText)
		 {
		   pg2[t].setStyle({fillColor: 'DarkSeaGreen',color: 'red',weight:3});
		   break;
		 }
		 
	   }
		 } 
	 }
	 else if(document.getElementById("PN").checked)
	 {
	   for(i=1;i<elt4.length;i++)
		 {
			 elt4[i].className='selected2';
			 for (var t = 0; t < pg3.length; t++)
	   {
		 if(pg3[t].options.id==elt4[i].getElementsByTagName("td")[0].innerText)
		 {
		   pg3[t].setStyle({fillColor: 'DarkSeaGreen',color: 'red',weight:3});
		   break;
		 }
		 
	   }
		 }
	 }

	 else if(document.getElementById("RS").checked)
	 {
	   for(i=1;i<elt5.length;i++)
		 {
			 elt5[i].className='selected2';
			 for (var t = 0; t < pg4.length; t++)
	   {
		 if(pg4[t].options.id==elt5[i].getElementsByTagName("td")[0].innerText)
		 {
		   pg4[t].setStyle({fillColor: 'DarkSeaGreen',color: 'red',weight:3});
		   break;
		 }
		 
	   }
		 }
	 }

	 else if(document.getElementById("LC").checked)
	 {
	   for(i=1;i<elt6.length;i++)
		 {
			 elt6[i].className='selected2';
			 for (var t = 0; t < pg.length; t++)
	   {
		 if(pg[t].options.id==elt6[i].getElementsByTagName("td")[0].innerText)
		 {
		   pg[t].setStyle({fillColor: 'DarkSeaGreen',color: 'red',weight:3});
		   break;
		 }
		 
	   }
		 }
	 }

		 
	   
 }

//  function drag2()
// {
//  var str=0;
//  if(clicked.length==0 && document.getElementById("rd112").checked)
//  {
//    alert("sÃ©lectionner un titre minier");
//    document.getElementById("rd11").checked=false;
//    document.getElementById("rd112").checked=false;

//    return;
//  }
//  if(document.getElementById("rd112").checked)
//  {
//    document.getElementById("rd42").checked=false;

//   console.log(clicked.length)
//    clicked[clicked.length-1].dragging.enable();
  
   
//    clicked[clicked.length-1].addEventListener("dragend", function() {

// 	 clicked[clicked.length-1].dragging.enable();
// 	 if(reste!=null && reste!="")
// 	 {
// 	   map.removeLayer(reste);
//  map.closePopup();
// 	 }
	
//  document.getElementById("rd6").checked=false;
//  document.getElementById("rd5").checked=false;
//  document.getElementById("rd7").checked=false;
//  document.getElementById("rd8").checked=false;
//  //alert('drag ended');
//  var pt=turf.getCoord(turf.centroid(this.toGeoJSON()));
//  console.log("1");
//  console.log(this.options.crd);
//  document.getElementById("X2").value=pt[0];
//  document.getElementById("Y2").value=pt[1];
//  document.getElementById("rd12").checked=true;
//  var cdtpg=turf.polygon([cadetaf.features[0].geometry.coordinates[0]]);
  
//    if(turf.intersect(this.toGeoJSON(), cdtpg))
// 		 {
			
// 			 //  return false;
		  
// 		   alert("intersection avec la zone CADETAF");
// 		   // return;
// 		   // clicked[clicked.length-1].dragging.disable();
// 		   // console.log("ds")
// 		   // clicked[clicked.length-1].dragging.enable();
// 		   // console.log("en")
// 		   // return;
// 		 }
// 		 var mrc=turf.polygon([morocco.features[0].geometry.coordinates[0]]);
//    var mrc2=turf.polygonToLine(mrc);
//    let distancemrc = turf.pointToLineDistance(pt,mrc2, {units: 'meters'});
//    console.log("2");
// 		 if(distancemrc<10000)
// 		 {
// 		   alert("zone frontaliÃ¨re");
// 		   // return;
// 		 }
// 		 if(turf.booleanPointInPolygon(pt, mrc)==false && distancemrc>10000)
// 		 {
// 		   alert("le centre se situe hors le maroc");
// 		   // return;
// 		 }
		
//  //   marker.setLatLng(y, x);
//  //   var marker = new L.Marker([12, 15]);
  
//  var lmt="";
//  let distanceKm2 = turf.pointToLineDistance(pt,limit, {units: 'meters'});
//  if(distanceKm2>10000 && turf.booleanPointInPolygon(pt, limit2)==false)
// 		 {
// 		   alert("le centre se situe hors la rÃ©gion Draa-Tafilalet");
// 		   // return;
		 
// 		 }
// 		 for(let i=0;i<limits.length;i++)
//    {
// 	 var pl= limits[i][0];
// 	 var pl2= limits[i][2];
	 
// 	 let distanceKm = turf.pointToLineDistance(pt,pl, {units: 'meters'});
	 
	
// 		if(distanceKm<6000 && distanceKm2<6000)
// 		 {
// 		   lmt=lmt+"/"+limits[i][1];
		
		 
// 		 }
		  
//    }
// 		 if(lmt!="")
// 		 {
// 		   alert("Zone limitrophe avec "+lmt);
// 		   // return;
		  
// 		 }
//  // var location = marker.getLatLng();
//  // var lat = location.lat;
//  // var lon = location.lng;
//  // addToTextBox(lat,lon);
//  //alert(lat);
//  //retrieved the position
//    var feat=[];
// 	   var u=0;
// 	   var z=0;
// 	   var chv;
// 	   chvch=[];
// 	   chvchR=[];
// 	   layChvR=[];
// 	   layChv=[];
// 	   reste="";
// 	   allInter="";
// 	   clicked.push(this);
// 	   var pg=this;
// 	   for (var t = 0; t < permisAll.length; t++)
// 	   {
// 		 var inters=turf.intersect(this.toGeoJSON(), permisAll[t][0].toGeoJSON());
// 		 console.log("2");
		
// 		 if(inters!=null)
// 		 {
		  
// 		   var area2=turf.area(inters)/1000000;
		  
// 		   if(area2<15.95 && area2>0.0015 && permisAll[t][0]!=this)
// 			   {
// 		   chvch[u]=[permisAll[t][0],permisAll[t][1]];
// 		   layChv[u]=permisAll[t][0];
// 		   chvchR[u]=[permisAll[t][0],permisAll[t][1]];
// 			   layChvR[u]=permisAll[t][0];
			  
// 			   feat[u]= inters;
			  
// 		   u++;

		 
// 			   }

// 		 }

// 	   }
	 
// 	   function intersection() {

// 	   if(feat.length!=0)
// 	   {
		 
// 		 var feature = turf.featureCollection(feat);
// 		 console.log("3");
// 		 var un="";
// 		 if(feature.features.length==1)
// 		 {
// 		   un=feature.features[0];
// 		 }
// 		 if(feature.features.length==2)
// 		 {
// 		   un=turf.union(feature.features[0],feature.features[1]);
// 		   console.log("4");
// 		 }
// 		 if(feature.features.length>2)
// 		 {
// 		   un=turf.union(feature.features[0],feature.features[1]);
// 		   console.log("5");
// 		   for(i=2;i<feature.features.length;i++)
// 		   {
			 
// 			 un=turf.union(un,feature.features[i])
// 			 console.log("6");
// 		   }
// 		 }
		
		 
		
// 		 // var dissolved2 = turf.dissolve(feature);
		
// 		 var dissolved = turf.combine(feature);
// 		 console.log("7");
		
// 		 // allInter=L.geoJson(dissolved2);
// 		 allInter=L.geoJson(un);
		
// 		 var dissolved3=turf.combine(allInter.toGeoJSON());
// 		 console.log("8");
		
// 		var chv=turf.difference(pg.toGeoJSON(), dissolved3.features[0]);
// 		console.log("9");
	   
// 		chv=turf.difference(pg.toGeoJSON(), dissolved3.features[0]);
// 		console.log("10");
// 	   console.log(chv);
// 	   var area=0;
// 	   var areas=[];
// 	   if(chv)
// 	   {
// 		 console.log("ok")
// 		 reste=L.geoJson(chv);
	 
// 	  area=turf.area(chv)/1000000;
// 	  console.log("11");
	  
// 	   var i=0;
	  

// 	 for (var i=0;i<(chv.geometry).coordinates.length;i++){   
	  
// 	   var feat2=turf.multiPolygon([(chv.geometry).coordinates[i]]);
// 	   console.log("12");
// 	   areas[i]=turf.area(feat2)/1000000;
	  
// 	 }
// 	   }
// 	   else
// 	   {
// 		 console.log("ok2")
// 		 reste="";
// 	   }
		
	 
// 	   if(areas.length>1)
// 	   {
	 
// 	 if(Math.max(...areas)<1 && Math.max(...areas)>0 && area>1)
// 	   {
// 		 alert("la surface rÃ©sultante est supÃ©rieure Ã  1km2 mais est discontinue et toutes ses parties sont infÃ©rieure Ã  1km2; elles sont Ã©gales Ã : "+areas+" km2");
// 		   exit=1;
// 	   }
// 	   }
// 	  if(area<1)
// 	   {
// 		 alert("la surface rÃ©sultante est infÃ©rieure Ã  1km2; elle est Ã©gale Ã : "+area+" km2");
// 		 exit=1;
// 	   }
// 	   }
// 	   else{
		 
		 
// 		 var crdd=turf.getCoords(pg.toGeoJSON());
// 		 console.log("13");
	 
// 		 var pgd=turf.polygon(crdd);
// 		 console.log("14");
// 		 reste=L.geoJson(pgd);
// 	   }
// 		}
	 
// 	   intersection();




// });
//  }
//  else
//  {
//    for (var t = 0; t < permisAll.length; t++)
// 	   {
// 		 permisAll[t][0].dragging.disable();
// 	   }
   
//  }
// }
// function drag()
// {

//  var str=0;
//  if(clicked.length==0 && document.getElementById("rd11").checked)
//  {
//    alert("sÃ©lectionner un titre minier");
//    document.getElementById("rd11").checked=false;
//    document.getElementById("rd112").checked=false;


//    return;
//  }
//  if(document.getElementById("rd11").checked)
//  {
//    document.getElementById("rd4").checked=false;

//   console.log(clicked.length)
//    clicked[clicked.length-1].dragging.enable();
  
   
//    clicked[clicked.length-1].addEventListener("dragend", function() {

// 	 clicked[clicked.length-1].dragging.enable();
// 	 if(reste!=null && reste!="")
// 	 {
// 	   map.removeLayer(reste);
//  map.closePopup();
// 	 }
	
//  document.getElementById("rd6").checked=false;
//  document.getElementById("rd5").checked=false;
//  document.getElementById("rd7").checked=false;
//  document.getElementById("rd8").checked=false;
//  //alert('drag ended');
//  var pt=turf.getCoord(turf.centroid(this.toGeoJSON()));
//  console.log("1");
//  console.log(this.options.crd);
//  document.getElementById("X").value=pt[0];
//  document.getElementById("Y").value=pt[1];
//  document.getElementById("rd1").checked=true;
//  var cdtpg=turf.polygon([cadetaf.features[0].geometry.coordinates[0]]);
  
//    if(turf.intersect(this.toGeoJSON(), cdtpg))
// 		 {
			
// 			 //  return false;
		  
// 		   alert("intersection avec la zone CADETAF");
// 		   // return;
// 		   // clicked[clicked.length-1].dragging.disable();
// 		   // console.log("ds")
// 		   // clicked[clicked.length-1].dragging.enable();
// 		   // console.log("en")
// 		   // return;
// 		 }
// 		 var mrc=turf.polygon([morocco.features[0].geometry.coordinates[0]]);
//    var mrc2=turf.polygonToLine(mrc);
//    let distancemrc = turf.pointToLineDistance(pt,mrc2, {units: 'meters'});
//    console.log("2");
// 		 if(distancemrc<10000)
// 		 {
// 		   alert("zone frontaliÃ¨re");
// 		   // return;
// 		 }
// 		 if(turf.booleanPointInPolygon(pt, mrc)==false && distancemrc>10000)
// 		 {
// 		   alert("le centre se situe hors le maroc");
// 		   // return;
// 		 }
		
//  //   marker.setLatLng(y, x);
//  //   var marker = new L.Marker([12, 15]);
  
//  var lmt="";
//  let distanceKm2 = turf.pointToLineDistance(pt,limit, {units: 'meters'});
//  if(distanceKm2>10000 && turf.booleanPointInPolygon(pt, limit2)==false)
// 		 {
// 		   alert("le centre se situe hors la rÃ©gion Draa-Tafilalet");
// 		   // return;
		 
// 		 }
// 		 for(let i=0;i<limits.length;i++)
//    {
// 	 var pl= limits[i][0];
// 	 var pl2= limits[i][2];
	 
// 	 let distanceKm = turf.pointToLineDistance(pt,pl, {units: 'meters'});
	 
	
// 		if(distanceKm<6000 && distanceKm2<6000)
// 		 {
// 		   lmt=lmt+"/"+limits[i][1];
		
		 
// 		 }
		  
//    }
// 		 if(lmt!="")
// 		 {
// 		   alert("Zone limitrophe avec "+lmt);
// 		   // return;
		  
// 		 }
//  // var location = marker.getLatLng();
//  // var lat = location.lat;
//  // var lon = location.lng;
//  // addToTextBox(lat,lon);
//  //alert(lat);
//  //retrieved the position
//    var feat=[];
// 	   var u=0;
// 	   var z=0;
// 	   var chv;
// 	   chvch=[];
// 	   chvchR=[];
// 	   layChvR=[];
// 	   layChv=[];
// 	   reste="";
// 	   allInter="";
// 	   clicked.push(this);
// 	   var pg=this;
// 	   for (var t = 0; t < permisAll.length; t++)
// 	   {
// 		 var inters=turf.intersect(this.toGeoJSON(), permisAll[t][0].toGeoJSON());
// 		 console.log("2");
		
// 		 if(inters!=null)
// 		 {
		  
// 		   var area2=turf.area(inters)/1000000;
		  
// 		   if(area2<15.95 && area2>0.0015 && permisAll[t][0]!=this)
// 			   {
// 		   chvch[u]=[permisAll[t][0],permisAll[t][1]];
// 		   layChv[u]=permisAll[t][0];
// 		   chvchR[u]=[permisAll[t][0],permisAll[t][1]];
// 			   layChvR[u]=permisAll[t][0];
			  
// 			   feat[u]= inters;
			  
// 		   u++;

		 
// 			   }

// 		 }

// 	   }
	 
// 	   function intersection() {

// 	   if(feat.length!=0)
// 	   {
		 
// 		 var feature = turf.featureCollection(feat);
// 		 console.log("3");
// 		 var un="";
// 		 if(feature.features.length==1)
// 		 {
// 		   un=feature.features[0];
// 		 }
// 		 if(feature.features.length==2)
// 		 {
// 		   un=turf.union(feature.features[0],feature.features[1]);
// 		   console.log("4");
// 		 }
// 		 if(feature.features.length>2)
// 		 {
// 		   un=turf.union(feature.features[0],feature.features[1]);
// 		   console.log("5");
// 		   for(i=2;i<feature.features.length;i++)
// 		   {
			 
// 			 un=turf.union(un,feature.features[i])
// 			 console.log("6");
// 		   }
// 		 }
		
		 
		
// 		 // var dissolved2 = turf.dissolve(feature);
		
// 		 var dissolved = turf.combine(feature);
// 		 console.log("7");
		
// 		 // allInter=L.geoJson(dissolved2);
// 		 allInter=L.geoJson(un);
		
// 		 var dissolved3=turf.combine(allInter.toGeoJSON());
// 		 console.log("8");
		
// 		var chv=turf.difference(pg.toGeoJSON(), dissolved3.features[0]);
// 		console.log("9");
	   
// 		chv=turf.difference(pg.toGeoJSON(), dissolved3.features[0]);
// 		console.log("10");
// 	   console.log(chv);
// 	   var area=0;
// 	   var areas=[];
// 	   if(chv)
// 	   {
// 		 console.log("ok")
// 		 reste=L.geoJson(chv);
	 
// 	  area=turf.area(chv)/1000000;
// 	  console.log("11");
	  
// 	   var i=0;
	  

// 	 for (var i=0;i<(chv.geometry).coordinates.length;i++){   
	  
// 	   var feat2=turf.multiPolygon([(chv.geometry).coordinates[i]]);
// 	   console.log("12");
// 	   areas[i]=turf.area(feat2)/1000000;
	  
// 	 }
// 	   }
// 	   else
// 	   {
// 		 console.log("ok2")
// 		 reste="";
// 	   }
		
	 
// 	   if(areas.length>1)
// 	   {
	 
// 	 if(Math.max(...areas)<1 && Math.max(...areas)>0 && area>1)
// 	   {
// 		 alert("la surface rÃ©sultante est supÃ©rieure Ã  1km2 mais est discontinue et toutes ses parties sont infÃ©rieure Ã  1km2; elles sont Ã©gales Ã : "+areas+" km2");
// 		   exit=1;
// 	   }
// 	   }
// 	  if(area<1)
// 	   {
// 		 alert("la surface rÃ©sultante est infÃ©rieure Ã  1km2; elle est Ã©gale Ã : "+area+" km2");
// 		 exit=1;
// 	   }
// 	   }
// 	   else{
		 
		 
// 		 var crdd=turf.getCoords(pg.toGeoJSON());
// 		 console.log("13");
	 
// 		 var pgd=turf.polygon(crdd);
// 		 console.log("14");
// 		 reste=L.geoJson(pgd);
// 	   }
// 		}
	 
// 	   intersection();




// });
//  }
//  else
//  {
//    for (var t = 0; t < permisAll.length; t++)
// 	   {
// 		 permisAll[t][0].dragging.disable();
// 	   }
   
//  }
// }
function canceldrag()
{

 for (var t = 0; t < permisAll.length; t++)
	   {
		 if(permisAll[t][0].options.crd==clicked[clicked.length-1].options.crd)
		 {
			 
		 }
	   }

}
function validrag()
{

}

function editcenter()
{

}


function searchPermit()
{
if(trf!=null)
{
 trf.removeFrom(map);

}

let val=document.getElementById("inprech").value;
for (var t = 0; t < permisAll.length; t++)
	   {
		 if(permisAll[t][1]=="pr")
		 {
		   if(val==permisAll[t][0].options.N_Permis)
		   {
			 map.fitBounds(permisAll[t][0].getBounds());
			 document.getElementById('rd10').checked=true;

		   trf=L.geoJSON(permisAll[t][0].toGeoJSON());
		   
		   trf.addTo(map);
		   trf.setInteractive(false);
 

			 return;
		   }
		 }
		 if(permisAll[t][1]=="pn")
		 {
		   if(val==permisAll[t][0].options.N_Permis)
		   {
			 map.fitBounds(permisAll[t][0].getBounds());
			 document.getElementById('rd10').checked=true;

		   trf=L.geoJSON(permisAll[t][0].toGeoJSON());
		   
		   trf.addTo(map);
		   trf.setInteractive(false);
 

			 return;
		   }
		 }
		 if(permisAll[t][1]=="RS")
		 {
		   if(val==permisAll[t][0].options.nr)
		   {
			 map.fitBounds(permisAll[t][0].getBounds());
			 document.getElementById('rd10').checked=true;

		   trf=L.geoJSON(permisAll[t][0].toGeoJSON());
		   
		   trf.addTo(map);
		   trf.setInteractive(false);
 

			 return;
		   }
		 }
		 if(permisAll[t][1]=="LC")
		 {
		   if(val==permisAll[t][0].options.N_Licence)
		   {
			 map.fitBounds(permisAll[t][0].getBounds());
			 document.getElementById('rd10').checked=true;

		   trf=L.geoJSON(permisAll[t][0].toGeoJSON());
		   
		   trf.addTo(map);
		   trf.setInteractive(false);
 

			 return;
		   }
		 }
	   }
}
var nbly=-1;
var grply=[];
var lyrsT=[];
var clickedY=[];
var clickedZ=[];

let swalCnt='<h4>Coordinates System</h4>'+'<select id="countrySwal" name="country" class="form-control text-center"><option value="selected">Select Country</option><option value="World">World</option><option value="Afghanistan">Afghanistan</option> <option value="Aland Islands">Aland Islands</option> <option value="Albania">Albania</option> <option value="Algeria">Algeria</option> <option value="American Samoa">American Samoa</option> <option value="Andorra">Andorra</option> <option value="Angola">Angola</option> <option value="Anguilla">Anguilla</option> <option value="Antarctica">Antarctica</option> <option value="Antigua and Barbuda">Antigua and Barbuda</option> <option value="Argentina">Argentina</option> <option value="Armenia">Armenia</option> <option value="Aruba">Aruba</option> <option value="Australia">Australia</option> <option value="Austria">Austria</option> <option value="Azerbaijan">Azerbaijan</option> <option value="Bahamas">Bahamas</option> <option value="Bahrain">Bahrain</option> <option value="Bangladesh">Bangladesh</option> <option value="Barbados">Barbados</option> <option value="Belarus">Belarus</option> <option value="Belgium">Belgium</option> <option value="Belize">Belize</option> <option value="Benin">Benin</option> <option value="Bermuda">Bermuda</option> <option value="Bhutan">Bhutan</option> <option value="Bolivia">Bolivia</option> <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option> <option value="Botswana">Botswana</option> <option value="Bouvet Island">Bouvet Island</option> <option value="Brazil">Brazil</option> <option value="British Indian Ocean Territory">British Indian Ocean Territory</option> <option value="Brunei Darussalam">Brunei Darussalam</option> <option value="Bulgaria">Bulgaria</option> <option value="Burkina Faso">Burkina Faso</option> <option value="Burundi">Burundi</option> <option value="Cambodia">Cambodia</option> <option value="Cameroon">Cameroon</option> <option value="Canada">Canada</option> <option value="Cape Verde">Cape Verde</option> <option value="Cayman Islands">Cayman Islands</option> <option value="Central African Republic">Central African Republic</option> <option value="Chad">Chad</option> <option value="Chile">Chile</option> <option value="China">China</option> <option value="Christmas Island">Christmas Island</option> <option value="Cocos (Keeling) Islands">Cocos (Keeling) Islands</option> <option value="Colombia">Colombia</option> <option value="Comoros">Comoros</option> <option value="Congo">Congo</option> <option value="Congo, The Democratic Republic of The">Congo, The Democratic Republic of The</option> <option value="Cook Islands">Cook Islands</option> <option value="Costa Rica">Costa Rica</option> <option value="Cote D ivoire">Cote D ivoire</option> <option value="Croatia">Croatia</option> <option value="Cuba">Cuba</option> <option value="Cyprus">Cyprus</option> <option value="Czech Republic">Czech Republic</option> <option value="Denmark">Denmark</option> <option value="Djibouti">Djibouti</option> <option value="Dominica">Dominica</option> <option value="Dominican Republic">Dominican Republic</option> <option value="Ecuador">Ecuador</option> <option value="Egypt">Egypt</option> <option value="El Salvador">El Salvador</option> <option value="Equatorial Guinea">Equatorial Guinea</option> <option value="Eritrea">Eritrea</option> <option value="Estonia">Estonia</option> <option value="Ethiopia">Ethiopia</option> <option value="Falkland Islands (Malvinas)">Falkland Islands (Malvinas)</option> <option value="Faroe Islands">Faroe Islands</option> <option value="Fiji">Fiji</option> <option value="Finland">Finland</option> <option value="France">France</option> <option value="French Guiana">French Guiana</option> <option value="French Polynesia">French Polynesia</option> <option value="French Southern Territories">French Southern Territories</option> <option value="Gabon">Gabon</option> <option value="Gambia">Gambia</option> <option value="Georgia">Georgia</option> <option value="Germany">Germany</option> <option value="Ghana">Ghana</option> <option value="Gibraltar">Gibraltar</option> <option value="Greece">Greece</option> <option value="Greenland">Greenland</option> <option value="Grenada">Grenada</option> <option value="Guadeloupe">Guadeloupe</option> <option value="Guam">Guam</option> <option value="Guatemala">Guatemala</option> <option value="Guernsey">Guernsey</option> <option value="Guinea">Guinea</option> <option value="Guinea-bissau">Guinea-bissau</option> <option value="Guyana">Guyana</option> <option value="Haiti">Haiti</option> <option value="Heard Island and Mcdonald Islands">Heard Island and Mcdonald Islands</option> <option value="Holy See (Vatican City State)">Holy See (Vatican City State)</option> <option value="Honduras">Honduras</option> <option value="Hong Kong">Hong Kong</option> <option value="Hungary">Hungary</option> <option value="Iceland">Iceland</option> <option value="India">India</option> <option value="Indonesia">Indonesia</option> <option value="Iran, Islamic Republic of">Iran, Islamic Republic of</option> <option value="Iraq">Iraq</option> <option value="Ireland">Ireland</option> <option value="Isle of Man">Isle of Man</option> <option value="Israel">Israel</option> <option value="Italy">Italy</option> <option value="Jamaica">Jamaica</option> <option value="Japan">Japan</option> <option value="Jersey">Jersey</option> <option value="Jordan">Jordan</option> <option value="Kazakhstan">Kazakhstan</option> <option value="Kenya">Kenya</option> <option value="Kiribati">Kiribati</option> <option value="Korea, Democratic People s Republic of">Korea, Democratic People s Republic of</option> <option value="Korea, Republic of">Korea, Republic of</option> <option value="Kuwait">Kuwait</option> <option value="Kyrgyzstan">Kyrgyzstan</option> <option value="Lao People s Democratic Republic">Lao People s Democratic Republic</option> <option value="Latvia">Latvia</option> <option value="Lebanon">Lebanon</option> <option value="Lesotho">Lesotho</option> <option value="Liberia">Liberia</option> <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option> <option value="Liechtenstein">Liechtenstein</option> <option value="Lithuania">Lithuania</option> <option value="Luxembourg">Luxembourg</option> <option value="Macao">Macao</option> <option value="Macedonia, The Former Yugoslav Republic of">Macedonia, The Former Yugoslav Republic of</option> <option value="Madagascar">Madagascar</option> <option value="Malawi">Malawi</option> <option value="Malaysia">Malaysia</option> <option value="Maldives">Maldives</option> <option value="Mali">Mali</option> <option value="Malta">Malta</option> <option value="Marshall Islands">Marshall Islands</option> <option value="Martinique">Martinique</option> <option value="Mauritania">Mauritania</option> <option value="Mauritius">Mauritius</option> <option value="Mayotte">Mayotte</option> <option value="Mexico">Mexico</option> <option value="Micronesia, Federated States of">Micronesia, Federated States of</option> <option value="Moldova, Republic of">Moldova, Republic of</option> <option value="Monaco">Monaco</option> <option value="Mongolia">Mongolia</option> <option value="Montenegro">Montenegro</option> <option value="Montserrat">Montserrat</option> <option value="Morocco">Morocco</option> <option value="Mozambique">Mozambique</option> <option value="Myanmar">Myanmar</option> <option value="Namibia">Namibia</option> <option value="Nauru">Nauru</option> <option value="Nepal">Nepal</option> <option value="Netherlands">Netherlands</option> <option value="Netherlands Antilles">Netherlands Antilles</option> <option value="New Caledonia">New Caledonia</option> <option value="New Zealand">New Zealand</option> <option value="Nicaragua">Nicaragua</option> <option value="Niger">Niger</option> <option value="Nigeria">Nigeria</option> <option value="Niue">Niue</option> <option value="Norfolk Island">Norfolk Island</option> <option value="Northern Mariana Islands">Northern Mariana Islands</option> <option value="Norway">Norway</option> <option value="Oman">Oman</option> <option value="Pakistan">Pakistan</option> <option value="Palau">Palau</option> <option value="Palestinian Territory, Occupied">Palestinian Territory, Occupied</option> <option value="Panama">Panama</option> <option value="Papua New Guinea">Papua New Guinea</option> <option value="Paraguay">Paraguay</option> <option value="Peru">Peru</option> <option value="Philippines">Philippines</option> <option value="Pitcairn">Pitcairn</option> <option value="Poland">Poland</option> <option value="Portugal">Portugal</option> <option value="Puerto Rico">Puerto Rico</option> <option value="Qatar">Qatar</option> <option value="Reunion">Reunion</option> <option value="Romania">Romania</option> <option value="Russian Federation">Russian Federation</option> <option value="Rwanda">Rwanda</option> <option value="Saint Helena">Saint Helena</option> <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option> <option value="Saint Lucia">Saint Lucia</option> <option value="Saint Pierre and Miquelon">Saint Pierre and Miquelon</option> <option value="Saint Vincent and The Grenadines">Saint Vincent and The Grenadines</option> <option value="Samoa">Samoa</option> <option value="San Marino">San Marino</option> <option value="Sao Tome and Principe">Sao Tome and Principe</option> <option value="Saudi Arabia">Saudi Arabia</option> <option value="Senegal">Senegal</option> <option value="Serbia">Serbia</option> <option value="Seychelles">Seychelles</option> <option value="Sierra Leone">Sierra Leone</option> <option value="Singapore">Singapore</option> <option value="Slovakia">Slovakia</option> <option value="Slovenia">Slovenia</option> <option value="Solomon Islands">Solomon Islands</option> <option value="Somalia">Somalia</option> <option value="South Africa">South Africa</option> <option value="South Georgia and The South Sandwich Islands">South Georgia and The South Sandwich Islands</option> <option value="Spain">Spain</option> <option value="Sri Lanka">Sri Lanka</option> <option value="Sudan">Sudan</option> <option value="Suriname">Suriname</option> <option value="Svalbard and Jan Mayen">Svalbard and Jan Mayen</option> <option value="Swaziland">Swaziland</option> <option value="Sweden">Sweden</option> <option value="Switzerland">Switzerland</option> <option value="Syrian Arab Republic">Syrian Arab Republic</option> <option value="Taiwan">Taiwan</option> <option value="Tajikistan">Tajikistan</option> <option value="Tanzania, United Republic of">Tanzania, United Republic of</option> <option value="Thailand">Thailand</option> <option value="Timor-leste">Timor-leste</option> <option value="Togo">Togo</option> <option value="Tokelau">Tokelau</option> <option value="Tonga">Tonga</option> <option value="Trinidad and Tobago">Trinidad and Tobago</option> <option value="Tunisia">Tunisia</option> <option value="Turkey">Turkey</option> <option value="Turkmenistan">Turkmenistan</option> <option value="Turks and Caicos Islands">Turks and Caicos Islands</option> <option value="Tuvalu">Tuvalu</option> <option value="Uganda">Uganda</option> <option value="Ukraine">Ukraine</option> <option value="United Arab Emirates">United Arab Emirates</option> <option value="United Kingdom">United Kingdom</option> <option value="United States">United States</option> <option value="United States Minor Outlying Islands">United States Minor Outlying Islands</option> <option value="Uruguay">Uruguay</option> <option value="Uzbekistan">Uzbekistan</option> <option value="Vanuatu">Vanuatu</option> <option value="Venezuela">Venezuela</option> <option value="Viet Nam">Viet Nam</option> <option value="Virgin Islands, British">Virgin Islands, British</option> <option value="Virgin Islands, U.S.">Virgin Islands, U.S.</option> <option value="Wallis and Futuna">Wallis and Futuna</option> <option value="Yemen">Yemen</option><option value="Zambia">Zambia</option><option value="Zimbabwe">Zimbabwe</option></select>';   
// let swalSys='<select id="sysSwal" name="sys" class="form-control"><option value="wgs">WGS84</option><option value="Afghanistan">Afghanistan</option> <option value="Ãland Islands">Ãland Islands</option> <option value="Albania">Albania</option> <option value="Algeria">Algeria</option> <option value="American Samoa">American Samoa</option> <option value="Andorra">Andorra</option> <option value="Angola">Angola</option> <option value="Anguilla">Anguilla</option> <option value="Antarctica">Antarctica</option> <option value="Antigua and Barbuda">Antigua and Barbuda</option> <option value="Argentina">Argentina</option> <option value="Armenia">Armenia</option> <option value="Aruba">Aruba</option> <option value="Australia">Australia</option> <option value="Austria">Austria</option> <option value="Azerbaijan">Azerbaijan</option> <option value="Bahamas">Bahamas</option> <option value="Bahrain">Bahrain</option> <option value="Bangladesh">Bangladesh</option> <option value="Barbados">Barbados</option> <option value="Belarus">Belarus</option> <option value="Belgium">Belgium</option> <option value="Belize">Belize</option> <option value="Benin">Benin</option> <option value="Bermuda">Bermuda</option> <option value="Bhutan">Bhutan</option> <option value="Bolivia">Bolivia</option> <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option> <option value="Botswana">Botswana</option> <option value="Bouvet Island">Bouvet Island</option> <option value="Brazil">Brazil</option> <option value="British Indian Ocean Territory">British Indian Ocean Territory</option> <option value="Brunei Darussalam">Brunei Darussalam</option> <option value="Bulgaria">Bulgaria</option> <option value="Burkina Faso">Burkina Faso</option> <option value="Burundi">Burundi</option> <option value="Cambodia">Cambodia</option> <option value="Cameroon">Cameroon</option> <option value="Canada">Canada</option> <option value="Cape Verde">Cape Verde</option> <option value="Cayman Islands">Cayman Islands</option> <option value="Central African Republic">Central African Republic</option> <option value="Chad">Chad</option> <option value="Chile">Chile</option> <option value="China">China</option> <option value="Christmas Island">Christmas Island</option> <option value="Cocos (Keeling) Islands">Cocos (Keeling) Islands</option> <option value="Colombia">Colombia</option> <option value="Comoros">Comoros</option> <option value="Congo">Congo</option> <option value="Congo, The Democratic Republic of The">Congo, The Democratic Republic of The</option> <option value="Cook Islands">Cook Islands</option> <option value="Costa Rica">Costa Rica</option> <option value="Cote D ivoire">Cote D ivoire</option> <option value="Croatia">Croatia</option> <option value="Cuba">Cuba</option> <option value="Cyprus">Cyprus</option> <option value="Czech Republic">Czech Republic</option> <option value="Denmark">Denmark</option> <option value="Djibouti">Djibouti</option> <option value="Dominica">Dominica</option> <option value="Dominican Republic">Dominican Republic</option> <option value="Ecuador">Ecuador</option> <option value="Egypt">Egypt</option> <option value="El Salvador">El Salvador</option> <option value="Equatorial Guinea">Equatorial Guinea</option> <option value="Eritrea">Eritrea</option> <option value="Estonia">Estonia</option> <option value="Ethiopia">Ethiopia</option> <option value="Falkland Islands (Malvinas)">Falkland Islands (Malvinas)</option> <option value="Faroe Islands">Faroe Islands</option> <option value="Fiji">Fiji</option> <option value="Finland">Finland</option> <option value="France">France</option> <option value="French Guiana">French Guiana</option> <option value="French Polynesia">French Polynesia</option> <option value="French Southern Territories">French Southern Territories</option> <option value="Gabon">Gabon</option> <option value="Gambia">Gambia</option> <option value="Georgia">Georgia</option> <option value="Germany">Germany</option> <option value="Ghana">Ghana</option> <option value="Gibraltar">Gibraltar</option> <option value="Greece">Greece</option> <option value="Greenland">Greenland</option> <option value="Grenada">Grenada</option> <option value="Guadeloupe">Guadeloupe</option> <option value="Guam">Guam</option> <option value="Guatemala">Guatemala</option> <option value="Guernsey">Guernsey</option> <option value="Guinea">Guinea</option> <option value="Guinea-bissau">Guinea-bissau</option> <option value="Guyana">Guyana</option> <option value="Haiti">Haiti</option> <option value="Heard Island and Mcdonald Islands">Heard Island and Mcdonald Islands</option> <option value="Holy See (Vatican City State)">Holy See (Vatican City State)</option> <option value="Honduras">Honduras</option> <option value="Hong Kong">Hong Kong</option> <option value="Hungary">Hungary</option> <option value="Iceland">Iceland</option> <option value="India">India</option> <option value="Indonesia">Indonesia</option> <option value="Iran, Islamic Republic of">Iran, Islamic Republic of</option> <option value="Iraq">Iraq</option> <option value="Ireland">Ireland</option> <option value="Isle of Man">Isle of Man</option> <option value="Israel">Israel</option> <option value="Italy">Italy</option> <option value="Jamaica">Jamaica</option> <option value="Japan">Japan</option> <option value="Jersey">Jersey</option> <option value="Jordan">Jordan</option> <option value="Kazakhstan">Kazakhstan</option> <option value="Kenya">Kenya</option> <option value="Kiribati">Kiribati</option> <option value="Korea, Democratic People s Republic of">Korea, Democratic People s Republic of</option> <option value="Korea, Republic of">Korea, Republic of</option> <option value="Kuwait">Kuwait</option> <option value="Kyrgyzstan">Kyrgyzstan</option> <option value="Lao People s Democratic Republic">Lao People s Democratic Republic</option> <option value="Latvia">Latvia</option> <option value="Lebanon">Lebanon</option> <option value="Lesotho">Lesotho</option> <option value="Liberia">Liberia</option> <option value="Libyan Arab Jamahiriya">Libyan Arab Jamahiriya</option> <option value="Liechtenstein">Liechtenstein</option> <option value="Lithuania">Lithuania</option> <option value="Luxembourg">Luxembourg</option> <option value="Macao">Macao</option> <option value="Macedonia, The Former Yugoslav Republic of">Macedonia, The Former Yugoslav Republic of</option> <option value="Madagascar">Madagascar</option> <option value="Malawi">Malawi</option> <option value="Malaysia">Malaysia</option> <option value="Maldives">Maldives</option> <option value="Mali">Mali</option> <option value="Malta">Malta</option> <option value="Marshall Islands">Marshall Islands</option> <option value="Martinique">Martinique</option> <option value="Mauritania">Mauritania</option> <option value="Mauritius">Mauritius</option> <option value="Mayotte">Mayotte</option> <option value="Mexico">Mexico</option> <option value="Micronesia, Federated States of">Micronesia, Federated States of</option> <option value="Moldova, Republic of">Moldova, Republic of</option> <option value="Monaco">Monaco</option> <option value="Mongolia">Mongolia</option> <option value="Montenegro">Montenegro</option> <option value="Montserrat">Montserrat</option> <option value="Morocco">Morocco</option> <option value="Mozambique">Mozambique</option> <option value="Myanmar">Myanmar</option> <option value="Namibia">Namibia</option> <option value="Nauru">Nauru</option> <option value="Nepal">Nepal</option> <option value="Netherlands">Netherlands</option> <option value="Netherlands Antilles">Netherlands Antilles</option> <option value="New Caledonia">New Caledonia</option> <option value="New Zealand">New Zealand</option> <option value="Nicaragua">Nicaragua</option> <option value="Niger">Niger</option> <option value="Nigeria">Nigeria</option> <option value="Niue">Niue</option> <option value="Norfolk Island">Norfolk Island</option> <option value="Northern Mariana Islands">Northern Mariana Islands</option> <option value="Norway">Norway</option> <option value="Oman">Oman</option> <option value="Pakistan">Pakistan</option> <option value="Palau">Palau</option> <option value="Palestinian Territory, Occupied">Palestinian Territory, Occupied</option> <option value="Panama">Panama</option> <option value="Papua New Guinea">Papua New Guinea</option> <option value="Paraguay">Paraguay</option> <option value="Peru">Peru</option> <option value="Philippines">Philippines</option> <option value="Pitcairn">Pitcairn</option> <option value="Poland">Poland</option> <option value="Portugal">Portugal</option> <option value="Puerto Rico">Puerto Rico</option> <option value="Qatar">Qatar</option> <option value="Reunion">Reunion</option> <option value="Romania">Romania</option> <option value="Russian Federation">Russian Federation</option> <option value="Rwanda">Rwanda</option> <option value="Saint Helena">Saint Helena</option> <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option> <option value="Saint Lucia">Saint Lucia</option> <option value="Saint Pierre and Miquelon">Saint Pierre and Miquelon</option> <option value="Saint Vincent and The Grenadines">Saint Vincent and The Grenadines</option> <option value="Samoa">Samoa</option> <option value="San Marino">San Marino</option> <option value="Sao Tome and Principe">Sao Tome and Principe</option> <option value="Saudi Arabia">Saudi Arabia</option> <option value="Senegal">Senegal</option> <option value="Serbia">Serbia</option> <option value="Seychelles">Seychelles</option> <option value="Sierra Leone">Sierra Leone</option> <option value="Singapore">Singapore</option> <option value="Slovakia">Slovakia</option> <option value="Slovenia">Slovenia</option> <option value="Solomon Islands">Solomon Islands</option> <option value="Somalia">Somalia</option> <option value="South Africa">South Africa</option> <option value="South Georgia and The South Sandwich Islands">South Georgia and The South Sandwich Islands</option> <option value="Spain">Spain</option> <option value="Sri Lanka">Sri Lanka</option> <option value="Sudan">Sudan</option> <option value="Suriname">Suriname</option> <option value="Svalbard and Jan Mayen">Svalbard and Jan Mayen</option> <option value="Swaziland">Swaziland</option> <option value="Sweden">Sweden</option> <option value="Switzerland">Switzerland</option> <option value="Syrian Arab Republic">Syrian Arab Republic</option> <option value="Taiwan">Taiwan</option> <option value="Tajikistan">Tajikistan</option> <option value="Tanzania, United Republic of">Tanzania, United Republic of</option> <option value="Thailand">Thailand</option> <option value="Timor-leste">Timor-leste</option> <option value="Togo">Togo</option> <option value="Tokelau">Tokelau</option> <option value="Tonga">Tonga</option> <option value="Trinidad and Tobago">Trinidad and Tobago</option> <option value="Tunisia">Tunisia</option> <option value="Turkey">Turkey</option> <option value="Turkmenistan">Turkmenistan</option> <option value="Turks and Caicos Islands">Turks and Caicos Islands</option> <option value="Tuvalu">Tuvalu</option> <option value="Uganda">Uganda</option> <option value="Ukraine">Ukraine</option> <option value="United Arab Emirates">United Arab Emirates</option> <option value="United Kingdom">United Kingdom</option> <option value="United States">United States</option> <option value="United States Minor Outlying Islands">United States Minor Outlying Islands</option> <option value="Uruguay">Uruguay</option> <option value="Uzbekistan">Uzbekistan</option> <option value="Vanuatu">Vanuatu</option> <option value="Venezuela">Venezuela</option> <option value="Viet Nam">Viet Nam</option> <option value="Virgin Islands, British">Virgin Islands, British</option> <option value="Virgin Islands, U.S.">Virgin Islands, U.S.</option> <option value="Wallis and Futuna">Wallis and Futuna</option> <option value="Yemen">Yemen</option><option value="Zambia">Zambia</option><option value="Zimbabwe">Zimbabwe</option></select>';   
let swalSys='<select id="sysSwal" name="sys" class="form-control text-center"></select>'
let coordCnt=[["Morocco",["Nord Maroc","Sud Maroc","Nord Maroc Degree","Sud Maroc Degree"]],["World",["WGS84"]]];
let coordSys=["Nord Maroc","Sud Maroc","Nord Maroc Degree","Sud Maroc Degree","WGS84"];
let cnt=["Morocco","World"];
let sysTab=[nm,sm,nmd,smd,wgs];
let sysWkid=[26191,26192,102191,102192,4326];
let swalFeatType='<h3>Layer Type</h3><select id="swalCreateLayer" name="Feat" class="form-control text-center"><option value="polyg">Polygon</option><option value="pointGis">Point</option><option value="polylineGis">Polyline</option></select>';
let swalFeatName='<h3>Layer Name</h3><input type="text" id="LayerName" name="Layer" required style="width:200px">';
let swalFields='<h3>Add Fields</h3><div id="fields"><input type="text" class="text-center" id="layerId" name="LayerId" value="Id" disabled style="width:80px"></div>'; 
let swalButtons= '<div><span><input class="form-control btn btn-danger text-center" type="button" id="delFields" value="-" style="height:30px;width:30px;font-size:20px;align-items: center;padding:0"><span> </span><input class="form-control btn btn-success text-center" type="button" id="addFields" value="+" style="height:30px;width:30px;font-size:20px;align-items: center;padding:0" ></span></div>';

function removeOptions(selectElement) {
var i, L = selectElement.options.length - 1;
for(i = L; i >= 0; i--) {
   selectElement.remove(i);
}
}
function chngSwal() {
					   let sysw=document.getElementById('sysSwal');
					   removeOptions(sysw);
					   let i=cnt.indexOf(document.getElementById('countrySwal').value);
					   if(i!=-1)
					   {
							   for(let k=0;k<coordCnt[i][1].length;k++)
							 {
											   let opt = document.createElement("option");
											   opt.value = coordCnt[i][1][k]; // the index
											   opt.text=coordCnt[i][1][k];
											   sysw.append(opt);
							 }
						 
					   }
					   
					   let swalSys='<select id="sysSwal" name="sys" class="form-control text-center"></select>'

						 }


function addField() {
let swlAdd=document.getElementById('fields');

let type='<input type="text" name="FieldName" class="form-control text-center" style="display:inline-block"><select name="Type" class="form-control text-center" style="display:inline-block"><option value="esriFieldTypeInteger">Int</option><option value="esriFieldTypeDouble">Double</option><option value="esriFieldTypeString">String</option><option value="esriFieldTypeDate">Date</option></select>'
	let hr = document.createElement("hr");
	let div = document.createElement("div");
	div.style.display="inline-block"
div.innerHTML=type;
// swlAdd.append(hr);
swlAdd.appendChild(div);



}

function delField() {
let swlAdd=document.getElementById('fields');
if(swlAdd.lastChild.id!='layerId')
{
swlAdd.removeChild(swlAdd.lastChild);
}
}
// read excel file

let deletedN=[];
let eventLst=[];
let eventLst2=[];



const excel_file = document.getElementById('excel_file');
var file = document.querySelector('#excel_file').files[0];
var reader = new FileReader();
var sys;
excel_file.onchange = function ({ target: { files: [file] } }) {

 if(['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel','application/vnd.oasis.opendocument.spreadsheet'].includes(file.type))
 {
let pgs=[];
let table,tableSlc,tbdSlc,lab,fc,sc,out,t,slider;
let featureGroup = L.featureGroup()
nbly++;
let N1,N2,N3,N4,N5,N6,geom;
let swalOpt={
 centers: 'Draw only centers',
 buffers: 'Draw circles around centers',
 squares: 'Draw squares around centers',
 polygs: 'Draw polygons using a WKT string',
 polylines: 'Draw polylines using a WKT string'
};



reader.readAsArrayBuffer(file);

reader.onload = function(event){
var data = new Uint8Array(reader.result);

var work_book = XLSX.read(data, {type:'array'});

var sheet_name = work_book.SheetNames;

var sheet_data = XLSX.utils.sheet_to_json(work_book.Sheets[sheet_name[0]], {header:1});
let swalOpt2={};
let fa={};
		   
		   let fd=[];
		   let objFd={name:"",type:"",alias:""};
		   
for(var cell = 0; cell < sheet_data[0].length; cell++)
	 {
	   swalOpt2[sheet_data[0][cell]] = sheet_data[0][cell];
	   
	 }
	 console.log("swalOPt")
	 console.log(swalOpt2)
var idTable="Id";
if(sheet_data[0].indexOf(idTable)!=-1)
{
	idTable="GisId";
}
function Tt()
	 {

if(sheet_data.length > 0)
{
 var table_output = "<thead>"+'<th>'+idTable+'</th>';

 for(var row = 0; row < sheet_data.length; row++)
 {
	
   if(row == 1)
		 {

		   table_output += '<tbody>';

		 }
   if(row != 0)
		 {
			
		   table_output += '<tr>'+'<td>'+row+'</td>';
		 }
		 
	 for(var cell = 0; cell < sheet_data[row].length; cell++)
	 {

		 if(row == 0)
		 {

			 table_output += '<th>'+sheet_data[row][cell]+'</th>';

		 }
		 else
		 {

			 table_output +='<td>'+sheet_data[row][cell]+'</td>';

		 }

	 }
	 
	 if(row != 0)
		 {

		   table_output += '</tr>';

		 }
	 else
	 {
	   table_output += '</thead>';

	 }


 }

 table_output += '</tbody>';
 let lyrs=document.getElementById("tableSp");

 // document.getElementById('excel_data').innerHTML = table_output;
 let y = document.createElement("label");
 
 
let aa=document.querySelector('#excel_file').files[0].name;
// console.log(aa.name)
let valy=aa.split(".").shift();
y.innerText=valy;

 table=document.createElement("table");
table.setAttribute("id", valy);
table.classList.add("table");
table.classList.add("table-bordered");

 table.innerHTML=table_output;
 lyrs.appendChild(table)



console.log(table)
 let x = document.createElement("INPUT");
x.setAttribute("type", "checkbox");
x.checked=true;


let cloneX=x.cloneNode(true);
let cloneY=y.cloneNode(true);


slider = document.createElement('input');
slider.id = "sl"+nbly;
slider.type = 'range';
slider.min = 0;
slider.max = 1;
slider.value = 1;
slider.step = 0.1;
slider.style.width=120;
slider.style.position = "relative"; 
// slider.style.zIndex = "2000";
var br = document.createElement('br');

let lyrs3=document.getElementById("dragList");
let lyrs2=document.getElementById("TableList");
let slcSp1=document.getElementById("slcSp");

let dv=document.createElement("div");
// dv.style.cssFloat = "left";
// if(nbly>=1)
// {
// $('#layers3 span:first').css('display', 'inline-block');
x.style.cssFloat = "left";
dv.appendChild(x);
dv.appendChild(y);
dv.appendChild(br);
dv.appendChild(slider);
dv.style.display="inline-block";
let plt=document.createElement("span");
plt.innerHTML=palette;
plt.style.cssFloat = "right"; 
dv.appendChild(plt);

let li=document.createElement("li");
li.appendChild(dv);
lyrs3.insertBefore(li, lyrs3.firstChild);
let plt2=document.getElementById("palette1");
let valz=valy+"Plt";
plt2.setAttribute("id", valz);
let a=lyrs3.getElementsByTagName("select")
console.log("dÃ©but")
console.log(a)
if(a.length==1)
{
fc="blue";
sc="yellow";
out="white"
console.log(fc)
}
else
{
console.log("else")
let clrs=[];
for(t of lyrs3.getElementsByTagName("select"))
{
console.log(t)
console.log(t.options[t.selectedIndex].innerText)
clrs.push(t.options[t.selectedIndex].text);
}
let difference = colorsPlt.filter(x => !clrs.includes(x));
if(difference.length==0)
{
alert("vous avez dÃ©passÃ© 7 layers")

}
else
{
plt2.value=difference[0];
fc=plt2.value;
let inda=colorsPlt.indexOf(fc);
sc=slctPlt[inda];
out=outPlt[inda];

}
}
let b=lyrs3.getElementsByTagName("select");
b[0].style.backgroundColor=fc;
b[0].style.color="white"

// for(u of b[0].options)
// {
// 	u.style.color="white";
// }
let divT=document.createElement("div");
divT.style.borderColor = "red";

 dv.style.cssFloat = "left";
lab=document.createElement("span");
lab.innerText="(Selected: 0 Highlighted: 0)";
divT.appendChild(cloneX);
divT.appendChild(cloneY);
divT.appendChild(lab);



let tableHd=table.getElementsByTagName("thead")[0].cloneNode(true);

let hh=table.getElementsByTagName("thead")[0].rows[0]

	let kk=hh.getElementsByTagName("th");
	for(g of kk)
	{
		g.addEventListener('dblclick',function()
		{if(this.style.backgroundColor=="")
		{this.style.backgroundColor="orange";}
		else
		{this.style.backgroundColor=""}; })
		g.addEventListener('mouseover',function(){this.style="cursor: pointer;"})
		
		fa[g.innerText]=g.innerText;
	   objFd={};
		objFd.name=g.innerText;
		objFd.alias=g.innerText;
		objFd.type='';
		fd.push(objFd);
	}




let valyslc=valy+"Slc";
tableSlc=document.createElement("table");
tableSlc.setAttribute("id", valyslc);
tableSlc.classList.add("table-bordered");
let slcSp2=document.getElementById("slcSp2");
tableSlc.appendChild(tableHd);
slcSp2.appendChild(tableSlc);

let bt = document.createElement("button");
 bt.textContent = 'Add field';
 bt.classList.add("btn")
bt.classList.add("btn-success")

let bt2 = document.createElement("button");
 bt2.textContent = 'Heatmap';
 bt2.classList.add("btn")
bt2.classList.add("btn-primary")

let bt3 = document.createElement("button");
 bt3.textContent = 'Delete field';
 bt3.classList.add("btn")
bt3.classList.add("btn-danger")

bt3.addEventListener('click',function(){

for (var i = kk.length - 1; i >= 0; i--) {
	if(kk[i].style.backgroundColor=="orange")
	{
		kk[i].style.backgroundColor="";
			for (let u = 0; u < table.rows.length; u++) {
   	table.rows[u].deleteCell(i);
		}
		for (let v = 0; v < tableSlc.rows.length; v++) {
   	tableSlc.rows[v].deleteCell(i);
		}
	}

}

})
divT.appendChild(bt);
divT.appendChild(bt2);
divT.appendChild(bt3);


lyrs2.appendChild(divT);

let idTbl=lyrs.getElementsByTagName("table").length
idTbl--;
bt.addEventListener("click", function(){createColumn2(table,tableSlc,idTbl)});
bt2.addEventListener("click", function(){createColumn3(table,idTbl)});

for(t of lyrs2.children)
{
t.checked=false;
}
cloneX.checked=true;
for(u of lyrs.children)
{
u.style.display="none";
}
for(u of slcSp2.children)
{
u.style.display="none";
}
for(u of lyrs2.getElementsByTagName("input"))
{
u.checked=false;
}
cloneX.checked=true;
$("#"+valy).show();
$("#"+valyslc).show();
function showhidetbl()
{
if(cloneX.checked==false)
{
$("#"+valy).hide();
$("#"+valyslc).hide();

for(u of lyrs.children)
{
u.style.display="none";
}
for(u of slcSp2.children)
{
u.style.display="none";
}
}
else
{
for(u of lyrs.children)
{
u.style.display="none";
}
for(u of slcSp2.children)
{
u.style.display="none";
}
for(u of lyrs2.getElementsByTagName("input"))
{
u.checked=false;
}
cloneX.checked=true;
$("#"+valy).show();
$("#"+valyslc).show();

}
}
cloneX.onclick=showhidetbl;
let parc=0;
let pgs=[];
let bw=1;
if(geom=="carrÃ©s")
{


for (var i = 1; i < table.rows.length; i++) {
let vals=(table.rows[i]).getElementsByTagName("td");
console.log(N6)
console.log(vals)
let i1=parseInt(N1);
let i2=parseInt(N2);
var wgsR1,wgsR2,wgsR3,wgsR4;

wgsR1=proj4(sys,wgs,[parseFloat(vals[i1].innerText)-parseFloat(N6),parseFloat(vals[i2].innerText)-parseFloat(N6)]);
wgsR2=proj4(sys,wgs,[parseFloat(vals[i1].innerText)-parseFloat(N6),parseFloat(vals[i2].innerText)+parseFloat(N6)]);
wgsR3=proj4(sys,wgs,[parseFloat(vals[i1].innerText)+parseFloat(N6),parseFloat(vals[i2].innerText)+parseFloat(N6)]);
wgsR4=proj4(sys,wgs,[parseFloat(vals[i1].innerText)+parseFloat(N6),parseFloat(vals[i2].innerText)-parseFloat(N6)]);

var coords = [
[wgsR1[1],wgsR1[0]],
[wgsR2[1],wgsR2[0]],
[wgsR3[1],wgsR3[0]],
[wgsR4[1],wgsR4[0]],
[wgsR1[1],wgsR1[0]]
];

var coords2=[];
var u=0;
for (var j = 0; j < coords.length; j++) {
coords2[u]={lat: coords[j][0], lng: coords[j][1]};
u++;
}

let options={};
let parc2=0;
options.fieldAliases=fa;
options.fields=fd;
options.geometryType="esriGeometryPolygon";

options.attributes={};
let hh2=table.getElementsByTagName("thead")[0].rows[0]

	let kk2=hh2.getElementsByTagName("th");
	
for(t of kk2)
{
let s=t.innerText;
options.attributes[s]=vals[parc2].innerText;
parc2++;
}

options.table=nbly;
options.layer=nbly;

deletedN.push(maxVal(table,0));
eventLst.push(1);
eventLst2.push(1);


options.type="polyg";
options.clicked=0;
options.colors=[fc,sc,out];
options.zindex=parc;
pgs[parc]=L.polygon(coords2,options);

pgs[parc].setStyle({fillColor: fc,fillOpacity:1,color: 'orange',weight:1});
pgs[parc].addTo(featureGroup);
//  pgs[parc].addTo(map);

parc++;

}

}
else if (geom=="buffers")
{
pgs=[];
parc=0;
for (var i = 1; i < table.rows.length; i++) {
let vals=(table.rows[i]).getElementsByTagName("td");
console.log(N6)

let i1=parseInt(N1);
let i2=parseInt(N2);
let wgsR1;

wgsR1=proj4(sys,wgs,[parseFloat(vals[i1].innerText),parseFloat(vals[i2].innerText)]);

let options={};
options.fieldAliases=fa;
options.fields=fd;
options.geometryType="esriGeometryPolygon";

options.attributes={};

let parc2=0;
let hh2=table.getElementsByTagName("thead")[0].rows[0]

	let kk2=hh2.getElementsByTagName("th");
	
for(t of kk2)
{
let s=t.innerText;
options.attributes[s]=vals[parc2].innerText;
parc2++;
}



options.table=nbly;
options.layer=nbly;

deletedN.push(maxVal(table,0));
eventLst.push(1);
eventLst2.push(1);

options.type="polyg";

options.clicked=0;
options.radius=parseFloat(N6);
options.center={lng:wgsR1[0], lat:wgsR1[1]};

options.colors=[fc,sc,out];
pgs[parc]=L.circle([wgsR1[1], wgsR1[0]], options)

pgs[parc].setStyle({fillColor: fc,fillOpacity:1,color: out,weight:1});
pgs[parc].addTo(featureGroup);
//  pgs[parc].addTo(map);

parc++;

}



}
else if (geom=="polyg")
{
pgs=[];
parc=0;
for (var i = 1; i < table.rows.length; i++) {
let vals=(table.rows[i]).getElementsByTagName("td");
let i1=parseInt(N1);
console.log(vals[i1].innerText)
let tmp = parsePolyStrings(vals[i1].innerText,sys);

let options={};
options.fieldAliases=fa;
options.fields=fd;
options.geometryType="esriGeometryPolygon";

options.attributes={};
let parc2=0;
let hh2=table.getElementsByTagName("thead")[0].rows[0]

	let kk2=hh2.getElementsByTagName("th");
	
for(t of kk2)
{
let s=t.innerText;
options.attributes[s]=vals[parc2].innerText;
parc2++;
}


options.table=nbly;
options.layer=nbly;

deletedN.push(maxVal(table,0));
eventLst.push(1);
eventLst2.push(1);

options.type="polyg";
options.clicked=0;
options.colors=[fc,sc,out];

if (tmp.length) {

pgs[parc]=L.polygon(tmp,options);
}

pgs[parc].setStyle({fillColor: fc,fillOpacity:1,color: out,weight:1});
pgs[parc].addTo(featureGroup);
//  pgs[parc].addTo(map);

parc++;

}



}
else if (geom=="polylines")
{
pgs=[];
parc=0;
for (var i = 1; i < table.rows.length; i++) {
let vals=(table.rows[i]).getElementsByTagName("td");
let i1=parseInt(N1);
let tmp = parsePolyStrings(vals[i1].innerText,sys);

let options={};
options.fieldAliases=fa;
options.fields=fd;
options.geometryType="esriGeometryPolyline";

options.attributes={};

let parc2=0;
let hh2=table.getElementsByTagName("thead")[0].rows[0]

	let kk2=hh2.getElementsByTagName("th");
	
for(t of kk2)
{
let s=t.innerText;
options.attributes[s]=vals[parc2].innerText;
parc2++;
}


options.type="polylineGis";
options.table=nbly;
options.layer=nbly;

deletedN.push(maxVal(table,0));
eventLst.push(1);
eventLst2.push(1);

options.clicked=0;
options.colors=[fc,sc,out];
if (tmp.length) {

pgs[parc]=L.polyline(tmp,options);
}

pgs[parc].setStyle({color: fc,weight:1});
pgs[parc].addTo(featureGroup);
//  pgs[parc].addTo(map);

parc++;

}

}
else
{
bw=0;
switch(fc)
{

case 'blue': fc=blueIcon;
		  sc=yellowIcon;
		  out=whiteIcon;
		  break;
case 'cyan': fc=cyanIcon;
		  sc=orangeIcon;
		  out=blackIcon;
		  break;
case 'green': fc=greenIcon;
		  sc=redIcon;
		  out=blueIcon;
		  break;
case 'yellow': fc=yellowIcon;
		  sc=blueIcon;
		  out=whiteIcon;
		  break;
case 'orange': fc=orangeIcon;
		  sc=cyanIcon;
		  out=blackIcon;
		  break;
case 'red':  fc=redIcon;
		  sc=greenIcon;
		  out=blueIcon;
		  break;
case 'black': fc=blackIcon;
		  sc=whiteIcon;
		  out=redIcon;
		  break;

}
pgs=[];
parc=0;


let markerLayer = new L.ConditionalMarkers({
 minZoomShow: 8,
 viewportPadding: 0.0
});
markerLayer.addTo(map);
for (var i = 1; i < table.rows.length; i++) {
let vals=(table.rows[i]).getElementsByTagName("td");
console.log(N6)

let i1=parseInt(N1);
let i2=parseInt(N2);
let wgsR1;

wgsR1=proj4(sys,wgs,[parseFloat(vals[i1].innerText),parseFloat(vals[i2].innerText)]);

let options={};
options.fieldAliases=fa;
options.fields=fd;
options.geometryType="esriGeometryPoint";

options.attributes={};

let parc2=0;
let hh2=table.getElementsByTagName("thead")[0].rows[0]

	let kk2=hh2.getElementsByTagName("th");
	
for(t of kk2)
{
let s=t.innerText;
options.attributes[s]=vals[parc2].innerText;
parc2++;
}


options.type="pointGis";
options.table=nbly;
options.layer=nbly;

deletedN.push(maxVal(table,0));
eventLst.push(1);
eventLst2.push(1);

options.clicked=0;
options.icon=fc;
options.colors=[fc,sc,out];

//  let ltlng=[wgsR1[1], wgsR1[0]];
//  let icn='marker-icon.png'
// drawMarker(icn,ltlng);
// pgs[parc]=drawMarker(icn,ltlng);
pgs[parc]=L.marker([wgsR1[1], wgsR1[0]], options);

pgs[parc].addTo(featureGroup);
//  pgs[parc].addTo(map);
markerLayer.addLayer(pgs[parc]);
parc++;

}





}
lyrsT.push(pgs);

// deletedN.push(maxVal(table,0));
// eventLst.push(1);
// eventLst2.push(1);



if(bw!=0)
{
map.addLayer(featureGroup); 
}
grply.push(featureGroup);
featureGroup.bringToFront();



lyrs3.getElementsByTagName("label")[0].innerText+='('+pgs[0].options.type+')';

li.draggable = true;
slider.addEventListener("click", function(){t=this;updateOpacity(pgs,t.value);li.draggable = false;});
slider.addEventListener("mouseout", function(){li.draggable = true;});
// li.addEventListener("mouseout", function(){li.draggable = false;});

tbdSlc = document.createElement("tbody");
tableSlc.appendChild(tbdSlc);

for(i=0;i<pgs.length;i++)
{
pgs[i].addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
}

table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value);});


tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});

plt2.addEventListener('click', (event) => {
let ev=event.target.options[event.target.selectedIndex];
let ev2=slctPlt[event.target.selectedIndex];
let ev3=outPlt[event.target.selectedIndex];
plt2.style.backgroundColor=ev.style.backgroundColor; 
fc=ev.innerText;
sc=ev2;
out=ev3;


for(p of pgs)
{
	p.options.colors=[fc,sc,out];
 t=p;
 if(p.options.type=="polyg" || p.options.type=="circle")
 {
   p.setStyle({fillColor: ev.innerText,weight:1,color:out});
   p.off("click");
   p.options.clicked=0;
 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
 }
 else if(p.options.type=="polylineGis")
 {
   p.setStyle({color: ev.innerText,weight:1});
   p.off("click");
   p.options.clicked=0;
 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
 }
 else if(p.options.type=="pointGis")
 {
			 switch(fc)
	 {
	   
	   case 'blue': fc=blueIcon;
				   sc=yellowIcon;
				   out=whiteIcon;
				   break;
	   case 'cyan': fc=cyanIcon;
				   sc=orangeIcon;
				   out=blackIcon;
				   break;
	   case 'green': fc=greenIcon;
				   sc=redIcon;
				   out=blueIcon;
				   break;
	   case 'yellow': fc=yellowIcon;
				   sc=blueIcon;
				   out=whiteIcon;
				   break;
	   case 'orange': fc=orangeIcon;
				   sc=cyanIcon;
				   out=blackIcon;
				   break;
	   case 'red':  fc=redIcon;
				   sc=greenIcon;
				   out=blueIcon;
				   break;
	   case 'black': fc=blackIcon;
				   sc=whiteIcon;
				   out=redIcon;
				   break;

	 }
   p.setIcon(fc);
   p.off("click");
   p.options.clicked=0;
 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
 }
 
}
clearTbl(table,tbdSlc)
selectedHighlighted(table,tbdSlc,lab);
table.off("click");
table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value);});
tableSlc.off("click");
tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});

x.off("click");
x.onclick=showhidelyr;


   // addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc);
   //         for(i=0;i<pgs.length;i++)
   //         {
   //         onclickPgs(pgs[i],pgs,table,tableSlc,tbdSlc,lab,fc,sc); 
   //         }
   // addClickBdslc(tableSlc,pgs,lab,fc,sc);

	 console.log(fc)
	 console.log(sc)
}); 

let trgt=document.getElementById("dragList")
slist(trgt);

function showhidelyr()
{
if(x.checked==false)
{
for (let l of pgs)
{
if(l.options.type=="polyg" || l.options.type=="circle")
{
l.setStyle({opacity: 0,fillOpacity: 0,weight:0});
}
else if(l.options.type=="polylineGis")
{
l.setStyle({weight:0});
}
// l.unbindTooltip();
}
for(i=0;i<pgs.length;i++)
{
pgs[i].setInteractive(false);
}
}
else
{
for(i=0;i<pgs.length;i++)
{
if(pgs[i].options.type=="polyg" || pgs[i].options.type=="circle")
{

if(clickedZ.indexOf(pgs[i])==-1)
{
 if(clickedY.indexOf(pgs[i])==-1)
{
 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:fc,weight:1});
}
else
{
 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:sc,weight:3});
}
}
else
{
 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor: out,color: sc,weight:3});
}

}
else if(pgs[i].options.type=="polylineGis")
{
pgs[i].setStyle({weight:3});
}


pgs[i].setInteractive(true);
}
}
}
x.onclick=showhidelyr;
}

excel_file.value = '';

	 }


	 (async () => {

const { value: draw } = await Swal.fire({
title: 'Select geometry',
input: 'select',
inputOptions: swalOpt,
inputPlaceholder: 'Select a geometry to draw',
allowOutsideClick: false,
showCancelButton: true,
inputValidator: (value) => {
 return new Promise((resolve) => {
   console.log(swalOpt)
   let obj=Object.keys(swalOpt);
   if (obj.indexOf(value)!=-1) {
	switch(value){
	 case 'buffers': geom='buffers';
					 break;
	 case 'centers': geom='centres';
					 N6=1;
					 break;
	 case 'squares': geom='carrÃ©s';
					 break;
	 case 'polygs': geom='polyg';
					 N6=1;
					 break;
	 case 'polylines': geom='polylines';
					   N6=1;
					 break;
	}
	 
	 
   resolve()
   
   } else {
	 resolve('You need to select a geometry :)')
   }
 })
}
})

})().then(function() {
if(geom=="buffers" ||geom=="carrÃ©s")
{
 (async () => {
 
 const { value: radius } = await Swal.fire({
   title: 'enter radius',
   input: 'text',
   allowOutsideClick: false,
   showCancelButton: true,
   inputValidator: (value) => {
	 return new Promise((resolve) => {
	   if(isNaN(value) || value=="")
		   {
			 resolve('You need to enter a number :)')

		   }
		   else
		   {
			 N6=value;
									 
		 resolve()
		   }
	  
	 
	 })
   }


 })

		   })().then(function() {
					   (async () => {

	   const { value: X } = await Swal.fire({
		 title: 'select X column',
		 input: 'select',
		 inputOptions: swalOpt2,
		 inputPlaceholder: 'Select X column',
		 showCancelButton: true,
		 inputValidator: (value) => {
		   return new Promise((resolve) => {
					   let obj=Object.keys(swalOpt2);
			   if (obj.indexOf(value)!=-1) {
			   N1=obj.indexOf(value)+1;
			   resolve()
			   
			   } else {
				 resolve('You need to select a column :)')
			   }
		   })
		 }
	   })

	   })().then(function() {
					 (async () => {

	 const { value: Y } = await Swal.fire({
	   title: 'select Y column',
	   input: 'select',
	   inputOptions: swalOpt2,
	   inputPlaceholder: 'Select Y column',
	   showCancelButton: true,
	   inputValidator: (value) => {
		 return new Promise((resolve) => {
					 let obj=Object.keys(swalOpt2);
			 if (obj.indexOf(value)!=-1) {
			 N2=obj.indexOf(value)+1;
			 resolve()
			 
			 } else {
			   resolve('You need to select a column :)')
			 }
		 })
	   }
	 })

	 })().then(function() {
					 
						 (async () => {
						  
		 const { value: formValues } = await Swal.fire({
		   title: 'Multiple inputs',
		   html:swalCnt +'<br>'+swalSys+'<div id="resolve"></div>',
		   focusConfirm: false,
		   didOpen: () => {
			 let swl=document.getElementById('countrySwal');
			 swl.addEventListener("change", chngSwal);
				   },
		   preConfirm: () => {
			 let i=cnt.indexOf(document.getElementById('countrySwal').value);
			 let j=coordSys.indexOf(document.getElementById('sysSwal').value);
			 sys=sysTab[j];
		   }
		 })
		 if (document.getElementById('countrySwal').value!="selected") {
		   Tt();
		   // Swal.fire(JSON.stringify(formValues))
		 }
		 else
		 {
		   document.getElementById('resolve').innerText="You need to select a country!";
		 }

		 })()
   });
});
});
}
else if(geom=="centres")
{
		 (async () => {

	 const { value: X } = await Swal.fire({
	   title: 'select X column',
	   input: 'select',
	   inputOptions: swalOpt2,
	   inputPlaceholder: 'Select X column',
	   showCancelButton: true,
	   inputValidator: (value) => {
		 return new Promise((resolve) => {
					 let obj=Object.keys(swalOpt2);
			 if (obj.indexOf(value)!=-1) {
			 N1=obj.indexOf(value)+1;
			 resolve()
			 
			 } else {
			   resolve('You need to select a column :)')
			 }
		 })
	   }
	 })

	 })().then(function() {
				   (async () => {

	 const { value: Y } = await Swal.fire({
	 title: 'select Y column',
	 input: 'select',
	 inputOptions: swalOpt2,
	 inputPlaceholder: 'Select Y column',
	 showCancelButton: true,
	 inputValidator: (value) => {
	   return new Promise((resolve) => {
				   let obj=Object.keys(swalOpt2);
		   if (obj.indexOf(value)!=-1) {
		   N2=obj.indexOf(value)+1;
		   resolve()
		   
		   } else {
			 resolve('You need to select a column :)')
		   }
	   })
	 }
	 })

	 })().then(function() {
			   (async () => {
				 
		   const { value: formValues } = await Swal.fire({
		   title: 'Multiple inputs',
		   html:swalCnt +'<br>'+swalSys,
		   focusConfirm: false,
		   didOpen: () => {
			 let swl=document.getElementById('countrySwal');
			 swl.addEventListener("change", chngSwal);
				   },
		   preConfirm: () => {
			 let i=cnt.indexOf(document.getElementById('countrySwal').value);
			 let j=coordSys.indexOf(document.getElementById('sysSwal').value);
			 sys=sysTab[j];
		   }
		   })

		   if (formValues) {  
			 Tt();
		   // Swal.fire(JSON.stringify(formValues))
		   }

		   })()
		   });
});
}
else
{
		 (async () => {

	 const { value: wkt } = await Swal.fire({
	   title: 'select WKT column',
	   input: 'select',
	   inputOptions: swalOpt2,
	   inputPlaceholder: 'Select WKT column',
	   showCancelButton: true,
	   inputValidator: (value) => {
		 return new Promise((resolve) => {
					 let obj=Object.keys(swalOpt2);
			 if (obj.indexOf(value)!=-1) {
			 N1=obj.indexOf(value)+1;
			 resolve()
			 
			 } else {
			   resolve('You need to select a column :)')
			 }
		 })
	   }
	 })
	 })().then(function() {
					   (async () => {
						 
				   const { value: formValues } = await Swal.fire({
				   title: 'Multiple inputs',
				   html:swalCnt +'<br>'+swalSys,
				   focusConfirm: false,
				   didOpen: () => {
				   let swl=document.getElementById('countrySwal');
				   swl.addEventListener("change", chngSwal);
				   },
				   preConfirm: () => {
							 let i=cnt.indexOf(document.getElementById('countrySwal').value);
					 let j=coordSys.indexOf(document.getElementById('sysSwal').value);
					 sys=sysTab[j];
				   }
				   })

				   if (formValues) {          
				   // Swal.fire(JSON.stringify(formValues))
				   Tt();
				   }

				   })()
				   });
}

});



}
 }
 else if (file.type== 'application/json') {
   let pgs=[];
let table,tableSlc,tbdSlc,lab,fc,sc,out,t,slider;

reader.onload = ({ target: { result } }) => {
 prelev=JSON.parse(result);
 let h=sysWkid.indexOf(prelev.spatialReference.wkid);
 sys=sysTab[h];
 
 let valy=((this.value).split("\\").pop()).split(".").shift();
 function Tt()
 {

 
 nbly++;
 let featureGroup = L.featureGroup();

 
 let x = document.createElement("INPUT");
 x.setAttribute("type", "checkbox");
 x.checked=true;

 let y = document.createElement("label");
 let bt = document.createElement("button");
 bt.textContent = 'Add field';
 bt.classList.add("btn")
bt.classList.add("btn-success")

let bt2 = document.createElement("button");
 bt2.textContent = 'Heatmap';
 bt2.classList.add("btn")
bt2.classList.add("btn-primary")

 // console.log(aa.name)
 y.innerText=valy;
 let cloneX=x.cloneNode(true);
 let cloneY=y.cloneNode(true);
 

 slider = document.createElement('input');
 slider.id = "sl"+nbly;
 slider.type = 'range';
 slider.min = 0;
 slider.max = 1;
 slider.value = 1;
 slider.step = 0.1;
 slider.style.width=120;
 slider.style.position = "relative"; 
 
 var br = document.createElement('br');

 let lyrs3=document.getElementById("dragList");
 let lyrs2=document.getElementById("TableList");
 let slcSp1=document.getElementById("slcSp");

 let dv=document.createElement("div");
 x.style.cssFloat = "left";
   dv.appendChild(x);
   dv.appendChild(y);
   dv.appendChild(br);
   dv.appendChild(slider);
   dv.style.display="inline-block";
   let plt=document.createElement("span");
   plt.innerHTML=palette;
   plt.style.cssFloat = "right"; 
   dv.appendChild(plt);
   
   let li=document.createElement("li");
   li.appendChild(dv);
   lyrs3.insertBefore(li, lyrs3.firstChild);
   let plt2=document.getElementById("palette1");
   let valz=valy+"Plt";
   plt2.setAttribute("id", valz);
   let a=lyrs3.getElementsByTagName("select")
console.log("dÃ©but")
console.log(a)
if(a.length==1)
{
 fc="blue";
 sc="yellow";
 out="white"
 console.log(fc)
}
else
{
 console.log("else")
 let clrs=[];
for(t of lyrs3.getElementsByTagName("select"))
{
 console.log(t)
 console.log(t.options[t.selectedIndex].innerText)
 clrs.push(t.options[t.selectedIndex].text);
}
let difference = colorsPlt.filter(x => !clrs.includes(x));
if(difference.length==0)
{
 alert("vous avez dÃ©passÃ© 7 layers")
 
}
else
{
 plt2.value=difference[0];
 
 fc=plt2.value;
 let inda=colorsPlt.indexOf(fc);
 sc=slctPlt[inda];
 out=outPlt[inda];

}
}
let b=lyrs3.getElementsByTagName("select");
b[0].style.backgroundColor=fc;
b[0].style.color="white"

// for(u of b[0].options)
// {
// 	u.style.color="white";
// }
 let bw=1;
 let parc=0;
 for(let k of prelev.features)
{
 var coords2=[];
 let coords3=[];
 
	 var u=0;
	 let options={};
	 options.attributes={};
	 options.spatialReference=prelev.spatialReference;
	 options.geometryType=prelev.geometryType;
	 options.fieldAliases=prelev.fieldAliases;
	 options.fields=prelev.fields;
	 if(prelev.geometryType=="esriGeometryPolygon"||prelev.geometryType=="esriGeometryMultiPolygon")
	 {
	   let wgsR1;
	   
		   for (var j = 0; j < k.geometry.rings[0].length; j++) {
			 wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.rings[0][j][0]),parseFloat(k.geometry.rings[0][j][1])]);
		   coords2[u]=[wgsR1[1], wgsR1[0]];
		   coords3[u]=[wgsR1[0], wgsR1[1]];
		   u++;
				 }
	 // console.log(k)
	 let objv1=Object.values(k.attributes);
	 let objk=Object.keys(k.attributes);
	 
	 for (let j = 0; j < objv1.length; j++)
	 {
	   let s=objk[j];
	   options.attributes[s]=objv1[j];
	 }
	 
	 
	 options.coords=[coords3];
	 options.table=nbly;
	 options.layer=nbly;

	 options.type="polyg";
	 options.clicked=0;
	 options.colors=[fc,sc,out];
	 options.zindex=parc;
   let polyg=L.polygon(coords2,options);
   
   
   polyg.setStyle({fillColor: fc,fillOpacity:1,color: out,weight:1});
   polyg.addTo(featureGroup);
	 // polyg.addTo(map);
	 pgs.push(polyg);
	 }
	 else if(prelev.geometryType=="esriGeometryPoint")
	 {
	   bw=0;
	   switch(fc)
		 {
		   
		   case 'blue': fc=blueIcon;
					   sc=yellowIcon;
					   out=whiteIcon;
					   break;
		   case 'cyan': fc=cyanIcon;
					   sc=orangeIcon;
					   out=blackIcon;
					   break;
		   case 'green': fc=greenIcon;
					   sc=redIcon;
					   out=blueIcon;
					   break;
		   case 'yellow': fc=yellowIcon;
					   sc=blueIcon;
					   out=whiteIcon;
					   break;
		   case 'orange': fc=orangeIcon;
					   sc=cyanIcon;
					   out=blackIcon;
					   break;
		   case 'red':  fc=redIcon;
					   sc=greenIcon;
					   out=blueIcon;
					   break;
		   case 'black': fc=blackIcon;
					   sc=whiteIcon;
					   out=redIcon;
					   break;

		 }
			 let markerLayer = new L.ConditionalMarkers({
		   minZoomShow: 8,
		   viewportPadding: 0.0
		 });
		 markerLayer.addTo(map);
	   
	   let objv1=Object.values(k.attributes);
	 let objk=Object.keys(k.attributes);
	

	 for (let j = 0; j < objv1.length; j++)
	 {
	   let s=objk[j];
	   options.attributes[s]=objv1[j];
	 }
	 

	   let wgsR1;
	   wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.x),parseFloat(k.geometry.y)]);
	   let coords2=[wgsR1[1], wgsR1[0]];
	   options.type="pointGis";
	   options.table=nbly;
	   options.layer=nbly;

	   options.clicked=0;
	   options.icon=fc;
	   options.colors=[fc,sc,out];

	   let point=L.marker(coords2, options);
	 markerLayer.addLayer(point);
   
   point.addTo(featureGroup);

	   pgs.push(point);
	 }
	 else
	 {
	   let wgsR1;
	   
		   for (var j = 0; j < k.geometry.paths[0].length; j++) {
			 wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.paths[0][j][0]),parseFloat(k.geometry.paths[0][j][1])]);
		   coords2[u]=[wgsR1[1], wgsR1[0]];
		   u++;
				 }
	 // console.log(k)
	 let objv1=Object.values(k.attributes);
	 let objk=Object.keys(k.attributes);
	

	 for (let j = 0; j < objv1.length; j++)
	 {
	   let s=objk[j];
	   options.attributes[s]=objv1[j];
	 }
	 

	 options.type="polylineGis";
	 options.table=nbly;
	 options.layer=nbly;

	 options.colors=[fc,sc,out];
	 options.clicked=0;
   let polyg=L.polyline(coords2,options);
   polyg.setStyle({color: fc,weight:1});
   polyg.addTo(featureGroup);
	 // polyg.addTo(map);
	 pgs.push(polyg);
	 }
	 // var objs=JSON.stringify(coords2)
	 // console.log(objs[0])
parc++;
}

lyrsT.push(pgs);

console.log(lyrsT)
if(bw!=0)
{
 map.addLayer(featureGroup); 
}
console.log(pgs[0])

//    pgs[0].addEventListener("click", function(){
//     this.enableEdit();
//     document.onkeydown = function(evt) {
//     evt = evt || window.event;
//     if (evt.keycode == 13) {
//         pgs[0].disableEdit();
//     }
// };
//   });

    

grply.push(featureGroup);
featureGroup.bringToFront();

lyrs3.getElementsByTagName("label")[0].innerText+='('+pgs[0].options.type+')';

li.draggable = true;
slider.addEventListener("click", function(){t=this;updateOpacity(pgs,t.value);li.draggable = false;});
slider.addEventListener("mouseout", function(){li.draggable = true;});
 for(t of lyrs2.children)
 {
   t.checked=false;
 }
 function showhidelyr()
 {
   if(x.checked==false)
   {
	 for (let l of pgs)
	 {
	   if(l.options.type=="polyg" || l.options.type=="circle")
	 {
	   l.setStyle({opacity: 0,fillOpacity: 0,weight:0});
	 }
	 else if(l.options.type=="polylineGis")
	 {
		l.setStyle({weight:0});

	 }
	   // l.unbindTooltip();
	 }
	 for(i=0;i<pgs.length;i++)
	{
	   pgs[i].setInteractive(false);
	 }
   }
   else
   {
	 for(i=0;i<pgs.length;i++)
	{
	 if(pgs[i].options.type=="polyg" || pgs[i].options.type=="circle")
	 {
	   
	   if(clickedZ.indexOf(pgs[i])==-1)
	   {
		 if(clickedY.indexOf(pgs[i])==-1)
	   {
		 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:fc,weight:1});
	   }
	   else
	   {
		 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:sc,weight:3});
	   }
	   }
	   else
	   {
		 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor: out,color: sc,weight:3});
	   }
	   
	 }
	 else if(pgs[i].options.type=="polylineGis")
	 {
		pgs[i].setStyle({weight:3});

	 }
	 
	   pgs[i].setInteractive(true);
	 }
   }
 }
 x.onclick=showhidelyr;


 let divT=document.createElement("div");
divT.style.border = "medium solid red";
  lab=document.createElement("span");
 lab.innerText="(Selected: 0 Highlighted: 0)";
 divT.appendChild(cloneX);
 divT.appendChild(cloneY);
 divT.appendChild(lab);
 divT.appendChild(bt);
 divT.appendChild(bt2);

 divT.style.marginTop = "2vh";

 
 lyrs2.appendChild(divT);

 console.log(grply)
 let trgt=document.getElementById("dragList")
   slist(trgt);
   
let lyrs=document.getElementById("tableSp");
table = document.createElement("table");
   table.setAttribute("id", valy);
   table.classList.add("table");

table.classList.add("table-bordered");

let thd = document.createElement("thead");
let row = document.createElement("tr");
let th=[];
let objv=Object.values(prelev.fieldAliases)
// let chld=0;
for(k=0;k<Object.keys(prelev.fieldAliases).length;k++)
{
 // if(Object.keys(prelev.fieldAliases)[k]=="OBJECTID")
 // {
 //   chld=k;
 // }
 th[k] = document.createElement("th");
 th[k].innerText =objv[k] ;
 row.appendChild(th[k]);

}
thd.appendChild(row);
table.appendChild(thd);

let tbd = document.createElement("tbody");

for(i=0;i<prelev.features.length;i++)
{
 let row = document.createElement("tr");
 let cell=[];
 let objv=Object.values(prelev.features[i].attributes)
 // console.log(objv[0])
 for(j=0;j<Object.keys(prelev.fieldAliases).length;j++)
{
 cell[j] = document.createElement("td");
 cell[j].innerText =objv[j] ;
 row.appendChild(cell[j]);
 // row.className='selected';
}
tbd.appendChild(row);
}
table.appendChild(tbd);
// for(t of lyrs.children)
// {
//   t.style.display="none";
// }
lyrs.appendChild(table);

deletedN.push(maxVal(table,0));
eventLst.push(1);
eventLst2.push(1);

let tableHd=table.getElementsByTagName("thead")[0].cloneNode(true);
let valyslc=valy+"Slc";
tableSlc=document.createElement("table");
tableSlc.setAttribute("id", valyslc);
tableSlc.classList.add("table");
tableSlc.classList.add("table-bordered");
let slcSp2=document.getElementById("slcSp2");
tableSlc.appendChild(tableHd);
tbdSlc = document.createElement("tbody");
tableSlc.appendChild(tbdSlc);
slcSp2.appendChild(tableSlc);
let idTbl=lyrs.getElementsByTagName("table").length
idTbl--;
bt.addEventListener("click", function(){createColumn2(table,tableSlc,idTbl)});
bt2.addEventListener("click", function(){createColumn3(table,idTbl)});

table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value)});
tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});

plt2.addEventListener('click', (event) => {
	   let ev=event.target.options[event.target.selectedIndex];
	   let ev2=slctPlt[event.target.selectedIndex];
	   let ev3=outPlt[event.target.selectedIndex];
	   fc=ev.innerText;
	   sc=ev2;
	   out=ev3;
	   plt2.style.backgroundColor=ev.style.backgroundColor; 
	   for(p of pgs)
   {
	p.options.colors=[fc,sc,out];
	 t=p;
	 if(p.options.type=="polyg" || p.options.type=="circle")
	 {
	   p.setStyle({fillColor: ev.innerText,weight:1,color:out});
	   p.off("click");
	   p.options.clicked=0;
	 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
	 }
	 else if(p.options.type=="polylineGis")
	 {
	   p.setStyle({color: ev.innerText,weight:1});
	   p.off("click");
	   p.options.clicked=0;
	 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
	 }
	 else if(p.options.type=="pointGis")
	 {
				 switch(fc)
		 {
		   
		   case 'blue': fc=blueIcon;
					   sc=yellowIcon;
					   out=whiteIcon;
					   break;
		   case 'cyan': fc=cyanIcon;
					   sc=orangeIcon;
					   out=blackIcon;
					   break;
		   case 'green': fc=greenIcon;
					   sc=redIcon;
					   out=blueIcon;
					   break;
		   case 'yellow': fc=yellowIcon;
					   sc=blueIcon;
					   out=whiteIcon;
					   break;
		   case 'orange': fc=orangeIcon;
					   sc=cyanIcon;
					   out=blackIcon;
					   break;
		   case 'red':  fc=redIcon;
					   sc=greenIcon;
					   out=blueIcon;
					   break;
		   case 'black': fc=blackIcon;
					   sc=whiteIcon;
					   out=redIcon;
					   break;

		 }
	   p.setIcon(fc);
	//    p.off("click");
	 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
	 }
   }
   clearTbl(table,tbdSlc)
	   selectedHighlighted(table,tbdSlc,lab);
	//    table.off("click");
   table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value)});
//    tableSlc.off("click");
   tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});

//    x.off("click");
   x.onclick=showhidelyr;
	 }); 
for(t of lyrs2.children)
 {
   t.checked=false;
 }
 cloneX.checked=true;
 for(u of lyrs.children)
	{
	   u.style.display="none";
	 }
	 for(u of slcSp2.children)
	{
	   u.style.display="none";
	 }
	 for(u of lyrs2.getElementsByTagName("input"))
	{
	   u.checked=false;
	 }
	 cloneX.checked=true;
	 $("#"+valy).show();
	 $("#"+valyslc).show();

 function showhidetbl()
 {
   if(cloneX.checked==false)
   {
	 // console.log($(valy))
	 $("#"+valy).hide();
	 $("#"+valyslc).hide();

	 for(u of lyrs.children)
	{
	   u.style.display="none";
	 }
	 for(u of slcSp2.children)
	{
	   u.style.display="none";
	 }
   }
   else
   {
	 for(u of lyrs.children)
	{
	   u.style.display="none";
	 }
	 for(u of slcSp2.children)
	{
	   u.style.display="none";
	 }
	 for(u of lyrs2.getElementsByTagName("input"))
	{
	   u.checked=false;
	 }
	 cloneX.checked=true;
	 $("#"+valy).show();
	 $("#"+valyslc).show();

   }
 }
 cloneX.onclick=showhidetbl;
 // let tbdSlc = document.createElement("tbody");



for(i=0;i<pgs.length;i++)
{

pgs[i].addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
}


 }



Tt();



}
reader.readAsText(file);
 }
 else if (((this.value).split("\\").pop()).split(".").pop()== 'shp') {
 sys=wgs;
   let pgs=[];
let table,tableSlc,tbdSlc,lab,fc,sc,out,t,slider;

   reader.onload = ({ target: { result } }) => {
 let featureGroup = L.featureGroup();

 nbly++;
 let valy=((this.value).split("\\").pop()).split(".").shift();
 let x = document.createElement("INPUT");
 x.setAttribute("type", "checkbox");
 x.checked=true;

 let y = document.createElement("label");
 let bt = document.createElement("button");
 bt.textContent = 'Add field';
 bt.classList.add("btn")
bt.classList.add("btn-success")

let bt2 = document.createElement("button");
 bt2.textContent = 'Heatmap';
 bt2.classList.add("btn")
bt2.classList.add("btn-primary")
 // console.log(aa.name)
 y.innerText=valy;
 let cloneX=x.cloneNode(true);
 let cloneY=y.cloneNode(true);
 

 slider = document.createElement('input');
 slider.id = "sl"+nbly;
 slider.type = 'range';
 slider.min = 0;
 slider.max = 1;
 slider.value = 1;
 slider.step = 0.1;
 slider.style.width=120;
 slider.style.position = "relative"; 
 
 var br = document.createElement('br');

 let lyrs3=document.getElementById("dragList");
 let lyrs2=document.getElementById("TableList");
 let slcSp1=document.getElementById("slcSp");

 let dv=document.createElement("div");
 x.style.cssFloat = "left";
   dv.appendChild(x);
   dv.appendChild(y);
   dv.appendChild(br);
   dv.appendChild(slider);
   dv.style.display="inline-block";
   let plt=document.createElement("span");
   plt.innerHTML=palette;
   plt.style.cssFloat = "right"; 
   dv.appendChild(plt);
   
   let li=document.createElement("li");
   li.appendChild(dv);
   lyrs3.insertBefore(li, lyrs3.firstChild);
   let plt2=document.getElementById("palette1");
   let valz=valy+"Plt";
   plt2.setAttribute("id", valz);
   let a=lyrs3.getElementsByTagName("select")
console.log("dÃ©but")
console.log(a)
if(a.length==1)
{
 fc="blue";
 sc="yellow";
 out="white"
 console.log(fc)
}
else
{
 console.log("else")
 let clrs=[];
for(t of lyrs3.getElementsByTagName("select"))
{
 console.log(t)
 console.log(t.options[t.selectedIndex].innerText)
 clrs.push(t.options[t.selectedIndex].text);
}
let difference = colorsPlt.filter(x => !clrs.includes(x));
if(difference.length==0)
{
 alert("vous avez dÃ©passÃ© 7 layers")
 
}
else
{
 plt2.value=difference[0];
 console.log(difference[0])
 fc=plt2.value;
 let inda=colorsPlt.indexOf(fc);
 sc=slctPlt[inda];
 out=outPlt[inda];

}
}
let b=lyrs3.getElementsByTagName("select");
b[0].style.backgroundColor=fc;
b[0].style.color="white"

// for(u of b[0].options)
// {
// 	u.style.color="white";
// }

//  let strg="http://localhost:8080/PHP/scan"+"/"+valy;
 let strg="shapefiles"+"/"+valy;

 shp(strg).then(function(geojson){
   let objk=Object.keys(geojson.features[0].properties);
   let objv=Object.values(geojson.features[0].properties);
   console.log(objk);
   let pgs=[];
   let polyg;
   let bw=1;
   let parc=0;
   for(k of geojson.features)
   {
	 console.log(k.geometry.coordinates)
   let objk2=Object.keys(k.properties);

	let objv2=Object.values(k.properties);
	let options={};
	options.attributes={};

	 for (let j = 0; j < objv2.length; j++) 
	 {
	   let s=objk2[j];
	   options.attributes[s]=objv2[j];
	 }
	 

	 options.clicked=0;    
	 if(k.geometry.type=="Polygon")
	 {
	   let wgsR1;
			 let coords2=[];
		   let u=0;
		   for (let j = 0; j < k.geometry.coordinates[0].length; j++) {
			 wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.coordinates[0][j][0]),parseFloat(k.geometry.coordinates[0][j][1])]);
			 coords2[u]=[wgsR1[1], wgsR1[0]];
		   u++;
		   }
		   options.table=nbly;
		   options.layer=nbly;

		   options.type="polyg";
		   options.colors=[fc,sc,out];
		   options.zindex=parc;
			polyg=L.polygon(coords2,options);
			
		   polyg.setStyle({fillColor: fc,fillOpacity: 1,color: out,weight:1});

	 }
	 else if(k.geometry.type=="Polyline")
	 {
			 let wgsR1;
			 let coords2=[];
		   let u=0;
		   for (let j = 0; j < k.geometry.coordinates[0].length; j++) {
			 wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.coordinates[0][j][0]),parseFloat(k.geometry.coordinates[0][j][1])]);
			 coords2[u]=[wgsR1[1], wgsR1[0]];
		   u++;
		   }
		   options.table=nbly;
		   options.layer=nbly;

		   options.colors=[fc,sc,out];
		   options.type="polylineGis";
		   polyg=L.polyline(coords2,options);
		   polyg.setStyle({color: fc,weight:1});

	 }
	else
	{
	 bw=0;
	 switch(fc)
{
 
 case 'blue': fc=blueIcon;
			  sc=yellowIcon;
			  out=whiteIcon;
			  break;
 case 'cyan': fc=cyanIcon;
			  sc=orangeIcon;
			  out=blackIcon;
			  break;
 case 'green': fc=greenIcon;
			  sc=redIcon;
			  out=blueIcon;
			  break;
 case 'yellow': fc=yellowIcon;
			  sc=blueIcon;
			  out=whiteIcon;
			  break;
 case 'orange': fc=orangeIcon;
			  sc=cyanIcon;
			  out=blackIcon;
			  break;
 case 'red':  fc=redIcon;
			  sc=greenIcon;
			  out=blueIcon;
			  break;
 case 'black': fc=blackIcon;
			  sc=whiteIcon;
			  out=redIcon;
			  break;

}


let markerLayer = new L.ConditionalMarkers({
	 minZoomShow: 8,
	 viewportPadding: 0.0
   });
   markerLayer.addTo(map);

options.table=nbly;
options.layer=nbly;

options.colors=[fc,sc,out];
options.type="pointGis";
options.icon=fc;
let wgsR1;
wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.coordinates[0]),parseFloat(k.geometry.coordinates[1])]);

let coords2=[wgsR1[1],wgsR1[0]];
polyg=L.marker(coords2, options);
options.icon=fc;



markerLayer.addLayer(polyg);





	}
	 

		 // console.log(coords2)
	 
		   // polyg.addTo(map);
		   polyg.addTo(featureGroup);

	 pgs.push(polyg);
	 parc++;
   }

   


   lyrsT.push(pgs);

   // grply.push(pgs)
   if(bw!=0)
{
 map.addLayer(featureGroup); 
}
grply.push(featureGroup);


lyrs3.getElementsByTagName("label")[0].innerText+='('+pgs[0].options.type+')';
li.draggable = true;
slider.addEventListener("click", function(){t=this;updateOpacity(pgs,t.value);li.draggable = false;});
slider.addEventListener("mouseout", function(){li.draggable = true;});
   // L.geoJSON(geojson).addTo(map);
   let lyrs=document.getElementById("tableSp");
table = document.createElement("table");
table.classList.add("table");
let thd = document.createElement("thead");
let row = document.createElement("tr");
let th=[];
// let chld=0;
		 // document.getElementById('excel_data').innerHTML = table_output;
		 

		table.setAttribute("id", valy);
		table.classList.add("table-bordered");

		 
		 
	lab=document.createElement("span");
   lab.innerText="(Selected: 0 Highlighted: 0)";
   let divT=document.createElement("div");
divT.style.borderColor = "red";
 divT.appendChild(cloneX);
 divT.appendChild(cloneY);
 divT.appendChild(lab);
 divT.appendChild(bt);
 divT.appendChild(bt2);

 lyrs2.appendChild(divT);

 let trgt=document.getElementById("dragList")
   slist(trgt);
 
 for(t of lyrs2.children)
 {
   t.checked=false;
 }
 cloneX.checked=true;
 
 function showhidelyr()
 {
   if(x.checked==false)
   {
	 for (let l of pgs)
	 {
	   if(l.options.type=="polyg" || l.options.type=="circle")
	 {
	   l.setStyle({opacity: 0,fillOpacity: 0,weight:0});
	 }
	 else if(l.options.type=="polylineGis")
	 {
		l.setStyle({weight:0});

	 }
	   // l.unbindTooltip();
	 }
	 for(i=0;i<pgs.length;i++)
	{
	   pgs[i].setInteractive(false);
	 }
   }
   else
   {
	 for(i=0;i<pgs.length;i++)
	{
	 if(pgs[i].options.type=="polyg" || pgs[i].options.type=="circle")
	 {
	   
	   if(clickedZ.indexOf(pgs[i])==-1)
	   {
		 if(clickedY.indexOf(pgs[i])==-1)
	   {
		 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:fc,weight:1});
	   }
	   else
	   {
		 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:sc,weight:3});
	   }
	   }
	   else
	   {
		 pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor: out,color: sc,weight:3});
	   }
	   
	 }
	 else if(pgs[i].options.type=="polylineGis")
	 {
		pgs[i].setStyle({weight:3});

	 }
	 
	   pgs[i].setInteractive(true);
	 }
   }
 }
 x.onclick=showhidelyr;
for(k=0;k<objk.length;k++)
{
 // if(objk[k]=="OBJECTID")
 // {
 //   chld=k;
 // }
 th[k] = document.createElement("th");
 th[k].innerText =objk[k] ;
 row.appendChild(th[k]);

}
thd.appendChild(row);
table.appendChild(thd);

let tbd = document.createElement("tbody");

for(i=0;i<geojson.features.length;i++)
{
 let row = document.createElement("tr");
 let cell=[];
 let objv=Object.values(geojson.features[i].properties)
 // console.log(objv[0])
 for(j=0;j<objk.length;j++)
{
 cell[j] = document.createElement("td");
 cell[j].innerText =objv[j] ;
 row.appendChild(cell[j]);
 // row.className='selected';
}
tbd.appendChild(row);
}
table.appendChild(tbd);
for(t of lyrs.children)
{
 t.style.display="none";
}
lyrs.appendChild(table);

deletedN.push(maxVal(table,0));
eventLst.push(1);
eventLst2.push(1);


let tableHd=table.getElementsByTagName("thead")[0].cloneNode(true);
let valyslc=valy+"Slc";
tableSlc=document.createElement("table");
tableSlc.setAttribute("id", valyslc);
tableSlc.classList.add("table");
tableSlc.classList.add("table-bordered");
let slcSp2=document.getElementById("slcSp2");
tableSlc.appendChild(tableHd);
tbdSlc = document.createElement("tbody");
tableSlc.appendChild(tbdSlc);
slcSp2.appendChild(tableSlc);
let idTbl=lyrs.getElementsByTagName("table").length
idTbl--;
bt.addEventListener("click", function(){createColumn2(table,tableSlc,idTbl)});
bt2.addEventListener("click", function(){createColumn3(table,idTbl)});

table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value)});
tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});
plt2.addEventListener('click', (event) => {
	   let ev=event.target.options[event.target.selectedIndex];
	   let ev2=slctPlt[event.target.selectedIndex];
	   let ev3=outPlt[event.target.selectedIndex];
	   fc=ev.innerText;
	   sc=ev2;
	   out=ev3;
	   plt2.style.backgroundColor=ev.style.backgroundColor; 
	   for(p of pgs)
   {
	p.options.colors=[fc,sc,out];
	 t=p;
	 if(p.options.type=="polyg" || p.options.type=="circle")
	 {
	   p.setStyle({fillColor: ev.innerText,weight:1,color:out});
	   p.off("click");
	   p.options.clicked=0;
	 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
	 }
	 else if(p.options.type=="polylineGis")
	 {
	   p.setStyle({color: ev.innerText,weight:1});
	   p.off("click");
	   p.options.clicked=0;
	 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
	 }
	 else if(p.options.type=="pointGis")
	 {
				 switch(fc)
		 {
		   
		   case 'blue': fc=blueIcon;
					   sc=yellowIcon;
					   out=whiteIcon;
					   break;
		   case 'cyan': fc=cyanIcon;
					   sc=orangeIcon;
					   out=blackIcon;
					   break;
		   case 'green': fc=greenIcon;
					   sc=redIcon;
					   out=blueIcon;
					   break;
		   case 'yellow': fc=yellowIcon;
					   sc=blueIcon;
					   out=whiteIcon;
					   break;
		   case 'orange': fc=orangeIcon;
					   sc=cyanIcon;
					   out=blackIcon;
					   break;
		   case 'red':  fc=redIcon;
					   sc=greenIcon;
					   out=blueIcon;
					   break;
		   case 'black': fc=blackIcon;
					   sc=whiteIcon;
					   out=redIcon;
					   break;

		 }
	   p.setIcon(fc);
	   p.off("click");
	   p.options.clicked=0;
	 p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
	 }
   }
   clearTbl(table,tbdSlc)
	   selectedHighlighted(table,tbdSlc,lab);
	   table.off("click");
table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value)});
tableSlc.off("click");
tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});

x.off("click");
   x.onclick=showhidelyr;

	 }); 
for(u of lyrs.children)
	{
	   u.style.display="none";
	 }
	 for(u of slcSp2.children)
	{
	   u.style.display="none";
	 }
	 for(u of lyrs2.getElementsByTagName("input"))
	{
	   u.checked=false;
	 }
	 cloneX.checked=true;
	 $("#"+valy).show();
	 $("#"+valyslc).show();

 function showhidetbl()
 {
   if(cloneX.checked==false)
   {
	 $("#"+valy).hide();
	 $("#"+valyslc).hide();

	 for(u of lyrs.children)
	{
	   u.style.display="none";
	 }
	 for(u of slcSp2.children)
	{
	   u.style.display="none";
	 }
   }
   else
   {
	 for(u of lyrs.children)
	{
	   u.style.display="none";
	 }
	 for(u of slcSp2.children)
	{
	   u.style.display="none";
	 }
	 for(u of lyrs2.getElementsByTagName("input"))
	{
	   u.checked=false;
	 }
	 cloneX.checked=true;
	 $("#"+valy).show();
	 $("#"+valyslc).show();

   }
 }
 cloneX.onclick=showhidetbl;

 
 for(i=0;i<pgs.length;i++)
{

pgs[i].addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
}



 });
}
reader.readAsText(file);
 }
 else if (((this.value).split("\\").pop()).split(".").pop()== 'zip') {
 
 let pgs=[];
 sys=wgs
let table,tableSlc,tbdSlc,lab,fc,sc,out,t,slider;

 reader.onload = ({ target: { result } }) => {
let featureGroup = L.featureGroup();

nbly++;
let valy=((this.value).split("\\").pop()).split(".").shift();
let x = document.createElement("INPUT");
x.setAttribute("type", "checkbox");
x.checked=true;

let y = document.createElement("label");
let bt = document.createElement("button");
 bt.textContent = 'Add field';
 bt.classList.add("btn")
bt.classList.add("btn-success")

let bt2 = document.createElement("button");
 bt2.textContent = 'Heatmap';
 bt2.classList.add("btn")
bt2.classList.add("btn-primary")
// console.log(aa.name)
y.innerText=valy;
let cloneX=x.cloneNode(true);
let cloneY=y.cloneNode(true);


slider = document.createElement('input');
slider.id = "sl"+nbly;
slider.type = 'range';
slider.min = 0;
slider.max = 1;
slider.value = 1;
slider.step = 0.1;
slider.style.width=120;
slider.style.position = "relative"; 

var br = document.createElement('br');

let lyrs3=document.getElementById("dragList");
let lyrs2=document.getElementById("TableList");
let slcSp1=document.getElementById("slcSp");

let dv=document.createElement("div");
x.style.cssFloat = "left";
 dv.appendChild(x);
 dv.appendChild(y);
 dv.appendChild(br);
 dv.appendChild(slider);
 dv.style.display="inline-block";
 let plt=document.createElement("span");
 plt.innerHTML=palette;
 plt.style.cssFloat = "right"; 
 dv.appendChild(plt);
 
 let li=document.createElement("li");
 li.appendChild(dv);
 lyrs3.insertBefore(li, lyrs3.firstChild);
 let plt2=document.getElementById("palette1");
 let valz=valy+"Plt";
 plt2.setAttribute("id", valz);
 let a=lyrs3.getElementsByTagName("select")
console.log("dÃ©but")
console.log(a)
if(a.length==1)
{
fc="blue";
sc="yellow";
out="white"
console.log(fc)
}
else
{
console.log("else")
let clrs=[];
for(t of lyrs3.getElementsByTagName("select"))
{
console.log(t)
console.log(t.options[t.selectedIndex].innerText)
clrs.push(t.options[t.selectedIndex].text);
}
let difference = colorsPlt.filter(x => !clrs.includes(x));
if(difference.length==0)
{
alert("vous avez dÃ©passÃ© 7 layers")

}
else
{
plt2.value=difference[0];
console.log(difference[0])
fc=plt2.value;
let inda=colorsPlt.indexOf(fc);
sc=slctPlt[inda];
out=outPlt[inda];

}
}
let b=lyrs3.getElementsByTagName("select");
b[0].style.backgroundColor=fc;
b[0].style.color="white"

// for(u of b[0].options)
// {
// 	u.style.color="white";
// }

// let strg="http://localhost:8080/PHP/scan"+"/"+valy;
let strg="shapefiles"+"/"+valy;

strg+='.zip';
loadshp({
   url: strg,
   encoding: 'big5',
   // EPSG: 26192
}, function(geojson){
 let objk=Object.keys(geojson.features[0].properties);
 let objv=Object.values(geojson.features[0].properties);
 console.log(objk);
 let pgs=[];
 let polyg;
 let bw=1;
 // console.log(geojson)
 let parc=0;
 for(k of geojson.features)
 {
   console.log(k)
 let objk2=Object.keys(k.properties);

  let objv2=Object.values(k.properties);
  let options={};
  options.attributes={};

   for (let j = 0; j < objv2.length; j++) 
   {
	 let s=objk2[j];
	 options.attributes[s]=objv2[j];
   }
   

   options.clicked=0;    
   if(k.geometry.type=="Polygon")
   {
	 let wgsR1;
			 let coords2=[];
		   let u=0;
		   for (let j = 0; j < k.geometry.coordinates[0].length; j++) {
			 wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.coordinates[0][j][0]),parseFloat(k.geometry.coordinates[0][j][1])]);
			 coords2[u]=[wgsR1[1], wgsR1[0]];
		   u++;
		   }
		   options.table=nbly;
		   options.layer=nbly;

		 options.type="polyg";
		 options.colors=[fc,sc,out];
		 options.zindex=parc;
		  polyg=L.polygon(coords2,options);
		  
		 polyg.setStyle({fillColor: fc,fillOpacity: 1,color: out,weight:1});

   }
   else if(k.geometry.type=="Polyline")
   {
	 let wgsR1;
			 let coords2=[];
		   let u=0;
		   for (let j = 0; j < k.geometry.coordinates[0].length; j++) {
			 wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.coordinates[0][j][0]),parseFloat(k.geometry.coordinates[0][j][1])]);
			 coords2[u]=[wgsR1[1], wgsR1[0]];
		   u++;
		   }
		 options.type="polylineGis";
		 polyg=L.polyline(coords2,options);
		 polyg.setStyle({color: fc,weight:1});

   }
  else
  {
   bw=0;
   switch(fc)
{

case 'blue': fc=blueIcon;
			sc=yellowIcon;
			out=whiteIcon;
			break;
case 'cyan': fc=cyanIcon;
			sc=orangeIcon;
			out=blackIcon;
			break;
case 'green': fc=greenIcon;
			sc=redIcon;
			out=blueIcon;
			break;
case 'yellow': fc=yellowIcon;
			sc=blueIcon;
			out=whiteIcon;
			break;
case 'orange': fc=orangeIcon;
			sc=cyanIcon;
			out=blackIcon;
			break;
case 'red':  fc=redIcon;
			sc=greenIcon;
			out=blueIcon;
			break;
case 'black': fc=blackIcon;
			sc=whiteIcon;
			out=redIcon;
			break;

}


let markerLayer = new L.ConditionalMarkers({
   minZoomShow: 8,
   viewportPadding: 0.0
 });
 markerLayer.addTo(map);
options.type="pointGis";
options.icon=fc;

let wgsR1;
wgsR1=proj4(sys,wgs,[parseFloat(k.geometry.coordinates[0]),parseFloat(k.geometry.coordinates[1])]);
let coords2=[wgsR1[1],wgsR1[0]];
polyg=L.marker(coords2, options);
options.icon=fc;

markerLayer.addLayer(polyg);

  }
   

	   // console.log(coords2)
   
		 // polyg.addTo(map);
		 polyg.addTo(featureGroup);

   pgs.push(polyg);
   parc++;
 }

 


 lyrsT.push(pgs);

 // grply.push(pgs)
 if(bw!=0)
{
map.addLayer(featureGroup); 
}
grply.push(featureGroup);


lyrs3.getElementsByTagName("label")[0].innerText+='('+pgs[0].options.type+')';
li.draggable = true;
slider.addEventListener("click", function(){t=this;updateOpacity(pgs,t.value);li.draggable = false;});
slider.addEventListener("mouseout", function(){li.draggable = true;});
 // L.geoJSON(geojson).addTo(map);
 let lyrs=document.getElementById("tableSp");
table = document.createElement("table");
table.classList.add("table");
table.classList.add("table-bordered");
let thd = document.createElement("thead");
let row = document.createElement("tr");
let th=[];
// let chld=0;
	   // document.getElementById('excel_data').innerHTML = table_output;
	   

	  table.setAttribute("id", valy);

	   
	   
  lab=document.createElement("span");
 lab.innerText="(Selected: 0 Highlighted: 0)";
 let divT=document.createElement("div");
divT.style.borderColor = "red";
divT.appendChild(cloneX);
divT.appendChild(cloneY);
divT.appendChild(lab);
divT.appendChild(bt);
divT.appendChild(bt2);

lyrs2.appendChild(divT);

let trgt=document.getElementById("dragList")
 slist(trgt);

for(t of lyrs2.children)
{
 t.checked=false;
}
cloneX.checked=true;

function showhidelyr()
{
 if(x.checked==false)
 {
   for (let l of pgs)
   {
	 if(l.options.type=="polyg" || l.options.type=="circle")
   {
	 l.setStyle({opacity: 0,fillOpacity: 0,weight:0});
   }
   else if(l.options.type=="polylineGis")
   {
	l.setStyle({weight:0});

   }
	 // l.unbindTooltip();
   }
   for(i=0;i<pgs.length;i++)
  {
	 pgs[i].setInteractive(false);
   }
 }
 else
 {
   for(i=0;i<pgs.length;i++)
  {
   if(pgs[i].options.type=="polyg" || pgs[i].options.type=="circle")
   {
	 
	 if(clickedZ.indexOf(pgs[i])==-1)
	 {
	   if(clickedY.indexOf(pgs[i])==-1)
	 {
	   pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:fc,weight:1});
	 }
	 else
	 {
	   pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:sc,weight:3});
	 }
	 }
	 else
	 {
	   pgs[i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor: out,color: sc,weight:3});
	 }
	 
   }
   else if(pgs[i].options.type=="polylineGis")
   {
	pgs[i].setStyle({weight:3});

   }
   
	 pgs[i].setInteractive(true);
   }
 }
}
x.onclick=showhidelyr;
for(k=0;k<objk.length;k++)
{
// if(objk[k]=="OBJECTID")
// {
//   chld=k;
// }
th[k] = document.createElement("th");
th[k].innerText =objk[k] ;
row.appendChild(th[k]);

}
thd.appendChild(row);
table.appendChild(thd);

let tbd = document.createElement("tbody");

for(i=0;i<geojson.features.length;i++)
{
let row = document.createElement("tr");
let cell=[];
let objv=Object.values(geojson.features[i].properties)
// console.log(objv[0])
for(j=0;j<objk.length;j++)
{
cell[j] = document.createElement("td");
cell[j].innerText =objv[j] ;
row.appendChild(cell[j]);
// row.className='selected';
}
tbd.appendChild(row);
}
table.appendChild(tbd);
for(t of lyrs.children)
{
t.style.display="none";
}
lyrs.appendChild(table);

deletedN.push(maxVal(table,0));
eventLst.push(1);
eventLst2.push(1);


let tableHd=table.getElementsByTagName("thead")[0].cloneNode(true);
let valyslc=valy+"Slc";
tableSlc=document.createElement("table");
tableSlc.setAttribute("id", valyslc);
tableSlc.classList.add("table");
tableSlc.classList.add("table-bordered");
let slcSp2=document.getElementById("slcSp2");
tableSlc.appendChild(tableHd);
tbdSlc = document.createElement("tbody");
tableSlc.appendChild(tbdSlc);
slcSp2.appendChild(tableSlc);
let idTbl=lyrs.getElementsByTagName("table").length
idTbl--;
bt.addEventListener("click", function(){createColumn2(table,tableSlc,idTbl)});
bt2.addEventListener("click", function(){createColumn3(table,idTbl)});

table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value)});
tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});
plt2.addEventListener('click', (event) => {
	 let ev=event.target.options[event.target.selectedIndex];
	 let ev2=slctPlt[event.target.selectedIndex];
	 let ev3=outPlt[event.target.selectedIndex];
	 fc=ev.innerText;
	 sc=ev2;
	 out=ev3;
	 plt2.style.backgroundColor=ev.style.backgroundColor; 
	 for(p of pgs)
 {
	p.options.colors=[fc,sc,out];
   t=p;
   if(p.options.type=="polyg" || p.options.type=="circle")
   {
	 p.setStyle({fillColor: ev.innerText,weight:1,color:out});
	 p.off("click");
	 p.options.clicked=0;
   p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
   }
   else if(p.options.type=="polylineGis")
   {
	 p.setStyle({color: ev.innerText,weight:1});
	 p.off("click");
	 p.options.clicked=0;
   p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
   }
   else if(p.options.type=="pointGis")
   {
			   switch(fc)
	   {
		 
		 case 'blue': fc=blueIcon;
					 sc=yellowIcon;
					 out=whiteIcon;
					 break;
		 case 'cyan': fc=cyanIcon;
					 sc=orangeIcon;
					 out=blackIcon;
					 break;
		 case 'green': fc=greenIcon;
					 sc=redIcon;
					 out=blueIcon;
					 break;
		 case 'yellow': fc=yellowIcon;
					 sc=blueIcon;
					 out=whiteIcon;
					 break;
		 case 'orange': fc=orangeIcon;
					 sc=cyanIcon;
					 out=blackIcon;
					 break;
		 case 'red':  fc=redIcon;
					 sc=greenIcon;
					 out=blueIcon;
					 break;
		 case 'black': fc=blackIcon;
					 sc=whiteIcon;
					 out=redIcon;
					 break;

	   }
	 p.setIcon(fc);
	 p.off("click");
	 p.options.clicked=0;
   p.addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
   }
 }
 clearTbl(table,tbdSlc)
	 selectedHighlighted(table,tbdSlc,lab);
	 table.off("click");
table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,slider.value)});
tableSlc.off("click");
tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});

x.off("click");
 x.onclick=showhidelyr;

   }); 
for(u of lyrs.children)
  {
	 u.style.display="none";
   }
   for(u of slcSp2.children)
  {
	 u.style.display="none";
   }
   for(u of lyrs2.getElementsByTagName("input"))
  {
	 u.checked=false;
   }
   cloneX.checked=true;
   $("#"+valy).show();
   $("#"+valyslc).show();

function showhidetbl()
{
 if(cloneX.checked==false)
 {
   $("#"+valy).hide();
   $("#"+valyslc).hide();

   for(u of lyrs.children)
  {
	 u.style.display="none";
   }
   for(u of slcSp2.children)
  {
	 u.style.display="none";
   }
 }
 else
 {
   for(u of lyrs.children)
  {
	 u.style.display="none";
   }
   for(u of slcSp2.children)
  {
	 u.style.display="none";
   }
   for(u of lyrs2.getElementsByTagName("input"))
  {
	 u.checked=false;
   }
   cloneX.checked=true;
   $("#"+valy).show();
   $("#"+valyslc).show();

 }
}
cloneX.onclick=showhidetbl;


for(i=0;i<pgs.length;i++)
{

pgs[i].addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,slider.value);});
}



});
}
reader.readAsText(file);
}
else if(file.type== 'image/jpeg' || file.type== 'image/png' || file.type== 'image/webp')
{
	let name=((this.value).split("\\").pop());
	console.log(name)
	AjtDoc(name);
	// var crtRaster=L.imageOverlay(name,[[31.000000000000057,-6.499999999999943],[30.500000000000057,-6.999999999999943]]);
	// crtRaster.addTo(map);
	swalImg(name,"img");
	function MyConfirm()
	{
		deleteImage(name);
	}
	setTimeout(MyConfirm,1500);
}
else if(file.type== 'video/mp4' || file.type== 'video/mpeg' || file.type== 'video/ogg' || file.type== 'video/webm' || file.type== 'video/3gpp' || file.type== 'video/3gpp2' || file.type== 'video/x-msvideo')
{
	let name=((this.value).split("\\").pop());
	console.log(name)
	AjtDoc(name);
	// var crtRaster=L.imageOverlay(name,[[31.000000000000057,-6.499999999999943],[30.500000000000057,-6.999999999999943]]);
	// crtRaster.addTo(map);
	swalImg(name,"video");
	function MyConfirm()
	{
		deleteImage(name);
	}
	setTimeout(MyConfirm,1500);
}
 else
 {
   console.log(file.value)
   Swal.fire('veuillez choisir un fichier JSON(.json)/Excel(.xls/.xlsx/.ods)/Shapefile(.shp)/Image');
 }

};

function addClickBdslc(bdslc,ly,lbl,sc,out,e2,sld)
{
	let ss=bdslc.rows[0].getElementsByTagName("th")[0].innerText;
	if(editStart==1)
	{
		swal.fire("Stop editing first")
		return;
	}
for(t of ly)
 {
   if (t.editEnabled())
{
 swal.fire("stop editing first");
 return;
}
 }
 drawnItems.eachLayer(function (layer) {
		// drawnItems.removeLayer(layer)
		// layer.addTo(map);
		map.eachLayer(function (pg) {
	
		if((typeof(pg._bounds)!=="undefined") && (pg.options.table==layer.options.table))
		{
			if(pg!=layer && typeof(pg._bounds.max)==="undefined")
			{
				if(layer.options.type!="pointGis")
					{
						if(typeof(layer.options.center)!=="undefined")
						{
							let lyr;
							let center = [layer.options.center.lng, layer.options.center.lat];
							let radius = layer.options.radius;
							let options = {steps: 128, units: 'meters'};
							let circle = turf.circle(center, radius, options);
							if(typeof(pg.options.center)!=="undefined")
										{
											
											let center2 = [pg.options.center.lng, pg.options.center.lat];
										console.log(center)
										let radius2 = pg.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=pg.toGeoJSON();
										}
							if(turf.booleanContains(circle, lyr)==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						else
						{
							let lyr;
							if(typeof(pg.options.center)!=="undefined")
										{
											
											let center2 = [pg.options.center.lng, pg.options.center.lat];
										console.log(center)
										let radius2 = pg.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=pg.toGeoJSON();
										}
							if(turf.booleanContains(layer.toGeoJSON(), lyr)==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						
					}
			}
			

			
		}
			
		});	
	});	


if(e2.target.parentNode!=bdslc.rows[0])
{

 if(mod==0)
{
 if(multp==0)
 {
   for(p of ly)
   {
	 let strg="";
   for(let i=0;i<Object.keys(p.options.attributes).length;i++)
   {
	 strg+=Object.keys(p.options.attributes)[i];
	 strg+=':';
	 strg+=Object.values(p.options.attributes)[i];
	 strg+='\n';
	 
   }
   
		 for(r of bdslc.rows)
	   {
		 if(p.options.attributes[ss]==r.children[0].innerText)
		 {
		   if(p.options.type=="polyg" || p.options.type=="circle")
		   {
			 p.setStyle({fillColor: sc,color: out,weight:3}); 
		   }
		   else if(p.options.type=="polylineGis")
		   {
			 p.setStyle({color: sc,weight:3}); 
		   }
		   else if(p.options.type=="pointGis")
		   {
			 p.setIcon(sc);
		   }
		   p.bindPopup(strg).openPopup();
		   break;
		 }
	   }
   }
   if(e2.target.parentNode.className == 'selected2')
   {
	
	for(t of bdslc.rows)
   {
	 if(t!=bdslc.rows[0])
	 {
	   t.className ="selected";
	 }   
   }
   
   }
   else
   {
	 e2.target.parentNode.className = 'selected2';
	 for(t of bdslc.rows)
   {
	 if(t!=e2.target.parentNode && t!=bdslc.rows[0])
	 {
	   t.className ="selected";

	 }
   }
   }
 }
 else
 {
   if(e2.target.parentNode.className == 'selected2')
 {
   e2.target.parentNode.className = 'selected'
   console.log("selected1")
 }
 else
 {
  
   e2.target.parentNode.className = 'selected2';
   console.log("selected2")

 }
 }
 
 for(i=0;i<ly.length;i++)
{
 let strg="";
   for(let j=0;j<Object.keys(ly[i].options.attributes).length;j++)
   {
	 strg+=Object.keys(ly[i].options.attributes)[j];
	 strg+=':';
	 strg+=Object.values(ly[i].options.attributes)[j];
	 strg+='\n';
	 
   }
 if(ly[i].options.attributes[ss]==e2.target.parentNode.children[0].innerText)
 {
   
	 if(e2.target.parentNode.className != 'selected2')
 {
//    clickedDrawn=[];
   if(ly[i].options.type=="polyg" || ly[i].options.type=="circle")
   {
	 ly[i].setStyle({fillColor: sc,color: out,weight:1});
	 let mz=map.getBoundsZoom(ly[i].getBounds());
   map.setZoom(mz-2);
   }
   else if(ly[i].options.type=="polylineGis")
   {
	 ly[i].setStyle({color: sc,weight:1});
	 let mz=map.getBoundsZoom(ly[i].getBounds());
   map.setZoom(mz-2);
   }
   else if(ly[i].options.type=="pointGis")
   {
	 ly[i].setIcon(sc);
   map.setZoom(10);
   }
   
   let inda=clickedZ.indexOf(ly[i]);
	 delete clickedZ[inda];
 }
 else
 {
   if(ly[i].options.type=="polyg" || ly[i].options.type=="circle")
   {
	 ly[i].setStyle({fillColor: out,color: sc,weight:3});
	 map.fitBounds(ly[i].getBounds());
   }
   else if(ly[i].options.type=="polylineGis")
   {
	 ly[i].setStyle({color: out,weight:3});
	 map.fitBounds(ly[i].getBounds());
   }
   else if(ly[i].options.type=="pointGis")
   {
	 ly[i].setIcon(out);
   }
   ly[i].bindPopup(strg).openPopup();
//    clickedDrawn=[ly[i],sld,out,fc];
//    drawnItems.addLayer(ly[i]);
			 
			 clickedZ.push(ly[i]);
 }

   
  setZindexItem2(ly[i])
  
   
   
 }
 
}
}
selectedHighlighted(bdslc,bdslc,lbl);
}
}

function slist(target) {
	
// (A) SET CSS + GET ALL LIST ITEMS
target.classList.add("slist");
let items = target.getElementsByTagName("li"), current = null;

// (B) MAKE ITEMS DRAGGABLE + SORTABLE
for (let i of items) {
 // (B1) ATTACH DRAGGABLE
 // i.draggable = true;

 // (B2) DRAG START - YELLOW HIGHLIGHT DROPZONES
 i.ondragstart = e => {
   current = i;
   for (let it of items) {
	 if (it != current) { it.classList.add("hint"); }
   }
 };
 
 // (B3) DRAG ENTER - RED HIGHLIGHT DROPZONE
 i.ondragenter = e => {
   if (i != current) { i.classList.add("active"); }
 };

 // (B4) DRAG LEAVE - REMOVE RED HIGHLIGHT
 i.ondragleave = () => i.classList.remove("active");i.draggable = false;

 // (B5) DRAG END - REMOVE ALL HIGHLIGHTS
 i.ondragend = () => { for (let it of items) {
	 it.classList.remove("hint");
	 it.classList.remove("active");
	 
 }
 i.draggable = false;
};

 // (B6) DRAG OVER - PREVENT THE DEFAULT "DROP", SO WE CAN DO OUR OWN
 i.ondragover = e => e.preventDefault();

 // (B7) ON DROP - DO SOMETHING
 i.ondrop = e => {
   e.preventDefault();
   if (i != current) {
	 let currentpos = 0, droppedpos = 0;
	 for (let it=0; it<items.length; it++) {
	   if (current == items[it]) { currentpos = it; }
	   if (i == items[it]) { droppedpos = it; }
	 }
	 if (currentpos < droppedpos) {
	   i.parentNode.insertBefore(current, i.nextSibling);
	 } else {
	   i.parentNode.insertBefore(current, i);
	 }
   }
   setZindexItem();

 };
}
}


L.Path.prototype.setZIndex = function (index)
{
 var obj = $(this._container || this._path);
 if (!obj.length) return; // not supported on canvas
 var parent = obj.parent();
 obj.data('order', index).detach();

 var lower = parent.children().filter(function ()
 {
		 var order = $(this).data('order');
		 if (order == undefined) return false;
		 return order <= index;
 });

 if (lower.length)
 {
		 lower.last().after(obj);
 }
 else
 {
		 parent.prepend(obj);
 }
};


function setZindexItem()
{
let drg=document.getElementById("dragList");
let lyrs2=document.getElementById("TableList");
let lyrsT2=[];
console.log(drg.getElementsByTagName("li"))
console.log(lyrs2.getElementsByTagName("label"))
if(lyrsT.length!=0)
{

for(t of drg.getElementsByTagName("li"))
{
for(let l=0 ;l<lyrs2.getElementsByTagName("label").length;l++)
{
	
 if(String((t.getElementsByTagName("label")[0].innerText).split("(", 1))==lyrs2.getElementsByTagName("label")[l].innerText)
 {
  lyrsT2.push(lyrsT[l]);
  break;
 }
 
}

}




for(let i=0 ;i<lyrsT2.length;i++)
{
	if(typeof(lyrsT2[i][0])!=="undefined")
	{
		if(lyrsT2[i][0].options.type!="pointGis")
	{
		for(let n=0 ;n<lyrsT2[i].length;n++)
		   {
					// if(drawnPl.indexOf(layer)>drawnPl.indexOf(d))
					// 	{
					// 		layer.bringToFront();
					// 	}
						// if(typeof(n.options.zindex)!=="undefined")
						// {
						// 	n.bringToFront();
						// }
						// else
						console.log(lyrsT2[i][lyrsT2[i].length-n-1])
							if(lyrsT2[i][lyrsT2[i].length-n-1].Temp!="yes")
							{
								lyrsT2[i][lyrsT2[i].length-n-1].bringToBack();
							}
						
					
		   }
		   
		
	}
	}
	

}



lyrsT2=[];
for(t of drg.getElementsByTagName("li"))
{
for(let l=0 ;l<lyrs2.getElementsByTagName("label").length;l++)
{
	
 if(String((t.getElementsByTagName("label")[0].innerText).split("(", 1))==lyrs2.getElementsByTagName("label")[l].innerText)
 {
  lyrsT2.push(lyrsT[l]);
  break;
 }
 
}

}
for(let i=0 ;i<lyrsT2.length;i++)
{
		for(let n of lyrsT2[i])
		   {		
						n.options.layer=lyrsT2.length-i-1;
		   }
	

}
}
	 
}

function setZindexItem2(d)
{
	map.eachLayer(function (layer) {
		if(typeof(layer._bounds)!=="undefined" || typeof(layer.options.center)!=="undefined")
		{
			if(layer.options.table!=='undefined' && layer!=d && layer.options.table==d.options.table)
				{
					if(typeof(layer.options.center)!=="undefined")
					{

						if(layer!=d)
						{	

							if(d.options.type!="pointGis")
								{	
									if(typeof(d.options.center)!=="undefined")
									{	

										let lyr;
										let center = [d.options.center.lng, d.options.center.lat];
										console.log(center)
										let radius = d.options.radius;
										console.log(radius)

										let options = {steps: 128, units: 'meters'};
										let circle = turf.circle(center, radius, options);
										if(typeof(layer.options.center)!=="undefined")
										{
											let center2 = [layer.options.center.lng, layer.options.center.lat];
										console.log(center)
										let radius2 = layer.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=layer.toGeoJSON();
										}
										if(turf.booleanContains(circle,lyr)==true)
										{
											layer.bringToFront();
										}
									}
									else
									{

										if(typeof(layer._url)!=="undefined")
										{
											layer.bringToFront();
										}
										else
										{
											let lyr;
											if(typeof(layer.options.center)!=="undefined")
										{
											console.log(layer.options.table)
											let center2 = [layer.options.center.lng, layer.options.center.lat];
										let radius2 = layer.options.radius;

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=layer.toGeoJSON();
										}
											if(turf.booleanContains(d.toGeoJSON(), lyr)==true)
										{
											layer.bringToFront();
										}
										if(drawnPl.indexOf(layer)>drawnPl.indexOf(d))
										{
											layer.bringToFront();
										}
										}
										
									}
									if(typeof(layer.options.zindex)!=="undefined" && layer.options.table==d.options.table)
									{
										// console.log(layer.options.center)
										layer.bringToFront();
									}
									
								}


						}
					}
					else
					{

						if(layer!=d && typeof(layer._bounds.max)==="undefined")
						{	
							
							if(d.options.type!="pointGis")
								{	
									if(typeof(d.options.center)!=="undefined")
									{	
										let lyr;
										let center = [d.options.center.lng, d.options.center.lat];
										console.log(center)
										let radius = d.options.radius;
										console.log(radius)

										let options = {steps: 128, units: 'meters'};
										let circle = turf.circle(center, radius, options);
										if(typeof(layer.options.center)!=="undefined")
										{
											let center2 = [layer.options.center.lng, layer.options.center.lat];
										console.log(center)
										let radius2 = layer.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=layer.toGeoJSON();
										}
										if(turf.booleanContains(circle,lyr)==true)
										{
											layer.bringToFront();
										}
									}
									else
									{
										if(typeof(layer._url)!=="undefined")
										{
											layer.bringToFront();
										}
										else
										{
											let lyr;
											if(typeof(layer.options.center)!=="undefined")
										{
											
											let center2 = [layer.options.center.lng, layer.options.center.lat];
										console.log(center)
										let radius2 = layer.options.radius;
										console.log(radius2)

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr=circle2;
										}
										else
										{
											lyr=layer.toGeoJSON();
										}
											if(turf.booleanContains(d.toGeoJSON(), lyr)==true)
										{
											layer.bringToFront();
										}
										if(drawnPl.indexOf(layer)>drawnPl.indexOf(d))
										{
											layer.bringToFront();
										}
										}
										
									}
									if(typeof(layer.options.zindex)!=="undefined" && layer.options.table==d.options.table)
									{
										layer.bringToFront();
									}
									
								}


						}
					}
					
				}
				else if(layer==d && layer.options.table==d.options.table)
				{

					layer.bringToFront();
				}
			
	
		}
		
		
		});

		map.eachLayer(function (layer) {
					if(typeof(layer._bounds)!=="undefined" || typeof(layer.options.center)!=="undefined")
			{

				if(typeof(layer.options.table)!=='undefined' && layer.options.table!=d.options.table)
			{

				if(parseInt(layer.options.layer)>parseInt(d.options.layer))
					{
							layer.bringToFront();
							
					}			
					
			
			}
			}
			
		});
		// setZindexItem();

	
}



function clearTbl(tbl,tbdsc)
{
for(t of tbl.rows)
{
t.className="";
}

while(tbdsc.hasChildNodes())
 {
   tbdsc.removeChild(tbdsc.firstChild);
 }
 clickedY=[];
 clickedZ=[];
}
function fnselect()
 {
   let bd1=[];
   let element1=[];
   let parc=0;
	 let slc=document.getElementById("slcSp2");
	 for(t of slc.getElementsByTagName("tbody"))
	 {
		bd1[parc]=t; 
		element1[parc] = bd1[parc].querySelectorAll('.selected2');
		parc++;
	 }
	 let sum=0;
	   for(s of element1)
	   {
		 sum+=s.length;
	   }
	 if(sum==0)
	 {
	   swal.fire("veuillez selectionner une ligne");
	   mod=0;
	   return;
	 }
	 else
	 {
	   mod=1;

	 }

	 for(e of element1)
	 {
	   for(i=0;i<e.length;i++)
	   {
		 for(j=0;j<e[0].getElementsByTagName("td").length;j++)
	   {
		 e[i].getElementsByTagName("td")[j].contentEditable="true";
	   }
	   }

	 }
	
   
 }


function upd()
{
mod=0;
   var data1=[];
   var data1T=[];

   let bd1=[];
   let bd2=[];
   let element1=[];
   let element2=[];
   let temp=[];

   let parc=0;
 
	 let slc=document.getElementById("slcSp2");
	

	 for(t of slc.getElementsByTagName("tbody"))
	 {
		bd1[parc]=t; 
		element1[parc] = bd1[parc].querySelectorAll('.selected2');
		parc++;
	 }
	 parc=0;
	 let slc1=document.getElementById("tableSp");
	 for(t of slc1.getElementsByTagName("tbody"))
	 {
		bd2[parc]=t; 
	   //  et[parc]=bd2[parc].rows;
		element2[parc] = bd2[parc].querySelectorAll('.selected');
		parc++;
	 }
	 parc=0;
	 for(e of element1)
	 {
	   for(i=0;i<e.length;i++)
	   {
		 let p=e[i].getElementsByTagName("td");
		 let dn=[];
		 for(j=0;j<p.length;j++)
		   {
			 dn.push(p[j].innerText);
		   }
		   data1.push(dn);
	   }
	   data1T[parc]=data1;
	   parc++;
	 }
	 parc=0;
	 console.log(data1T)
	 let edited=[];
	 let editedT=[];
	 console.log(element2)
	 for(let t=0;t<element2.length;t++)
			 {
			   editedT[t]=[-1,-1];
			   for(e of element2[t])
			   {
				 for(g of element1[t])
				 {
		 
				   if(e.cells[0].innerText==g.cells[0].innerText && editedT[t].indexOf(e.cells[0].innerText)==-1)
				   {
					 edited.push(e.cells[0].innerText);
					 editedT[t].push(e.cells[0].innerText)
					 console.log(editedT[t]);
					 for(let i=0;i<e.cells.length;i++)
					 {
					   for(let u=0;u<lyrsT[t].length;u++)
						   {
							let jj=lyrsT[t][u].options.table;
							let jj2=document.getElementsByTagName("table")[jj]
							let ss=jj2.rows[0].getElementsByTagName("th")[0].innerText;

							 if(lyrsT[t][u].options.attributes[ss]==e.cells[0].innerText)
							 {
							   let st=Object.keys(lyrsT[t][u].options.attributes)[i];
							   for(let l of lyrsT[t][0].options.fields)
							   {
								if(l.name==st)
								{
									switch(l.type)
									{
										case "esriFieldTypeString": 
										case "esriFieldTypeDate": lyrsT[t][u].options.attributes[st]=g.cells[i].innerText;
																    break;
										case "esriFieldTypeShortInteger":
										case "esriFieldTypeSmallInteger": 
										case "esriFieldTypeInteger":
										case "esriFieldTypeOID":lyrsT[t][u].options.attributes[st]=parseInt(g.cells[i].innerText);
																	 break;
										case "esriFieldTypeDouble": lyrsT[t][u].options.attributes[st]=parseFloat(g.cells[i].innerText);
																    break;
										default: lyrsT[t][u].options.attributes[st]=g.cells[i].innerText;
										
									}
								}
							   }
								 
							   
							 }
						   }
						 e.cells[i].innerText=g.cells[i].innerText;
						 
					 }
					   break;
				   }
				   
				 }
				 
			   }
			   console.log(editedT)
			 }
	 

	 for(e of element1)
	 {
		  for(i=0;i<e.length;i++)
			 {
			   for(j=0;j<e[0].getElementsByTagName("td").length;j++)
			 {
			   e[i].getElementsByTagName("td")[j].contentEditable="false";
			 }
			 }
	}
	swal.fire("terminÃ©")
}


function upd2()
 {
   mod=0;

   let bd1=[];
   let bd2=[];
   let element1=[];
   let element2=[];
   let temp=[];

   let parc=0;
	 let slc=document.getElementById("slcSp2");
	 for(t of slc.getElementsByTagName("tbody"))
	 {
		bd1[parc]=t; 
		element1[parc] = bd1[parc].querySelectorAll('.selected2');
		parc++;
	 }
	 parc=0;
	 let slc1=document.getElementById("tableSp");
	 for(t of slc1.getElementsByTagName("tbody"))
	 {
		bd2[parc]=t; 
		et[parc]=bd2[parc].rows;
		element2[parc] = bd2[parc].querySelectorAll('.selected');
		parc++;
	 }
	parc=0;
	 for(e of element2)
	 {
	   for(i=0;i<e.length;i++)
	   {
		 temp[parc].push(parseInt(e[i].cells[0].innerText));
	   }
	   parc++;
	 }
	 var data1=[];
	 for(e of element1)
	 {
	   for(i=0;i<e.length;i++)
	   {
		 let p=e[i].getElementsByTagName("td");
		 let dn=[];
		 for(j=0;j<p.length;j++)
		   {
			 dn.push(p[j].innerText);
		   }
		   data1.push(dn);
	   }
	 }
	 
	 $.ajax({
	 url: "updateGis.php",  
	 type: "POST",
	   //pass data like this 
	 data: {data1:data1},    
	 cache: false,
	 success: function(response) {
	  $('#tbd').html(response);
	
	  }

		});   

		parc=0;
		for(e of et)
	 {
	   for(i=0;i<e.length;i++)
	   {
		 if(temp[parc].indexOf(parseInt(e[i].getElementsByTagName("td")[0].innerText,10))!=-1)
		   {
			 e[i].className='selected';
			 break;
		   }
	   }
	   parc++;
	 }

   alert('TerminÃ©');

 }

function selectedHighlighted(tb,bdsc,lbl)
{
let n=0;
let m=0;
let x=lbl.innerText.split(" ");
let a=parseInt(x[1]);
// let b=parseInt(x[3]);
for(t of tb.rows)
{
 if(t.className=="selected")
 {
   n++;
 }
}
for(t of bdsc.rows)
{
 if(t.className=="selected2")
 {
   m++;
 }
}
 if(tb==bdsc)
 {
   lbl.innerText="(Selected: "+a+" Highlighted: "+m+")";

 }
 else
 {
   lbl.innerText="(Selected: "+n+" Highlighted: "+m+")";
 }


// if(n==0)
// {
//   lbl.getElementsByTagName("span")[0].style.color="red";
// }
// else
// {
//   lbl.style.backgroundColor=color;
// }
}

// var XMLReq = new XMLHttpRequest();

//   XMLReq.open( "GET", "https://www.tooltester.com/", false )


//   XMLReq.onreadystatechange = function() {
//     if(XMLReq.readyState == 4 && XMLReq.status == 200) {
//       console.log(XMLReq.responseText);
//     }
//   }

//   XMLReq.send();

// fetch('https://www.tooltester.com').then(d => d.text()).then(d => console.log(d))
let layerType=[];
let layerFields=[];
let lyrFlds=[];
let fldsType=[];
let layerName,layerTp;
function swalCreate()
{
(async () => {
						  
	 const { value: formValues } = await Swal.fire({
	  
	   html: swalFeatType +'<br>'+swalFeatName+'<br>'+'<br>'+swalFields+swalButtons+'<br>'+'<h3>Select Coordinates System</h3>'+swalCnt +'<br>'+swalSys,
	   focusConfirm: false,
	   didOpen: () => {
		 let swl=document.getElementById('countrySwal');
		 let swlDel=document.getElementById('delFields');
		 let swlAdd=document.getElementById('addFields');

		 swl.addEventListener("change", chngSwal);
		 swlAdd.addEventListener("click", addField);
		 swlDel.addEventListener("click", delField);

			   },
	   preConfirm: () => {
		 let flds=document.getElementById('fields');
		 flds=flds.getElementsByTagName("input");
		 lyrFlds=[];
		 for(t of flds)
		 {
		   lyrFlds.push(t.value);
		 }
		 flds=document.getElementById('fields');
		 let fldsTp=flds.getElementsByTagName("select");
		 fldsType=[];
		 fldsType[0]='esriFieldTypeOID';
		 for(t of fldsTp)
		 {
			
			fldsType.push(t.options[t.selectedIndex].value);
		 }
		 layerName=document.getElementById('LayerName').value;
		 layerTp=document.getElementById('swalCreateLayer').value;
		 layerType.push([layerName,document.getElementById('swalCreateLayer').value]);
		 layerFields.push([layerName,lyrFlds]);
		 let i=cnt.indexOf(document.getElementById('countrySwal').value);
		 let j=coordSys.indexOf(document.getElementById('sysSwal').value);
		 sys=sysTab[j];
	   }
	 })

	 })().then(function(){
	//    let pgs=[];
		   nbly++;
		   let table,tableSlc,tbdSlc,lab,fc,sc,out,t,slider;
		   let x = document.createElement("INPUT");
			 x.setAttribute("type", "checkbox");
			 x.checked=true;

			 let y = document.createElement("label");
			 // console.log(aa.name)
			 y.innerText=layerName;
			 let cloneX=x.cloneNode(true);
			 let cloneY=y.cloneNode(true);
			 

			 slider = document.createElement('input');
			 slider.id = "sl"+nbly;
			 slider.type = 'range';
			 slider.min = 0;
			 slider.max = 1;
			 slider.value = 1;
			 slider.step = 0.1;
			 slider.style.width=120;
			 slider.style.position = "relative"; 
			 
			 var br = document.createElement('br');

			 let lyrs3=document.getElementById("dragList");
			 let lyrs2=document.getElementById("TableList");
			 let slcSp1=document.getElementById("slcSp");

			 let dv=document.createElement("div");
			 x.style.cssFloat = "left";
			   dv.appendChild(x);
			   dv.appendChild(y);
			   dv.appendChild(br);
			   dv.appendChild(slider);
			   dv.style.display="inline-block";
			   let plt=document.createElement("span");
			   plt.innerHTML=palette;
			   plt.style.cssFloat = "right"; 
			   dv.appendChild(plt);
			   
			   let li=document.createElement("li");
			   li.appendChild(dv);
			   lyrs3.insertBefore(li, lyrs3.firstChild);
			   let plt2=document.getElementById("palette1");
			   let valz=layerName+"Plt";
			   plt2.setAttribute("id", valz);
			   let a=lyrs3.getElementsByTagName("select")
		   console.log("dÃ©but")
		   console.log(a)
		   let tempFeat={};
			 tempFeat.Temp="yes";
			 tempFeat.options={};
			//  tempFeat.options.type='polyg';
			 let clrs=[];
		   for(t of lyrs3.getElementsByTagName("select"))
		   {
			 clrs.push(t.options[t.selectedIndex].text);
		   }
		   let difference = colorsPlt.filter(x => !clrs.includes(x));
		   if(a.length==1)
		   {
			plt2.value=difference[0];
			 fc=plt2.value;
			 
			if(layerTp!="pointGis")
			{
				fc="blue";
			 sc="yellow";
			 out="white";
			}
			else
			{
				switch(fc)
					   {
						 
						 case 'blue': fc=blueIcon;
									 sc=yellowIcon;
									 out=whiteIcon;
									 break;
						 case 'cyan': fc=cyanIcon;
									 sc=orangeIcon;
									 out=blackIcon;
									 break;
						 case 'green': fc=greenIcon;
									 sc=redIcon;
									 out=blueIcon;
									 break;
						 case 'yellow': fc=yellowIcon;
									 sc=blueIcon;
									 out=whiteIcon;
									 break;
						 case 'orange': fc=orangeIcon;
									 sc=cyanIcon;
									 out=blackIcon;
									 break;
						 case 'red':  fc=redIcon;
									 sc=greenIcon;
									 out=blueIcon;
									 break;
						 case 'black': fc=blackIcon;
									 sc=whiteIcon;
									 out=redIcon;
									 break;

					   }

			}
			
		   }
		   else
		   {
			 console.log("else")
			 
		   if(difference.length==0)
		   {
			 alert("vous avez dÃ©passÃ© 7 layers");
		   }
		   else
		   {
			plt2.value=difference[0];
			 fc=plt2.value;
			 
			//  tempFeat.options.table=0;
			if(layerTp!="pointGis")
			{
			 let inda=colorsPlt.indexOf(fc);
			 sc=slctPlt[inda];
			 out=outPlt[inda];
			}
			else
			{
				switch(fc)
					   {
						 
						 case 'blue': fc=blueIcon;
									 sc=yellowIcon;
									 out=whiteIcon;
									 break;
						 case 'cyan': fc=cyanIcon;
									 sc=orangeIcon;
									 out=blackIcon;
									 break;
						 case 'green': fc=greenIcon;
									 sc=redIcon;
									 out=blueIcon;
									 break;
						 case 'yellow': fc=yellowIcon;
									 sc=blueIcon;
									 out=whiteIcon;
									 break;
						 case 'orange': fc=orangeIcon;
									 sc=cyanIcon;
									 out=blackIcon;
									 break;
						 case 'red':  fc=redIcon;
									 sc=greenIcon;
									 out=blueIcon;
									 break;
						 case 'black': fc=blackIcon;
									 sc=whiteIcon;
									 out=redIcon;
									 break;

					   }

			}
			
		   }
		   }
		   tempFeat.options.colors=[fc,sc,out];
		   let fa={};
		   for(let u of lyrFlds)
		   {
			fa[u]=u;
		   }
		   tempFeat.options.fieldAliases=fa;
		   let fd=[];
		   let objFd={name:"",type:"",alias:""};
		   parc=0;
		   for(let u of fldsType)
		   {
			objFd={};
			objFd.name=lyrFlds[parc];
			objFd.alias=lyrFlds[parc];
			objFd.type=u;
			fd.push(objFd);
			parc++;
		   }
		   console.log(fd)
		   tempFeat.options.fields=fd;
		   tempFeat.options.fillOpacity=1;
		   tempFeat.options.layer=lyrsT.length
			 let tempLyr=[];
			 tempLyr.push(tempFeat)
			 lyrsT.push(tempLyr)
			 
			 deletedN[lyrsT.length-1]=1;
		   	eventLst.push(0)
			eventLst2.push(0);

		   let b=lyrs3.getElementsByTagName("select");
		   b[0].style.backgroundColor=fc;
		   b[0].style.color="white"
		//    for(u of b[0].options)
		// 		{
		// 			u.style.color="white";
		// 		}
		   let lyrs=document.getElementById("tableSp");
					 table = document.createElement("table");
					 let valy=layerName;
					 table.setAttribute("id", valy);
					 table.classList.add("table");
				 table.classList.add("table-bordered");
				 let thd = document.createElement("thead");
				 let row = document.createElement("tr");
				 let th=[];
				 // let chld=0;
				 let k=0;
				 for(t of lyrFlds)
				 {
				   th[k] = document.createElement("th");
				   th[k].innerText =t ;
				   row.appendChild(th[k]);
				   k++;

				 }
				 thd.appendChild(row);
				 table.appendChild(thd);
				 let tbd = document.createElement("tbody");
				 table.appendChild(tbd);
				 // let tbd = document.createElement("tbody");

				 // for(i=0;i<prelev.features.length;i++)
				 // {
				 //   let row = document.createElement("tr");
				 //   let cell=[];
				 //   let objv=Object.values(prelev.features[i].attributes)
				 //   for(j=0;j<Object.keys(prelev.fieldAliases).length;j++)
				 // {
				 //   cell[j] = document.createElement("td");
				 //   cell[j].innerText =objv[j] ;
				 //   row.appendChild(cell[j]);
				   
				 // }
				 // tbd.appendChild(row);
				 // }
				 // table.appendChild(tbd);

				 lyrs.appendChild(table);
				 let tableHd=table.getElementsByTagName("thead")[0].cloneNode(true);
				 let valyslc=valy+"Slc";
				 tableSlc=document.createElement("table");
				 let tbd2=document.createElement("tbody");
				 let tbd2Tr=document.createElement("tr");
				 tbd2.appendChild(tbd2Tr);
				 tableSlc.setAttribute("id", valyslc);
				 tableSlc.classList.add("table");
				 tableSlc.classList.add("table-bordered");
				 let slcSp2=document.getElementById("slcSp2");
				 tableSlc.appendChild(tableHd);
				 tableSlc.appendChild(tbd2);
				 // tbdSlc = document.createElement("tbody");
				 // tableSlc.appendChild(tbdSlc);
				 slcSp2.appendChild(tableSlc);
				 pgs=lyrsT[lyrsT.length-1];
				//  table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbd2,pgs,lab,fc,sc,out,e,slider.value)});
				//  tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,slider.value);});
					lyrs3.getElementsByTagName("label")[0].innerText+='('+layerTp+')';
			// 	 li.draggable = true;
			// 	 slider.addEventListener("click", function(){t=this;updateOpacity(pgs,t.value);li.draggable = false;});
			//    slider.addEventListener("mouseout", function(){li.draggable = true;});
				   for(t of lyrs2.children)
				   {
					 t.checked=false;
				   }
				   let bt = document.createElement("button");
					bt.textContent = 'Add field';
					bt.classList.add("btn")
					bt.classList.add("btn-success")

					let bt2 = document.createElement("button");
					bt2.textContent = 'Heatmap';
					bt.classList.add("btn")
					bt2.classList.add("btn-primary")

					let idTbl=lyrs.getElementsByTagName("table").length
					idTbl--;
					bt.addEventListener("click", function(){createColumn2(table,tableSlc,idTbl)});
					bt2.addEventListener("click", function(){createColumn3(table,idTbl)});
				   lab=document.createElement("span");
				   lab.innerText="(Selected: 0 Highlighted: 0)";
				   let divT=document.createElement("div");
					divT.style.borderColor = "red";
				   divT.appendChild(cloneX);
				   divT.appendChild(cloneY);
				   divT.appendChild(lab);
				   divT.appendChild(bt);
				   divT.appendChild(bt2);


				   lyrs2.appendChild(divT);

				   let trgt=document.getElementById("dragList")
					slist(trgt);
				   plt2.addEventListener('click', (event) => {
					 let ev=event.target.options[event.target.selectedIndex];
					 let ev2=slctPlt[event.target.selectedIndex];
					 let ev3=outPlt[event.target.selectedIndex];
					 fc=ev.innerText;
					 sc=ev2;
					 out=ev3;
					 plt2.style.backgroundColor=ev.style.backgroundColor; 
					
				   }); 
			 for(t of lyrs2.children)
			   {
				 t.checked=false;
			   }
			   cloneX.checked=true;
			   for(u of lyrs.children)
				 {
					 u.style.display="none";
				   }
				   for(u of slcSp2.children)
				 {
					 u.style.display="none";
				   }
				   for(u of lyrs2.getElementsByTagName("input"))
				 {
					 u.checked=false;
				   }
				   cloneX.checked=true;
				   $("#"+valy).show();
				   $("#"+valyslc).show();

			   function showhidetbl()
			   {
				 if(cloneX.checked==false)
				 {
				   // console.log($(valy))
				   $("#"+valy).hide();
				   $("#"+valyslc).hide();

				   for(u of lyrs.children)
				 {
					 u.style.display="none";
				   }
				   for(u of slcSp2.children)
				 {
					 u.style.display="none";
				   }
				 }
				 else
				 {
				   for(u of lyrs.children)
				 {
					 u.style.display="none";
				   }
				   for(u of slcSp2.children)
				 {
					 u.style.display="none";
				   }
				   for(u of lyrs2.getElementsByTagName("input"))
				 {
					 u.checked=false;
				   }
				   cloneX.checked=true;
				   $("#"+valy).show();
				   $("#"+valyslc).show();

				 }
			   }
			   cloneX.onclick=showhidetbl;
			   // let tbdSlc = document.createElement("tbody");

			 
			 
			



	 });
}

let drwCrd='<h3>Drawing Method</h3><select id="drwCrd" name="drwCrd" class="form-control text-center"><option value="Draw">Draw On Click</option><option value="CoordBox">Draw by inputting Coordinates</option></select>';
let boxHtml1=swalCnt+'<br>'+swalSys;
let inpCrd1='<div id="topLeft"><input type="text" name="Long"  style="width:114px"><input type="text" name="Lat"  style="width:114px"></div>';
let inpCrd12='<div id="bottomRight"><input type="text" name="Long"  style="width:114px"><input type="text" name="Lat"  style="width:114px"></div>';

inpCrd='<div id="inpCrd">'+inpCrd1+inpCrd1+inpCrd1+'</div>';

let inpCrd2='<div id="inpCrd">'+inpCrd1+inpCrd1+'</div>';

let standInp='<input type="text" name="Long"  style="width:114px"><input type="text" name="Lat"  style="width:114px">';
let standHd='<div><input type="text" name="Long" value="Longitude(X)" disabled style="width:114px;background-color:yellow"><input type="text" name="Lat" value="Latitude(Y)" disabled style="width:114px;background-color:yellow"></div>';
let boxHtml=boxHtml1+'<br>'+'<br>'+standHd+inpCrd+swalButtons;
let boxHtml2=boxHtml1+'<br>'+'<br>'+standHd+inpCrd2+swalButtons;

let drwRect='<h4>Rectangle definition</h4><select id="drwRect" name="drwRect" class="form-control text-center"><option value="Bounds">Bounds</option><option value="CVH">Center & HV lengths</option></select>';
let boxHtml3=boxHtml1+'<br>'+'<br>'+drwRect;
let standHd3='<div><input type="text" name="Long" value="Longitude(X)" disabled style="width:114px;background-color:yellow"><input type="text" name="Lat" value="Latitude(Y)" disabled style="width:114px;background-color:yellow"></div>';
// let boxHtml31=boxHtml3+'<br>'+'<br>'+standHd3;
let topLeftCorner='<label for="">Top left corner</label>'+standHd3+inpCrd1;
let bottomRightCorner='<label for="">Bottom right corner</label>'+standHd3+inpCrd12;
boxHtml31=topLeftCorner+'<br>'+bottomRightCorner;

let centerRect='<label for="">Center coordinates</label>'+standHd3+inpCrd1;
let HRect='<label for="">Horizontal length</label>'+'<input type="text" name="H"  style="width:114px;float:right">';
let VRect='<label for="">Vertical length</label>'+'<input type="text" name="V"  style="width:114px;float:right">';
let boxHtml32=centerRect+'<br>'+'<br>'+HRect+'<br>'+VRect;

let boxHtml33=boxHtml1+'<br>'+'<br>'+boxHtml31;


function chngDrw() {
					   let drw=document.getElementById('drwCrd').value;
					   let bx=document.getElementById('box')
					   let bx2=document.getElementById('rectBox')
						 if(drw=='CoordBox')
						 {
						   bx.innerHTML=boxHtml;
						 let swlDel=document.getElementById('delFields');
						 let swlAdd=document.getElementById('addFields');
						 swlAdd.addEventListener("click", addCoord);
						 swlDel.addEventListener("click", delCoord);
						 let swl2=document.getElementById('countrySwal');
						 swl2.addEventListener("change", chngSwal);
						 }
						 else
						 {
						   bx.innerHTML="";
						   bx2.innerHTML="";
						 }
						 
						 
						 
  
				 }

function chngDrw2() {
					   let drw=document.getElementById('drwCrd').value;
					   let bx=document.getElementById('box')
						 if(drw=='CoordBox')
						 {
						   bx.innerHTML=boxHtml2;
						 let swlDel=document.getElementById('delFields');
						 let swlAdd=document.getElementById('addFields');
						 swlAdd.addEventListener("click", addCoord);
						 swlDel.addEventListener("click", delCoord2);
						 let swl2=document.getElementById('countrySwal');
						 swl2.addEventListener("change", chngSwal);
						 }
						 else
						 {
						   bx.innerHTML="";
						 }
						 
				 }

function chngDrw3() {
					   let drw=document.getElementById('drwCrd').value;
					   let bx=document.getElementById('box')
					   let bx2=document.getElementById('rectBox2')
					   let boundsBox=document.getElementById('rectBox');


						 if(drw=='CoordBox')
						 {
						   bx.innerHTML=boxHtml3;
						   bx2.innerHTML='<br>'+boxHtml31;
						 let swlRect=document.getElementById('drwRect');
						 swlRect.addEventListener("change", chngDrw31);
						 let swl2=document.getElementById('countrySwal');
						 swl2.addEventListener("change", chngSwal);
						 }
						 else
						 {
						   bx.innerHTML="";
						   bx2.innerHTML="";
						   boundsBox.innerHTML="";
						 }

		
						 
				 }

function chngDrw31() {
	let swlRect=document.getElementById('drwRect').value;
	let boundsBox=document.getElementById('rectBox');
	let bx2=document.getElementById('rectBox2')
	bx2.innerHTML="";
				if(swlRect=='Bounds')
				{
					boundsBox.innerHTML=boxHtml31;
				}
				if(swlRect=='CVH')
				{
					boundsBox.innerHTML=boxHtml32;
				}
						 
				 }



function chngDrw33() 
{
	let drw=document.getElementById('drwCrd').value;
	let bx=document.getElementById('box');
		

					   let bx2=document.getElementById('rectBox')
						 if(drw=='CoordBox')
						 {
							bx.innerHTML=boxHtml1;
							let swl2=document.getElementById('countrySwal');
						 swl2.addEventListener("change", chngSwal);
							
							bx2.innerHTML=boxHtml31;
						 
						 }
						 else
						 {
						   bx.innerHTML="";
						   bx2.innerHTML="";
						 }
}


function addCoord() {
   let swlAdd=document.getElementById('inpCrd');
   let field = document.createElement("div");
   field.innerHTML=standInp;
   swlAdd.appendChild(field);
   }

function delCoord() {
   let swlAdd=document.getElementById('inpCrd');
   let swlAddInp=swlAdd.getElementsByTagName('div').length;
	 if(swlAddInp > 3)
	 {
	   swlAdd.removeChild(swlAdd.lastChild);
	 }
   
   }
function delCoord2() {
let swlAdd=document.getElementById('inpCrd');
let swlAddInp=swlAdd.getElementsByTagName('div').length;
	if(swlAddInp > 2)
	{
	swlAdd.removeChild(swlAdd.lastChild);
	}

}
let pl;
let drawnPl=[];
let clickedDrawn=[];
// var drawOrBox;
function Polygon(){

	async function swalAsync() {
						  
						  	await Swal.fire({
							title: 'Add feature',
							html:drwCrd +'<br>'+'<div id="box"></div>' +'<br>'+'<div id="rectBox"></div>'+'<div id="rectBox2"></div>',
							// focusConfirm: false,
							showCancelButton: true,
							confirmButtonText: 'Ok',
							// showDenyButton: true,
							// denyButtonText: 'Cancel',
							// confirmButtonText:'<div id="confirmId">Ok</div>',
							didOpen: () => {
							  let swl=document.getElementById('drwCrd');
							  if(drawStopKey.type=="polygon")
									{
										swl.addEventListener("change", chngDrw);
									}
							 else if(drawStopKey.type=="polyline")
									{
										swl.addEventListener("change", chngDrw2);
									}
							else if(drawStopKey.type=="rectangle")
									{
										swl.addEventListener("change", chngDrw3);
									}
							  
									},
							preConfirm: () => {
							 if(document.getElementById('drwCrd').value=='CoordBox')
							 {
								// document.getElementById('confirmId').dispatchEvent(new KeyboardEvent('keydown', {'key': 'Escape'}));
							 let i=cnt.indexOf(document.getElementById('countrySwal').value);
							 let j=coordSys.indexOf(document.getElementById('sysSwal').value);
							 sys=sysTab[j];
							 }
							 else
							 {
								return;
							 }
							  
							}
						  }).then((result) => {
							if (result.isConfirmed) {
								if (document.getElementById('drwCrd').value=="Draw") {
							return true;
							// pl=map.editTools.startPolygon();
							// pl.options.clicked=0;
							// pl.on('click', function (e) {
							// 	 if(this.options.clicked==0)
							// 	 {
							// 	   clickedDrawn=[];
							// 	   this.setStyle({fillColor: "green",fillOpacity: 1,color: "red",weight:4});
							// 	   map.fitBounds(this.getBounds());
							// 	   this.options.clicked=1;
							// 	 clickedDrawn=[pl,1,"green","red"];
							// 	 }
							// 	 else
							// 	 {
							// 	   this.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
							// 	   let mz=map.getBoundsZoom(this.getBounds());
							// 	   map.setZoom(mz-2);
							// 	   clickedDrawn=[];
							// 	   this.options.clicked=0;

							// 	 }
							// 	   // this.enableEdit();
							//    });
							//  drawnPl.push(pl);
							 
							// Swal.fire(JSON.stringify(formValues))
						  }
						  else
						  {
							console.log(drawStopKey)
							L.Handler.prototype.disable.call(drawStopKey);
							// drawStopKey._map.fire('draw:canceled', { layerType: this.type });
							// drawStopKey.disable();
							// return false;
							let crd=[];
						   let wgsR1;
						   let fc,sc,out;
							if(drawStopKey.type!="rectangle")
							{
								let swlAdd2=document.getElementById('inpCrd');
						   let swlAddInp2=swlAdd2.getElementsByTagName('div');
						   for(let k of swlAddInp2)
						   {
						  
							 wgsR1=proj4(sys,wgs,[parseFloat(k.getElementsByTagName('input')[0].value),parseFloat(k.getElementsByTagName('input')[1].value)]);

							 crd.push([wgsR1[1],wgsR1[0]]);
						   }
						   wgsR1=proj4(sys,wgs,[parseFloat(swlAddInp2[0].getElementsByTagName('input')[0].value),parseFloat(swlAddInp2[0].getElementsByTagName('input')[1].value)]);
							}

						   // console.log(crd);
						   if(drawStopKey.type=="polygon")
						   {
							crd.push([wgsR1[1],wgsR1[0]]);
							pl = L.polygon([crd]);
						   // pl=L.polygon([[29.681473681970694, -7.465619107681778],[29.681554178514055, -7.4604523233621105],[29.683769800971504, -7.463081809851238],[29.681473681970694, -7.465619107681778]]);
						   pl.setStyle({fillColor: 'green',color: 'red',weight:4});
						   pl.options.type='polyg';
						   fc="red";
							sc="green";
							out="white";
						   map.fitBounds(pl.getBounds());
						   }
						   else if(drawStopKey.type=="polyline")
						   {
							pl = L.polyline([crd]);
						   // pl=L.polygon([[29.681473681970694, -7.465619107681778],[29.681554178514055, -7.4604523233621105],[29.683769800971504, -7.463081809851238],[29.681473681970694, -7.465619107681778]]);
						   pl.setStyle({color: 'green',weight:4});
						   pl.options.type='polylineGis';
						   map.fitBounds(pl.getBounds());
						   fc="red";
							sc="green";
							out="white";
						   }
						   else if(drawStopKey.type=="marker")
						   {
							pl=L.marker([wgsR1[1],wgsR1[0]]);
							pl.setIcon(greenIcon);
							pl.options.type='pointGis';
							map.setView(e.latlng, 13);
							fc=redIcon;
							sc=greenIcon;
							out=greenIcon;
						   }
						   else if(drawStopKey.type=="rectangle")
						   {
							let swlRect=document.getElementById('drwRect').value;
									let boundsBox=document.getElementById('rectBox');
									// let bx2=document.getElementById('rectBox2')
									// bx2.innerHTML="";
												if(swlRect=='Bounds')
												{
													let swlAdd3=document.getElementById('topLeft');
													let swlAdd4=document.getElementById('bottomRight');
													wgsR1=proj4(sys,wgs,[parseFloat(swlAdd3.getElementsByTagName('input')[0].value),parseFloat(swlAdd3.getElementsByTagName('input')[1].value)]);
													let wgsR2=proj4(sys,wgs,[parseFloat(swlAdd4.getElementsByTagName('input')[0].value),parseFloat(swlAdd4.getElementsByTagName('input')[1].value)]);

													crd.push([wgsR1[1],wgsR1[0]]);
													crd.push([wgsR1[1],wgsR2[0]]);
													crd.push([wgsR2[1],wgsR2[0]]);
													crd.push([wgsR2[1],wgsR1[0]]);

													pl = L.polygon([crd]);
												// pl=L.polygon([[29.681473681970694, -7.465619107681778],[29.681554178514055, -7.4604523233621105],[29.683769800971504, -7.463081809851238],[29.681473681970694, -7.465619107681778]]);
												pl.setStyle({fillColor: 'green',color: 'red',weight:4});
												pl.options.type='polyg';
												fc="red";
												sc="green";
												out="white";
												map.fitBounds(pl.getBounds());

												}
												if(swlRect=='CVH')
												{
													boundsBox.innerHTML=boxHtml32;
												}
						   }
						//    console.log(pl.getLatLngs());
							pl.options.colors=[fc,sc,out]
						   pl.addTo(map);

						   pl.options.clicked=0;
						   pl.options.table=100;
						   pl.options.layer=100;

							pl.options.attributes={};
							pl.on('click', function (e) {
								if(editStart==1)
							{
								swal.fire("Stop editing first")
								return;
							}
							if(deleteStopKey==0)
								{
									swal.fire("Finish removing first")
									return;
								}
								drawnItems.eachLayer(function (layer) {
									if(multp==0)
									{
									drawnItems.removeLayer(layer)
									layer.addTo(map);
									setZindexItem2(layer)
									}
									map.eachLayer(function (pg) {
								
									if((typeof(pg._bounds)!=="undefined") && (pg.options.table==layer.options.table))
									{
										if(pg!=layer && typeof(pg._bounds.max)==="undefined")
											{	
												if(layer.options.type!="pointGis")
					{
						if(layer.options.type=="circle")
						{
							let center = [layer.options.center.lng, layer.options.center.lat];
							let radius = layer.options.radius;
							let options = {steps: 128, units: 'meters'};
							let circle = turf.circle(center, radius, options);
							if(turf.booleanContains(circle, pg.toGeoJSON())==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						else
						{
							if(turf.booleanContains(layer.toGeoJSON(), pg.toGeoJSON())==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						
					}

														
									}
									}
										
									});	
								});	
								// drawnItems.eachLayer(function (layer) {
								// drawnItems.removeLayer(layer)
								// 		layer.addTo(map);	
								// 		console.log("table op")
								// 		console.log(layer.options.table)
								// 				});

								if(multp==0)
								{
									for(t of drawnPl)
							{
								if(t!=this)
								{
									t.options.clicked=0;
									if(t.options.type=="polyg" ||  t.options.type=="circle")
										{
											t.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
										}
									else if(t.options.type=="polylineGis")
										{
											t.setStyle({color: "red",weight:3});
										}
								   else if(t.options.type=="pointGis")
								   {
									t.setIcon(redIcon);
								   }
								}
								
							}
								}
							
								drawnItems.removeLayer(this)
										this.addTo(map);

									// drawnItems.eachLayer(function (layer) {
									// 	drawnItems.removeLayer(layer)
									// 	layer.addTo(map);
									// });	
									if(this.options.clicked==0)
								 {
								
									drawnItems.addLayer(this)
									if(multp==0)
									{
										clickedDrawn=[];
									}
								   if(this.options.type=="polyg" || this.options.type=="circle")
										{
									this.setStyle({fillColor: "green",fillOpacity: 1,color: "red",weight:4});
									map.fitBounds(this.getBounds());

										}
								   else if(this.options.type=="polylineGis")
										{
									this.setStyle({color: "green",weight:4});
									map.fitBounds(this.getBounds());

										}
								   else if(this.options.type=="pointGis")
										{
									this.setIcon(greenIcon);
									map.setView(e.latlng, 13);
										}
								   this.options.clicked=1;
								 clickedDrawn.push([pl,1,"green","red"]);

								 }
								 else
								 {
									if(this.options.type=="polyg" || this.options.type=="circle")
										{
									this.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
									let mz=map.getBoundsZoom(this.getBounds());
								   map.setZoom(mz-2);
										}
								   else if(this.options.type=="polylineGis")
										{
									this.setStyle({color: "red",weight:3});
									let mz=map.getBoundsZoom(this.getBounds());
								   map.setZoom(mz-2);
										}
								   else if(this.options.type=="pointGis")
										{
									this.setIcon(redIcon);
									map.setView(e.latlng, 9);

										}
									clickedDrawn = clickedDrawn.filter(function(item){ return item[0] != this })
								//    clickedDrawn=[];
								   this.options.clicked=0;

								 }
								 pl.bringToFront();

								   // this.enableEdit();
							   });
							 drawnPl.push(pl);  

							 trnsfrmSwal(pl);

						  }
							} 
							else if (result.dismiss === Swal.DismissReason.cancel) {
								
									// drawStopKey._tooltip.dispose();
									// drawStopKey._tooltip = null;
									drawStopKey._map.fire('draw:canceled', { layerType: drawStopKey.type });
									drawStopKey.disable();							
									Swal.fire('Changes are not saved', '', 'info')
							}
							})
						  
			  
						  }
						  swalAsync();
						// const result = Promise.resolve(swalAsync());
						// result.then((value) => {
						// console.log(JSON.parse(value));
						// drawOrBox=JSON.parse(value);;
						// console.log(drawOrBox);
						// // Expected output: 123
						// });
						// console.log(result)
						
						
						// asyncCaller();

						

	 }




function Polygon2()
{

//  pl=map.editTools.startPolygon(L.latLng(30.37285, -6.98837));
pl=map.editTools.startPolygon();
						   document.onkeydown = function(evt) {
								 evt = evt || window.event;
								 if (evt.keycode == 13) {
								   pl.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
								   console.log(pl.getLatLngs())
									 pl.disableEdit();
									 
								 }
							 };
							 pl.on('click',() => {
							   pl.enableEdit();
							   pl.getLatLngs();
								 });

   

}



function Polyline2()
{

pl=map.editTools.startPolyline();


}

function Rectangle3()
{

pl=map.editTools.startRectangle();

}

function Circle4()
{

pl=map.editTools.startCircle();

}

function Point5()
{  

pl=map.editTools.startMarker();


}

function Hole6()
{

pl.enableEdit();
pl.on('click', function (e) {
	 if (this.editEnabled()) {
	   this.editor.newHole(e.latlng);
	 }
 });


}

var appendLyr=[];
var appendLyr2=[];

function trnsfrmSwal(tt)
{
	let trnsfrm;
 switch(drawStopKey.type)
 {
	case 'polygon':
	case  'rectangle':
	case  'circle':
					 trnsfrm="polyg";
					 break;
    case 'polyline': trnsfrm="polylineGis";
					 break;
	case 'marker'   : trnsfrm="pointGis"
					 break;
 }
 console.log(trnsfrm);
 let lyrs3=document.getElementById("dragList");
let comp1=lyrs3.getElementsByTagName("label");

let comp=[];
for(n of comp1)
{
	if((n.innerText).match(/\(([^)]+)\)/)[1]==trnsfrm)
	{
		comp.push(String((n.innerText).split("(", 1)))
	}
}
console.log(comp)
let idxLyr=[];
let lyrs33=document.getElementById("tableSp");
let lyrs22=document.getElementById("TableList");
let comp3=lyrs22.getElementsByTagName("label");

let comp2=[];
for(c of comp3)
{
	comp2.push(String((c.innerText).split("(", 1)))
}
for(b of comp)
		{
			let u=comp2.indexOf(b);
			let v=comp.indexOf(b);
			let plt2=lyrs3.getElementsByTagName("li");
			console.log(lyrs33.getElementsByTagName("table")[u])
            let clr=plt2[v].getElementsByTagName("select")[0]
			console.log(clr.style.backgroundColor);
			if(lyrs33.getElementsByTagName("tbody")[u].hasChildNodes()==false)
			{
				idxLyr.push([u,clr.style.backgroundColor]);
			}		
		}
		let tbleLyr=lyrs33.getElementsByTagName("thead");
		let lab22=lyrs22.getElementsByTagName("label");
		let i=0;
		for(b of lyrsT)
		{
			appendLyr2.push([lab22[i],tbleLyr[i].getElementsByTagName("th")]);
			if(typeof(b[0])!=='undefined')
			{
				if(b[0].options.type==trnsfrm)
			{
				idxLyr.push([b[0].options.table,b[0].options.colors[0]]);
				
			}
			
			}
			
			i++;
		}
console.log(idxLyr)
appendLyr=[];
if(idxLyr.length!=0)
{
	for(p=0;p<idxLyr.length;p++)
	{
	let i=idxLyr[p][0];
	appendLyr[p]=[lab22[i],idxLyr[p][1],tbleLyr[i].getElementsByTagName("th"),i];
		parc++;
	}
	swalEdit(tt);
}

}

var markerImgs=[];

map.on('draw:drawstop', function (e) {

	if(markerImg==1)
	{
		drawStopKey=thisImg[2];
	}
// e.layer.options.clicked=0;
console.log(e.target._targets)
 let cc=Object.values(e.target._targets);
 cc=cc[cc.length-1];
 
							console.log(cc)
										drawnItems.removeLayer(cc)
										cc.addTo(map);
										cc.options.draggable=true;
										let fc,sc,out;
										
										drawnPl.push(cc);

										if(markerImg==1)
										{
											cc.options.Img=true;
										}
										else
										{
											cc.options.Img=false;
										}
										if(drawStopKey.type=="polygon" || drawStopKey.type=="rectangle")
										{
											cc.options.type="polyg";

										}
										else if(drawStopKey.type=="circle")
										{
											cc.options.type="circle";
											cc.options.radius=cc._mRadius;
											cc.options.center=cc._latlng;
										}
										else if(drawStopKey.type=="polyline")
										{
											cc.options.type="polylineGis";

										}
										if(drawStopKey.type=="marker")
										{
											cc.options.type="pointGis";

										}
										if(cc.options.type=="polyg" || cc.options.type=="circle")
										{
											cc.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
											fc="red";
											sc="green"
											out="white"
											
										}
									if(cc.options.type=="polylineGis")
										{
											cc.setStyle({color: "red",weight:3});
											fc="red";
											sc="green"
											out="white"
										}
									if(cc.options.type=="pointGis")
										{
											cc.setIcon(redIcon);
											fc=redIcon;
											sc=greenIcon;
											out=greenIcon
										}

										cc.options.colors=[fc,sc,out]
										cc.options.clicked=0;
										cc.options.attributes={};

							cc.on('click', function (e) {
								if(editStart==1)
							{
								swal.fire("Stop editing first")
								return;
							}
							if(deleteStopKey==0)
								{
									swal.fire("Finish removing first")
									return;
								}
								drawnItems.eachLayer(function (layer) {
									if(multp==0)
									{
									drawnItems.removeLayer(layer)
									layer.addTo(map);
									setZindexItem2(layer)
									}
									map.eachLayer(function (pg) {
								
									if((typeof(pg._bounds)!=="undefined") && (pg.options.table==layer.options.table))
									{
										if(pg!=layer && typeof(pg._bounds.max)==="undefined")
											{	
												if(layer.options.type!="pointGis")
					{
						if(layer.options.type=="circle")
						{
							let center = [layer.options.center.lng, layer.options.center.lat];
							let radius = layer.options.radius;
							let options = {steps: 128, units: 'meters'};
							let circle = turf.circle(center, radius, options);
							if(turf.booleanContains(circle, pg.toGeoJSON())==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						else
						{
							if(typeof(pg._url)!=="undefined")
										{
											pg.bringToFront();
										}
							else
							{
								if(turf.booleanContains(layer.toGeoJSON(), pg.toGeoJSON())==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
							}
							
						}
						
					}
														
									}
									}
										
									});	
								});	
							if(multp==0)	
							{
								for(t of drawnPl)
							{
								if(t!=this)
								{
									console.log(t)
									t.options.clicked=0;
									if(t.options.type=="polyg" ||  t.options.type=="circle")
										{
											t.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
										}
									if(t.options.type=="polylineGis")
										{
											t.setStyle({color: "red",weight:3});
										}
									if(t.options.type=="pointGis")
										{
											t.setIcon(redIcon);
										}
								}
								
							}
							}
							
								drawnItems.removeLayer(this)
										this.addTo(map);
									// drawnItems.eachLayer(function (layer) {
									// 	drawnItems.removeLayer(layer)
									// 	layer.addTo(map);
									// });	
									if(this.options.clicked==0)
								 {
									this.options.draggable=true;
									drawnItems.addLayer(this)
									if(multp==0)
									{
										clickedDrawn=[];
										if(markerImg==1)
										{
											imgDrawn=[];
										}
									}
								   if(this.options.type=="polyg" || this.options.type=="circle")
										{
									this.setStyle({fillColor: "green",fillOpacity: 1,color: "red",weight:4});
									map.fitBounds(this.getBounds());
										}
								   else if(this.options.type=="polylineGis")
										{
									this.setStyle({color: "green",weight:4});
									map.fitBounds(this.getBounds());
										}
									else if(this.options.type=="pointGis")
										{
											this.setIcon(greenIcon);
											console.log(this)
											map.setView(e.latlng, 13);
										}
								   
								   this.options.clicked=1;

								 clickedDrawn.push([cc,1,"green","red"]);
								 if(markerImg==1)
										{
											imgDrawn.push(this);
										}
								 }
								 else
								 {
									if(this.options.type=="polyg" || this.options.type=="circle")
										{
									this.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
									let mz=map.getBoundsZoom(this.getBounds());
								   map.setZoom(mz-2);
										}
								   else if(this.options.type=="polylineGis")
										{
									this.setStyle({color: "red",weight:3});
									let mz=map.getBoundsZoom(this.getBounds());
								   map.setZoom(mz-2);
										}
									else if(this.options.type=="pointGis")
										{
									this.setIcon(redIcon);
									map.setView(e.latlng, 9);
										}


								   
								//    clickedDrawn=[];
								clickedDrawn = clickedDrawn.filter(function(item){ return item[0] != this })
								if(markerImg==1)
										{
											imgDrawn = imgDrawn.filter(function(item){ return item!= this })
										}
								   this.options.clicked=0;

								 }
								//  this.options.draggable=true;

								   // this.enableEdit();
							   });
							   if(editStart==1 || deleteStopKey==0)
							{
								// drawnItems.addLayer(ccEdit);
								// swal.fire("Stop editing first")
								return;
							}
							//  drawnPl.push(cc);    
							if(markerImg==1 && markerImgs.length<2)
										{
											markerImgs.push(cc)

								// 			L.Handler.prototype.enable.call(thisImg[2]);
								// thisImg[2].fire('enabled', { handler: "marker" });
								// map.fire(L.Draw.Event.DRAWSTART, { layerType: "marker" });
								return;
										}
						   
							
		trnsfrmSwal(cc);


});
var editStart=0;
map.on('draw:drawstart', function (e) {
	console.log(this)
	 
	if(editStart==1)
	{
		swal.fire("Stop editing first")
		return;
	}
		if(markerImg==0)
		{
			Polygon();
		}
		// else
		// {
		// 	markerImg=0;
		// }
	
		
});
map.on('draw:deleted', function (e) {

	if(markerImg==1)
	{

		for(t of imgDrawn)
	{
			for(j of markerImgs)
		{
				if(j===t)
			{
				markerImgs=markerImgs.filter(function(item){ return item!= j })
			}
		}
	}	
	}

	for(t of clickedDrawn)
	{
		if(drawnPl.indexOf(t[0])!=-1)
	{
		return;
	}
	}
	
	console.log(clickedDrawn)
	

	let lyrs11=document.getElementById("tableSp");
	let tb=lyrs11.getElementsByTagName("tbody");
	let tbSc=document.getElementById("slcSp2");
	let tb2=tbSc.getElementsByTagName("tbody")
	// let nb=tb.length;
	// let parc=0;
	// for(let i=0;i<nb/2+1;i++)
	// {
	// 	parc++;
	// }
	// console.log(tb)
	// let idx=[];
	// for(t of clickedDrawn)
	// {
	// 	idx.push(t[0].options.table);
	// }
	
	// console.log(idx);
	// idx=[...new Set(idx)]
	// console.log(idx);
	for(let t of clickedDrawn)
	{
		

		let jj=t[0].options.table;
		console.log(jj)

							let jj2=document.getElementsByTagName("table")[jj]
							let ss=jj2.rows[0].getElementsByTagName("th")[0].innerText;
				for(m of tb[jj].rows)
				{
							
					if(m.getElementsByTagName("td")[0].innerText==t[0].options.attributes[ss])
					{
					deletedN[jj]=Math.max(deletedN[jj],parseInt(t[0].options.attributes[ss]));
					m.remove();
					console.log("removed row")

					break;
					}
				}

				for(m of tb2[jj].rows)
				{
					let jj=t[0].options.table;
							// let jj2=document.getElementsByTagName("table")[jj]
							// let ss=jj2.rows[0].getElementsByTagName("th")[0].innerText;
					if(m.getElementsByTagName("td")[0].innerText==t[0].options.attributes[ss])
					{
					m.remove();
					break;
					}
				}
				let lyrs2=document.getElementById("TableList");
				let lbl=lyrs2.getElementsByTagName("span")[jj];
				selectedHighlighted(tb[jj],tb2[jj],lbl);
			
	}
	let parc=0;
for(t of lyrsT)
{
	for(j of t)
	{
		for(k of clickedDrawn)
		{
			if(k[0]===j)
		{
			let fa={};
		let fd=[];
		let clrs=[];
		let lyrN;
		let attr={};
		if(lyrsT[k[0].options.layer].length==1)
		{
			fa=k[0].options.fieldAliases;
			fd=k[0].options.fields;
			clrs=k[0].options.colors;
			lyrsN=k[0].options.layer;
			attr=k[0].options.attributes;
			console.log(lyrsN)
			console.log(lyrsT[lyrsN][0])
			console.log(k[0])
			map.removeLayer(k[0]);
			map.removeLayer(lyrsT[lyrsN][0])
			
			console.log("removed layer")
			console.log(lyrsT[lyrsN][0])

			let tempFeat={};
			tempFeat.Temp="yes";
			tempFeat.options={};
			tempFeat.options.colors=clrs;
			tempFeat.options.fields=fd;
			tempFeat.options.fieldAliases=fa;
			tempFeat.options.attributes=attr;
			lyrsT[lyrsN][0]=tempFeat;

		}
		console.log(lyrsT)
			console.log("oui deleted")
			let inda=t.indexOf(j);
			console.log(inda)
	 		delete t[inda];
			 lyrsT[parc] = lyrsT[parc].filter(function(item){return item != j })
			 
		}
		}
		
	}
	parc++;
}
// for(t of clickedDrawn)
// 	{
// 		console.log(t[0])
// 		console.log(t[0].options.layer)
// 		console.log(lyrsT.length)
// 		console.log(lyrs[t[0].options.layer])
		
		
		
// 	}
console.log(lyrsT)
clickedDrawn=[];


});
map.on('draw:deletestop', function (e) {
console.log("hhh")
});
var ccEdit;
map.on('draw:editstart', function (e) {

	// if(clickedDrawn.length==0)
	// {
	// 	swal.fire("Select a feature first")
	// 	return;
	// }
	editStart=1;
 ccEdit=Object.values(drawnItems._layers);
// ccEdit=ccEdit[ccEdit.length-1];
// ccEdit.options.draggable=true;
//  console.log(ccEdit.options)
 for(t of ccEdit)
 {
	console.log(t)
	if(t.options.type!='pointGis' && t.options.type!='polylineGis')
 {
	t.setStyle({fillOpacity:0.4,weight:5});
	t.bringToFront();
 }
 }
 
 console.log(e)
//  let cc=Object.values(e.sourceTarget._targets);
//  cc=cc[cc.length-1];
// cc[1].dragging._enabled=true
// cc[1].dragging._draggable._enabled=true


});
map.on('draw:editstop', function (e) {
	editStart=0;
let cc=Object.values(drawnItems._layers);
//  cc=cc[cc.length-1];
 
 for(t of cc)
 {
	if(t.options.type!='pointGis' && t.options.type!='polylineGis')
 {
	t.setStyle({fillOpacity:1,weight:3});
	setZindexItem2(t);
 }
 }

});
map.on('editable:drawing:cancel', function (e) {
console.log(e.layer)
 map.removeLayer(e.layer);
});

map.on('editable:drawing:end', function (e) {
	if(drawStopKey.type=="polygon")
		{
			e.layer.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
		}
	else if(drawStopKey.type=="polyline")
		{
			e.layer.setStyle({color: "red",weight:3});
		}
 
 // e.layer.editor.disable();
});
var onKeyDown = function (e) {
let dt=document.getElementById("drawingTools");
	 let rd=dt.getElementsByTagName("input");
 if (e.keyCode == 27) {  // esc button
   console.log(e.keyCode+'Esc')
	 if (!this.editTools._drawingEditor) {return;};
	 map.editTools._drawingEditor.disable();
	 
	 for(let t of rd)
	 {
	   if(t.type=="radio")
	   {
		 t.checked=false;
	   }
	 }
 }
 else if (e.keyCode == 13) {
   // pl.setIcon(fc);
   console.log(e.keyCode+'Ent')
   console.log(pl.getLatLngs())
   pl.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
	 // pl.editor.disable();
	 map.editTools.commitDrawing();
	 for(let t of rd)
	 {
	   if(t.type=="radio")
	   {
		 t.checked=false;
	   }
	 }
 }
};

let dt=document.getElementById("drawingTools");
	 let rd=dt.getElementsByTagName("input");
var onKeyDown2 = function (e) {

 if (e.keyCode == 27) {  // esc button
   console.log(e.keyCode+'Esc')
	 if (!this.editTools._drawingEditor) {return;};
	 map.editTools._drawingEditor.disable();
	 
	 for(let t of rd)
	 {
	   if(t.type=="radio")
	   {
		 t.checked=false;
	   }
	 }
 }
 else if (e.keyCode == 13) {
   // pl.setIcon(fc);
   console.log(e.keyCode+'Ent')
   console.log(pl.getLatLngs())
   pl.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
	 // pl.editor.disable();
	 for(let t of rd)
	 {
	   if(t.type=="radio")
	   {
		 t.checked=false;
	   }
	 }
 }
};


L.DomEvent.addListener(document, 'keydown', onKeyDown, map);
function stringify(obj) {
  let cache = [];
  let str = JSON.stringify(obj, function(key, value) {
    if (typeof value === "object" && value !== null) {
      if (cache.indexOf(value) !== -1) {
        // Circular reference found, discard key
        return;
      }
      // Store value in our collection
      cache.push(value);
    }
    return value;
  });
  cache = null; // reset the cache
  return str;
}

var jsonMod={displayFieldName:"",
fieldAliases:{},
geometryType:"",
spatialReference:{},
fields:[],
features:[{attributes:{},geometry:{rings:[]}}]
};

var geojsonMod={
   type: 'FeatureCollection',
   features: [
    {
     type: 'Feature',
     geometry: {
      type: '',
      coordinates: []
     },
     properties: {}
    }
   ]
  }

  function destinationVincenty(lonlat, brng, dist) {
  // rewritten to work with leaflet
  const VincentyConstants = {
    a: L.CRS.Earth.R,
    b: 6356752.3142,
    f: 1 / 298.257223563,
  };

  const { a, b, f } = VincentyConstants;
  const lon1 = lonlat.lng;
  const lat1 = lonlat.lat;
  const s = dist;
  const pi = Math.PI;
  const alpha1 = (brng * pi) / 180; // converts brng degrees to radius
  const sinAlpha1 = Math.sin(alpha1);
  const cosAlpha1 = Math.cos(alpha1);
  const tanU1 =
    (1 - f) * Math.tan((lat1 * pi) / 180 /* converts lat1 degrees to radius */);
  const cosU1 = 1 / Math.sqrt(1 + tanU1 * tanU1);
  const sinU1 = tanU1 * cosU1;
  const sigma1 = Math.atan2(tanU1, cosAlpha1);
  const sinAlpha = cosU1 * sinAlpha1;
  const cosSqAlpha = 1 - sinAlpha * sinAlpha;
  const uSq = (cosSqAlpha * (a * a - b * b)) / (b * b);
  const A = 1 + (uSq / 16384) * (4096 + uSq * (-768 + uSq * (320 - 175 * uSq)));
  const B = (uSq / 1024) * (256 + uSq * (-128 + uSq * (74 - 47 * uSq)));
  let sigma = s / (b * A);
  let sigmaP = 2 * Math.PI;

  let cos2SigmaM;
  let sinSigma;
  let cosSigma;
  while (Math.abs(sigma - sigmaP) > 1e-12) {
    cos2SigmaM = Math.cos(2 * sigma1 + sigma);
    sinSigma = Math.sin(sigma);
    cosSigma = Math.cos(sigma);
    const deltaSigma =
      B *
      sinSigma *
      (cos2SigmaM +
        (B / 4) *
          (cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM) -
            (B / 6) *
              cos2SigmaM *
              (-3 + 4 * sinSigma * sinSigma) *
              (-3 + 4 * cos2SigmaM * cos2SigmaM)));
    sigmaP = sigma;
    sigma = s / (b * A) + deltaSigma;
  }
  const tmp = sinU1 * sinSigma - cosU1 * cosSigma * cosAlpha1;
  const lat2 = Math.atan2(
    sinU1 * cosSigma + cosU1 * sinSigma * cosAlpha1,
    (1 - f) * Math.sqrt(sinAlpha * sinAlpha + tmp * tmp)
  );
  const lambda = Math.atan2(
    sinSigma * sinAlpha1,
    cosU1 * cosSigma - sinU1 * sinSigma * cosAlpha1
  );
  const C = (f / 16) * cosSqAlpha * (4 + f * (4 - 3 * cosSqAlpha));
  const lam =
    lambda -
    (1 - C) *
      f *
      sinAlpha *
      (sigma +
        C *
          sinSigma *
          (cos2SigmaM + C * cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM)));
  // const revAz = Math.atan2(sinAlpha, -tmp);  // final bearing
  const lamFunc = lon1 + (lam * 180) / pi; // converts lam radius to degrees
  const lat2a = (lat2 * 180) / pi; // converts lat2a radius to degrees

  return L.latLng(lamFunc, lat2a);
}


 function createGeodesicPolygon(
  origin,
  radius,
  sides,
  rotation,
  withBearing = true
) {
  let trueAngle;
  let newLonlat;
  let geomPoint;
  const points = [];

  for (let i = 0; i < sides; i += 1) {
    if (withBearing) {
      trueAngle = (i * 360) / sides + rotation;
      newLonlat = destinationVincenty(origin, trueAngle, radius);
      geomPoint = L.latLng(newLonlat.lng, newLonlat.lat);
    } else {
      const pLat = origin.lat + Math.cos((2 * i * Math.PI) / sides) * radius;
      const pLng = origin.lng + Math.sin((2 * i * Math.PI) / sides) * radius;
      geomPoint = L.latLng(pLat, pLng);
    }
    points.push(geomPoint);
  }

  return points;
}

function circleToPolygon(circle, sides, withBearing) {
    const origin = circle.getLatLng();
    const radius = circle.getRadius();
    const polys = createGeodesicPolygon(origin, radius, sides, 0, withBearing); // these are the points that make up the circle
    const polygon = [];
    for (let i = 0; i < polys.length; i += 1) {
      const geometry = [polys[i].lat, polys[i].lng];
      polygon.push(geometry);
    }
    return L.polygon(polygon, circle.options);
  }
function SaveEd()
{
// jsonMod=JSON.parse(jsonMod);
jsonMod.fieldAliases=lyrsT[0][0].options.fieldAliases;
jsonMod.geometryType=lyrsT[0][0].options.geometryType;
// jsonMod.spatialReference=lyrsT[0][0].options.spatialReference;
jsonMod.spatialReference={wkid:4326,latestWkid:4326}
jsonMod.fields=lyrsT[0][0].options.fields;

let feat=[];
let feat2=[];
for(t of lyrsT[0])
{
	
	

	let objF={};
	objF.attributes=t.options.attributes;
	objF.geometry={};
	
	
	// objF={};
	// objF.geometry={};
	if(lyrsT[0][0].options.geometryType=="esriGeometryPolygon")
	{
		objF.geometry.type="Polygon";
					let crd=[];
		if(typeof(t.options.center)!=="undefined")
		{
			let t2=circleToPolygon(t,60,true);
			for(f of t2.getLatLngs()[0])
			{
				crd.push([f.lng,f.lat])
			}
		}
		else
		{
				for(f of t.getLatLngs()[0])
			{
				crd.push([f.lng,f.lat])	
			}
		}
			
		crd.push(crd[0]);
		objF.geometry.rings=[crd];
		objF.geometry.coordinates=[crd];
	}
	else if(lyrsT[0][0].options.geometryType=="esriGeometryPolyline")
	{
		objF.geometry.type="Polyline";
		let crd=[];
			for(f of t.getLatLngs()[0])
		{
			crd.push([f.lng,f.lat])
			
		}
		crd.push(crd[0]);
		objF.geometry.rings=[crd];
		objF.geometry.coordinates=[crd];
	}
	else if(lyrsT[0][0].options.geometryType=="esriGeometryPoint")
	{
		objF.geometry.type="Point";
		objF.geometry.x=t.getLatLng().lng;
		objF.geometry.y=t.getLatLng().lat;
		objF.geometry.coordinates=[objF.geometry.x,objF.geometry.y];

	}
	
	
	objF.properties=t.options.attributes;
	objF.type="Feature";
	feat.push(objF);
	feat2.push(objF);
}
jsonMod.features=feat;
geojsonMod.features=feat2;
console.log(jsonMod.features)

console.log(jsonMod)
console.log(geojsonMod)

let filename="test"
let file = filename + '.json';
  saveAs(new File([JSON.stringify(jsonMod)], file, {
    type: 'application/json'
  }), file);


// let mergedObject={};
// let geoj1=lyrsT[0][0].toGeoJSON();
// for(i=1;i<lyrsT[0].length;i++)
// {
// 	 mergedObject = {
//   ...geoj1,
//   ...lyrsT[0][i].toGeoJSON()
// 	};
// 	geoj1=mergedObject;
// }
// let geoj=lyrsT[0][0].toGeoJSON();
//   shpwrite.download(geoj);
const options = {
  folder: "shapefiles",
  filename: "my_zip_filename",
  outputType: "blob",
  compression: "DEFLATE",
  types: {
    point: "Point",
    polygon: "Polygon",
    polyline: "Polyline",
  },
};

// shpwrite.download(geojsonMod, options);
}

$(function() {
    var e = $.Event('keypress');
    e.which = 27; // Character 'Esc'
    $('#confirmId').trigger(e);
});

var markerImg=0;
function CancelEd()
{
	
	markerImg=1;
	if(markerImgs.length>=2)
						   {
							swal.fire("Only two referencial markers are allowed");
							return;
						   }
// console.log(lyrsT)
// return;
//  clickedDrawn[0].setStyle({fillColor: clickedDrawn[2],fillOpacity: clickedDrawn[1],color: clickedDrawn[3],weight:1});
//  if (clickedDrawn[0].editEnabled())
//  {
//    console.log("oui")
//    clickedDrawn[0].editor.reset();
//    // map.editTools.cancelDrawing();

//  // t.disableEdit();
//  }
// 	 // map.editTools._drawingEditor.disable();
 
// 	 clickedDrawn=[];
async function swalAsync() {
						  
						  await Swal.fire({
						title: 'Georeferencing',
						html:drwCrd +'<br>'+'<div id="box"></div>'+'<br>'+'<div id="rectBox"></div>'+'<div id="rectBox2"></div>',
						// focusConfirm: false,
						showCancelButton: true,
						confirmButtonText: 'Ok',
						// showDenyButton: true,
						// denyButtonText: 'Cancel',
						// confirmButtonText:'<div id="confirmId">Ok</div>',
						didOpen: () => {
						  let swl=document.getElementById('drwCrd');						  
						  swl.addEventListener("change", chngDrw33);
								},
						preConfirm: () => {
						 if(document.getElementById('drwCrd').value=='CoordBox')
						 {
							// document.getElementById('confirmId').dispatchEvent(new KeyboardEvent('keydown', {'key': 'Escape'}));
						 let i=cnt.indexOf(document.getElementById('countrySwal').value);
						 let j=coordSys.indexOf(document.getElementById('sysSwal').value);
						 sys=sysTab[j];
						 }
						 else
						 {
							return;
						 }
						  
						}
					  }).then((result) => {
						if (result.isConfirmed) {
							if (document.getElementById('drwCrd').value=="Draw") {
								
								L.Handler.prototype.enable.call(thisImg[2]);
								thisImg[2].fire('enabled', { handler: "marker" });
								map.fire(L.Draw.Event.DRAWSTART, { layerType: "marker" });
						return;
						
					  }
					  else
					  {
						let swlAdd3=document.getElementById('topLeft');
						let swlAdd4=document.getElementById('bottomRight');
						let wgsR1=proj4(sys,wgs,[parseFloat(swlAdd3.getElementsByTagName('input')[0].value),parseFloat(swlAdd3.getElementsByTagName('input')[1].value)]);
						let wgsR2=proj4(sys,wgs,[parseFloat(swlAdd4.getElementsByTagName('input')[0].value),parseFloat(swlAdd4.getElementsByTagName('input')[1].value)]);
						let plT=[];
						 plT[0]=L.marker([wgsR1[1],wgsR1[0]]);
						 plT[1]=L.marker([wgsR2[1],wgsR2[0]]);
						
							for(pl of plT)
							{

								pl.setIcon(greenIcon);
							pl.options.type='pointGis';
							map.setView(pl.getLatLng(), 13);
						let fc=redIcon;
						let sc=greenIcon;
						let out=greenIcon;

						pl.options.colors=[fc,sc,out]
						pl.options.Img=true;
						   pl.setIcon(fc);
						   pl.addTo(map);

						   pl.options.clicked=0;
						   pl.options.table=100;
						   pl.options.layer=100;

							pl.options.attributes={};
							pl.on('click', function (e) {
								if(editStart==1)
							{
								swal.fire("Stop editing first")
								return;
							}
							if(deleteStopKey==0)
								{
									swal.fire("Finish removing first")
									return;
								}
								drawnItems.eachLayer(function (layer) {
									if(multp==0)
									{
									drawnItems.removeLayer(layer)
									layer.addTo(map);
									setZindexItem2(layer)
									}
									map.eachLayer(function (pg) {
								
									if((typeof(pg._bounds)!=="undefined") && (pg.options.table==layer.options.table))
									{
										if(pg!=layer && typeof(pg._bounds.max)==="undefined")
											{	
												if(layer.options.type!="pointGis")
					{
						if(layer.options.type=="circle")
						{
							let center = [layer.options.center.lng, layer.options.center.lat];
							let radius = layer.options.radius;
							let options = {steps: 128, units: 'meters'};
							let circle = turf.circle(center, radius, options);
							if(turf.booleanContains(circle, pg.toGeoJSON())==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						else
						{
							if(turf.booleanContains(layer.toGeoJSON(), pg.toGeoJSON())==true)
							{
								pg.bringToFront();
								setZindexItem2(pg)
							}
						}
						
					}

														
									}
									}
										
									});	
								});	
								// drawnItems.eachLayer(function (layer) {
								// drawnItems.removeLayer(layer)
								// 		layer.addTo(map);	
								// 		console.log("table op")
								// 		console.log(layer.options.table)
								// 				});

								if(multp==0)
								{
									for(t of drawnPl)
							{
								if(t!=this)
								{
									t.options.clicked=0;
									if(t.options.type=="polyg" ||  t.options.type=="circle")
										{
											t.setStyle({fillColor: "red",fillOpacity: 1,color: "white",weight:3});
										}
									else if(t.options.type=="polylineGis")
										{
											t.setStyle({color: "red",weight:3});
										}
								   else if(t.options.type=="pointGis")
								   {
									t.setIcon(redIcon);
								   }
								}
								
							}
								}
							
								drawnItems.removeLayer(this)
										this.addTo(map);

									// drawnItems.eachLayer(function (layer) {
									// 	drawnItems.removeLayer(layer)
									// 	layer.addTo(map);
									// });	
									if(this.options.clicked==0)
								 {
									drawnItems.addLayer(this)
									if(multp==0)
									{
										clickedDrawn=[];
										imgDrawn=[];
									}
								   
									this.setIcon(greenIcon);
									map.setView(e.latlng, 13);
										
								   this.options.clicked=1;
								 clickedDrawn.push([pl,1,"green","red"]);
								 imgDrawn.push(this)


								 }
								 else
								 {
									
									this.setIcon(redIcon);
									map.setView(e.latlng, 9);

									clickedDrawn = clickedDrawn.filter(function(item){ return item[0] != this })
									imgDrawn=imgDrawn.filter(function(item){ return item!= this })

								//    clickedDrawn=[];
								   this.options.clicked=0;

								 }
								//  pl.bringToFront();

								   // this.enableEdit();
							   });
							 drawnPl.push(pl); 
							 markerImgs.push(pl)
							}

							 
					  }
						} 
						else if (result.dismiss === Swal.DismissReason.cancel) {
							
								// drawStopKey._tooltip.dispose();
								// drawStopKey._tooltip = null;
								drawStopKey._map.fire('draw:canceled', { layerType: drawStopKey.type });
								drawStopKey.disable();							
								Swal.fire('Changes are not saved', '', 'info')
						}
						})
					  
		  
					  }
					  swalAsync();

}

function EdEd()
{
swalEdit2();
//  if(clickedDrawn.length==0)
//  {
//    Swal.fire('Click on a feature!')

//  }
//  else
//  {
//    clickedDrawn[0].setStyle({fillColor: "blue",fillOpacity:0.4,color: "black",weight:5});
//    clickedDrawn[0].enableEdit();
//  }



}
let swalLyr='<select id="lyrSwal" name="lyr" class="form-control text-center"></select>'
let swalLyr2='<select id="lyrSwal2" name="lyr" class="form-control text-center"></select>'

function chngLyr() {
					   let sysw=document.getElementById('lyrSwal');
					   if(sysw.options.length!=0)
					   {
						removeOptions(sysw);

					   }
					  
							   for(let k=0;k<appendLyr.length;k++)
							 {
								console.log(appendLyr[k][1])
											   let opt = document.createElement("option");
											   opt.value = appendLyr[k][0].value; // the index
											   opt.style.backgroundColor=appendLyr[k][1];
											   opt.text=appendLyr[k][0].innerText;
											   sysw.append(opt);
							 }
							 let boxId=document.getElementById('box');


							 let table=document.createElement("table");
						table.classList.add("table");
						table.classList.add("table-bordered");
						let tbHd=document.createElement("thead");
						let tr=document.createElement("tr");
						let tbd=document.createElement("tbody");
						let tr2=document.createElement("tr");
						for(f of appendLyr[0][2])
							{
								let th=document.createElement("th");
								th.innerText=f.innerText;
								tr.appendChild(th);
								let td=document.createElement("td");
								td.contentEditable="true";
								// td.innerText=f.innerText;
								tr2.appendChild(td);
							}
							tr2.getElementsByTagName("td")[0].contentEditable="false";
							// let tbmaxVal=document.getElementsByTagName("table")[appendLyr[0][3]];
							// tr2.getElementsByTagName("td")[0].innerText=maxVal(tbmaxVal,0);
							tr2.getElementsByTagName("td")[0].innerText=deletedN[appendLyr[0][3]];
							tr.getElementsByTagName("th")[0].style.backgroundColor="yellow";
							tr2.getElementsByTagName("td")[0].style.backgroundColor="yellow";
							tbHd.appendChild(tr);
							table.appendChild(tbHd);
							tbd.appendChild(tr2);
							table.appendChild(tbd);
							boxId.appendChild(table)

    return sysw.innerHTML;
						 }
function chngLyr2() {
					   let sysw=document.getElementById('box');
					   sysw.innerHTML="";
					   let swl=document.getElementById('lyrSwal')
						let idx=swl.selectedIndex;
					   
					   let table=document.createElement("table");
						table.classList.add("table");
						table.classList.add("table-bordered");
						let tbHd=document.createElement("thead");
						
						let tbd=document.createElement("tbody");
						let tr=document.createElement("tr");
						let tr2=document.createElement("tr");
						for(f of appendLyr[idx][2])
							{
								let th=document.createElement("th");
								th.innerText=f.innerText;
								tr.appendChild(th);
								let td=document.createElement("td");
								td.contentEditable="true";
								// td.innerText=f.innerText;
								tr2.appendChild(td);
							}
							tr2.getElementsByTagName("td")[0].contentEditable="false";
							let tbmaxVal=document.getElementsByTagName("table")[appendLyr[idx][3]];
							tr2.getElementsByTagName("td")[0].innerText=maxVal(tbmaxVal,0);							tr.getElementsByTagName("th")[0].style.backgroundColor="yellow";
							tr2.getElementsByTagName("td")[0].style.backgroundColor="yellow";
							tbHd.appendChild(tr);
							table.appendChild(tbHd);
							tbd.appendChild(tr2);
							table.appendChild(tbd);
							sysw.appendChild(table)
						 }
function swalEdit(ll)
{
	async function swalAsync() {
						  
						  const { value: formValues } = await Swal.fire({
							title: 'Append feature to layer',
							customClass: 'swal-height',
							html:'<h2>Add this feature to a layer</h2>'+swalLyr +'<br>'+'<div id="box" style="width:400vh;overflow: auto"></div>',
							focusConfirm: false,
							// confirmButtonText:'<div id="confirmId">Ok</div>',
							didOpen: () => {
								
							  let swl=document.getElementById('lyrSwal');
									swl.innerHTML=chngLyr();
										swl.addEventListener("change", chngLyr2);

										  },
							preConfirm: () => {
								let inda1=drawnPl.indexOf(ll);
							delete drawnPl[inda1];
							drawnPl = drawnPl.filter(function(item){return item != ll })
								let swl=document.getElementById('lyrSwal');
								let bx=document.getElementById('box');
								let tr=bx.getElementsByTagName("tr")[1];
								let vals=[];
								let parc=0;
								let fc,sc,out;
								for(k of tr.getElementsByTagName("td"))
								{
									k.contentEditable="false";
								    vals[parc]=k;
									parc++;

								}
								tr.getElementsByTagName("td")[0].style.backgroundColor="";

								let tbl=document.getElementsByTagName('tbody');
								let idx=swl.selectedIndex;

								let tblId=appendLyr[idx][3]
								tbl[tblId].appendChild(tr)
								let u;
								let rappel=0;
								let pgs;
								let tblId2=tblId;
								// ll.options={};
								
								ll.options.fieldAliases=lyrsT[tblId][0].options.fieldAliases;
								ll.options.fields=lyrsT[tblId][0].options.fields;

								var methods = {
								'editEnabled': function() { return false; }
								};

								function addMethods(object, methods) {
								for (var name in methods) {
									object[name] = methods[name];
								}
								};

								addMethods(ll, methods);

								console.log(lyrsT.length)
								ll.options.layer=lyrsT.length;
								switch(drawStopKey.type)
											{
												case 'polygon':
												case  'rectangle':
												case  'circle':
																ll.options.type="polyg";
																ll.options.geometryType="esriGeometryPolygon";
																break;
												case 'polyline': ll.options.type="polylineGis";
																 ll.options.geometryType="esriGeometryPolyline";
																break;
												case 'marker'   : ll.options.type="pointGis";
																  ll.options.geometryType="esriGeometryPoint";
																break;
											}
								console.log(ll.options.type)
								if(typeof(lyrsT[tblId][0].Temp)==="undefined")
								{
									ll.options.colors=lyrsT[tblId][0].options.colors;
									u=lyrsT[tblId].length;
									ll.options.zindex=u;
									
									lyrsT[tblId][u]=ll;
									fc=ll.options.colors[0];
									sc=ll.options.colors[1];
									out=ll.options.colors[2];
									 pgs=lyrsT[tblId];
								}
								else
								{
									delete lyrsT[tblId][0].Temp;

									rappel=1;
									let jj=swl.options[idx].text

									 fc=lyrsT[tblId][0].options.colors[0];
									// let inda=colorsPlt.indexOf(fc);
									 sc=lyrsT[tblId][0].options.colors[1];
									 out=lyrsT[tblId][0].options.colors[2];

									ll.options.colors=[fc,sc,out];
									
									console.log(ll.options.colors)
									u=0;
									let pgsN=[];
									ll.options.zindex=u;
									pgsN[0]=ll;
									pgsN[0].options.fillOpacity=1;
									pgsN[0].options.weight=1;
									// lyrsT.pop();
									pgs=pgsN
									
									lyrsT[tblId]=pgsN;
									let lyrs33=document.getElementById("dragList");
								let parcjj=0;
								for(f of lyrs33.getElementsByTagName("label"))
								{
									let compar=(f.innerText).split("(")[0];
									console.log(compar)
									if(jj==compar)
									{
										tblId2=parcjj;
										console.log(tblId2)
										break;
									}
									parcjj++;
								}
								
									
								}
								console.log(u)
								
								
								let options={};
								ll.options.attributes={};
								let parc2=0;
								let tr0=bx.getElementsByTagName("tr")[0];

								for(t of tr0.getElementsByTagName("th"))
								{
								let s=t.innerText;
								console.log(lyrsT[tblId][0])
								console.log(s)
							   for(let l of lyrsT[tblId][0].options.fields)
							   {
								console.log(l.name)

								if(l.name==s)
								{
									switch(l.type)
									{
										case "esriFieldTypeString": 
										case "esriFieldTypeDate": ll.options.attributes[s]=vals[parc2].innerText;
																    break;
										case "esriFieldTypeShortInteger": 
										case "esriFieldTypeOID":ll.options.attributes[s]=deletedN[tblId];
																	break;
										case "esriFieldTypeDouble": ll.options.attributes[s]=parseFloat(vals[parc2].innerText);
																    break;
										default: ll.options.attributes[s]=vals[parc2].innerText;
										
									}
								}
								console.log(ll.options.attributes)
							   }
								
								parc2++;
								}
								

								let ss=tr0.getElementsByTagName("th")[0].innerText;
								// options[ss]=parseInt(vals[0].innerText);
								// ll.options.attributes[ss]=parseInt(vals[0].innerText);
								console.log(ll.options.attributes.Id)
								// ll.options.attributes[ss]=deletedN[appendLyr[0][3]];
								// console.log(ll.options.attributes.Id)

								deletedN[appendLyr[0][3]]=deletedN[appendLyr[0][3]]+1;

								let tbl2=document.getElementsByTagName('table');
								ll.options.table=tblId;
								ll.options.layer=tblId;
								
								console.log(tblId)
								
								let lyrs3=document.getElementById("dragList");
								let li=lyrs3.getElementsByTagName("li")[tblId2];
								let x=li.getElementsByTagName("input")[0];
								let slider=li.getElementsByTagName("input")[1]
								console.log(slider)
								let plt2=li.getElementsByTagName("span")[0]
								let comp1=lyrs3.getElementsByTagName("label")[tblId2];
								// ll.options.type=(comp1.innerText).match(/\(([^)]+)\)/)[1]
								// ll.options.type=lyrsT[tblId][0].options.type;
								console.log(ll.options.type)
								// ll.options.type=lyrsT[tblId][0].options.type;
								// ll.options.clicked=ll.options.clicked;
								// ll.options={};
								//  ll.options = Object.assign({}, options);
								// ll.options = Object.assign(ll.options, options);
								let lyrs22=document.getElementById("TableList");
	   							let lab=lyrs22.getElementsByTagName("span")[tblId];
								let sld=0;
								console.log(lyrsT[tblId][0].options.type)
								if(ll.options.type=='polyg')
								{
									console.log(ll.options.colors)
									console.log(ll.options.fillOpacity)

									sld=lyrsT[tblId][0].options.fillOpacity;
									console.log(sld)
									ll.setStyle({fillColor: ll.options.colors[0],fillOpacity:sld,color: ll.options.colors[2],weight:3});
									// ll.setStyle({fillColor: "blue",fillOpacity:1,color: "white",weight:3});


								}
								else if(ll.options.type=='polylineGis')
								{
									sld=lyrsT[tblId][0].options.weight;
									ll.setStyle({color: ll.options.colors[0],weight:sld});
								}
								else if(ll.options.type=='pointGis')
								{
									ll.setIcon(ll.options.colors[0])
								}
								setZindexItem()
								let nb=tbl2.length;
								let parc3=0;
								for(let i=0;i<nb/2+1;i++)
								{
									parc3++;
								}
								let idx2=ll.options.table;
								// let tableSlc=tbl2[idx2+parc3-1];
								// console.log(tableSlc)
								let tbSp=document.getElementById("tableSp");
								tbSp=tbSp.getElementsByTagName("table")
								let tbSc=document.getElementById("slcSp2");
								let tblBd=tbSc.getElementsByTagName("tbody")
								console.log(tblBd)
								let tbdSlc=tblBd[tblId];
								console.log(tbdSlc)
								ll.off("click");
								ll.addEventListener("click", function(){
									if(lyrsT[tblId][0].options.type=='polyg')
								{
									sld=lyrsT[tblId][0].options.fillOpacity;

								}
								else if(lyrsT[tblId][0].options.type=='polylineGis')
								{
									sld=lyrsT[tblId][0].options.weight;
								}
								});

								console.log(ll)
								let table=tbSp[tblId];
								let tableSlc=tbSc.getElementsByTagName("table")[tblId];
								console.log(tblId)
								console.log(table)
								console.log(tableSlc)
								// let uu=lyrsT[lyrsT.length-1];
								// uu[uu.length-1]=ll.options.colors
								console.log(lyrsT[lyrsT.length-1])
								// let elClone = table.cloneNode(true);
								function rmvLst(e)
								{
									addClickTable(table,tableSlc,tbdSlc,lyrsT[ll.options.table],lab,fc,sc,out,e,sld);
								}
								// table.removeEventListener('click', rmvLst,false);
									
									// table.parentNode.replaceChild(elClone, table);
									console.log(ll.options.table)
									console.log(lyrsT[lyrsT.length-1][0].options.table)

									if(rappel==1 && eventLst[ll.options.table]==0)
									{
										console.log(ll.options.table)
									console.log(lyrsT[lyrsT.length-1][0].options.table)
										table.addEventListener('click',rmvLst);
									
									tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,lyrsT[ll.options.table],lab,sc,out,e,sld);});
										 slider.addEventListener("click", function(){t=this;updateOpacity(lyrsT[tblId],t.value);li.draggable = false;});
										 onclickPgs(ll,lyrsT[ll.options.table],table,tbdSlc,lab,ll.options.colors[0],ll.options.colors[1],ll.options.colors[2],sld);
										 eventLst[ll.options.table]=1;
										}
									// else
									// {
									// 	onclickPgs(ll,lyrsT[tblId],table,tbdSlc,lab,ll.options.colors[0],ll.options.colors[1],ll.options.colors[2],sld);

									// }

									//  slider.addEventListener("click", function(){t=this;updateOpacity(pgs,t.value);li.draggable = false;});
			//    slider.addEventListener("mouseout", function(){li.draggable = true;});
			li.draggable = true;
			// 	 slider.addEventListener("click", function(){t=this;updateOpacity(pgs,t.value);li.draggable = false;});
				   function showhidelyr()
				   {
					 if(x.checked==false)
					 {
					   for (let l of lyrsT[tblId])
					   {
						 if(l.options.type=="polyg" || l.options.type=="circle")
					   {
						 l.setStyle({opacity: 0,fillOpacity: 0,weight:0});
					   }
					   else if(l.options.type=="polylineGis")
					   {
						l.setStyle({weight:0});

					   }
						 // l.unbindTooltip();
					   }
					   for(i=0;i<lyrsT[tblId].length;i++)
					 {
						lyrsT[tblId][i].setInteractive(false);
					   }
					 }
					 else
					 {
					   for(i=0;i<lyrsT[tblId].length;i++)
					 {
					   if(lyrsT[tblId][i].options.type=="polyg" || lyrsT[tblId][i].options.type=="circle")
					   {
						 
						 if(clickedZ.indexOf(lyrsT[tblId][i])==-1)
						 {
						   if(clickedY.indexOf(lyrsT[tblId][i])==-1)
						 {
							lyrsT[tblId][i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:fc,weight:1});
						 }
						 else
						 {
							lyrsT[tblId][i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor:sc,weight:3});
						 }
						 }
						 else
						 {
							lyrsT[tblId][i].setStyle({opacity: slider.value,fillOpacity: slider.value,fillColor: out,color: sc,weight:3});
						 }
						 
					   }
					   else if(lyrsT[tblId][i].options.type=="polyline")
					   {
						lyrsT[tblId][i].setStyle({weight:3});

					   }
					   
					   lyrsT[tblId][i].setInteractive(true);
					   }
					 }
				   }
				   console.log(rappel)
				   console.log(rappel)

				   if(rappel==1 && eventLst2[ll.options.table]==0)
				   {
									   x.onclick=showhidelyr;
									   plt2.addEventListener('click', (event) => {
					let ev=event.target.options[event.target.selectedIndex];
					let ev2=slctPlt[event.target.selectedIndex];
					 let ev3=outPlt[event.target.selectedIndex];
					 fc=ev.innerText;
					 sc=ev2;
					 out=ev3;
					 for(p of lyrsT[tblId])
				 {
				p.options.colors=[fc,sc,out];
				   t=p;
				   if(p.options.type=="polyg" || p.options.type=="circle")
				   {
					 p.setStyle({fillColor: ev.innerText,weight:1,color:out});
					 p.off("click");
					 p.options.clicked=0;
				   p.addEventListener("click", function(){t=this;onclickPgs(t,lyrsT[tblId],table,tbdSlc,lab,fc,sc,out,sld);});
				   }
				   else if(p.options.type=="polylineGis")
				   {
					 p.setStyle({color: ev.innerText,weight:1});
					 p.off("click");
					 p.options.clicked=0;
				   p.addEventListener("click", function(){t=this;onclickPgs(t,lyrsT[tblId],table,tbdSlc,lab,fc,sc,out,sld);});
				   }
				   else if(p.options.type=="pointGis")
				   {
							   switch(fc)
					   {
						 
						 case 'blue': fc=blueIcon;
									 sc=yellowIcon;
									 out=whiteIcon;
									 break;
						 case 'cyan': fc=cyanIcon;
									 sc=orangeIcon;
									 out=blackIcon;
									 break;
						 case 'green': fc=greenIcon;
									 sc=redIcon;
									 out=blueIcon;
									 break;
						 case 'yellow': fc=yellowIcon;
									 sc=blueIcon;
									 out=whiteIcon;
									 break;
						 case 'orange': fc=orangeIcon;
									 sc=cyanIcon;
									 out=blackIcon;
									 break;
						 case 'red':  fc=redIcon;
									 sc=greenIcon;
									 out=blueIcon;
									 break;
						 case 'black': fc=blackIcon;
									 sc=whiteIcon;
									 out=redIcon;
									 break;

					   }
					 p.setIcon(fc);
					 p.off("click");
				   p.addEventListener("click", function(){t=this;onclickPgs(t,lyrsT[tblId],table,tbdSlc,lab,fc,sc,out,sld);});
				   }
				 }
				 clearTbl(table,tbdSlc)
					 selectedHighlighted(table,tbdSlc,lab);
					//  table.off("click");
				 table.addEventListener('click', function(e) {addClickTable(table,tableSlc,tbdSlc,pgs,lab,fc,sc,out,e,sld)});
				//  tableSlc.off("click");
				 tableSlc.addEventListener('click', function(e) {addClickBdslc(tableSlc,pgs,lab,sc,out,e,sld);});

				//  x.off("click");
				//  x.onclick=showhidelyr;
				console.log(ll)

				   }); 
				   eventLst2[ll.options.table]=1;

				   }

				 
				   
				  
				   
			 
			  
			   // let tbdSlc = document.createElement("tbody");

			 
			 
			 pgs[pgs.length-1].addEventListener("click", function(){t=this;onclickPgs(t,pgs,table,tbdSlc,lab,fc,sc,out,sld);});
		   
				

							}
						  })
						


						  }
						  swalAsync();
						  console.log(lyrsT[0])
}



function maxVal(tb,col)
{
	if(tb.rows.length==1)
	{
		return 1;
	}
	let maxVal;
            
            for(var i = 1; i < tb.rows.length; i++)
            {
                // if its the first row get th value
                if(i === 1){
                    maxVal = parseInt(tb.rows[i].cells[col].innerText);
                }
              // test the values
              else if(maxVal < parseInt(tb.rows[i].cells[col].innerText))
                {
                    maxVal = parseInt(tb.rows[i].cells[col].innerText);
                }
            }
		return maxVal+1;
}

document.onkeydown = function(evt) {
    if (evt.keyCode == 17) {
		document.getElementById("rd9").checked=true;
        mult();
    }
};

document.onkeyup = function(evt) {
    evt = evt || window.event;
    if (evt.keyCode == 17) {
        document.getElementById("rd9").checked=false;
        mult();
    }
};

function AjtDoc(new_name)
{
	// let a='HAHHAH'
	// document.getElementById("tableSp").innerText=a;
  var acc;
  acc=excel_file;
  const xhr=new XMLHttpRequest();
  const formData=new FormData();
 
  for(const file of acc.files)
  {
    formData.append("myFiles[]",file, new_name);
  }
  xhr.open("post","toolbarEnvDoc.php");
  xhr.send(formData);
//   let indexg=document.getElementById("X").value;
//   $.ajax({
//         url: "toolbarEnvDoc.php",  
//         type: "POST",
//           //pass data like this 
//         data: formData,
// 		processData: false,
//         contentType: false,
//         success: function(response) {		
// 		// $('#tableSp').html(response);
// 		let name2=response.split("}").pop()
// 		console.log(name2)
// 		var crtRaster=L.imageOverlay(name2,[[31.000000000000057,-6.499999999999943],[30.500000000000057,-6.999999999999943]]);
// 	crtRaster.addTo(map);
//          }

//     });

	


  
  
}

function deleteImage(file_name)
{
        $.ajax({
          url: 'deleteImg.php',
		  type: "POST",
          data: {fileN:file_name},
          success: function (response) {
            // $('#tableSp').html(response);
          },
          error: function () {
             // do something
          }
        });
    
}





// var polygon = {
//   "type": "FeatureCollection",
//   "features": [
//     {
//       "type": "Feature",
//       "properties": {},
//       "geometry": {
//         "coordinates": [
//           [
//             [
// 			-6.499999999999943,
// 			  31.000000000000057
//             ],
//             [
// 			-6.999999999999943,
// 			  31.000000000000057,
//             ],
//             [
// 			-6.999999999999943,
// 			  30.500000000000057
//             ],
//             [
// 			-6.499999999999943,
// 			  30.500000000000057
//             ],
// 			[
// 			-6.499999999999943,
// 			  31.000000000000057
//             ]
//           ]
//         ],
//         "type": "Polygon"
//       }
//     }
//   ]
// };



// var polygonLayer = L.geoJSON(polygon, {
//   interactive: false
// });
// polygonLayer.addTo(map)
// var polygonBounds = polygonLayer.getBounds();
// var polygonBoundsRectangle = L.rectangle(polygonBounds, {
//   fill: false,
//   interactive: false
// });
// polygonBoundsRectangle.addTo(map)
// var polygonBoundsLayer = L.featureGroup([polygonBoundsRectangle]);


// document.getElementById("X").value=-6.499999999999943;
// document.getElementById("Y").value=31.000000000000057;
// document.getElementById("X2").value=-6.999999999999943;
// document.getElementById("Y2").value=30.500000000000057;


function adjustByFactor(pixelCoords, pixelOrigin, factorH, factorV) {
  var pixelCoordsFromOrigin = pixelCoords.subtract(pixelOrigin);
  pixelCoordsFromOrigin = pixelCoordsFromOrigin.scaleBy(L.point([factorH, factorV]));
  
  return(pixelCoordsFromOrigin.add(pixelOrigin));
}
  
var imageBounds;
function loadImageOverlay(nom,tpp,imgWidth, imgHeight) {
//   var boundsCornerPixels1 = map.latLngToContainerPoint(polygonLayer.getBounds().getNorthWest());
//   var boundsCornerPixels2 = map.latLngToContainerPoint(polygonLayer.getBounds().getSouthEast());
  
//   var boundsCenterPixels = map.latLngToContainerPoint(polygonLayer.getBounds().getCenter())
//   var imageHeightPixels = Math.abs(boundsCornerPixels2.y - boundsCornerPixels1.y);
//   var imageWidthPixels = imageHeightPixels * (imgWidth / imgHeight);
//   var imageCornerPixels1 = boundsCenterPixels.subtract(L.point([imageWidthPixels / 2, imageHeightPixels / 2]));
//   var imageCornerPixels2 = boundsCenterPixels.add(L.point([imageWidthPixels / 2, imageHeightPixels / 2]));
//   var imageCorner1 = map.containerPointToLatLng(imageCornerPixels1);
//   var imageCorner2 = map.containerPointToLatLng(imageCornerPixels2);

//   var imageBounds = L.latLngBounds(imageCorner1, imageCorner2).pad(0.15);

var imageLayer;
if(tpp=="img")
{
	imageLayer = L.imageOverlay(nom, imageBounds, {
    interactive: true,
    opacity: 0.7
  });
}
else
{
	imageLayer = L.videoOverlay(nom, imageBounds, {
    opacity: 0.8,
    // errorOverlayUrl: errorOverlayUrl,
    interactive: true,
    autoplay: true,
    muted: true,
    playsInline: true
});
}
 
  imageLayer.addTo(map);
  
//   var draggable = new L.Draggable(imageLayer.getElement());
//   draggable.enable();
  
  var markers = [];
  var wasDrag = false;
  var prevDragPosition;
//   draggable.on('dragstart drag dragend', function(evt) {
//     wasDrag = true;
//     if (evt.type == 'dragstart')
//       prevDragPosition = evt.target._startPos;
//     else if (evt.type == 'dragend') {
//       var move = evt.target._newPos.subtract(evt.target._startPos);
//       var bounds = imageLayer.getBounds();
//       var boundsNW = bounds.getNorthWest();
//       var boundsSE = bounds.getSouthEast();
//       var boundsNWPixels = map.latLngToContainerPoint(boundsNW);
//       var boundsSEPixels = map.latLngToContainerPoint(boundsSE);
//       var newBoundsNWPixels = boundsNWPixels.add(move);
//       var newBoundsSEPixels = boundsSEPixels.add(move);
//       var newBoundsNW = map.containerPointToLatLng(newBoundsNWPixels);
//       var newBoundsSE = map.containerPointToLatLng(newBoundsSEPixels);
//       imageLayer.setBounds(L.latLngBounds(newBoundsNW, newBoundsSE));
//       }
//     else {
//       var move = evt.target._newPos.subtract(prevDragPosition);
//       prevDragPosition = evt.target._newPos;
//       markers.forEach(function(marker) {
//         var markerPixel = map.latLngToContainerPoint(marker.getLatLng());
//         var newMarkerPixel = markerPixel.add(move);
//         marker.setLatLng(map.containerPointToLatLng(newMarkerPixel));
//       });
//     }
//   });
  
  imageLayer.on('click', function(evt) {
    if (wasDrag)
      wasDrag = false;
    else if (markers.length < 2) {
      var marker = L.marker(evt.latlng, {draggable: true}).addTo(map);
      markers.push(marker);
	  return;
      }
		if(markerImgs.length<2)
		{
			swal.fire("you need two referencial markers");
			return;
		}
      var marker1LatLng = markers[0].getLatLng();
      var marker1Pixels = map.latLngToContainerPoint(marker1LatLng);
      var marker2LatLng = markers[1].getLatLng();
      var marker2Pixels = map.latLngToContainerPoint(marker2LatLng);
      var markersDistPixelsH = Math.abs(marker1Pixels.x - marker2Pixels.x);
      var markersDistPixelsV = Math.abs(marker1Pixels.y - marker2Pixels.y);       
    //   var polygonBoundsNW = polygonBounds.getNorthWest();
	// var polygonBoundsNW={lat: document.getElementById("Y").value,
	// 					lng: document.getElementById("X").value
	// 					};
	var polygonBoundsNW=markerImgs[0].getLatLng();
      var polygonBoundsNWPixels = map.latLngToContainerPoint(polygonBoundsNW);
    //   var polygonBoundsSE = polygonBounds.getSouthEast();
	// var polygonBoundsSE={lat: document.getElementById("Y2").value,
	// 					lng: document.getElementById("X2").value
	// 					};
	var polygonBoundsSE=markerImgs[1].getLatLng();
      var polygonBoundsSEPixels = map.latLngToContainerPoint(polygonBoundsSE);
      var polygonBoundsDistPixelsH = Math.abs(polygonBoundsNWPixels.x - polygonBoundsSEPixels.x);
      var polygonBoundsDistPixelsV = Math.abs(polygonBoundsNWPixels.y - polygonBoundsSEPixels.y);
      var factorH = polygonBoundsDistPixelsH / markersDistPixelsH;
      var factorV = polygonBoundsDistPixelsV / markersDistPixelsV;

      var bounds = imageLayer.getBounds();
      var boundsNW = bounds.getNorthWest();
      var boundsSE = bounds.getSouthEast();
      var boundsNWPixels = map.latLngToContainerPoint(boundsNW);
      var boundsSEPixels = map.latLngToContainerPoint(boundsSE);
      var boundsSEPixels = adjustByFactor(boundsSEPixels, boundsNWPixels, factorH, factorV);
      var marker1Pixels = adjustByFactor(marker1Pixels, boundsNWPixels, factorH, factorV);
      var marker2Pixels = adjustByFactor(marker2Pixels, boundsNWPixels, factorH, factorV);

      var move = polygonBoundsNWPixels.subtract(marker1Pixels);

      var newBoundsNWPixels = boundsNWPixels.add(move);
      var newBoundsSEPixels = boundsSEPixels.add(move);
      var newBoundsNW = map.containerPointToLatLng(newBoundsNWPixels);
      var newBoundsSE = map.containerPointToLatLng(newBoundsSEPixels);
      imageLayer.setBounds(L.latLngBounds(newBoundsNW, newBoundsSE));

      var newMarker1Pixels = marker1Pixels.add(move);
      var newMarker2Pixels = marker2Pixels.add(move);
      var newMarker1LatLng =  map.containerPointToLatLng(newMarker1Pixels);
      var newMarker2LatLng =  map.containerPointToLatLng(newMarker2Pixels);
      markers[0].setLatLng(newMarker1LatLng);
      markers[1].setLatLng(newMarker2LatLng);
    
  });
}



function swalImg(nom,tp)
{
	async function swalAsync() {
						  
						  await Swal.fire({
						title: 'Add Raster Image',
						html:boxHtml33,
						// focusConfirm: false,
						showCancelButton: true,
						confirmButtonText: 'Ok',
						// showDenyButton: true,
						// denyButtonText: 'Cancel',
						// confirmButtonText:'<div id="confirmId">Ok</div>',
						didOpen: () => {
							let swl=document.getElementById('countrySwal');
							swl.addEventListener("change", chngSwal);
								},
						preConfirm: () => {
							let i=cnt.indexOf(document.getElementById('countrySwal').value);
							let j=coordSys.indexOf(document.getElementById('sysSwal').value);
							sys=sysTab[j];
							let swlAdd3=document.getElementById('topLeft');
							let swlAdd4=document.getElementById('bottomRight');
							let wgsR1=proj4(sys,wgs,[parseFloat(swlAdd3.getElementsByTagName('input')[0].value),parseFloat(swlAdd3.getElementsByTagName('input')[1].value)]);
							let wgsR2=proj4(sys,wgs,[parseFloat(swlAdd4.getElementsByTagName('input')[0].value),parseFloat(swlAdd4.getElementsByTagName('input')[1].value)]);

							// var crtRaster=L.imageOverlay(nom,[[wgsR1[1],wgsR1[0]],[wgsR2[1],wgsR2[0]]]);
							// crtRaster.addTo(map);
							imageBounds=[[wgsR1[1],wgsR1[0]],[wgsR2[1],wgsR2[0]]];
						}
					  }).then((result) => {
						if (result.isConfirmed) {
							var img;
							if(tp=="img")
							{
								img = new Image();
								img.onload = function() {
							loadImageOverlay(nom,tp,img.width, img.height);
							};
							}
							else
							{
								img= document.createElement('video');
								img.onloadstart = function() {
							loadImageOverlay(nom,tp,img.width, img.height);
							};
							}
							
							img.src = nom;
						} 
						else if (result.dismiss === Swal.DismissReason.cancel) {
							
							
								// Swal.fire('Changes are not saved', '', 'info')
						}
						})
					  
		  
					  }
					  swalAsync();
}


let checkBt1='<div><input type="checkbox" id="chck1" /><label for="chck1">Add To selection</label></div>';
let checkBt2='<div><input type="checkbox" id="chck2" /><label for="chck2">Add data column to source layer</label></div>';

var IntMeth='<select name="intMeth" class="form-control" id="intMth"><option value="Contains">Contains</option><option value="Intersect">Intersect</option><option value="Within">Within</option><option value="Centroid">Have centroid in</option></select>';

function fillOpt()
{
	
 let lyrs3=document.getElementById("dragList");

let lyrs33=document.getElementById("tableSp");
let lyrs22=document.getElementById("TableList");


		let tbleLyr=lyrs33.getElementsByTagName("thead");
		let lab22=lyrs22.getElementsByTagName("label");
		let i=0;
		for(b of lyrsT)
		{
			appendLyr2.push([lab22[i],tbleLyr[i].getElementsByTagName("th")]);

			i++;
		}


}
function chngLyr11() {
					   let sysw=document.getElementById('lyrSwal');
					   let sysw2=document.getElementById('lyrSwal2');

					   if(sysw.options.length!=0)
					   {
						removeOptions(sysw);

					   }
					  
							   for(let k=0;k<appendLyr2.length;k++)
							 {
											   let opt = document.createElement("option");
											   opt.value = appendLyr2[k][0].value; // the index
											   opt.text=appendLyr2[k][0].innerText;
											   sysw.append(opt);
							 }
					sysw2.innerHTML=sysw.innerHTML

							 
							 
							

    return sysw.innerHTML;
						 }

function chngLyr12()
{
	let boxId=document.getElementById('box');

						
let chck2=document.getElementById('chck2');
let slc = document.createElement("select");
 if(chck2.checked)
 {
		for(f of appendLyr2[0][1])
	{
		let opt = document.createElement("option");
					opt.value = f.value; // the index
					opt.text=f.innerText;
					slc.append(opt);
	}
	boxId.append(slc);
 }
 else
 {
	boxId.innerHTML="";
 }
}
function chngLyr22() {
					   let sysw=document.getElementById('box');
					   sysw.innerHTML="";
					   let swl=document.getElementById('lyrSwal2')
						let idx=swl.selectedIndex;
					   
						let chck2=document.getElementById('chck2');
						let slc = document.createElement("select");
						if(chck2.checked)
						{
								for(f of appendLyr2[idx][1])
							{
								let opt = document.createElement("option");
											opt.value = f.value; // the index
											opt.text=f.innerText;
											slc.append(opt);
							}
							sysw.append(slc);
						}
						else
						{
							sysw.innerHTML="";
						}
						 }


function createColumn(tbl,tblsc2,Fld,Fld2,idTbl)
{
	let tbl1=tbl.getElementsByTagName("tr")[0]
	// tbl1=tbl1.getElementsByTagName("th")
	let tbl2=tbl.getElementsByTagName("tbody")[0]
	
    let col = document.createElement("th");
    col.innerText=Fld;
    tbl1.append(col);
	console.log(tbl)
	console.log(idTbl)
	console.log(lyrsT[idTbl])
	for(let n of lyrsT[idTbl])
	{
		n.options.fieldAliases[Fld]=Fld;
	}
	let obj={name:Fld,type:"",alias:Fld};
	
	switch(Fld2)
				{
					case "esriFieldTypeString":
							if(lyrsT.length!=0)
					{
							for(let n of lyrsT[idTbl])
						{
							obj.type="esriFieldTypeString";
							n.options.fields.push(obj);
							break;
						}
					}
						   break;
					
					case "esriFieldTypeDouble":
							if(lyrsT.length!=0)
					{
							for(let n of lyrsT[idTbl])
						{
							obj.type="esriFieldTypeDouble";
							n.options.fields.push(obj);
							break;
						}
					}
						   break;
					case "esriFieldTypeInteger":
							if(lyrsT.length!=0)
					{
							for(let n of lyrsT[idTbl])
						{
							obj.type="esriFieldTypeInteger";
							n.options.fields.push(obj);
							break;
						}
					}
						   break;
					case "esriFieldTypeDate":
							if(lyrsT.length!=0)
					{
							for(let n of lyrsT[idTbl])
						{
							obj.type="esriFieldTypeDate";
							n.options.fields.push(obj);
							break;
						}
					}
						   break;
				}
				
	let tbl3=tblsc2.getElementsByTagName("tr")[0]
	let col2 = document.createElement("th");
    col2.innerText=Fld;
	tbl3.appendChild(col2);
	
	for(u of tbl2.rows)
	{
		let td = document.createElement("td");
		u.appendChild(td);
	}
	if(lyrsT.length!=0)
	{
			for(let n of lyrsT[idTbl])
		{
			n.options.attributes[Fld]="";
		}
	}
	
}

function intMethFun(idxlyr1,idxlyr2,lyr1,lyr2,idxMeth,Meth,chck1,Field)
{
	let Field2=lyr1+"_"+Meth+"_"+lyr2+"_"+Field;
	let tb=document.getElementById("tableSp");
	let tblF=tb.getElementsByTagName("table")[idxlyr1];
	let tbSc=document.getElementById("slcSp2");
	let tblF2=tbSc.getElementsByTagName("table")[idxlyr1]
	let tblBd=tb.getElementsByTagName("tbody")[idxlyr1];
	let idxTbl=tblF.getElementsByTagName("tr")[0];
	idxTbl=idxTbl.getElementsByTagName("th")
    let rows=tblBd.rows;
	// let radius = 2000;
	// let options = {steps: 64, units: 'meters', properties: {foo: 'bar'}};
	let FieldString;
	let string;
	console.log(idxlyr1)
	createColumn(tblF,tblF2,Field2,"esriFieldTypeString",idxlyr1);
	for(let u=0;u<lyrsT[idxlyr1].length;u++)
	{
		let lyr;
		FieldString="";
		if(typeof(lyrsT[idxlyr1][u].options.center)!=="undefined")
										{
											let center = [lyrsT[idxlyr1][u].options.center.lng, lyrsT[idxlyr1][u].options.center.lat];
										let radius = lyrsT[idxlyr1][u].options.radius;

										let options = {steps: 128, units: 'meters'};
										let circle = turf.circle(center, radius, options);
										lyr=circle;
										}
										else
										{
											lyr=lyrsT[idxlyr1][u].toGeoJSON();
										}
				for(let v=0;v<lyrsT[idxlyr2].length;v++)
			{
				let lyr2;
				if(typeof(lyrsT[idxlyr2][v].options.center)!=="undefined")
										{
											let center2 = [lyrsT[idxlyr2][v].options.center.lng, lyrsT[idxlyr2][v].options.center.lat];
										let radius2 = lyrsT[idxlyr2][v].options.radius;

										let options2 = {steps: 128, units: 'meters'};
										let circle2 = turf.circle(center2, radius2, options2);
										lyr2=circle2;
										}
										else
										{
											lyr2=lyrsT[idxlyr2][v].toGeoJSON();
										}
				switch(idxMeth)
				{
					case 0:string=turf.booleanContains(lyr,lyr2);
						   break;
					case 1:string=turf.booleanIntersects(lyr,lyr2);
						   break;  
					case 2:string=turf.booleanWithin(lyr,lyr2);
						   break; 
					case 3:let centroid=turf.centroid(lyr);
						   string=turf.booleanPointInPolygon(centroid, lyr2);
						   break;
				}
				if(string)
				{
					FieldString=FieldString+"-"+lyrsT[idxlyr2][v].options.attributes[Field];
					
				}

			}
			if(FieldString!="")
			{
				FieldString=FieldString.substring(1);
			}
					rows[u].getElementsByTagName("td")[idxTbl.length-1].innerText=FieldString;
					lyrsT[idxlyr1][u].options.attributes[Field2]=FieldString;
			// let center=[lyrsT[0][u].getLatLng().lng,lyrsT[0][u].getLatLng().lat];
			// console.log(center)
			// let circle = turf.circle(center, radius, options);
			//  carteS="";
			// for(let v=0;v<lyrsT[2].length;v++)
			// {
			// 	if(turf.booleanIntersects(circle, lyrsT[2][v].toGeoJSON()))
			// 	{
			// 		carteS=carteS+"-"+lyrsT[2][v].options.attributes.Carte;
			// 		rows[u].getElementsByTagName("td")[28].innerText=carteS;
			// 		lyrsT[0][u].options.attributes.Carte2=carteS;
			// 	}

			// }
	}
}



function swalEdit2()
{
	fillOpt();
	async function swalAsync() {
						  
						  const { value: formValues } = await Swal.fire({
							title: 'features intersection',
							customClass: 'swal-height',
							html:'<h3>Source layer</h3>'+swalLyr +'<br>'+'<h3>Intersection Method</h3>'+IntMeth+'<h3>Intersection layer</h3>'+swalLyr2+'<br>'+checkBt1+checkBt2+'<div id="box"></div>',
							focusConfirm: false,
							// confirmButtonText:'<div id="confirmId">Ok</div>',
							didOpen: () => {
								
							  let swl=document.getElementById('lyrSwal');
									swl.innerHTML=chngLyr11();
									let swl3=document.getElementById('lyrSwal2');
									swl3.addEventListener("change", chngLyr22);

									let swl2=document.getElementById('chck2');
									swl2.addEventListener("click", chngLyr22);
										  },
							preConfirm: () => {
								let swl1=document.getElementById('lyrSwal');
								let swl2=document.getElementById('lyrSwal2');
								let swl1T=swl1.options[swl1.selectedIndex].text;
								let swl2T=swl2.options[swl2.selectedIndex].text;
								let iswl1=swl1.selectedIndex;
								let iswl2=swl2.selectedIndex;


								let im=document.getElementById("intMth");
								let ims=im.selectedIndex;
								let ms=im.options[im.selectedIndex].text;
								let chck1=document.getElementById("chck1").checked;
								// let chck2=document.getElementById("chck2").checked;
								let bx2=document.getElementById("box");
								let ibx22;
								if(typeof(bx2.getElementsByTagName("select")[0])!=="undefined")
								{
									let bx22=bx2.getElementsByTagName("select")[0];
									ibx22=bx22.options[bx22.selectedIndex].text;
								}

								intMethFun(iswl1,iswl2,swl1T,swl2T,ims,ms,chck1,ibx22);
								
				

				 

							}
						  })
						


						  }
						  swalAsync();
						  console.log(lyrsT[0])
}


let FieldName='<input type="text" id="FieldName" name="FieldName" required style="width:16vh;color:black">';

let FieldType='<select name="FieldType" class="form-control" id="FieldType"><option value="esriFieldTypeString">String</option><option value="esriFieldTypeDouble">Double</option><option value="esriFieldTypeInteger">Int</option><option value="esriFieldTypeDate">Date</option></select>';


function createColumn2(tab,tabSlc,idTab)
{
	async function swalAsync() {
						  
						  const { value: formValues } = await Swal.fire({
							title: 'Adding Field',
							customClass: 'swal-height',
							html:'<h3>Field Name</h3>'+FieldName +'<br>'+'<h3>Field Type</h3>'+FieldType,
							focusConfirm: false,
							// confirmButtonText:'<div id="confirmId">Ok</div>',
							// didOpen: () => {
								
							//   let swl=document.getElementById('lyrSwal');
							// 		swl.innerHTML=chngLyr11();
							// 		let swl3=document.getElementById('lyrSwal2');
							// 		swl3.addEventListener("change", chngLyr22);

							// 		let swl2=document.getElementById('chck2');
							// 		swl2.addEventListener("click", chngLyr22);
							// 			  },
							preConfirm: () => {
								let swl1=document.getElementById('FieldName');
								let swl2=document.getElementById('FieldType');
								let Fld=swl1.value;
								let Fld2=swl2.value;
								// let iswl1=swl1.selectedIndex;
								// let iswl2=swl2.selectedIndex;


								createColumn(tab,tabSlc,Fld,Fld2,idTab);
								
				

				 

							}
						  })
						


						  }
						  swalAsync();
}

function fillFld(id)
{
	let boxId=document.getElementById('box');
			
let slc = document.createElement("select");
 
		for(f of appendLyr2[id][1])
	{
		let opt = document.createElement("option");
					opt.value = f.value; // the index
					opt.text=f.innerText;
					slc.append(opt);
	}
	boxId.append(slc);
 
}




function createColumn3(tab,idTab)
{
	fillOpt();
	function getColor(d) {
    return d > 1050 ? '#800026' :
           d > 900  ? '#BD0026' :
           d > 750 ? '#E31A1C' :
           d > 600  ? '#FC4E2A' :
           d > 450   ? '#FD8D3C' :
           d > 300   ? '#FEB24C' :
           d > 150   ? '#FED976' :
                      '#FFEDA0';
}
function style(attr) {
    return {
        fillColor: getColor(attr),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}
	async function swalAsync() {
						  
						  const { value: formValues } = await Swal.fire({
							title: 'Heatmap Field',
							customClass: 'swal-height',
							html:'<h3>Field</h3>'+'<br>'+'<div id="box"></div>',
							focusConfirm: false,
							didOpen: () => {
								
							  fillFld(idTab);
										  },
							preConfirm: () => {
								let swl1=document.getElementById('box');
								swl1=swl1.getElementsByTagName("select")[0]
								let Fld=swl1.options[swl1.selectedIndex].text;
								let iswl1=swl1.selectedIndex;
								let dataF=[];
								let mxVal=maxVal(tab,iswl1)-1;
								// let lyr=lyrsT[idTab].toGeoJSON();
								// L.geoJson(lyr, {style: style}).addTo(map);
								for(let k of lyrsT[idTab])
								{
									////for polygon layers
									// let k2=L.polygon(k.getLatLngs());
									// k2.addTo(map);
									// k2.setStyle(style(parseFloat(k.options.attributes[Fld])));
									////for point layers
									let obj=[];
									
									obj[0]=k.getLatLng().lat;
									obj[1]=k.getLatLng().lng;
									obj[2]=parseFloat((parseFloat(k.options.attributes[Fld])/mxVal).toFixed(2));
									dataF.push(obj);
								}
								
								let heat = L.heatLayer(dataF, {radius: 10,gradient:{0.00: 'green', 0.50: 'yellow', 1.00: 'red'}}).addTo(map);
								map.on('zoomstart', function(ev) {
									let currentZoom=map.getZoom();
									console.log(currentZoom)
									let rad;
									if(currentZoom<=7)
									{
										rad=10;
									}
									else
									{
										rad=(currentZoom-6)*10;
									}
								// zoom level changed... adjust heatmap layer options!
								heat.setOptions({
									radius: rad,
									max: 1.0,
									blur: 15,              
									gradient: {
										0.00: 'green',
										0.50: 'yellow',
										1.00: 'red'
									},
									minOpacity: 0.7
								});
								// render the new options
								heat.redraw();
							});

							

								//// createColumn(tab,tabSlc,Fld,idTab);
								
				

				 

							}
						  })
						


						  }
						  swalAsync();
}

let l=document.getElementById("interp")
l.addEventListener('click',function(){

	let points=[];
	
	for(let k of lyrsT[0])
	{
	let chart;
	points.push([k.getLatLng().lat,k.getLatLng().lng,parseFloat(k.options.attributes.FID)]);
    var scoresDiff = [
      k.options.attributes.FID,
      k.options.attributes.population
    ];
    chart = L.minichart([k.getLatLng().lat,k.getLatLng().lng], {type:'pie',data: scoresDiff, maxValues:[1322,85000],
    width:40, height:40,
	labels:"auto",
    colors: ["#7A8B99", "#91ADC2", "#A9DDD6"]});
    map.addLayer(chart) ;
  

								}
								console.log(points)
	var idw = L.idwLayer(points, {opacity: 0.3, cellSize: 10, exp: 3, max: 1322});
	idw.addTo(map);
	console.log(idw)
})




	</script>
</body>
</html>
